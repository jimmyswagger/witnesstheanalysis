## Finals ##
# Not needed - just filter from all games 


finals <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/airecs/aifinals.csv", header=TRUE, sep=";")
attach (finals)

# pull numbers from before a decimal place 

finals <- finals %>% dplyr::mutate(goalsa = str_extract(scorea, "^[^.]+"))

# pull numbers from after a decimal place 
finals <- finals %>% dplyr::mutate(pointsa = str_extract(scorea, "[^.]+$"))

# team b
finals <- finals %>% dplyr::mutate(goalsb = str_extract(scoreb, "^[^.]+"))

# pull numbers from after a decimal place 
finals <- finals %>% dplyr::mutate(pointsb = str_extract(scoreb, "[^.]+$"))

# change to numeric

finals$goalsa <- as.numeric(finals$goalsa)
finals$goalsb <- as.numeric(finals$goalsb)
finals$pointsa <- as.numeric(finals$pointsa)
finals$pointsb <- as.numeric(finals$pointsb)

# goals to 3 points - figure out Goals = 5 points etc - ifelse <year then *5 if not *3 etc

#finals <- finals%>%group_by(teama)%>%mutate(totgolsa = (goalsa * 3), totgolsb = (goalsb * 3), totscrsa = (totgolsa + pointsa), totscrsb = (totgolsb + pointsb))

# Find out year of change

finals <- finals%>%group_by(teama)%>%mutate(totgolsa = ifelse(champyear < 1893, goalsa * 5, goalsa *3), totgolsb = ifelse(champyear < 1893, goalsb * 5, goalsb *3), 
                                            totscrsa = (totgolsa + pointsa), totscrsb = (totgolsb + pointsb))

# won/loss
finals <- finals%>%group_by(teama) %>% mutate(won = ifelse(totscrsa > totscrsb , teama, "draw"))
finals <- finals%>%group_by(teama) %>% mutate(loss = ifelse(totscrsb < totscrsa , teamb, "draw"))

# change wo na's to nan
na_to_space <- function(x) ifelse(is.na(x),"NAN",x)
finals <- finals %>% mutate_if(.predicate = is.character,.funs = na_to_space)

# replace na's with 0
finals [is.na(finals)] <- 0


# change nan to win/loss team
finals <- finals %>%group_by(teama) %>% mutate(won= ifelse(won == "NAN",teama,won), loss = ifelse(loss == "NAN",teamb,loss))

finals <- finals %>% mutate(Win_Marg =(abs(totscrsa - totscrsb)))
