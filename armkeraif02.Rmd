---
title: "Armagh (1.12) vs Kerry (0.14)"
output:
  html_document:
    theme: cosmo
    toc: yes
    toc_float: yes
---

All Ireland Football Final 2002

22 September 2002

Croke Park, Dublin

Total Game Time: 76 mins

1st Half: 38 mins 

2nd Half: 38 mins



```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, options(knitr.kable.NA = ''))

#Load packages and pitch
#install.packages('digest', repos='http://cran.us.r-project.org')
library (digest)
library(flexdashboard)
library(dplyr)
library(deldir)
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(knitr)
library(rmarkdown)
library(kableExtra)
library(data.table)
library(RColorBrewer)
library(gridExtra)
library(igraph)
library(tidyverse)
library(treemap)
library(plotly)
library(networkD3)
library (curl)
library(formattable)
library(grid)
library(yaml)
library (tinytex)
library (ggforce)
library (waffle)
library (ggnewscale)
library(factoextra)
library(cluster)
library(tidyquant)
library(parallel)
library(ggExtra)

```

```{r}

match <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/armkeraif02/matcharmkeraif02.csv", header=TRUE, sep=";")
attach (match)

teamsheet <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/armkeraif02/teamsheetarmkeraif02.csv", header=TRUE, sep=";")
attach (teamsheet)

#create a Sht Prs df 

shdf <- match %>%filter(Action %in% c("Sht Prs"))

#delete Sht Prs from match 

start = 	0
p1 = 	1144.645639
ht = 	2289.291278
p3 = 	3436.593595



match <- match %>% mutate(Teamnum =ifelse(Team == "Armagh","A","B"))

match <- match%>% mutate(half =ifelse(time <= ht,1, ifelse(time > ht,2,"time")))

match <- match %>%mutate(Areax=ifelse(Teamnum == "A" & half == 1,X,ifelse(Teamnum == "B" & half == 1,144-X
,ifelse(Teamnum == "A" & half == 2,144-X,ifelse(Teamnum == "B" & half == 2,X,X)))))


match <-match %>%mutate(Areay=ifelse(Teamnum == "A" & half == 1,Y,ifelse(Teamnum == "B" & half == 1,88-Y
,ifelse(Teamnum == "A" & half == 2,88-Y,ifelse(Teamnum == "B" & half == 2,Y,Y)))))



match <- match %>% mutate(Zone =
ifelse(Areax >=0 & Areax <=19.99& Areay >=0 & Areay <=17.99,1, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=18 & Areay <=35.99,2, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=36 & Areay <=61.99,3, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=62 & Areay <=79.99,4, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=80 & Areay <=98,5, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=0 & Areay <=17.99,6, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=18 & Areay <=35.99,7, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=36 & Areay <=61.99,8, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=62 & Areay <=79.99,9, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=80 & Areay <=98,10, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=0 & Areay <=17.99,11, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=18 & Areay <=35.99,12, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=36 & Areay <=61.99,13, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=62 & Areay <=79.99,14, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=80 & Areay <=98,15, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=0 & Areay <=17.99,16, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=18 & Areay <=35.99,17, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=36 & Areay <=61.99,18, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=62 & Areay <=79.99,19, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=80 & Areay <=98,20, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=0 & Areay <=17.99,21, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=18 & Areay <=35.99,22, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=36 & Areay <=61.99,23, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=62 & Areay <=79.99,24, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=80 & Areay <=98,25, 
ifelse(Areax >=124 & Areax <=144& Areay >=0 & Areay <=17.99,26, 
ifelse(Areax >=124 & Areax <=144& Areay >=18 & Areay <=35.99,27, 
ifelse(Areax >=124 & Areax <=144& Areay >=36 & Areay <=61.99,28, 
ifelse(Areax >=124 & Areax <=144& Areay >=62 & Areay <=79.99,29, 
ifelse(Areax >=124 & Areax <=144& Areay >=80 & Areay <=98,30
,"No_Zone")))))))))))))))))))))))))))))))



match = match %>% 
   unite(plyid, Team, Player, sep = " ", remove = FALSE)

sets <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/sets.csv", header=TRUE, sep=";")
attach (sets)


teamsheet = teamsheet %>% 
   unite(plyid, Team, ply, sep = " ", remove = FALSE)
   
zonetext <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/zonetext.csv", header=TRUE, sep=";")
attach (zonetext) 

match <-match %>%
    mutate(subset = VLOOKUP(Action, sets, Action, subset), main = VLOOKUP(Action, sets, Action, main),plyname = VLOOKUP(plyid,teamsheet,plyid, name))
    
match = match %>% 
   unite(plylab, Player, Action, sep = " ", remove = FALSE)


   

#teamcnts <- read.csv(file="c:/Users/donag/OneDrive/Spreadsheet fun/PA Analytics/PA Template/newplan/passlinenewplan.csv", header=TRUE, sep=";")
#attach (teamcnts)

teamcnts <- match%>%group_by(Teamnum)%>% mutate(possno = cumsum(main %in% c("PW","Ko")|Action %in% c("45 Shot Left","45 Shot Right","45 Pass")))

teamcnts <- teamcnts%>%group_by(Teamnum)%>% mutate(phaseno = cumsum(main %in% c("PW","Ko","Pass Rs","Shot Rs")))

teamcnts <-teamcnts%>% unite(poss, Teamnum, possno,sep = "",  remove = FALSE)

teamcnts <-teamcnts%>% unite(Phase, Teamnum, phaseno,sep = "",  remove = FALSE)

teamcnts <- teamcnts%>% mutate(period =ifelse(time < p1,1, ifelse(time > p1 & time <=ht ,2, ifelse(time > ht & time <= p3,3,ifelse(time > p3,4,"Time")))))

teamcnts$Zone <- as.integer(teamcnts$Zone)

teamcnts <- teamcnts %>% mutate(Pitch_Area =ifelse(Zone >0 & Zone  <=5 ,"In_Def", ifelse(Zone >= 6 & Zone  <=10 ,"Mid_Def", ifelse(Zone >=11 & Zone <=15, "Out_Def",ifelse(Zone  >=16 & Zone <=20,"Out_Att",ifelse(Zone  >=21 & Zone <=25, "Mid_Att",ifelse(Zone >=26 & Zone <=30, "In_Att","Draw")))))))

teamcnts <- teamcnts %>% mutate(Pitch_Area_No =ifelse(Zone >0 & Zone  <=5 ,"1", ifelse(Zone >= 6 & Zone  <=10 ,"2", ifelse(Zone >=11 & Zone <=15, "3",ifelse(Zone  >=16 & Zone <=20,"4",ifelse(Zone  >=21 & Zone <=25, "5",ifelse(Zone >=26 & Zone <=30, "6","Draw")))))))

teamcnts <-teamcnts%>%select (period,possno,poss, phaseno, Phase, Teamnum, Team, Player, plyname,Action, Areax, Areay, plylab, subset, Zone, time, main, Pitch_Area,Pitch_Area_No)



pass <-teamcnts

pass$period <- as.integer(pass$period)
pass$poss <- as.factor(pass$poss)
pass$Phase <- as.factor(pass$Phase)
pass$Teamnum <- as.factor(pass$Teamnum)
pass$subset <- as.factor(pass$subset)


shdfposs <- pass %>%filter(Action %in% c("Sht Prs"))


#if zones need changing 
shdfposs  <- shdfposs %>% mutate (diffsh = ifelse(Zone == 30,1, ifelse(Zone  == 29,2, ifelse(Zone == 28,3,shdfposs$Zone))))

#shdfposs  <-shdfposs %>%mutate(shotdiff = VLOOKUP(time,shdf,time, Zone))


pass <- pass[pass$Action!="Sht Prs", ]
pass <- pass[pass$Action!="Red Card", ]


#write.csv2(pass, "tallylog.csv")



#Run - w/ own and opp brks
passR <- pass[pass$main!="Def Act", ]
passR <- passR[passR$main!="Free Loss", ]
passR <- passR[passR$main!="Tck Def", ]
passR <- passR[passR$main!="Tck End", ]
passR <- passR[passR$main!="Sht Prs", ]
passR <- passR[passR$main!="Spoil Off", ]

passR <- passR%>%select(period,possno,poss,Teamnum,Phase,phaseno,Team,Player,Action,Areax,Areay,plylab,subset,Zone,time,main,Pitch_Area)

passRc <- passR 

#passRc <- passR %>% filter (poss =="A1"|poss == "B1"|poss == "A2")

oddps <- passRc[seq(1, nrow(passRc), 1),]
colnames(oddps) <- c("period","possno","poss","Teamnum","phaseno","Phase","Team","Player","Action","Areax","Areay","plylab","subset","Zone","time","main","Pitch_Area")
evenps <- passRc[seq(2, nrow(passRc), 1),]
colnames(evenps) <- c("periodoc","possnooc","possoc","Teamnumoc","phasenooc","Phaseoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc","Pitch_End")

#add column to each data frame with row number
oddps$number <- row.names(oddps)
evenps$number <- row.names(evenps)

run <- merge(oddps, evenps, by = "number", all = TRUE)

run$number <- as.numeric(run$number)

run  <- run %>% arrange(number)

library(plyr)

run  <- rename(run, c( Areaxoc = "xend", Areayoc = "yend",Zone = "zone",  Zoneoc = "zoneoc"))

detach(package:plyr)

run <-run %>% mutate(teamsame = ifelse(Team == Teamoc ,"Y","N"))
run <-run %>% mutate(keep = ifelse(main =="Free Won" ,"N",ifelse(main == "PosReg","N",ifelse(Action == "Loss Kp 45W","N",ifelse(Action == "Ko Fk Won Off","N",run$teamsame)))))

run <-run %>% mutate(segtypea = ifelse(Action =="Hp","Hp",ifelse(Action  == "Kp Left","Kp Left",ifelse(Action  == "Kp Right","Kp Right",
ifelse(Action  == "Ko","Ko",ifelse(Action == "Fk Pass","Fk Pass",ifelse(Action  == "Sl Pass","Sl Pass"
,ifelse(Action  == "Brk Own","Brk Own",ifelse(Action  == "Opp Brk","Opp Brk",ifelse(Action  == "koBrk Own","KoBrk Own",ifelse(Action  == "Opp KoBrk","Opp KoBrk",ifelse(Action  == "PW Fk Pass","Fk Pass",ifelse(Action  == "Pw Sl Pass","Sl Pass","Carry")))))))))))))

run <-run %>% mutate(segtype = ifelse(subsetoc =="Scr Op","Score",ifelse(subsetoc  == "Ms Op","Miss",ifelse(subsetoc  == "Scr Rs","Scr Rs",ifelse(subsetoc  == "Ms Rs","Ms Rs",
ifelse(subsetoc == "Ko ToL","Ko ToL",ifelse(subsetoc  == "Pass ToL","Pass ToL",run$segtypea)))))))

segtype <- c("Hp","Carry","Kp Right","Score","Ko","Ko ToL","Pass ToL","Miss","Kp Left","Fk Pass","Sl Pass","Scr Rs","Ms Rs",
"Opp Brk","Brk Own","Opp KoBrk","KoBrk Own")

seg<- c("1",	"2",	"3",	"4",	"5",	"6",	"7",	"8",	"9",	"10",	
"10",	"11",	"12",	"13",	"14",	"15",	"16")

segments <- data.frame(segtype ,seg)

run  <-run  %>%
    mutate(seg = VLOOKUP(segtype,segments, segtype, seg))

run <-run %>% mutate(same = ifelse(zone == zoneoc ,"Y", "N"))

run <-run %>% mutate(time_diff = (timeoc-time), dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)),ms = (dist/time_diff), vec = (atan2(yend-Areay,xend - Areax)*180/pi))

#create dataframe for line colours
timedur <- run %>% group_by(poss) %>% filter (keep =="Y") %>%   summarize (dur = sum(time_diff))

run  <-run  %>% mutate(timedur = VLOOKUP(poss,timedur, poss, dur))

run <-run %>% mutate(linecol = ifelse(timedur >0 & timedur  <=9.99 ,1, ifelse(timedur  >=10 & timedur  <=19.99, 2,ifelse(timedur >=20 & timedur  <=29.99, 3,
ifelse(timedur >=30 & timedur  <=39.99, 4 ,ifelse(timedur >=40 & timedur  <=49.99, 5 ,
ifelse(timedur >=50 & timedur  <=59.99, 6,ifelse(timedur >=60 & timedur  <=69.99, 7,ifelse(timedur >=70, 8,10)))))))))

run <-run %>% mutate(line_time = ifelse(linecol == 1 ,"0-9", ifelse(linecol == 2, "10-19",ifelse(linecol == 3,"20-29" ,
ifelse(linecol == 4, "30-39" ,ifelse(linecol == 5, "40-49" ,
ifelse(linecol == 6, "50-59",ifelse(linecol == 7, "60-69",ifelse(linecol == 8, "70+",10)))))))))

#Add phase time colours
phs_time <- run %>% group_by(phaseno) %>% filter (keep =="Y") %>% summarize (phs_time = sum(time_diff))

run  <-run  %>% mutate(phs_time = VLOOKUP(phaseno,phs_time,phaseno,phs_time))

run <-run %>% mutate(phasecol = ifelse(phs_time >0 & phs_time  <=9.99 ,1, ifelse(phs_time  >=10 & phs_time  <=19.99, 2,ifelse(phs_time >=20 & phs_time  <=29.99, 3,
ifelse(phs_time >=30 & phs_time  <=39.99, 4 ,ifelse(phs_time >=40 & phs_time  <=49.99, 5 ,
ifelse(phs_time >=50 & phs_time  <=59.99, 6,ifelse(phs_time >=60 & phs_time  <=69.99, 7,ifelse(phs_time >=70, 8,10)))))))))

run <-run %>% mutate(phs_time_line = ifelse(phasecol == 1 ,"0-9", ifelse(phasecol == 2, "10-19",ifelse(phasecol == 3,"20-29" ,
ifelse(phasecol == 4, "30-39" ,ifelse(phasecol == 5, "40-49" ,
ifelse(phasecol == 6, "50-59",ifelse(phasecol == 7, "60-69",ifelse(phasecol == 8, "70+",10)))))))))


#Add ms time colours

run <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

run <- run %>% mutate(RunDir = ifelse(vec_col == "1" ,"swr", ifelse(vec_col == 2 ,"for",ifelse(vec_col == 3 ,"for",
ifelse(vec_col == 4 ,"for",ifelse(vec_col == 5 ,"swl",ifelse(vec_col == 6 ,"swl",
ifelse(vec_col == 7 ,"bw",ifelse(vec_col == 8 ,"bw",ifelse(vec_col == 9 ,"bw",ifelse(vec_col == 10 ,"swr",ifelse(vec_col == "None","None","None"))))))))))))

passlinepos <- run %>%group_by (Team, phaseno) %>%
  summarize(ms_ave_phase = mean(ms, na.rm = TRUE))

run <-run  %>% mutate(ms_time = VLOOKUP(phaseno,passlinepos,phaseno,ms_ave_phase))

run <-run %>% mutate(mscol = ifelse(ms_time  >0 & ms_time <= 2.99 ,1, ifelse(ms_time  >=3 & ms_time  <=5.99, 2,ifelse(ms_time >=6 & ms_time  <=8.99, 3,
ifelse(ms_time >=9 & ms_time <=11.99, 4,ifelse(ms_time >= 12 & ms_time <=14.99, 5 ,
ifelse(ms_time >=15.00 & ms_time <=17.99, 6,ifelse(ms_time >= 18 & ms_time <=20.99, 7,ifelse(ms_time >=21, 8,10)))))))))

run <-run %>% mutate(ms_time_line = ifelse(mscol == 1 ,"0-2.99", ifelse(mscol == 2, "3-5.99",ifelse(mscol == 3,"6-8.99",
ifelse(mscol == 4, "9-11.99" ,ifelse(mscol == 5, "12-14.99",
ifelse(mscol == 6, "15-17.99",ifelse(mscol == 7, "18-20.99",ifelse(mscol == 8, ">21",10)))))))))

#write.csv(run, "run.csv")


#Phasesop

#Shot Distance & Details - Check what difference shot rs makes as not showing for ko's

runa <- run %>% filter (main %in% c("Shot Op"))%>%select(poss,Player, Action,Areax,Areay,vec)

runShtd <-runa%>%mutate (Shot_Dist =(sqrt((144 - Areax)^2+ (49 - Areay)^2)))%>%select(poss,Player, Action,Areax,Areay, Shot_Dist,vec)

#Ko Dist y Ko Rec

runakod <- run %>% filter (main %in% c("Ko"))

KOuts <- runakod %>% mutate (Ko_Dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)))%>%select (poss, Ko_Dist,mainoc,zoneoc,Pitch_End)

#Ko Time

runa <- run %>% filter (mainoc %in% c("Ko"))

runa$time <- as.numeric(runa$time)
runa$timeoc <- as.numeric(runa$timeoc)

Ko_Time <- runa%>% mutate(Ko_Time = (timeoc - time))%>%select (possoc, Ko_Time)

#Totals 
totrun <- run %>% group_by(poss) %>% filter (keep =="Y") %>%   summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), 
m_s = sum(tot_dist/dur))

#phasesop

#pass <- pass[pass$Action!="Half Time", ]

#Half Time

phaseSoP <- pass %>%filter (main %in% c("PW", "Ko", "Pass Rs","Shot Rs", "Shot Op Oc", "Shot Rs Oc","ToL","Free Won","Off Foul Won","Off Sl Won","Half Time", "Full Time")|
Action %in% c("45 Shot Right","45 Shot Left","45 Pass","Loss Kp SlW","Loss Hp SlW","Loss Ko SlW","Ko Fk Won Off", "Att Mk Won", "Ko Mk Won"))

phaseSoP <- phaseSoP%>%select(-plyname)



oddps <- phaseSoP [seq(1, nrow(phaseSoP), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","plylab","subset","Zone","time","main","Pitch_Area")
evenps <- phaseSoP[seq(2, nrow(phaseSoP), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc", "Pitch_Areaoc")

phaseSoP <- bind_cols(oddps, evenps) 
phaseSoP <- phaseSoP %>%select("period","possno","poss","Phase","Teamnum","Team","Player","Action","Zone","Areax","Areay","plylab","subset","main","time","Pitch_Area",
"possoc","Phaseoc","Actionoc","Zoneoc","Areaxoc","Areayoc","plylaboc","subsetoc","mainoc","timeoc","Pitch_Areaoc")

phaseSoP  <-phaseSoP %>% mutate(secs =(timeoc - time))

phaseSoP <- phaseSoP%>% mutate(line_col = ifelse(secs >=0 & secs  <9.49 ,1, ifelse(secs  >=9.5 & secs  <19.49, 2,ifelse(secs >=19.5 & secs  <29.49, 3,ifelse(secs >=29.5 & secs  <39.49, 4 ,ifelse(secs >=39.5 & secs  <50.49, 5 ,ifelse(secs >=49.5 & secs  <60.49, 6,ifelse(secs >=59.5 & secs  <70.49, 7,ifelse(secs >=70.5, 8,10)))))))))

phaseSoP <- phaseSoP %>% mutate(line_time = ifelse(line_col  == 1 ,"0-9", ifelse(line_col  == 2, "10-19",ifelse(line_col  == 3,"20-29" ,
ifelse(line_col== 4, "30-39" ,ifelse(line_col == 5, "40-49" ,
ifelse(line_col  == 6, "50-59",ifelse(line_col  == 7, "60-69",ifelse(line_col  == 8, "70+",10)))))))))

phaseSoP <- phaseSoP %>% mutate(Entry_45 = ifelse(Areax <99.5 & Areaxoc >99.6 ,"Y", "N"))

#passSoP <- passSoP %>%select (-phaseno,-Phase, -periodoc,-possnooc, -phasenooc,-Phaseoc,-Teamnumoc,-Teamoc)

phaseSoP  <- phaseSoP  %>% mutate(passno = VLOOKUP(poss,totrun, poss, passes),tot_dist = VLOOKUP(poss,totrun, poss, tot_dist),m_s = VLOOKUP(poss,totrun, poss, m_s)
,Ko_Time  = VLOOKUP(poss,Ko_Time, possoc, Ko_Time),plyshot  = VLOOKUP(poss,runShtd, poss, Player),shot_type  = VLOOKUP(poss,runShtd, poss, Action)
,shotx  = VLOOKUP(poss,runShtd, poss,Areax),shoty  = VLOOKUP(poss,runShtd, poss,Areay), Shot_Dist  = VLOOKUP(poss,runShtd, poss,Shot_Dist), Shot_vec = VLOOKUP(poss,runShtd, poss,vec)
,Ko_Dist  = VLOOKUP(poss,KOuts, poss,Ko_Dist), Ko_Oc  = VLOOKUP(poss,KOuts, poss,mainoc),Pitch_Area_Ko  = VLOOKUP(poss,KOuts, poss,Pitch_End)
,Ko_Zone_Rec  = VLOOKUP(poss,KOuts, poss,zoneoc))

phasesop <-phaseSoP %>% mutate(Pitch_Area_Rec = ifelse(main == "Ko",Pitch_Area_Ko,Pitch_Area))

phasesop <- phasesop %>% mutate(Pitch_Area_No =ifelse(Pitch_Area_Rec == "In_Def" ,"1", ifelse(Pitch_Area_Rec == "Mid_Def","2", ifelse(Pitch_Area_Rec == "Out_Def", "3",ifelse(Pitch_Area_Rec == "Out_Att","4",ifelse(Pitch_Area_Rec =="Mid_Att","5",ifelse(Pitch_Area_Rec == "In_Att", "6","Draw")))))))


#write.csv(phasesop, "sop2.csv")
#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")


#SoP


#Shot Distance & Details - Check what difference shot rs makes as not showing for ko's

runa <- run %>% filter (main %in% c("Shot Op"))%>%select(poss,Player, Action,Areax,Areay,vec)

runShtd <-runa%>%mutate (Shot_Dist =(sqrt((144 - Areax)^2+ (49 - Areay)^2)))%>%select(poss,Player, Action,Areax,Areay, Shot_Dist,vec)

#Ko Dist y Ko Rec

runakod <- run %>% filter (main %in% c("Ko"))

KOuts <- runakod %>% mutate (Ko_Dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)))%>%select (poss, Ko_Dist,mainoc,zoneoc,Pitch_End)

#Ko Time

runa <- run %>% filter (mainoc %in% c("Ko"))

runa$time <- as.numeric(runa$time)
runa$timeoc <- as.numeric(runa$timeoc)

Ko_Time <- runa%>% mutate(Ko_Time = (timeoc - time))%>%select (possoc, Ko_Time)

#Totals 
totrun <- run %>% group_by(poss) %>% filter (keep =="Y") %>%   summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

#Time
phasetime  <-phasesop %>% group_by(poss) %>% summarise(phtime = sum(secs))

#phasetime$phtime <- as.integer(phasetime$phtime)

#time$phtime <- as.numeric(as.character(time$phtime))

#phasesop <- phasesop[phasesop$poss!="B98", ]

#SoP

passSoP <- pass %>%filter (main %in% c("PW", "Ko", "Shot Op Oc", "Shot Rs Oc","ToL", "Half Time", "Full Time")|Action %in% c("45 Shot Right","45 Shot Left","45 Pass","Off 45 Won"))

passSoP <- passSoP%>%select(-plyname)

oddps <- passSoP [seq(1, nrow(passSoP), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","plylab","subset","Zone","time","main","Pitch_Area")
evenps <- passSoP[seq(2, nrow(passSoP), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc", "Pitch_Areaoc")
passSoP <- bind_cols(oddps, evenps) 
passSoP <- passSoP%>%select("period","possno","poss","Phase","Teamnum","Team","Player","Action","Zone","Areax","Areay","plylab","subset","main","time","Pitch_Area",
"possoc","Phaseoc","Actionoc","Zoneoc","Areaxoc","Areayoc","plylaboc","subsetoc","mainoc","timeoc","Pitch_Areaoc")


#this will become a vlookup from phase sop
passSoP  <-passSoP %>% mutate(tot_poss_secs =(timeoc - time))

passSoP  <- passSoP %>% mutate(secs = VLOOKUP(poss,phasetime, poss, phtime))

passSoP <-passSoP %>% mutate(line_col = ifelse(secs >=0 & secs  <9.49 ,1, ifelse(secs  >=9.5 & secs  <19.49, 2,ifelse(secs >=19.5 & secs  <29.49, 3,ifelse(secs >=29.5 & secs  <39.49, 4 ,ifelse(secs >=39.5 & secs  <50.49, 5 ,ifelse(secs >=49.5 & secs  <60.49, 6,ifelse(secs >=59.5 & secs  <70.49, 7,ifelse(secs >=70.5, 8,10)))))))))

passSoP <- passSoP %>% mutate(line_time = ifelse(line_col  == 1 ,"0-9", ifelse(line_col  == 2, "10-19",ifelse(line_col  == 3,"20-29" ,
ifelse(line_col== 4, "30-39" ,ifelse(line_col == 5, "40-49" ,
ifelse(line_col  == 6, "50-59",ifelse(line_col  == 7, "60-69",ifelse(line_col  == 8, "70+",10)))))))))

passSoP <- passSoP %>% mutate(Entry_45 = ifelse(Areax <99.5 & Areaxoc >99.6 ,"Y", "N"))

#passSoP <- passSoP %>%select (-phaseno,-Phase, -periodoc,-possnooc, -phasenooc,-Phaseoc,-Teamnumoc,-Teamoc)

passSoP  <- passSoP  %>% mutate(passno = VLOOKUP(poss,totrun, poss, passes),tot_dist = VLOOKUP(poss,totrun, poss, tot_dist),m_s = VLOOKUP(poss,totrun, poss, m_s)
,Ko_Time  = VLOOKUP(poss,Ko_Time, possoc, Ko_Time),plyshot  = VLOOKUP(poss,runShtd, poss, Player),shot_type  = VLOOKUP(poss,runShtd, poss, Action)
,shotx  = VLOOKUP(poss,runShtd, poss,Areax),shoty  = VLOOKUP(poss,runShtd, poss,Areay), Shot_Dist  = VLOOKUP(poss,runShtd, poss,Shot_Dist), Shot_vec = VLOOKUP(poss,runShtd, poss,vec)
,Ko_Dist  = VLOOKUP(poss,KOuts, poss,Ko_Dist), Ko_Oc  = VLOOKUP(poss,KOuts, poss,mainoc),Pitch_Area_Ko  = VLOOKUP(poss,KOuts, poss,Pitch_End)
,Ko_Zone_Rec  = VLOOKUP(poss,KOuts, poss,zoneoc))

passSoP <-passSoP %>% mutate(Pitch_Area_Rec = ifelse(main == "Ko",Pitch_Area_Ko,Pitch_Area))

passSoP <- passSoP %>% mutate(Pitch_Area_No =ifelse(Pitch_Area_Rec == "In_Def" ,"1", ifelse(Pitch_Area_Rec == "Mid_Def","2", ifelse(Pitch_Area_Rec == "Out_Def", "3",ifelse(Pitch_Area_Rec == "Out_Att","4",ifelse(Pitch_Area_Rec =="Mid_Att","5",ifelse(Pitch_Area_Rec == "In_Att", "6","Draw")))))))


sop  <- passSoP  

#write.csv2(sop, "sop.csv")
#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")

#Shots



shotsall <- pass%>%group_by(Team,poss) %>% filter(main =="Shot Op Oc"|main =="Shot Rs Oc"|main == "Shot Op"|main =="Shot Rs")%>%select(-plyname)

oddps <- shotsall[seq(1, nrow(shotsall), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","plylab","subset","Zone","time","main")
evenps <- shotsall[seq(2, nrow(shotsall), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc")
shotsall <- bind_cols(oddps, evenps) 
shotsall <- shotsall%>%select("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Zone","Areax","Areay","plylab","subset"
,"Actionoc","Zoneoc","Areaxoc","Areayoc","plylaboc","subsetoc","timeoc")

scores = shotsall %>% 
   unite(Shot_lab, plylab, timeoc, sep = " ", remove = FALSE)

scores <- scores%>% mutate(scoreA = ifelse(Actionoc == "Goal" & Teamnum == "A",3,ifelse(Actionoc == "Pk Goal" & Teamnum == "A",3,ifelse(Actionoc == "Mk Point" & Teamnum == "A",1,ifelse(Actionoc == "Fk Point"& Teamnum == "A",1, ifelse(Actionoc == "Point"& Teamnum == "A",1, ifelse(Actionoc == "45 Point" & Teamnum == "A",1,0)))))))

scores <- scores%>% mutate(scoreB = ifelse(Actionoc == "Goal" & Teamnum == "B",3,ifelse(Actionoc == "Pk Goal" & Teamnum == "B",3,ifelse(Actionoc == "Mk Point" & Teamnum == "B",1,ifelse(Actionoc == "Fk Point"& Teamnum == "B",1, ifelse(Actionoc == "Point"& Teamnum == "B",1, ifelse(Actionoc == "45 Point" & Teamnum == "B",1,0)))))))

scored <- scores  %>%group_by(Teamnum)%>% mutate(Tot_ScrA = cumsum(scoreA), Tot_ScrB = cumsum(scoreB))  

scored <- as.data.frame(scored) %>% 
  dplyr::mutate(Tot_ScrA = ifelse(Tot_ScrA == 0, NA, Tot_ScrA)) %>% 
  tidyr::fill(Tot_ScrA, .direction = c("updown"))

scored <- as.data.frame(scored) %>% 
  dplyr::mutate(Tot_ScrB = ifelse(Tot_ScrB == 0, NA, Tot_ScrB)) %>% 
  tidyr::fill(Tot_ScrB, .direction = c("updown"))

scored$number <- row.names(scored)


scored <- scored%>% mutate(Tot_ScrA = ifelse(scoreA == "0" & number %in% c("1","2"),0,scored$Tot_ScrA))

scored <- scored%>% mutate(Tot_ScrB = ifelse(scoreB == "0" & number %in% c("1","2","3"),0,scored$Tot_ScrB))

scored <- scored %>%group_by(Teamnum)%>% mutate(diff = (Tot_ScrA- Tot_ScrB))  

scored <- scored %>%group_by(Teamnum)%>% mutate(abdiff = (abs(Tot_ScrA- Tot_ScrB)))

scores <-scored %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

#Add shot difficulty

scores  <- scores %>% mutate(shdf = VLOOKUP(poss,shdfposs,poss,diffsh))

#write.csv2(scores, "scores.csv")
#write.csv2(oddps, "oddpsscrs.csv")
#write.csv2(evenps, "evenpsscrs.csv")



#Player Stats
#Team A

plystatsAA <- teamsheet%>%filter(Teamnum =="A") %>%select( Teamnum, Team, plytime, ply, name, Player,Areax,Areay)

plystatsAA <- plystatsAA %>% arrange(ply)
#plystatsA

passA <- pass %>%filter (Teamnum == "A", Action != "Opp Brk")

playersts <- passA %>%group_by(Player)%>%summarize(PW =sum(main == "PW"),Pass =sum(main == "Pass Op"),Rec =sum(main == "Rec Op"),
KoRec =sum(main == "Ko Rec"),OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"),RsShot =sum(main == "Shot Rs"),RsScr =sum(subset == "Scr Rs"),
Poss_Lost =sum(main == "ToL"),
Fk_Won =sum(main == "Free Won"),Fk_Lost =sum(main == "Free Loss"),Spoils =sum(main == "Def Act"), OBP = (PW + Rec), Pass_Loss = sum(subset == "Pass Loss"), Comp_Pass = (Pass - Pass_Loss))

#plystatsAA <- plystatsAA[plystatsAA$ply!="20", ]

statsA <- bind_cols (plystatsAA,playersts)

statsA <- statsA %>% select(-Player...9)

statsA [is.na(statsA)] <- 0

statsA <- statsA %>% mutate(totPW = sum(PW), PWp = (PW/totPW*100), totPass = sum(Pass), Passp = (Pass/totPass*100), totRec = sum(Rec), Recp = (Rec/totRec*100),  totKoRec = sum(KoRec), KoRecp = (KoRec/totKoRec*100), 
totOpShot = sum(OpShot), OpShotp = (OpShot/totOpShot*100), totOpScr = sum(OpScr), OpScrp = (OpScr/totOpScr*100),
totRsShot = sum(RsShot), RsShotp = (RsShot/totRsShot*100), totRsScr = sum(RsScr), RsScrp = (RsScr/totRsScr*100),
totPoss_Lost = sum(Poss_Lost), Poss_Lostp = (Poss_Lost/totPoss_Lost*100), 
totFk_Won = sum(Fk_Won), Fk_Wonp = (Fk_Won/totFk_Won*100), totFk_Lost = sum(Fk_Lost), Fk_Lostp = (Fk_Lost/totFk_Lost*100), totSpoils = sum(Spoils), Spoilsp = (Spoils/totSpoils*100),
totOBP = sum(OBP), OBPp = (OBP/totOBP*100), totCP = sum(Comp_Pass), CPp = (Comp_Pass/totCP*100))

statsA <- statsA %>% mutate(PWamin = (PW/plytime),Passamin = (Pass/plytime), Recamin = (Rec/plytime), KoRecamin = (KoRec/plytime), 
OpShotamin = (OpShot/plytime),OpScramin = (OpScr/plytime),
RsShotamin = (RsShot/plytime),RsScramin = (RsScr/plytime),
Poss_Lostamin = (Poss_Lost/plytime), 
Fk_Wonamin = (Fk_Won/plytime),Fk_Losttamin = (Fk_Lost/plytime),Spoilsamin = (Spoils/plytime))


plystatsA <-statsA



#Team B
plystatsBB <- teamsheet%>%filter(Teamnum =="B") %>%select( Teamnum, Team, plytime, ply, name, Player,Areax,Areay)

plystatsBB <- plystatsBB %>% arrange(ply)

plystatsBB <- plystatsBB[plystatsBB$ply!="20", ]

#plystatsB

passB <- pass %>%filter (Teamnum == "B", Action != "Opp Brk")

playersts <- passB %>%group_by(Player)%>%summarize(PW =sum(main == "PW"),Pass =sum(main == "Pass Op"),Rec =sum(main == "Rec Op"),
KoRec =sum(main == "Ko Rec"),OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"),RsShot =sum(main == "Shot Rs"),RsScr =sum(subset == "Scr Rs"),
Poss_Lost =sum(main == "ToL"),
Fk_Won =sum(main == "Free Won"),Fk_Lost =sum(main == "Free Loss"),Spoils =sum(main == "Def Act"), OBP = (PW + Rec), Pass_Loss = sum(subset == "Pass Loss"), Comp_Pass = (Pass - Pass_Loss))


statsB <- bind_cols (plystatsBB,playersts)

statsB <- statsB %>% select(-Player...9)

statsB [is.na(statsB)] <- 0

statsB <- statsB %>%  mutate(totPW = sum(PW), PWp = (PW/totPW*100), totPass = sum(Pass), Passp = (Pass/totPass*100), totRec = sum(Rec), Recp = (Rec/totRec*100),  totKoRec = sum(KoRec), KoRecp = (KoRec/totKoRec*100), 
totOpShot = sum(OpShot), OpShotp = (OpShot/totOpShot*100), totOpScr = sum(OpScr), OpScrp = (OpScr/totOpScr*100),
totRsShot = sum(RsShot), RsShotp = (RsShot/totRsShot*100), totRsScr = sum(RsScr), RsScrp = (RsScr/totRsScr*100),
totPoss_Lost = sum(Poss_Lost), Poss_Lostp = (Poss_Lost/totPoss_Lost*100), 
totFk_Won = sum(Fk_Won), Fk_Wonp = (Fk_Won/totFk_Won*100), totFk_Lost = sum(Fk_Lost), Fk_Lostp = (Fk_Lost/totFk_Lost*100), totSpoils = sum(Spoils), Spoilsp = (Spoils/totSpoils*100),
totOBP = sum(OBP), OBPp = (OBP/totOBP*100), totCP = sum(Comp_Pass), CPp = (Comp_Pass/totCP*100))

statsB <- statsB %>% mutate(PWamin = (PW/plytime),Passamin = (Pass/plytime), Recamin = (Rec/plytime), KoRecamin = (KoRec/plytime), 
OpShotamin = (OpShot/plytime),OpScramin = (OpScr/plytime),
RsShotamin = (RsShot/plytime),RsScramin = (RsScr/plytime),
Poss_Lostamin = (Poss_Lost/plytime), 
Fk_Wonamin = (Fk_Won/plytime),Fk_Losttamin = (Fk_Lost/plytime),Spoilsamin = (Spoils/plytime))


plystatsB <-statsB


#Kick outs 

koonlyA <- pass %>%group_by(Team) %>% filter(subset == "Ko"|subset == "Ko Rec"| subset == "Ko ToL")%>%select(period, Teamnum,Phase,Team,Player,plylab,subset,Zone,main)
oddps <- koonlyA[seq(1, nrow(koonlyA), 2),]
colnames(oddps) <- c("period","Teamnum","Phase","Team","Player","plylab","subset","Zone","main")
evenps <- koonlyA[seq(2, nrow(koonlyA), 2),]
colnames(evenps) <- c("periodoc","Teamnumoc","Phaseoc","Teamoc","Playeroc","plylaboc","subsetoc","Zoneoc","mainoc")
koonlyA <- bind_cols(oddps, evenps) 
koonlyA <- koonlyA%>%select("period","Teamnum","Phase","Team","Player","plylab","subset","Zone","main","plylaboc","subsetoc","Zoneoc","mainoc")

koeff <-koonlyA %>%
    mutate(tx = VLOOKUP(Zoneoc, zonetext, zone, tx),ty = VLOOKUP(Zoneoc, zonetext, zone, ty),bx = VLOOKUP(Zoneoc, zonetext, zone, bx),by = VLOOKUP(Zoneoc, zonetext, zone, by))


#write.csv2(oddps, "oddpsko.csv")
#write.csv2(evenps, "evenpsko.csv")


#runwork - no brks 
passRw <- pass[pass$main!="Def Act", ]
passRw <- passRw[passRw$main!="Free Loss", ]
passRw <- passRw[passRw$main!="Tck Def", ]
passRw <- passRw[passRw$main!="Tck End", ]
passRw <- passRw[passRw$main!="Sht Prs", ]
passRw <- passRw[passRw$main!="Opp Brk", ]
passRw <- passRw[passRw$main!="Spoil Off", ]
passRw <- passRw[passRw$main!="Red Card", ]

passRw <- passRw%>%select(period,possno,poss,Teamnum,Phase,phaseno,Team,Player,Action,Areax,Areay,plylab,subset,Zone,time,main,Pitch_Area)

passRwc <- passRw 

#passRwc <- passRw %>% filter (poss =="A1"|poss == "B1"|poss == "A2")

oddps <- passRwc[seq(1, nrow(passRwc), 1),]
colnames(oddps) <- c("period","possno","poss","Teamnum","phaseno","Phase","Team","Player","Action","Areax","Areay","plylab","subset","Zone","time","main","Pitch_Area")
evenps <- passRwc[seq(2, nrow(passRwc), 1),]
colnames(evenps) <- c("periodoc","possnooc","possoc","Teamnumoc","phasenooc","Phaseoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc","Pitch_End")

#add column to each data frame with row number
oddps$number <- row.names(oddps)
evenps$number <- row.names(evenps)

runwork <- merge(oddps, evenps, by = "number", all = TRUE)

runwork$number <- as.numeric(runwork$number)

runwork  <- runwork %>% arrange(number)

library(plyr)

runwork  <- rename(runwork, c( Areaxoc = "xend", Areayoc = "yend",Zone = "zone",  Zoneoc = "zoneoc"))

detach(package:plyr)

runwork <-runwork %>% mutate(teamsame = ifelse(Team == Teamoc ,"Y","N"))
runwork <-runwork %>% mutate(keep = ifelse(main =="Free Won" ,"N",ifelse(Team == "Att Mk Won","N", runwork$teamsame)))

runwork <-runwork %>% mutate(segtypea = ifelse(Action =="Hp","Hp",ifelse(Action  == "Kp Left","Kp Left",ifelse(Action  == "Kp Right","Kp Right",
ifelse(Action  == "Ko","Ko",ifelse(Action == "Fk Pass","Fk Pass",ifelse(Action  == "Sl Pass","Sl Pass"
,ifelse(Action  == "Brk Own","Brk Own",ifelse(Action  == "Opp Brk","Opp Brk",ifelse(Action  == "koBrk Own","KoBrk Own",ifelse(Action  == "Opp KoBrk","Opp KoBrk",ifelse(Action  == "PW Fk Pass","Fk Pass",ifelse(Action  == "Pw Sl Pass","Sl Pass","Carry")))))))))))))

runwork <-runwork %>% mutate(segtype = ifelse(subsetoc =="Scr Op","Score",ifelse(subsetoc  == "Ms Op","Miss",ifelse(subsetoc  == "Scr Rs","Scr Rs",ifelse(subsetoc  == "Ms Rs","Ms Rs",
ifelse(subsetoc == "Ko ToL","Ko ToL",ifelse(subsetoc  == "Pass ToL","Pass ToL",runwork$segtypea)))))))

segtype <- c("Hp","Carry","Kp Right","Score","Ko","Ko ToL","Pass ToL","Miss","Kp Left","Fk Pass","Sl Pass","Scr Rs","Ms Rs",
"Opp Brk","Brk Own","Opp KoBrk","KoBrk Own")

seg<- c("1",	"2",	"3",	"4",	"5",	"6",	"7",	"8",	"9",	"10",	
"10",	"11",	"12",	"13",	"14",	"15",	"16")

segments <- data.frame(segtype ,seg)

runwork  <-runwork  %>%
    mutate(seg = VLOOKUP(segtype,segments, segtype, seg))




```

```{r}


create_GAA_Pitch <- function(grass_colour, line_colour, background_colour, goala_colour,goalb_colour,label_colour,tram_colour, BasicFeatures){
  
  theme_blankPitch = function(size=12) { 
    theme(
      #axis.line=element_blank(), 
      axis.text.x=element_blank(), 
      axis.text.y=element_blank(), 
      #axis.ticks.y=element_text(size=size),
      #axis.ticks=element_blank(),
      axis.ticks.length=unit(0, "lines"), 
      #axis.ticks.margin=unit(0, "lines"), 
      axis.title.x=element_blank(), 
      axis.title.y=element_blank(), 
      legend.key.size=unit(1.2, "lines"), 
      legend.text=element_text(size=size), 
      legend.title=element_text(size=size, face="bold",hjust=0),
      # panel.border=element_blank(), 
      panel.grid.major=element_blank(), 
      panel.grid.minor=element_blank(), 
      panel.spacing=element_blank(), 
      plot.margin=unit(c(0, 0, 0, 0), "lines"), 
      plot.title=element_text(size=size*1.2), 
      panel.background=element_rect(fill= background_colour,colour= background_colour),
      strip.text.x=element_text(size=size*1))}

  ymin <- 0 # minimum width
  ymax <- 88 # maximum width
  xmin <- 0 # minimum length
  xmax <- 144 # maximum length
  
  # pitch lines
  def13 <- 13
  def20 <- 20
  def45 <- 45
  def65 <- 65
  off65 <- 79
  off45 <- 99
  off20 <- 124
  off13 <- 131
  
  
  # small sqaure
  
 #HERE
  sixYardrd <- 37
  sixYardld <- 51
  
  sixYardDefxst <- 4.5
  sixYardOffxst <- 139.5

  #13 box
 #HERE  
  right14d <- 34.5
  left14d <- 53.5

  #Goals
  glxst <- 0
  glyst <- 40.75
  glxed <- 143.9
  glyed <- 47.25

  #halfway line
  hwxst <- 72
  hwyst <- 40.75
  hwyed <- 47.25

  #pen spot

  pdxst <- 11
  pdyst <- 43.5
  pdyed <- 44.5
  poxst <- 133
  
 #tramlines - hor
  srwing <- 13
  rhalfsp <- 31
  ctre <- 57
  lhalfsp <- 75
  
 #tramlines - vert

one <- 33
two <- 55
hw <- 72
four <- 89
five <- 111
  
  
      
  circleFundef <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] + diameter / 2 * cos(tt), 
               y = center[2] + diameter / 2 * sin(tt))
  }
  
  circleFunatt <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] - diameter / 2 * cos(tt), 
               y = center[2] - diameter / 2 * sin(tt))
  }
  #### create semi circle ####
  def_circle <-  circleFundef(c(20,44), 26, start=1.5, end=2.5)
  att_circle <-  circleFunatt(c(124,44), 26, start=1.5, end=2.5)
  
  if(BasicFeatures == TRUE){
    ## initiate the plot, set some boundries to the plot
    p <- ggplot() + 
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
      geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5) +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax))
    
  }
  
  else{
    ## initiate the plot, set some boundries to the plot
     p <- ggplot()  +
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
            geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_segment(aes(x = xmin, y = srwing, xend = xmax, yend = srwing),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = rhalfsp, xend = xmax, yend = rhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = ctre, xend = xmax, yend = ctre),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = lhalfsp, xend = xmax, yend = lhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hwxst, y =  ymin, xend = hwxst, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hw, y = ymin, xend = hw, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5)  +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax)) +
      annotate(geom="text", x= 21.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 46.5, y=1.25, label="45",color = label_colour,size = 4) +
      annotate(geom="text", x= 66.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x= 80.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x=100.5, y=1.25, label="45", color=label_colour,size = 4) +
      annotate(geom="text", x=125.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 100, y=2, label="www.witnesstheanalysis.com",color = "white",size = 2, alpha = 0.4) +
      annotate(geom="text", x= 12, y=87, label="www.witnesstheanalysis.com",color = "white",size = 2, alpha = 0.4)+
      annotate("segment", x = 68, xend = 76, y = 2, yend = 2, colour = "pink", size=3, alpha=0.6, arrow=arrow())
  }

  
  return(p)}


p <- create_GAA_Pitch("gray72", "white", "lightblue", "blue","red","white","blue", BasicFeatures=FALSE)







```

```{r}

#Run 

n <- 100
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(color) <- levels(pass$poss)
colScale <- scale_colour_manual(name = "poss",values = color)

runcolpal <- c(
  "PW" = "orange",
  "Carry" = "gold",
  "Hp" = "yellow", 
  "Tck Att" = "cornflowerblue",
  "Kp Left" = "grey45", 
  "Kp Right" = "orchid2",
  "Hp Prs" = "#D2691E", 
  "Kp Left Prs" = "#800080", 
  "Kp Right Prs" = "#00FFFF",
  "Pass Rs" = "lightblue",
  "Fk Pass" = "lightblue",
  "Ko" =  "darksalmon",
  "Ko Rec" = "green",
  "Ko ToL" = "darkred",
  "Pass ToL"= "red",
  "ToL" = "red",
  "Fk Point" = "pink",
  "Ms Op" = "darkred",
  "Fk Goal"= "darkgreen",
  "Ms Rs" = "dodgerblue3",
  "Free Won" = "blue",
  "Point" = "#00BA38",
  "Goal" ="black",
  "Ko Int" ="yellow",
  "Pk Goal"= "#FFFFFF",
  "Pk Point"="#800000",
  "Mk Goal"="#D92121",
  "Sl Shot Right"="blue",
  "45 Goal"="#FFFFFF",
  "45 Point"="darkred",
  "45 Short"="darkred",
  "Brk Own"= "darkgreen",
  "KoBrk Own" ="darkgreen" ,
  "Opp Brk" = "darkgreen",
  "Opp KoBrk" = "darkgreen",
  "PW Sl Pass"= "#D2691E",
  "PW Fk Pass"= "#D2691E")

#change lbw
pwcol <- c("Fk Pass"="#000000",
"PW Fk Pass" = "#000000",
"PW Sl Pass" = "#000000",
"Int Op"="blue",
"Int Rs"="purple",
"Gk Won"="#FF6347",
"Ko Int"="white",
"LBW"="#FFFF00",
"RBW Def"="#00FFFF",
"RBW Off"="#FF00FF",
"Rs Pass PW" = "#FFFFFF",
"PW Sl Pass"="#FFFFFF",
"Fkwof" = "#FFFFFF",
"Tck LB Won" = "#D2691E")

runlinepal <- c(
  "0" = 2,
  "1" = 1, 
  "2" = 2, 
  "3" = 1,
  "4" = 1,
  "5" = 1,
  "6" = 1,
  "7" = 1,
  "8" = 1,
  "9" = 1,
  "10"= 1,
  "11"= 1,
  "12"= 1,
  "13"= 1,
  "14"= 1,
  "15"=1,
  "16"=1)



```

```{r}

#Kick Outs 
pal <- c("Ko Rec" = "blue",
"Ko Lost"  = "red",
"KoBrk Rec" = "purple",
"KoBrk Lost"  = "red",
"Ko Mk Won"  = "black",
"Ko Lost Mk" = "red",
"Ko Unc Rec" = "white",
"Ko Fk Won Off" = "lightblue",
"Ko Fk Loss Off" = "darkred",
"Ko MkW Po" = "darkgreen")

pals <- c("Ko Rec" = 19,
"Ko Lost"  = 4,
"KoBrk Rec" = 19,
"KoBrk Lost"  = 4,
"Ko Mk Won"  = 19,
"Ko Lost Mk" = 4,
"Ko Unc Rec" = 19,
"Ko Fk Won Off" = 19,
"Ko Fk Loss Off" = 4,
"Ko Mk W Po" = 19)

perpal <- c("1" = "blue",
"2"  = "darkgreen",
"3" = "purple",
"4"  = "black")
```

```{r}

#Time

actcolpals <- c(
  "20" = "grey",
  "0-9" = "black", 
  "10-19" = "blue", 
  "20-29" = "red",
  "30-39" = "purple",
  "40-49" =  "yellow",
  "50-59" = "darkred",
  "60-69" = "orange",
  "70+" = "dodgerblue3")

```

```{r}


#PW
paltow <- c("Tack W"="#000000",
"Kp Int"="blue",
"Hp Int"="purple",
"Kp Brk Int"="#FF6347",
"Hp Brk Int"="#0000FF",
"Kp Free Int"="#FFFF00",
"Fk Brk Int"="#00FFFF",
"Mk Kp Int"="#FF00FF",
"Sl Int"="darkblue",
"Ti Brk Won"=" black",
"Ko Int"="#800000",
"KoBrk Int"="#808000",
"PW Ko Int Mk Pass"="#D2691E",
"PW Ko Int Mk Po"="#D2691E",
"Fk Short Gk"="#800080",
"Short Gk"="#008080",
"Tck LB Won"="#000080",
"Free Won Def"="gold",
"Sl Kp Won To"="darkred",
"RBW Off"="#808080",
"Loose BW"="#000000",
"Brk Won"="#FF0000",
"RBW Def"="#800000",
"Ko Fk Won Def" = "lightblue",
"Fk Brk Int" = "lightblue",
"Mk Kp Brk Int"="#D2691E",
"PW Kp Int Mk Pass"= "#D2691E",
"PW Kp Int Mk Po"= "#D2691E",
"PW Sl Pass"= "#D2691E",
"PW Fk Pass"= "#D2691E",
"Sl Won Def Loss" = "#D2691E")

```

```{r}
teamcol = c("Armagh" = "blue", "Kerry" = "red")

teamnumcol = c("A" = "blue", "B" = "red")
```

```{r}

#Shooting 

colshotvertpal <- c(
"Goal"= "blue",
"Point"= "black",
"Wide Left"="purple",
"Wide Right"="#FF6347",
"Saved"="#FFFF00",
"Blkd"="#00FFFF",
"Short"="#FF00FF",
"Post"="darkblue",
"Fk Goal"= "#FFFFFF",
"Fk Point"="#800000",
"Fk Wide Left"="#808000",
"Fk Wide Right"="#D2691E",
"Fk Saved"="#800080",
"Fk Short"="#008080",
"Fk Post"="#000080",
"45 Goal"="#FFFFFF",
"45 Point"="darkred",
"45 Wide Left"="#808080",
"45 Wide Right"="#000000",
"45 Saved"="#FF0000",
"45 Short"="#800000",
"45 Post"="yellow",
"Pk Goal" ="#619CFF",
"Pk Point"="#00BA38",
"Pk Wide Left"="#F8766D",
"Pk Wide Right"="#FF9326",
"Pk Saved"="#FFFF4D",
"Pk Post"="#21D921",
"Mk Goal"="white",
"Mk Point"="#D92121",
"Sl Wide Left"="gold",
"Mk Wide Right"="orange",
"Mk Short"="red",
"Mk Saved"="#2121D9",
"Hp Point"="#2121D9",
"Punch"="#21D921")

colshotshape <- c(
"Shot Right" = 15,
"Shot Left" = 16,
"45 Shot Right" = 2,
"45 Shot Right" = 6,
"Pk Shot Right" = 222,
"Pk Shot Right" = 112,
"Fk Shot Left" = 24,
"Fk Shot Right" = 25,
"Sl Shot Left" = 134,
"Sl Shot Right" = 135,
"Hp Shot" = 3,
"Punch" = 18
)

colshotpal <- c(
"1"= "white",
"2"= "yellow",
"3"="red")


```

```{r}
#Actions - Mainly used for ToL

n <- 160
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
colorAct = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
colormain = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(colorAct) <- levels(pass$Action)
colScale <- scale_colour_manual(name = "Action",values = colorAct)
```

```{r}
runcolpals <- c(
  "0" = "blue",
  "1" = "dodgerblue3", 
  "2" = "pink", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "darkred",
  "6" = "purple",
  "7" = "blue",
  "8" = "orange",
  "9" = "darkgreen",
  "10" = "lightblue")

```

```{r}
veccol <- c(
  "1" = "dodgerblue3", 
  "2" =  "darkred", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "pink",
   "6" = "lightblue",
  "7" = "orange",
  "8" = "purple",
  "9" = "darkgreen",
  "10" = "lightblue")

```

```{r}
mscolpals <- c(
  "0" = "grey",
  "0-2.99" = "black", 
  "3-5.99" = "blue", 
  "6-8.99" = "red",
  "9-11.99" = "purple",
  "12-14.99" =  "yellow",
  "15-17.99" = "darkred",
  "18-20.99" = "orange",
  ">21" = "dodgerblue3")
```


# Summary 
## Starting Line Up (Number, Player, Playing time)
### Armagh

```{r, fig.width = 16, fig.height = 12}


#Starting Line up change to single team

positionA <- plystatsA %>% filter (Teamnum == "A") %>%select(Areax,Areay,name, Player...6,plytime)

positionA = positionA %>% 
   unite(here, Player...6, plytime, sep = " ", remove = FALSE)

#positionA

p + geom_point(data = positionA, aes(x=Areax, y=Areay), shape = 19, colour = "blue",size = 6) +
  theme(plot.title = element_text( size=32, hjust=0)) +
  geom_text_repel(data = positionA, aes(x=Areax, y=Areay, label = here), colour = "white", size = 8) +
  theme(legend.position="none")


```

### Kerry



```{r, fig.width = 16, fig.height = 12}
#Starting Line up change to single team

positionB <- plystatsB %>% filter (Teamnum == "B") %>%select(Areax,Areay,name, Player...6,plytime)

positionB = positionB %>% 
   unite(here, Player...6, plytime, sep = " ", remove = FALSE)

#positionA

p + geom_point(data = positionB, aes(x=Areax, y=Areay), shape = 19, colour = "red",size = 6) +
  theme(plot.title = element_text( size=32, hjust=0)) +
  geom_text_repel(data = positionB, aes(x=Areax, y=Areay, label = here), colour = "white", size = 8) +
  theme(legend.position="none")


```

## Scores

Armagh|Kerry
--------|--------------
 J McEntee (0-1)| E Fitzmaurice (0-1)
 O McConville (1-2)| E Brosnan (0-1)
 S McDonnell (0-3)| L Hassett (0-2)
 R Clarke (0-3)| MF Russell (0-3)
 D Marsden (0-3)| D O Cinneide (0-5)
.| C Cooper (0-2)




```{r}


passlpop <- pass[pass$main!="Def Act", ]
passlpop <- passlpop[passlpop$main!="Free Loss", ]
passlpop <- passlpop[passlpop$main!="Tck Def", ]
passlpop <- passlpop[passlpop$main!="Tck End", ]
passlpop <- passlpop[passlpop$main!="Sht Prs", ]
passlpop <- passlpop[passlpop$main!="Spoil Off", ]
passlpop <- passlpop[passlpop$main!="Opp Brk", ]

lpop <- passlpop %>%group_by(Team)%>%summarize(Possession_Won =sum(main == "PW"), Kickouts = sum(main == "Ko"),Ko_Won = sum(main == "Ko Rec"),Total_Possessions = sum(Possession_Won + Kickouts),Open_Play_Shots = sum(main == "Shot Op"),Open_Play_Score = sum(subset == "Scr Op"),Fk_Shots = sum(main == "Shot Rs"),Fk_Score = sum(subset == "Scr Rs"))

library(plyr)

lpop <- rename(lpop, c(Possession_Won = "Possession Won", Ko_Won = "Kick Out Won", Total_Possessions = "Total Possessions",Open_Play_Shots = "Open Play Shots",Open_Play_Score = "Open Play Score" ,Fk_Shots = "Free Kick Shots",Fk_Score = "Free Kick Score"))

detach(package:plyr)

lpop <-lpop %>%
  tidyr::gather(variable, value, -Team)

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black")) +
theme(legend.position="bottom")
  }

q <- ggplot(data = lpop , aes(x = variable, y = value, colour = Team))

q +geom_point(stat = "identity", aes(x = variable, y = value, colour = Team), size = 12) +
geom_text(data =lpop ,aes(x = variable, y = value, label = value), colour = "white", size = 6) +
 coord_flip() +
  my_theme ()+
  scale_colour_manual(values= c (teamcol)) 


```



```{r}
#All_Poss  <- sop %>%group_by(Team) %>%summarize(Possessions =sum(main %in% c("PW","Ko", "Shot Rs", "Pass Rs")), Total_Possession_time =sum (secs/60), Ave_Possession_time =mean(secs), Entry_45 = sum (Entry_45 == "Y"), Shots = #sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
#Shot_Perc =(Shots/Possessions*100), Shot_Rate_secs = sum (secs/Shots),Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))

All_Poss  <- sop %>%group_by(Team) %>%summarize(Possessions =sum(main %in% c("PW","Ko")), Total_Possession_time =sum (secs/60), Ave_Possession_time =mean(secs), Entry_45 = sum (Entry_45 == "Y"), All_Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_Perc =(All_Shots/Possessions*100), Shot_Rate_secs = sum (secs/All_Shots),Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))


library(plyr)

All_Poss <- rename(All_Poss, c( Total_Possession_time = "Possession Time (mins)",Ave_Possession_time = "Ave Possession time (secs)",Entry_45 = "45 Entry",All_Shots = "All Shots", Shot_Perc = "% Shots per Possession",  Shot_Rate_secs  = "Shot Rate (secs)"))

detach(package:plyr)


formattable (All_Poss, align = c("l", rep("c", NCOL(All_Poss) - 1)))
```


## Periods

```{r, fig.width = 16, fig.height = 10}
perA <- pass%>%group_by(Team,main,period, , .drop=TRUE) %>% filter (main %in% c("PW", "ToL", "Ko Rec", "Ko", "Free Won", "Free Loss", "Shot Op","Shot Rs"))


perA <- perA %>%group_by(Team,main,period)%>%tally%>%mutate(f = sum(n))

pA <- ggplot(perA,aes(x=period,weight = n,fill = as.factor(period))) + 
geom_histogram()+facet_grid(Team ~ main, scales='free') + 
theme(strip.background = element_rect(colour="black", fill="lightgreen", size=1.5, linetype="solid"), 
strip.text = element_text(size = 14, colour = "black"),
axis.text = element_text(size = 12, colour = "black")) +
labs (fill = "Period")
pA
```


## Match Timeline (Segments indicate a Phase of Play)

```{r, fig.width = 16, fig.height = 10}

#phs <- pass%>%group_by(Phase) %>%filter(main %in% c("PW","Ko","ToL", "Pass Rs","Shot Op Oc","Shot Rs Oc","Free Won", "Shot Rs", "Half Time","Full Time")|
#(Action %in% c("Ko Mk Won", "Att Mk Won","Att Mk Won Prs","Loss Kp SlW","Loss Ko SlW","Loss Kp 45W","Off Foul Won","Ko Fk Won Off", "Sl Won Off","Off 45 Won")))


#w/out half time 

phs <- pass%>%group_by(Phase) %>%filter(main %in% c("PW","Ko","ToL", "Pass Rs","Shot Op Oc","Shot Rs Oc","Free Won", "Shot Rs","Half Time","Full Time")|
(Action %in% c("Ko Mk Won", "Att Mk Won","Att Mk Won Prs","Loss Kp SlW","Loss Hp SlW","Loss Ko SlW","Loss Kp 45W","Off Foul Won","Ko Fk Won Off", "Sl Won Off","Off 45 Won")))

oddps <- phs[seq(1, nrow(phs), 2),]
colnames(phs) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","plyname","Action","Areax","Areay","plylab","subset","Zone","time","main","Pitch_Area")
evenps <- phs[seq(2, nrow(phs), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","plynameoc","Actionoc","Areaxoc","Areayoc","plylaboc","subsetoc","Zoneoc","timeoc","mainoc","Pitch_Areaoc")
phs <- bind_cols(oddps, evenps) 
phs <- phs%>%select (Team,poss,Phase,time,Teamoc,possoc,Phaseoc,timeoc)

time <-  phs


teamcol = c("Armagh" = "blue", "Kerry" = "red")

teamnumcol = c("A" = "blue", "B" = "red")


sopa <-  time %>% select(Team,time,timeoc,Phase)

wormA <-scores%>%filter(Teamnum == "A",subsetoc =="Scr Op"|subsetoc =="Scr Rs")%>%select(Teamnum,Team, Actionoc,Areaxoc,Areayoc,plylaboc,timeoc,Shot_lab,diff,subsetoc)
wormB <-scores%>%filter(Teamnum == "B",subsetoc =="Scr Op"|subsetoc =="Scr Rs")%>%select(Teamnum,Team, Actionoc,Areaxoc,Areayoc,plylaboc,timeoc,Shot_lab,diff,subsetoc)
wormC <-scores%>%filter(Teamnum == "A", subsetoc =="Ms Op"|subsetoc =="Ms Rs")%>%select(Teamnum,Team, Actionoc,Areaxoc,Areayoc,plylaboc,timeoc,Shot_lab,diff,subsetoc)
wormD <-scores%>%filter(Teamnum == "B", subsetoc =="Ms Op"|subsetoc == "MS Rs")%>%select(Teamnum,Team, Actionoc,Areaxoc,Areayoc,plylaboc,timeoc,Shot_lab,diff,subsetoc)
#cardA <- scores%>%filter(Teamnum == "A", period == "c")
#cardB <- scores%>%filter(Teamnum == "B", period == "c")

scoresSD <- scores %>% select (Teamnum, timeoc,diff,abdiff)

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_blank(),
          plot.title =  element_blank(),
          panel.background = element_rect(fill = "#BFD5E3")) +
theme(legend.position="bottom")
  }

q = ggplot(data = sopa, aes(x = time, y = 0, xend = timeoc, yend = 0, colour =Team))


q + geom_segment(data = sopa, aes(x = time, y = 0, xend = timeoc, yend = 0, colour = Team),size = 6) +
  scale_colour_manual(values = c(teamcol)) +
geom_step(data=scoresSD, aes(x=timeoc, y=diff), colour = "white", ,size=1.5, linetype = 2,alpha = 0.4)+
  geom_text_repel(data = scoresSD, aes(x=timeoc, y=diff, label = abdiff), colour = "white",size = 6)+
  #geom_point(data = wormA, aes(x = timeoc, y = 0), shape = 20, size = 4, stroke = 2, colour = "white") +
  geom_text_repel(data = wormA, aes(x=timeoc, y=0, label = subsetoc, colour = Team),size = 4,segment.size  = 0.5,nudge_x = 0, nudge_y = 1.2) +
    #geom_point(data = wormB,aes(x=timeoc, y=0), shape = 20, size = 4, stroke = 2, colour = "white") +
geom_text_repel(data = wormB, aes(x=timeoc, y=0, label = subsetoc, colour = Team),size = 4, segment.size  = 0.5,nudge_x = 0, nudge_y = -1.2) +
    #geom_point(data = wormC,aes(x=timeoc, y=0,  colour = Team), shape = 4, size = 4, stroke = 2, colour = "white") +
geom_text_repel(data = wormC, aes(x=timeoc, y=0, label = subsetoc, colour = Team),size = 4, segment.size  = 0.5,nudge_x = 0, nudge_y = 0.5) +
   #geom_point(data = wormD,aes(x=timeoc, y=0), shape = 20, size = 4, stroke = 2, colour = "white") +
geom_text_repel(data = wormD, aes(x=timeoc, y=0, label = subsetoc, colour = Team),size = 4, segment.size  = 0.5,nudge_x = 0, nudge_y = -0.5) +
#geom_text_repel(data = cardA, aes(x=timeoc, y=0, label = subsetoc), colour ="black",size = 4, segment.size  = 0.5,nudge_x = 0, nudge_y = 1.5) +
#geom_text_repel(data = cardB, aes(x=timeoc, y=0, label = subsetoc), colour ="black",size = 4, segment.size  = 0.5,nudge_x = 0, nudge_y = -1.5) +
my_theme () +
scale_y_continuous(breaks=seq(-10,10,1)) +
expand_limits (y=c (-5,8)) +
      annotate(geom="text", x=2, y=4.5, label="Armagh", color="blue", size = 14) +
    annotate(geom="text", x=2, y=-4.5, label="Kerry", color="red", size = 14)+
  geom_vline(xintercept=p1, linetype="dotted", color = "black")+
  geom_vline(xintercept=ht, linetype="dotted", color = "black")+
  geom_vline(xintercept=p3, linetype="dotted", color = "black")+
  annotate(geom="text", x= p1, y=-8.75, label="Period 1",color = "black") +
  annotate(geom="text", x= ht, y=-8.75, label="HT",color = "black") +
  annotate(geom="text", x= p3, y=-8.75, label="Period 3",color = "black") 
  



```


# Positions
## Average Position by Action
### Armagh - Game

```{r, fig.width = 16, fig.height = 10}

aveposA <- pass %>%group_by(Player, main)%>%filter( Teamnum == "A", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "blue", size = 6) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 8, colour = "white") +
theme(legend.position="none") 
```

### Period
```{r,  out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

aveposA1 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "1", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxA <- aveposA1 %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA1%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA1 <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA1, aes(x=AreaxA, y=AreayA), colour = "red", size = 8) +
geom_text_repel(data = avgposA1, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposA2 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "2", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxA <- aveposA2 %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA2%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA2 <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA2, aes(x=AreaxA, y=AreayA), colour = "blue", size = 8) +
geom_text_repel(data = avgposA2, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 2") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


aveposA3 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "3", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA3 %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA3%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA3 <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA3, aes(x=AreaxA, y=AreayA), colour = "black", size = 8) +
geom_text_repel(data = avgposA3, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 3") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposA4 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "4", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA4 %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA4%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA4 <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA4, aes(x=AreaxA, y=AreayA), colour = "darkblue", size = 8) +
geom_text_repel(data = avgposA4, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 4") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
```

### Kerry - Game
```{r,  fig.width = 16, fig.height = 10}
aveposB <- pass %>%group_by(Player, main)%>%filter( Teamnum == "B", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "red", size = 6) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 8, colour = "white") +
theme(legend.position="none")
```

### Period 
```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

aveposB1 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "1", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxB <- aveposB1 %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB1%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB1 <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB1, aes(x=AreaxB, y=AreayB), colour = "red", size = 8) +
geom_text_repel(data = avgposB1, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
 ggtitle ("Period 1") +
theme(legend.position="none") + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposB2 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "2", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxB <- aveposB2 %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB2%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB2 <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB2, aes(x=AreaxB, y=AreayB), colour = "blue", size = 8) +
geom_text_repel(data = avgposB2, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 2") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


aveposB3 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "3", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))

AreaxB <- aveposB3 %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB3 %>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB2 <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB2, aes(x=AreaxB, y=AreayB), colour = "black", size = 8) +
geom_text_repel(data = avgposB2, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 3") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposB4 <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "4", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))

AreaxB <- aveposB4 %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB4%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB4 <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB4, aes(x=AreaxB, y=AreayB), colour = "darkblue", size = 8) +
geom_text_repel(data = avgposB4, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 4") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
```


# Action Areas

### Armagh

```{r, fig.width = 16, fig.height = 12}


ActA <- pass %>% filter(Teamnum =="A")

ActA <- ActA %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActA, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none")


```


```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

ActA1 <- pass %>% filter(Teamnum =="A", period == "1")

ActA1 <- ActA1 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActA1, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 1") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

ActA2 <- pass %>% filter(Teamnum =="A", period == "2")

ActA2 <- ActA2 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActA2, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 2") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

ActA3 <- pass %>% filter(Teamnum =="A", period == "3")

ActA3 <- ActA3 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActA3, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 3") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

ActA4 <- pass %>% filter(Teamnum =="A", period == "4")

ActA4 <- ActA4 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActA4, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 4") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


```

### Kerry

```{r, fig.width = 16, fig.height = 12}


ActB <- pass %>% filter(Teamnum =="B")

ActB <- ActB %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActB, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none")
```


```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

ActB1 <- pass %>% filter(Teamnum =="B", period == "1")

ActB1 <- ActB1 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActB1, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 1") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
 
ActB2 <- pass %>% filter(Teamnum =="B", period == "2")

ActB2 <- ActB2 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActB2, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 2") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

ActB3 <- pass %>% filter(Teamnum =="B", period == "3")

ActB3 <- ActB3 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActB3, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 3") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

ActB4 <- pass %>% filter(Teamnum =="B", period == "4")

ActB4 <- ActB4 %>% filter(Action != "Ko")

p +  stat_density_2d(data = ActB4, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none") +
  labs(title = "Period 4") + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

```


# Ball Movement 

## 45 Entries

```{r}

Entry_45 <- sop %>%group_by(Team) %>% filter (Entry_45 == "Y") %>%summarize(Entry_45 = sum (Entry_45 == "Y"), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_Perc =(Shots/Entry_45 *100), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),AttEff = (Scores/Entry_45 *100))

library(plyr)

Entry_45 <- rename(Entry_45, c( Entry_45 = "Entry into 45",Shot_Perc = "Shot% per Entry",AttEff = "Score% per Entry"))

detach(package:plyr)

formattable (Entry_45, align = c("l", rep("c", NCOL(Entry_45) - 1)))
```

### Armagh 

```{r}

total45A <- run%>%group_by(Team) %>% filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99 )
total45A <-total45A[!duplicated(total45A[,c('poss')]),]
total45A <- total45A%>%group_by(Team) %>% filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99 )%>%summarize(count=n())


hp45A <- run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )
hp45A <-hp45A[!duplicated(hp45A[,c('poss')]),]
hp45A <- hp45A%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )%>%summarize(count=n())

KPLA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )
KPLA <-KPLA[!duplicated(KPLA[,c('poss')]),]
KPLA <-  KPLA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )%>%summarize(count=n())

KPRA <-  run%>%filter(Teamnum=="A",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )
KPRA<-KPRA[!duplicated(KPRA[,c('poss')]),]
KPRA <-  KPRA%>%filter(Teamnum=="A",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )%>%summarize(count=n())

run45A <- run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )
run45A <-run45A[!duplicated(run45A[,c('poss')]),]
run45A <- run45A%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )%>%summarize(count=n())

RestartA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )
RestartA <-RestartA[!duplicated(RestartA[,c('poss')]),]
RestartA <-  RestartA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )%>%summarize(count=n())

LostA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )
LostA <-LostA[!duplicated(LostA[,c('poss')]),]
LostA <-  LostA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )%>%summarize(count=n())

KoLA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "6" )
KoLA <-KoLA[!duplicated(KoLA[,c('poss')]),]
KoLA <-  KoLA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "6" )%>%summarize(count=n())

KoRA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "5" )
KoRA <-KoRA[!duplicated(KoRA[,c('poss')]),]
KoRA <-  KoRA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "5" )%>%summarize(count=n())

tot45A <- bind_cols (total45A,hp45A,KPLA,KPRA,run45A, RestartA, LostA,KoRA,KoLA)



library(plyr)

tot45A <- rename(tot45A, c( count = "Total", count1 = "Hp", count2 = "Kp Left", count3 = "Kp Right", count4 = "Carry", count5 = "Restart Pass", count6 = "Lost", count7 = "Ko Received", count8 = "Ko Lost"))

detach(package:plyr)

#formattable (tot45A)

formattable (tot45A, align = c("l", rep("c", NCOL(tot45A) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:8) ~ color_tile("#DeF7E9", "#71CA97")))
```

### Armagh - Game


```{r, fig.width = 16, fig.height = 12}

runA45all <- run %>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99)

runA45 <- run %>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99)

runA45 <-runA45[!duplicated(runA45[,c('poss')]),]

runA45 <-runA45 %>% group_by(zone) %>% summarise(count = n())

runA45 <-runA45 %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext, zone, by))


p + geom_density_2d(data = runA45all, aes(x=Areax, y=Areay),colour = "blue") +
  geom_text(data= runA45, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +
theme(legend.position="none") 
 

```


### Kerry 

```{r}

total45B <- run%>%group_by(Team) %>% filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99 )
total45B <-total45B[!duplicated(total45B[,c('poss')]),]
total45B <- total45B%>%group_by(Team) %>% filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99 )%>%summarize(count=n())


hp45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )
hp45B <-hp45B[!duplicated(hp45B[,c('poss')]),]
hp45B <- hp45B%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )%>%summarize(count=n())

KPLB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )
KPLB <-KPLB[!duplicated(KPLB[,c('poss')]),]
KPLB <-  KPLB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )%>%summarize(count=n())

KPRB <-  run%>%filter(Teamnum=="B",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )
KPRB<-KPRB[!duplicated(KPRB[,c('poss')]),]
KPRB <-  KPRB%>%filter(Teamnum=="B",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )%>%summarize(count=n())

run45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )
run45B <-run45B[!duplicated(run45B[,c('poss')]),]
run45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )%>%summarize(count=n())

RestartB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )
RestartB <-RestartB[!duplicated(RestartB[,c('poss')]),]
RestartB <-  RestartB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )%>%summarize(count=n())

LostB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )
LostB <-LostB[!duplicated(LostB[,c('poss')]),]
LostB <-  LostB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )%>%summarize(count=n())


KoLB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "6" )
KoLB <-KoLB[!duplicated(KoLB[,c('poss')]),]
KoLB <-  KoLB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "6" )%>%summarize(count=n())

KoRB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "5" )
KoRB <-KoRB[!duplicated(KoRB[,c('poss')]),]
KoRB <-  KoRB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "5" )%>%summarize(count=n())


tot45B <- bind_cols (total45B,hp45B,KPLB,KPRB,run45B, RestartB, LostB,KoRB,KoLB)



library(plyr)

tot45B <- rename(tot45B, c( count = "Total", count1 = "Hp", count2 = "Kp Left", count3 = "Kp Right", count4 = "Carry", count5 = "Restart Pass", count6 = "Lost", count7 = "Ko Received", count8 = "Ko Lost"))

detach(package:plyr)

#formattable (tot45B)

formattable (tot45B, align = c("l", rep("c", NCOL(tot45B) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:8) ~ color_tile("#DeF7E9", "#71CA97")))
```
 

### Kerry  - Game

```{r, fig.width = 16, fig.height = 12}

runB45all <- run %>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99)

runB45 <- run %>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99)

runB45 <-runB45[!duplicated(runB45[,c('poss')]),]

runB45 <-runB45 %>% group_by(zone) %>% summarise(count = n())

runB45 <-runB45 %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext, zone, by))


p + geom_density_2d(data = runB45all, aes(x=Areax, y=Areay),colour = "blue") +
  geom_text(data= runB45, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +
theme(legend.position="none") 


    
```


## Zones Frequency (Total Actions within a Zone)
### Armagh

```{r}

zoneA <- pass %>%group_by(Team, Zone) %>% filter(Teamnum == "A", Zone >=0, Zone <=30)%>%summarize(count=n())

ggplot(zoneA, aes(x = Zone, y = count)) +   
  geom_bar(stat = "identity", 
           fill = "#71CA97",    
           width = 0.50) +
theme_classic() +
     geom_vline(xintercept=5.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=10.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=15.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=20.25, linetype="dotted", color = "black") +
     geom_vline(xintercept=25.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=30.25, linetype="dotted", color = "black") +  
    annotate(geom="text", x= 2.5, y=-0.25, label="In-Def",color = "black") +
      annotate(geom="text", x=7.5, y=-0.25, label="Out-Def",color = "black") +
      annotate(geom="text", x= 12.5, y=-0.25, label="Mid Def",color = "black") +
      annotate(geom="text", x= 17.5, y=-0.25, label="Mid Att",color = "black") +
      annotate(geom="text", x= 22.5, y=-0.25, label="Out-Att",color = "black") +
    annotate(geom="text", x= 27.5, y=-0.25, label="In-Attf",color = "black") +
   scale_x_continuous(labels = pass$Zone, breaks = pass$Zone) 
```

### Kerry 
```{r}
zoneB <- pass %>%group_by(Team, Zone) %>% filter(Teamnum == "B", Zone >=0, Zone <=140)%>%summarize(count=n())

ggplot(zoneB, aes(x = Zone, y = count)) +   
  geom_bar(stat = "identity", 
           fill = "#71CA97",    
           width = 0.50) +
theme_classic() +
     geom_vline(xintercept=5.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=10.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=15.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=20.25, linetype="dotted", color = "black") +
     geom_vline(xintercept=25.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=30.25, linetype="dotted", color = "black") +  
    annotate(geom="text", x= 2.5, y=-0.25, label="In-Def",color = "black") +
      annotate(geom="text", x=7.5, y=-0.25, label="Out-Def",color = "black") +
      annotate(geom="text", x= 12.5, y=-0.25, label="Mid Def",color = "black") +
      annotate(geom="text", x= 17.5, y=-0.25, label="Mid Att",color = "black") +
      annotate(geom="text", x= 22.5, y=-0.25, label="Out-Att",color = "black") +
    annotate(geom="text", x= 27.5, y=-0.25, label="In-Att",color = "black") +
  scale_x_continuous(labels = pass$Zone, breaks = pass$Zone)  
```


# Time
## Possessions - Pitch Area Origin & Type (Ko Start Area = where received)
### Armagh


```{r}
zonesA <- sop%>%group_by (Team,Pitch_Area_Rec)%>% filter (Teamnum =="A")

zonesA <- zonesA%>%group_by (Team,Pitch_Area_Rec,Pitch_Area_No)%>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec",na.rm=TRUE), Ave_Time = mean(secs),Att_Time =sum(secs))

zonesA <- zonesA%>% arrange(Pitch_Area_No)

zonesA <- zonesA%>% arrange(Pitch_Area_No) %>% select(-Pitch_Area_No)


library(plyr)

zonesA <- rename(zonesA, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesA, align = c("l", rep("c", NCOL(zonesA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))

```


### Kerry
```{r}
zonesB <- sop %>%group_by (Team,Pitch_Area_Rec) %>%  filter (Teamnum =="B")

zonesB <- zonesB %>%group_by (Team,Pitch_Area_Rec,Pitch_Area_No) %>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec",na.rm=TRUE), Ave_Time = mean(secs),Att_Time =sum(secs))

zonesB <- zonesB %>% arrange(Pitch_Area_No)

zonesB <- zonesB %>% arrange(Pitch_Area_No) %>% select(-Pitch_Area_No)

library(plyr)

zonesB <- rename(zonesB, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesB, align = c("l", rep("c", NCOL(zonesB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))


```

## Possession Duration (secs)
### Armagh - Game 

```{r}

PosstimeAb  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks.y = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeAb, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeAb$count) * 1.3)) +
  my_theme()  +
theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Game")


```


### Periods 

```{r}
PosstimeA1b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "1") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeA1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA1b$count) * 1.3)) +
my_theme() +
theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 1")



PosstimeA2b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "2") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA1b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 2")



PosstimeA3a <- sop %>% group_by(line_col, .drop = FALSE)%>% filter(Teamnum == "A", period == "3") %>% summarise(count = n())
PosstimeA3b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "3") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA3b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA3b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 3")



PosstimeA4b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "4") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA4b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA4b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 4")

```

### Possessions - Origin & Time 

```{r}
timeA <-sop%>% filter (Teamnum =="A")

timeA <-timeA%>% group_by (Team,Pitch_Area_Rec,Pitch_Area_No) %>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

timeA <- timeA %>% arrange(Pitch_Area_No)

timeA <- timeA%>% arrange(Pitch_Area_No) %>% select(-Pitch_Area_No)


library(plyr)

timeA <- rename(timeA, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeA, align = c("l", rep("c", NCOL(timeA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Kerry - Game 

```{r}

PosstimeBb  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeBb, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeBb$count) * 1.3)) +
  my_theme() + 
  theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Game")


```


### Periods

```{r}


PosstimeB1b  <- sop %>% group_by(line_time)%>% filter(Teamnum == "B", period == "1") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

ggplot(PosstimeB1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 44, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB1b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 1")


PosstimeB2b  <- sop %>% group_by(line_time)%>% filter(Teamnum == "B", period == "2") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB2b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB2b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 2")


PosstimeB3b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B", period == "3") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB3b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB3b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 3")


PosstimeB4b  <- sop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B", period == "4") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB4b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB4b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Possession Duration (secs)", 
          subtitle = "Period 4")

```


### Possessions - Origin & Time 

```{r}

timeB <-sop %>% filter (Teamnum =="B")

timeB <-timeB%>% group_by (Team,Pitch_Area_Rec,Pitch_Area_No) %>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

timeB <- timeB %>% arrange(Pitch_Area_No)

timeB <- timeB %>% arrange(Pitch_Area_No) %>% select(-Pitch_Area_No)

library(plyr)

timeB <- rename(timeB, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeB, align = c("l", rep("c", NCOL(timeB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```


## Possessions - Shot Origin,Outcome & Time
### Armagh
```{r}


scrmsAA <-sop%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "A")

scrmsAA <-scrmsAA %>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))


scrmsAA <- scrmsAA %>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsAA <- rename(scrmsAA, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsAA, align = c("l", rep("c", NCOL(scrmsAA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Kerry
```{r}

scrmsB <-sop%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "B")

scrmsB <-scrmsB%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsB <- rename(scrmsB, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsB, align = c("l", rep("c", NCOL(scrmsB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))


```

## Phase - Pitch Area Origin & Type (Ko Start Area = where received)
### Armagh


```{r}
zonesA <- phasesop %>%group_by (Team,Pitch_Area_Rec)%>% filter (Teamnum =="A")

zonesA <- zonesA%>%group_by (Team,Pitch_Area_Rec)%>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec",na.rm=TRUE), Ave_Time = mean(secs),Att_Time =sum(secs))

library(plyr)

zonesA <- rename(zonesA, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesA, align = c("l", rep("c", NCOL(zonesA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))

```



### Kerry
```{r}
zonesB <- phasesop %>%group_by (Team,Pitch_Area_Rec) %>%  filter (Teamnum =="B")

zonesB <- zonesB%>%group_by (Team,Pitch_Area_Rec) %>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec",na.rm=TRUE), Ave_Time = mean(secs),Att_Time =sum(secs))

library(plyr)

zonesB <- rename(zonesB, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesB, align = c("l", rep("c", NCOL(zonesB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))


```


## Phase Duration (secs)
### Armagh - Game 

```{r}

PosstimeAb  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks.y = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeAb, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeAb$count) * 1.3)) +
  my_theme()  +
theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Game")


```


### Periods 

```{r}
PosstimeA1b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "1") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeA1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA1b$count) * 1.3)) +
my_theme() +
theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 1")



PosstimeA2b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "2") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA1b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 2")



#PosstimeA3a <- phasesop %>% group_by(line_col, .drop = FALSE)%>% filter(Teamnum == "A", period == "3") %>% summarise(count = n())
PosstimeA3b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "3") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA3b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA3b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 3")



PosstimeA4b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "A", period == "4") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeA4b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeA4b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 4")

```


```{r}
timeA <-phasesop%>% filter (Teamnum =="A")

timeA <-timeA%>% group_by (Team,Pitch_Area_Rec) %>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))


library(plyr)

timeA <- rename(timeA, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeA, align = c("l", rep("c", NCOL(timeA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Kerry - Game 

```{r}

PosstimeBb  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }



ggplot(PosstimeBb, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeBb$count) * 1.3)) +
  my_theme() + 
  theme(text = element_text(),legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Game")


```


### Periods

```{r}


PosstimeB1b  <- phasesop %>% group_by(line_time)%>% filter(Teamnum == "B", period == "1") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

ggplot(PosstimeB1b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 44, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB1b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 1")


PosstimeB2b  <- phasesop %>% group_by(line_time)%>% filter(Teamnum == "B", period == "2") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB2b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB2b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 2")


PosstimeB3b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B", period == "3") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB3b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB3b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 3")


PosstimeB4b  <- phasesop %>% group_by(line_time, .drop = FALSE)%>% filter(Teamnum == "B", period == "4") %>% summarise(count = n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }


ggplot(PosstimeB4b, aes(x =line_time, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = count, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(PosstimeB4b$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black")) +
  ggtitle("Phase Duration (secs)", 
          subtitle = "Period 4")

```

### Phase - Origin & Time 

```{r}

timeB <-phasesop %>% filter (Teamnum =="B")

timeB <-timeB%>% group_by (Team,Pitch_Area_Rec) %>% filter (Teamnum =="B")%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))


library(plyr)

timeB <- rename(timeB, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeB, align = c("l", rep("c", NCOL(timeB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```


## Phase - Shot Origin,Outcome & Time
### Armagh
```{r}


scrmsAA <-phasesop%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "A")

scrmsAA <-scrmsAA %>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))


scrmsAA <- scrmsAA %>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsAA <- rename(scrmsAA, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsAA, align = c("l", rep("c", NCOL(scrmsAA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Kerry
```{r}

scrmsB <-phasesop %>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "B")

scrmsB <-scrmsB%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsB <- rename(scrmsB, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsB, align = c("l", rep("c", NCOL(scrmsB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))


```


# Kick Outs

```{r}

Ko <- sop %>%group_by(Team) %>% filter (main == "Ko")%>%summarize(Poss_Ko =sum(main %in% c("Ko")), Poss_time =sum (secs/60), All_Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_PP =(All_Shots/Poss_Ko*100), Shot_time = sum(secs/All_Shots), All_Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")), Ko_Time = mean (Ko_Time))

library(plyr)

Ko <- rename(Ko, c( Poss_Ko = "Kickouts",Poss_time = "Total Time (min)",All_Shots = "All Shots", Shot_PP = "% Shots per Ko", Shot_time = "Shot Rate (secs)",All_Scores = "All Scores", Ko_Time = "Time to Ko"))

detach(package:plyr)

formattable (Ko, align = c("l", rep("c", NCOL(Ko) - 1)))
```

## Kick Outs - Armagh

```{r}

ko <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset=="Ko Rec"| subset =="Ko ToL")
ko <- ko %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset=="Ko Rec"| subset =="Ko ToL")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

final_data <- ko %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ko <- paste0("Total Kickouts: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Kickout Outcomes", 
          subtitle = total_ko) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))




```


### Pitch Area

```{r}
Ko_Pa_RecA <- sop %>% group_by(Pitch_Area_Ko) %>% filter(Teamnum == "A", main == "Ko") %>% summarise(count = n())

library(plyr)

Ko_Pa_RecA  <- rename(Ko_Pa_RecA, c(Pitch_Area_Ko = "Pitch Area Rec'd"))

detach(package:plyr)

formattable (Ko_Pa_RecA , align = c("l", rep("c", NCOL(Ko_Pa_RecA ) - 1)))
```


```{r, fig.width = 16, fig.height = 12}

komapA <-filter(pass, Teamnum == "A",subset =="Ko Rec"| subset =="Ko ToL")

koeffA <- koeff %>%group_by(Zoneoc,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(Ko_Rec =sum(subsetoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost))%>%select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneoc)

koeffA = koeffA %>% 
   unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

p +  geom_density_2d(data = komapA, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= koeffA, aes(x= tx, y=ty, label = korectol),colour = "blue", size = 30,alpha=0.4) + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
theme(legend.position="none")



```

```{r, fig.width = 16, fig.height = 12}
KoaveA <- sop %>% filter (Teamnum == "A",main== "Ko")
KoaveAb <- KoaveA %>% group_by(Pitch_Area_Ko) %>% summarise(AreaxocKo = mean(Areaxoc,na.rm = TRUE), AreayocKo = mean(Areayoc,na.rm = TRUE))

p + geom_segment(data = KoaveAb, aes(x = AreaxocKo, y = 0, xend = AreaxocKo, yend = 88, colour = Pitch_Area_Ko, size = 1))+
labs(colour="Average Possession End From Ko Received Pitch Area")+
theme(legend.position="bottom") +
    guides(color = FALSE, size = FALSE) +
    guides(color = guide_legend(override.aes = list(size = 10)))
```

### Kick Outs - By Period 

```{r}
PWcntA <- pass %>% group_by(period) %>% filter (main == "Ko", Teamnum == "A") %>% summarise(count = n ())

formattable (PWcntA, align = c("l", rep("c", NCOL(PWcntA) - 1)))
```


### Open Play Shot from Ko Received

```{r, fig.width = 16, fig.height = 12}

a <- sop %>% filter(Teamnum == "A",Ko_Oc == "Ko Rec", mainoc == "Shot Op Oc")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")





```

### Open Play Score from Ko Received

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "A",Ko_Oc == "Ko Rec", subsetoc == "Scr Op")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")


```

### ToL from Ko Received

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "A",Ko_Oc == "Ko Rec", subsetoc == "Ko ToL")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(subsetoc == "Ko ToL")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")



```


## Kick Outs - Kerry

```{r}

ko <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset=="Ko Rec"| subset =="Ko ToL")
ko <- ko %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset=="Ko Rec"| subset =="Ko ToL")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

final_data <- ko %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ko <- paste0("Total Kickouts: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Kickout Outcomes", 
          subtitle = total_ko) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))


```

### Pitch Area

```{r}
Ko_Pa_RecB <- sop %>% group_by(Pitch_Area_Ko) %>% filter(Teamnum == "B", main == "Ko") %>% summarise(count = n())

library(plyr)

Ko_Pa_RecB  <- rename(Ko_Pa_RecB, c(Pitch_Area_Ko = "Pitch Area Rec'd"))

detach(package:plyr)

formattable (Ko_Pa_RecB, align = c("l", rep("c", NCOL(Ko_Pa_RecB) - 1)))
```

```{r, fig.width = 16, fig.height = 12}

komapA <-filter(pass, Teamnum == "B",subset =="Ko Rec"| subset =="Ko ToL")

koeffA <- koeff %>%group_by(Zoneoc,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(Ko_Rec =sum(subsetoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost))%>%select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneoc)

koeffA = koeffA %>% 
   unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

p +  geom_density_2d(data = komapA, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= koeffA, aes(x= tx, y=ty, label = korectol),colour = "blue", size = 30,alpha=0.4) + 
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
theme(legend.position="none")



```

```{r, fig.width = 16, fig.height = 12}
KoaveB <- sop %>% filter (Teamnum == "B",main== "Ko")
KoaveBb <- KoaveB %>% group_by(Pitch_Area_Ko) %>% summarise(AreaxocKo = mean(Areaxoc,na.rm = TRUE), AreayocKo = mean(Areayoc,na.rm = TRUE))

p + geom_segment(data = KoaveBb, aes(x = AreaxocKo, y = 0, xend = AreaxocKo, yend = 88, colour = Pitch_Area_Ko, size = 1))+
labs(colour="Average Possession End From Ko Received Pitch Area")+
theme(legend.position="bottom") +
    guides(color = FALSE, size = FALSE) +
    guides(color = guide_legend(override.aes = list(size = 10)))
```


### Open Play Shot from Ko Received

```{r, fig.width = 16, fig.height = 12}

a <- sop %>% filter(Teamnum == "B",Ko_Oc == "Ko Rec", mainoc == "Shot Op Oc")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="B") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="B") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")







```

### Open Play Score from Ko Received

```{r, fig.width = 16, fig.height = 12}

a <- sop %>% filter(Teamnum == "B",Ko_Oc == "Ko Rec", subsetoc == "Scr Op")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="B") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")



```

### ToL from Ko Received

```{r, fig.width = 16, fig.height = 12}

a <- sop %>% filter(Teamnum == "B",Ko_Oc == "Ko Rec", subsetoc == "Ko ToL")

koeffBa <-  sop  %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="B") %>%summarize(KoRec =sum(Ko_Oc == "Ko Rec")) %>% select(Ko_Zone_Rec,KoRec)

koeffBa  <- koeffBa  %>% filter(KoRec != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

a <-  a %>%group_by(Ko_Zone_Rec)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(subsetoc == "Ko ToL")) %>% select(Ko_Zone_Rec,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, tx),ty = VLOOKUP(Ko_Zone_Rec, zonetext, zone, ty),bx = VLOOKUP(Ko_Zone_Rec, zonetext, zone, bx),by = VLOOKUP(Ko_Zone_Rec, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(Ko_Zone_Rec, koa, Ko_Zone_Rec, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(u, Scrd, KoRec, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = u),colour = "white", size = 30,alpha=0.4)  +
theme(legend.position="none")



```



# Possession Won 

```{r}
PW <- sop %>%group_by(Team) %>% filter (main == "PW")%>%summarize(Poss_PW =sum(main %in% c("PW")), Poss_time =sum (secs/60), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_PP =(Shots/Poss_PW*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))


library(plyr)

PW <- rename(PW, c(Poss_PW = "Possession Won", Poss_time = "Possession Time (mins)", Shot_PP = "% Shots per Possession", Shot_time = "Shot Rate (secs)"))

detach(package:plyr)

formattable (PW, align = c("l", rep("c", NCOL(All_Poss) - 1)))




```


### Possession Won - Armagh

```{r}

ToWA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="PW")
ToWA <- ToWA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="PW")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ToWA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ToWA <- paste0("Total Possession Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Possession Won",  # Add the title and subtitle
          subtitle = total_ToWA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

conqmapA <- filter(pass, Teamnum == "A", main =="PW")

conqmapA <-conqmapA %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt <- conqmapA %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapA, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapAcnt, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
theme(legend.position="none") 


```


### Possession Won - By Period 

```{r}
PWcntA <- pass %>% group_by(period) %>% filter (main == "PW", Teamnum == "A") %>% summarise(count = n ())

formattable (PWcntA, align = c("l", rep("c", NCOL(PWcntA) - 1)))
```


```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

conqmapA1 <- filter(pass, Teamnum == "A", main =="PW", period =="1")

conqmapA1 <-conqmapA1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt1 <- conqmapA1 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "1") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapA1, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapAcnt1, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

conqmapA2 <- filter(pass, Teamnum == "A", main =="PW", period =="2")

conqmapA2 <-conqmapA2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt2 <- conqmapA2 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "2") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapA2, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapAcnt2, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


conqmapA3 <- filter(pass, Teamnum == "A", main =="PW", period =="3")

conqmapA3 <-conqmapA3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt3 <- conqmapA3 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "3") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapA3, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapAcnt3, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

conqmapA4 <- filter(pass, Teamnum == "A", main =="PW", period =="4")

conqmapA4 <-conqmapA4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt4 <- conqmapA4 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "4") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapA4, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapAcnt4, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


```

### Shots from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "A",main == "PW", mainoc == "Shot Op Oc")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="A") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)

koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="A") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Zone,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```

### Score from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "A",main == "PW", subsetoc == "Scr Op")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="A") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)

koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="A") %>%summarize(Scr =sum(subsetoc == "Scr Op")) %>% select(Zone,Scr)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, Scr))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```


### Possession Lost from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "A",main == "PW", mainoc == "ToL")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="A") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)


koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="A") %>%summarize(ToL =sum(mainoc == "ToL")) %>% select(Zone,ToL)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, ToL))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```


### Possession Won - Kerry

```{r}


ToWA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="PW")
ToWA <- ToWA %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="PW")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ToWA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ToWA <- paste0("Total Possession Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Possession Won",  # Add the title and subtitle
          subtitle = total_ToWA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

conqmapB <- filter(pass, Teamnum == "B", main =="PW")

conqmapB <-conqmapB %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt <- conqmapB %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapB, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapBcnt, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
theme(legend.position="none") 


```

### Possession Won - By Period 

```{r}
PWcntB <- pass %>% group_by(period) %>% filter (main == "PW", Teamnum == "B") %>% summarise(count = n ())

formattable (PWcntB, align = c("l", rep("c", NCOL(PWcntB) - 1)))
```

```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

conqmapB1 <- filter(pass, Teamnum == "B", main =="PW", period =="1")

conqmapB1 <-conqmapB1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt1 <- conqmapB1 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "1") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapB1, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapBcnt1, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

conqmapB2 <- filter(pass, Teamnum == "B", main =="PW", period =="2")

conqmapB2 <-conqmapB2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt2 <- conqmapB2 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "2") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapB2, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapBcnt2, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


conqmapB3 <- filter(pass, Teamnum == "B", main =="PW", period =="3")

conqmapB3 <-conqmapB3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt3 <- conqmapB3 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "3") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapB3, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapBcnt3, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


conqmapB4 <- filter(pass, Teamnum == "B", main =="PW", period =="4")

conqmapB4 <-conqmapB4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt4 <- conqmapB4 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "4") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_density_2d(data = conqmapB4, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= conqmapBcnt4, aes(x= tx, y=ty, label = PW_Won),colour = "blue", size = 30,alpha=0.4) +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))





```

### Shot from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "B",main == "PW", mainoc == "Shot Op Oc")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="B") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)

koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="B") %>%summarize(Shot =sum(mainoc == "Shot Op Oc")) %>% select(Zone,Shot)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, Shot))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```

### Score from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "B",main == "PW", subsetoc == "Scr Op")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="B") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)

koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="B") %>%summarize(Scr =sum(subsetoc == "Scr Op")) %>% select(Zone,Scr)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, Scr))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```


### Possession Lost from PW

```{r, fig.width = 16, fig.height = 12}
a <- sop %>% filter(Teamnum == "B",main == "PW", mainoc == "ToL")

koeffBa <-  run %>%group_by(zone)%>%filter(Teamnum =="B") %>%summarize(PW =sum(main == "PW")) %>% select(zone,PW)

koeffBa  <- koeffBa  %>% filter(PW != 0)

koeffB <-koeffBa %>%
    mutate(tx = VLOOKUP(zone, zonetext, zone, tx),ty = VLOOKUP(zone, zonetext, zone, ty),bx = VLOOKUP(zone, zonetext, zone, bx),by = VLOOKUP(zone, zonetext,zone, by))

a <-  a %>%group_by(Zone)%>%filter(Teamnum =="B") %>%summarize(ToL =sum(mainoc == "ToL")) %>% select(Zone,ToL)

koa<-a %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext,zone, by))

koB <-koeffB %>%
    mutate(Scrd = VLOOKUP(zone, koa, Zone, ToL))

koB <-koB%>% replace(is.na(.), 0)

koB = koB %>% 
   unite(a, Scrd, PW, sep = "/", remove = FALSE)

p + geom_text(data= koB, aes(x= tx, y=ty, label = a),colour = "white", size = 30,alpha=0.4) 
```




# Tackling
## Tackle Outcomes 

```{r}

#Change total tackles to sum of the other counts
TckDef <- pass %>%group_by(Team) %>%summarize(TackleAttempts = sum (main %in% c("Tck Def")), Dispossess = sum(Action %in% c("Tck Dp Def")),
PossessionWon = sum (Action %in% c("Tck LB Won")),NonDispossess = sum(Action %in% c("Tck Def Ndp")), PassPress = sum(Action %in% c("Tck Prs")), FreeLoss = sum(main %in% c("Free Loss")))

library(plyr)

TckDef  <- rename(TckDef , c( TackleAttempts = "Tackle Attempts",PossessionWon = "Possession Won",NonDispossess = "Non-Dispossess",PassPress = "Pass Under Pressure", FreeLoss = "Free Loss"))

detach(package:plyr)


formattable (TckDef , align = c("l", rep("c", NCOL(TckDef ) - 1)))

```

## Passes per Defensive Action 
### Armagh

```{r}

passppda <- pass[pass$main!="Def Act", ]
passppda <- passppda[passppda$main!="Free Loss", ]
passppda <- passppda[passppda$main!="Tck End", ]
passppda <- passppda[passppda$main!="Sht Prs", ]
passppda <- passppda[passppda$main!="Spoil Off", ]
passppda <- passppda[passppda$main!="Opp Brk", ]

Adef <- passppda%>%group_by(Team)%>%filter(Teamnum == "A") 
Adef <- Adef %>%group_by(Team)%>%filter(Teamnum == "A") %>%summarize(Tack = sum(main == "Tck Def"),Spoil = sum(subset == "Spoil Def"), FreeLoss = sum (main == "Free Loss"), Def_Act = (Tack + Spoil + FreeLoss))

Bpass <- passppda %>%group_by(Team)%>%filter(Teamnum == "B")
Bpass <- Bpass %>%group_by(Team)%>%filter(Teamnum == "B") %>%summarize(Pass =sum(main == "Pass Op"))

BA <- bind_cols(Bpass,Adef)


BAdefact <- BA %>% summarize (Pass, Def_Act, PPDA = (Pass/Def_Act))


library(plyr)

BAdefact <- rename(BAdefact, c(Pass = "# Opposition Passes", Def_Act = "Tackle Attempt (Def Act)", PPDA = "Passes per Defensive Action"))

detach(package:plyr)

formattable (BAdefact, align = c("l", rep("c", NCOL(BAdefact) - 1)))


```

### Kerry
```{r}

passppda <- pass[pass$main!="Def Act", ]
passppda <- passppda[passppda$main!="Free Loss", ]
passppda <- passppda[passppda$main!="Tck End", ]
passppda <- passppda[passppda$main!="Sht Prs", ]
passppda <- passppda[passppda$main!="Spoil Off", ]
passppda <- passppda[passppda$main!="Opp Brk", ]

Bdef <- passppda %>%group_by(Team)%>%filter(Teamnum == "B") 
Bdef <- Bdef %>%group_by(Team)%>%filter(Teamnum == "B")  %>%summarize(Tack = sum(main == "Tck Def"), Spoil = sum(subset == "Spoil Def"), FreeLoss = sum (main == "Free Loss"), Def_Act = (Tack + Spoil + FreeLoss))

Apass <- passppda %>%group_by(Team)%>%filter(Teamnum == "A")
Apass <- Apass %>%group_by(Team)%>%filter(Teamnum == "A") %>%summarize(Pass =sum(main == "Pass Op"))

dubkeraif15 <- bind_cols(Apass,Bdef)

dubkeraif15defact <- dubkeraif15 %>% summarize(Pass, Def_Act, PPDA = (Pass/Def_Act))


library(plyr)

dubkeraif15defact <- rename(dubkeraif15defact, c(Pass = "# Opposition Passes", Def_Act = "Tackle Attempt (Def Act)", PPDA = "Passes per Defensive Action"))

detach(package:plyr)

formattable (dubkeraif15defact, align = c("l", rep("c", NCOL(dubkeraif15defact) - 1)))



```


## Tackle Attempts and Defensive Spoils

*Tackle Attempt (Tck Def) = Any contact made by defender on player in possession

*Spoil Def = Defending player creates a break from opposition pass 

### Armagh

```{r, fig.width = 16, fig.height = 12}

#Needs more than def act??

defactA <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"))

actA <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())


actAcnt  <- pass %>% group_by (Zone) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

actAcnt <-actAcnt %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actAcnt, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") 
  

```



```{r}
PWcntA <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

formattable (PWcntA, align = c("l", rep("c", NCOL(PWcntA) - 1)))
```

## Tackle Attempts and Defensive Spoils - By Period

```{r}
PWcntA <- pass %>% group_by (period) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

formattable (PWcntA, align = c("l", rep("c", NCOL(PWcntA) - 1)))
```

```{r, , out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

#Needs more than def act??

defactA1 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1")

actA1 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1") %>% summarise (count = n ())


actAcnt1  <- pass %>% group_by (Zone) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1") %>% summarise (count = n ())

actAcnt1 <-actAcnt1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA1,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actAcnt1, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 1") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactA2 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2")

actA2 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2") %>% summarise (count = n ())


actAcnt2  <- pass %>% group_by (Zone) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2") %>% summarise (count = n ())

actAcnt2 <-actAcnt2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA2,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actAcnt2, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 2") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactA3 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3")

actA3 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3") %>% summarise (count = n ())


actAcnt3  <- pass %>% group_by (Zone) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3") %>% summarise (count = n ())

actAcnt3 <-actAcnt3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA3,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actAcnt3, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 3") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactA4 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4")

actA4 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4") %>% summarise (count = n ())


actAcnt4  <- pass %>% group_by (Zone) %>%filter(Teamnum == "A",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4") %>% summarise (count = n ())

actAcnt4 <-actAcnt4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA4,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actAcnt4, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 4") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
  

```


### Kerry

```{r, fig.width = 16, fig.height = 12}



defactB <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"))

actB <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

actBcnt  <- pass %>% group_by (Zone) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

actBcnt <-actBcnt %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actBcnt, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +    
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") 

```


```{r}
PWcntB <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

formattable (PWcntB, align = c("l", rep("c", NCOL(PWcntB) - 1)))
```


## Tackle Attempts and Defensive Spoils - By Period


```{r}
PWcntB <- pass %>% group_by (period) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss")) %>% summarise (count = n ())

formattable (PWcntB, align = c("l", rep("c", NCOL(PWcntB) - 1)))
```

```{r, , out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

#Needs more than def act??

defactB1 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1")

actB1 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1") %>% summarise (count = n ())


actBcnt1  <- pass %>% group_by (Zone) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "1") %>% summarise (count = n ())

actBcnt1 <-actBcnt1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB1,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actBcnt1, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 1") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactB2 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2")

actB2 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2") %>% summarise (count = n ())


actBcnt2  <- pass %>% group_by (Zone) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "2") %>% summarise (count = n ())

actBcnt2 <-actBcnt2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB2,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actBcnt2, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 2") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactB3 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3")

actB3 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3") %>% summarise (count = n ())


actBcnt3  <- pass %>% group_by (Zone) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "3") %>% summarise (count = n ())

actBcnt3 <-actBcnt3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB3,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actBcnt3, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 3") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


defactB4 <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4")

actB4 <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4") %>% summarise (count = n ())


actBcnt4  <- pass %>% group_by (Zone) %>%filter(Teamnum == "B",subset %in% c("Spoil Def")| main %in% c ("Tck Def")| main %in% c ("Free Loss"), period == "4") %>% summarise (count = n ())

actBcnt4 <-actBcnt4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(88,88,88,88,88,88))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB4,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p + geom_text(data= actBcnt4, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) +  
  theme(legend.position="none") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
  labs(title = "Period 4") +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
  

```


## Frees Loss
### Armagh

```{r}

FKLA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A",  main =="Free Loss"|Action == "Free Loss Off")
FKLA <- FKLA %>%group_by(Team, Action) %>% filter(Teamnum == "A",  main =="Free Loss"|Action == "Free Loss Off")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKLA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKLA  <- paste0("Total Fk Loss: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Loss",  # Add the title and subtitle
          subtitle = total_FKLA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

#Map Armagh

freeAmap <- filter(pass, Teamnum == "A", main =="Free Loss"|Action == "Free Loss Off")

freeAmap <- freeAmap  %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeAmapcnt <- freeAmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(ToL =sum(main =="Free Loss"|Action == "Free Loss Off"))%>%select(Zone,ToL,tx,ty,bx,by)

p + geom_text(data= freeAmapcnt, aes(x= tx, y=ty, label = ToL),colour = "white", size = 30,alpha=0.4) +
#geom_text_repel(data = freeAmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="none")



```

### Kerry

```{r}

FKLB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")
FKLB <- FKLB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKLB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKLB <- paste0("Total Fk Loss: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Loss",  # Add the title and subtitle
          subtitle = total_FKLB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

freeBmap <-filter(pass, Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")

freeBmap <-freeBmap %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeBmapcnt <- freeBmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(ToL =sum(main =="Free Loss"|Action == "Free Loss Off"))%>%select(Zone,ToL,tx,ty,bx,by)

p + geom_text(data= freeBmapcnt, aes(x= tx, y=ty, label = ToL),colour = "white", size = 30,alpha=0.4) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="none")


```


# Possession Lost 
### Armagh



```{r, fig.width = 16, fig.height = 12}

ToLmapA <- filter(pass, Teamnum == "A", main =="ToL")

ToLmapA <-ToLmapA %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapAcnt <- ToLmapA %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapA, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapAcnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(legend.position="none") 


```

```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

ToLmapA1 <- filter(pass, Teamnum == "A", main =="ToL", period == "1")

ToLmapA1 <-ToLmapA1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapA1cnt <- ToLmapA1 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "1") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapA1, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapA1cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 1") 



ToLmapA2 <- filter(pass, Teamnum == "A", main =="ToL", period == "2")

ToLmapA2 <-ToLmapA2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapA2cnt <- ToLmapA2 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "2") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapA2, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapA2cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 2") 


ToLmapA3 <- filter(pass, Teamnum == "A", main =="ToL", period == "3")

ToLmapA3 <-ToLmapA3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapA3cnt <- ToLmapA3 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "3") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapA3, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapA3cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 3") 



ToLmapA4 <- filter(pass, Teamnum == "A", main =="ToL", period == "4")

ToLmapA4 <-ToLmapA4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapA4cnt <- ToLmapA4 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", period == "4") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapA4, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapA4cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 4") 




```


### Kerry


```{r, fig.width = 16, fig.height = 12}

ToLmapB <- filter(pass, Teamnum == "B", main =="ToL")

ToLmapB <-ToLmapB %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapBcnt <- ToLmapB %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapB, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapBcnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(legend.position="none") 


```

```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

ToLmapB1 <- filter(pass, Teamnum == "B", main =="ToL", period == "1")

ToLmapB1 <-ToLmapB1 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapB1cnt <- ToLmapB1 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "1") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapB1, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapB1cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 1") 



ToLmapB2 <- filter(pass, Teamnum == "B", main =="ToL", period == "2")

ToLmapB2 <-ToLmapB2 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapB2cnt <- ToLmapB2 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "2") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapB2, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapB2cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 2") 


ToLmapB3 <- filter(pass, Teamnum == "B", main =="ToL", period == "3")

ToLmapB3 <-ToLmapB3 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapB3cnt <- ToLmapB3 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "3") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapB3, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapB3cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 3") 



ToLmapB4 <- filter(pass, Teamnum == "B", main =="ToL", period == "4")

ToLmapB4 <-ToLmapB4 %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapB4cnt <- ToLmapB4 %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", period == "4") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_density_2d(data = ToLmapB4, aes(x=Areax, y=Areay),colour = "white") +
  geom_text(data= ToLmapB4cnt, aes(x= tx, y=ty, label = ToL),colour = "blue", size = 30,alpha=0.4) +
theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  theme(legend.position="none")+
  labs(title = "Period 4") 




```


# Shooting

## All Shots - Location & Outcome 

### Armagh

```{r}

ShotsAll <- sop %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsAll <-ShotsAll %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsAll, align = c("l", rep("c", NCOL(ShotsAll) - 1)))
```

```{r}

ASA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASA <- ASA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASA <- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```


```{r, fig.width = 16, fig.height = 12}


scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))


```


### All Shots - By Period 

```{r}
PWcntA <- pass %>% group_by(period) %>% filter (subset =="Shot Op"|subset == "Shot Rs", Teamnum == "A") %>% summarise(count = n ())

formattable (PWcntA, align = c("l", rep("c", NCOL(PWcntA) - 1)))
```

```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs", period == "1")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs", period == "1") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  labs(title = "Period 1")


scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs", period == "2")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs", period == "2") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  labs(title = "Period 2")



scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs", period == "3")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs", period == "3") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  labs(title = "Period 3")



scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs", period == "4")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs", period == "4") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5)) +
  labs(title = "Period 4")





```

## Open Play Shots - Location & Outcome 

### Armagh

```{r}

ShotsOp <- sop %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsOp <- ShotsOp %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100), Shot_dist = mean (Shot_Dist))

library(plyr)

ShotsOp <- rename(ShotsOp, c( Shot_Eff = "% Scoring Efficiency",Shot_dist = "Average Shot Distance"))

detach(package:plyr)

formattable (ShotsOp, align = c("l", rep("c", NCOL(ShotsOp) - 1)))

```

```{r}

OPA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc")
OPA <- OPA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- OPA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_OPA <- paste0("Total Op Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Open Play Shots",  # Add the title and subtitle
          subtitle = total_OPA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op")

shotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```

### Open Play Scores - Density 

```{r, fig.width = 16, fig.height = 12}
shotsA <- scores %>% filter(subsetoc == "Scr Op", Teamnum =="A")

p  + geom_density_2d(data = shotsA, aes(x=Areax, y=Areay),colour = "white") +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```

### Shot Pressure - Armagh

```{r, fig.width = 16, fig.height = 12}

shotsA <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "A",  subset =="Shot Op")

p + geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action), size = 6) + 
 scale_colour_manual(values = colshotpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = as.factor(shdf)), size = 6) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  labs(colour="Shot Type") +
  ggtitle("White = no pressure, yelow = light/late pressure, red = heavy pressure")

```

## Frees Won
### Armagh

```{r}

FKA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")
FKA <- FKA%>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKA <- paste0("Total Fk Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Won",  # Add the title and subtitle
          subtitle = total_FKA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

freeAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")

freeAmap <-freeAmap %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeAcnt <- freeAmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(FW =sum(main =="Free Won"))%>%select(Zone,FW,tx,ty,bx,by)

p +  geom_text(data= freeAcnt, aes(x= tx, y=ty, label = FW),colour = "white", size = 30,alpha=0.4) +
#geom_point(data = freeAmap, aes(x=Areax, y=Areay, colour = Action, shape = Action), size = 6) +
#geom_text_repel(data = freeAmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 6) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+ 
scale_colour_manual(values = colorAct)
```

## Free Kick Shots - Location & Outcome 
### Armagh

```{r}
ShotsRs <- sop %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsRs <- ShotsRs %>%group_by(Team)%>%filter(mainoc %in% c("Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsRs  <- rename(ShotsRs, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsRs, align = c("l", rep("c", NCOL(ShotsRs) - 1)))

```

```{r}

ASA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")
ASA <- ASA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASA <- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scores <- scores [scores$period!="F", ]

shotsRSeffA <- scores  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotsRSeffA  = shotsRSeffA  %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset == "Shot Rs")

p + geom_text(data= shotsRSeffA , aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))


```


## All Shots - Location & Outcome 

### Kerry

```{r}

ShotsAll <- sop %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsAll <- ShotsAll %>%group_by(Team)%>%filter(Teamnum == "B",mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsAll, align = c("l", rep("c", NCOL(ShotsAll) - 1)))
```

```{r}
ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASB%>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASB<- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASB)+   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() + theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))

```

###All Shots - By Period 

```{r}
PWcntB <- pass %>% group_by(period) %>% filter (subset =="Shot Op"|subset == "Shot Rs", Teamnum == "B") %>% summarise(count = n ())

formattable (PWcntB, align = c("l", rep("c", NCOL(PWcntB) - 1)))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresB <- scores [scores$period!="F", ]

shotsB <- scoresB %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op"|subset == "Shot Rs")

AllshotseffB <- scoresB  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffB = AllshotseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))



```

## Open Play Shots - Location & Outcome 

```{r}

ShotsOp <- sop %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsOp <- ShotsOp %>%group_by(Team)%>%filter(Teamnum == "B",mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100), Shot_dist = mean (Shot_Dist))

library(plyr)

ShotsOp <- rename(ShotsOp, c( Shot_Eff = "% Scoring Efficiency",Shot_dist = "Average Shot Distance"))

detach(package:plyr)

formattable (ShotsOp, align = c("l", rep("c", NCOL(ShotsOp) - 1)))

```

```{r}

OPB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc")

OPB <- OPB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- OPB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_OPB <- paste0("Total Op Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Open Play Shots",  # Add the title and subtitle
          subtitle = total_OPB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresB <- scores [scores$period!="F", ]


shotsB <- scoresB %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op")

shotseffB <- scoresB  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotseffB = shotseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))

```

### Open Play Scores - Density 

```{r, fig.width = 16, fig.height = 12}
shotsA <- scores %>% filter(subsetoc == "Scr Op", Teamnum =="B")

p  + geom_density_2d(data = shotsA, aes(x=Areax, y=Areay),colour = "white") +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```


### Shot Pressure - Kerry

```{r, fig.width = 16, fig.height = 12}
shotsB <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "B",  subset =="Shot Op")

p + geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action), size = 6) + 
 scale_colour_manual(values = colshotpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = as.factor(shdf)), size = 6) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  labs(colour="Shot Type") +
  ggtitle("White = no pressure, yelow = light/late pressure, red = heavy pressure")

```


## Frees Won
### Kerry

```{r}

FKB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")
FKB <- FKB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKB <- paste0("Total Fk Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Won",  # Add the title and subtitle
          subtitle = total_FKB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}


#freeBmap <- filter(pass, Teamnum == "B", subset %in% c ("FkwTs","FkwTns","Rs Pass PW"))

freeBmap <- pass%>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")

freeBmap <-freeBmap %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeBcnt <- freeBmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(FW =sum(main =="Free Won"))%>%select(Zone,FW,tx,ty,bx,by)

p +  geom_text(data= freeBcnt, aes(x= tx, y=ty, label = FW),colour = "white", size = 30,alpha=0.4) +
#geom_point(data = freeBmap, aes(x=Areax, y=Areay, colour = Action, shape = Action), size = 6) +
#geom_text_repel(data = freeBmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 6) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+ 
scale_colour_manual(values = colorAct)
```

## Free Kick Shots - Location & Outcome 

```{r}

ShotsRs <- sop %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsRs <-ShotsRs %>%group_by(Team)%>%filter(mainoc %in% c("Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsRs  <- rename(ShotsRs, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsRs, align = c("l", rep("c", NCOL(ShotsRs) - 1)))

```

```{r}

ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASB%>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASB<- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Shots",  # Add the title and subtitle
          subtitle = total_ASB)+   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() + theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

shotsB <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset == "Shot Rs")

shotsRSseffB <- scores  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)


shotsRSseffB = shotsRSseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotsRSseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30,alpha = 0.4) +
  geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```


# Passing

## All Passes

### Armagh

```{r, fig.width = 16, fig.height = 12}


ActA <- pass %>% filter(Teamnum =="A", main == "Pass Op")

p +  stat_density_2d(data = ActA, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none")

```

### Kerry


```{r, fig.width = 16, fig.height = 12}


ActB <- pass %>% filter(Teamnum =="B",  main == "Pass Op")

p +  stat_density_2d(data = ActB, aes(x=Areax, y=Areay, fill = ..level..), geom = "polygon", contour = TRUE) +
  scale_fill_distiller(palette= "Heat", direction=1) +
theme(legend.position="none")

```


## Kick Passing Density and Type

### Armagh

```{r, fig.width = 16, fig.height = 12}
ActA <- pass %>% filter(Teamnum =="A", main == "Pass Op")

ActAKP <- pass %>% filter(Teamnum =="A", Action %in% c("Kp Right", "Kp Left"))
 
ActAKPRec <- pass %>% filter(Teamnum =="A", Action %in% c("Kp Rec"))

u <- p + 
  geom_point(data = ActAKP , aes(x=Areax, y=Areay, colour = Action), size = 8) +
   geom_point(data = ActAKP , aes(x=Areax, y=Areay), colour ="gray72", size = 8) +
   geom_density_2d(data = ActAKP , aes(x=Areax, y=Areay),colour = "blue") +
theme(legend.position="bottom")




ggMarginal(u, groupColour = TRUE, groupFill = TRUE)

```

### Kerry

```{r, fig.width = 16, fig.height = 12}
ActA <- pass %>% filter(Teamnum =="B", main == "Pass Op")

ActAKP <- pass %>% filter(Teamnum =="B", Action %in% c("Kp Right", "Kp Left"))
 
ActAKPRec <- pass %>% filter(Teamnum =="B", Action %in% c("Kp Rec"))

u <- p + 
  geom_point(data = ActAKP , aes(x=Areax, y=Areay, colour = Action), size = 8) +
   geom_point(data = ActAKP , aes(x=Areax, y=Areay), colour ="gray72", size = 8) +
   geom_density_2d(data = ActAKP , aes(x=Areax, y=Areay),colour = "blue") +
theme(legend.position="bottom")




ggMarginal(u, groupColour = TRUE, groupFill = TRUE)

```

## Pass BreakArmagh

```{r, fig.width = 16, fig.height = 12}

passbd <- pass%>% group_by(Team,Action) %>%filter(Action == "Hp"|Action == "Kp"|Action == "Kp Left"|Action == "Kp Right"|Action == "Fk Pass"|Action == "Sl Pass"|Action == "Mk Kp"|Action == "Mk Hp"|Action == "Sl Kp Won To"|Action == "45 Pass"|Action == "Hp Assist"|Action == "Kp L Assist"|Action == "Kp R Assist"|Action == "Hp Key"|Action == "Kp L Key"|Action == "Kp R Key"|Action == "Mk Kp Key"|Action == "Mk Kp Key")

 
passbd <- passbd%>% group_by(Team,Action) %>%filter(Action == "Hp"|Action == "Kp"|Action == "Kp Left"|Action == "Kp Right"|Action == "Fk Pass"|Action == "Sl Pass"|Action == "Mk Kp"|Action == "Mk Hp"|Action == "Sl Kp Won To"|Action == "45 Pass"|Action == "Hp Assist"|Action == "Kp L Assist"|Action == "Kp R Assist"|Action == "Hp Key"|Action == "Kp L Key"|Action == "Kp R Key"|Action == "Mk Kp Key"|Action == "Mk Kp Key")%>%summarize(count=n())

formattable (passbd, align = c("l", rep("c", NCOL(passbd) - 1)))


#, position = "dodge"

q <- ggplot(data = passbd, aes(x = Team, y = count, fill = Action))

q +geom_bar(width=.7, stat = "identity", aes(x = Team, y = count, fill = Action)) +
  xlab("Team") + ylab("Pass Count") +
  ggtitle("Pass BreakArmagh") +
  theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank())

```

## Pass After Possession Won

### Armagh

```{r}
PWPassA <- run %>%group_by (Actionoc) %>% filter(Teamnum == "A", main == "PW", mainoc %in% c("Pass Op")) %>% summarise (count = n())

library(plyr)

PWPassA <- rename(PWPassA, c( Actionoc = "Pass Type"))

detach(package:plyr)

formattable (PWPassA, align = c("l", rep("c", NCOL(PWPassA) - 1)))

```


### Kerry

```{r}
PWPassB <- run %>%group_by (Actionoc) %>% filter(Teamnum == "B", main == "PW", mainoc %in% c("Pass Op")) %>% summarise (count = n())

library(plyr)

PWPassB <- rename(PWPassB, c( Actionoc = "Pass Type"))

detach(package:plyr)

formattable (PWPassB, align = c("l", rep("c", NCOL(PWPassB) - 1)))

```


## Pass per Possession
### Armagh

```{r}
passcntA <- pass%>%group_by(possno, .drop=TRUE) %>% filter (Teamnum == "A",main %in% c("Pass Op"))%>%summarise (count = n())


ggplot(passcntA  , aes(x = possno, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passcntA$possno, breaks = passcntA$possno)  + 
ylab("Pass per Possession") +
  xlab("Possession") +
theme(legend.position="none") +
 theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

### Kerry
```{r}
passcntB <- pass%>%group_by(possno, .drop=TRUE) %>% filter (Teamnum == "B",main %in% c("Pass Op"))%>%summarise (count = n())


ggplot(passcntB  , aes(x = possno, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passcntB$possno, breaks = passcntB$possno)  + 
ylab("Pass per Possession") +
  xlab("Possession") +
theme(legend.position="none") +
 theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

```{r}
#All_Passes  <- sop %>%group_by(Team) %>%summarize(Passes =sum(passno), Total_Possession_time =sum (secs/60), Passes_Per =mean(Total_Possession_time/Passes))


#library(plyr)

#All_Passes <- rename(All_Passes, c( Total_Possession_time = "Total Possession Time", Passes_Per = "Passes Per Possession"))

#detach(package:plyr)

#formattable (All_Passes, align = c("l", rep("c", NCOL(All_Passes) - 1)))

```

# Player Stats

## Pass Network - Armagh 

```{r,fig.width = 16, fig.height = 12}
runnetA <- runwork%>%filter(keep=="Y")

runnetA<- runnetA[runnetA$main!="Opp Brk", ]

runnetA<- runnetA[runnetA$mainoc!="Opp Brk", ]

aveposA <- runnetA %>%group_by(Player, main)%>%filter( Teamnum == "A", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op","Ko",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")


#Open play Pass & rec (links)
linksnetA <- runnetA %>% filter(main %in%c("Ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksnetA <- linksnetA %>% filter( Teamnum == "A") %>% select(Teamnum,Player,Playeroc)

linksnetA<- subset(linksnetA, Player != Playeroc)

linksnetA <- linksnetA %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksnetA  %>%
    mutate(Areax = VLOOKUP(Player,avgposA,Player, AreaxA),Areay = VLOOKUP(Player,avgposA,Player, AreayA),
xend = VLOOKUP(Playeroc,avgposA,Player, AreaxA),yend = VLOOKUP(Playeroc,avgposA,Player, AreayA))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksnetA %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksnetA %>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strnetA <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposA,Player, AreaxA),Areay = VLOOKUP(ply,avgposA,Player, AreayA))

strnetA [is.na(strnetA)] <- 0

strnetA <- strnetA %>% mutate (totstr = (instr+outstr))

strnetA <- strnetA %>% filter(Teamnum =="A")

strnetA <- subset(strnetA, Areax != 0, Areay !=0)

strnetA <- subset(strnetA, totstr != 0)

new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strnetA, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strnetA, aes(x=Areax, y=Areay, label = ply), colour = "white", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 
```

```{r, fig.width = 16, fig.height = 12}

#nodesteamA <- data.frame (teamsheet %>% filter (Teamnum =="A"))
                          
#nodesteamA <- data.frame (nodesteamA  %>% select (ply,Pos, name, Areax, Areay))

nodesteamA <- data.frame (teamsheet %>% filter (Teamnum =="A") %>% select (ply,Pos, name, Areax, Areay))

runnet <- runwork%>%filter(keep=="Y")

runnet<- runnet[runnet$main!="Opp Brk", ]

runnet<- runnet[runnet$mainoc!="Opp Brk", ]

#Open play Pass & rec (links)
linksA <- runnet %>% filter(Teamnum == "A",main %in%c("Pass Op","Ko"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksA <- rename(count(linksA, Player, Playeroc), weight = n)

linksA<- subset(linksA, Player != Playeroc)

linksA<- data.frame (linksA)

netA <- graph_from_data_frame(d=linksA, vertices=nodesteamA, directed=T) 

```

### In Degree (Number of Players a Player Received a Pass from)
```{r}
-sort(-degree(netA, mode="in"))
```

### Out Degree (Number of Players a Player Made a Pass to)
```{r}
-sort(-degree(netA, mode="out"))
```

### Strength in (Number of Passes Received by a Player)
```{r}
-sort(-strength(netA, mode="in"))
```

### Strength Out (Number of Passes/Shots Made by a Player)
```{r}
-sort(-strength(netA, mode="out"))
```

### Betweenness Centrality (Flow of Passes through a Player)
```{r}
-sort(-betweenness(netA, directed=F, weights=NA, normalized = T))
```

### Closeness Centrality (How Well connected and central a Player is within the Teams Network)
```{r}
-sort(-closeness(netA, mode="all", weights=NA, normalized=T))
```

###Entropy (The Unpredictability in who a Player Passes to/Takes shot)
```{r}
sort(diversity(netA))
```

### Global clustering coefficient (Groups of Players who pass to each other)
```{r}
transitivity(netA)
```

### eigen_centrality (How well connected the well connected are)
```{r}
-sort(-eigen_centrality(netA)$vector)
```

## Pass Network - Shots - Armagh

```{r, fig.width = 16, fig.height = 12}

runshtA <- runwork%>%filter(keep=="Y")

runshtA <- runshtA[runshtA$main!="Opp Brk", ]

runshtA <- runshtA[runshtA$mainoc!="Opp Brk", ]

passshota <- runshtA %>%group_by(poss) %>% filter (main =="Shot Op"|main == "Shot Rs")

#Pulls out all of the poss
passshotAA <- subset(runshtA, poss %in%passshota$poss)

aveposA <- passshotAA %>%group_by(Player, main)%>%filter( Teamnum == "A", main %in% c("Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op", "Ko",
"Ko Rec"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")


#Open play Pass & rec (links)
linksshtA <- runshtA %>% filter(main %in%c("Ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksshtA <- linksshtA %>% filter( Teamnum == "A") %>% select(Teamnum,Player,Playeroc)

linksshtA<- subset(linksshtA, Player != Playeroc)

linksshtA <- linksshtA %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksshtA  %>%
    mutate(Areax = VLOOKUP(Player,avgposA,Player, AreaxA),Areay = VLOOKUP(Player,avgposA,Player, AreayA),
xend = VLOOKUP(Playeroc,avgposA,Player, AreaxA),yend = VLOOKUP(Playeroc,avgposA,Player, AreayA))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksshtA %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksshtA%>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strshtA <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposA,Player, AreaxA),Areay = VLOOKUP(ply,avgposA,Player, AreayA))

strshtA [is.na(strshtA)] <- 0

strshtA <- strshtA %>% mutate (totstr = (instr+outstr))

strshtA <- strshtA %>% filter(Teamnum =="A")

strshtA <- subset(strshtA, Areax != 0, Areay !=0)

strshtA <- subset(strshtA, totstr != 0)

new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strshtA, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strshtA, aes(x=Areax, y=Areay, label = ply), colour = "white", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 
```

## Pass Network - Scores - Armagh

```{r, fig.width = 16, fig.height = 12}

runscrA <- runwork%>%filter(keep=="Y")

runscrA <- runscrA[runscrA$main!="Opp Brk", ]

runscrA <- runscrA[runscrA$mainoc!="Opp Brk", ]

passscra <- runscrA %>%group_by(poss)%>% filter (subsetoc=="Scr Op"|subsetoc =="Scr Rs")

#Pulls out all of the poss
passscrAA <- subset(runscrA, poss %in%passscra$poss)

aveposscrA <- passscrAA %>%group_by(Player, main)%>%filter( Teamnum == "A", main %in% c("Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op", "Ko",
"Ko Rec"))

AreaxA <- aveposscrA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposscrA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposscrA <- left_join(AreaxA, AreayA, by ="Player")


#Open play Pass & rec (links)
linksscrA <- passscrAA %>% filter(main %in%c("Ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksscrA <- linksscrA %>% filter( Teamnum == "A") %>% select(Teamnum,Player,Playeroc)

linksscrA<- subset(linksscrA, Player != Playeroc)

linksscrA <- linksscrA %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksscrA  %>%
    mutate(Areax = VLOOKUP(Player,avgposscrA,Player, AreaxA),Areay = VLOOKUP(Player,avgposscrA,Player, AreayA),
xend = VLOOKUP(Playeroc,avgposscrA,Player, AreaxA),yend = VLOOKUP(Playeroc,avgposscrA,Player, AreayA))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksscrA %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksscrA %>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strscrA <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposscrA,Player, AreaxA),Areay = VLOOKUP(ply,avgposscrA,Player, AreayA))

strscrA [is.na(strscrA)] <- 0

strscrA <- strscrA %>% mutate (totstr = (instr+outstr))

strscrA <- strscrA %>% filter(Teamnum =="A")

strscrA <- subset(strscrA, Areax != 0, Areay !=0)

strscrA <- subset(strscrA, totstr != 0)

new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strscrA, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strscrA, aes(x=Areax, y=Areay, label = ply), colour = "white", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "lightblue", high = "darkblue",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 
```



## Pass Network - Kerry
```{r,fig.width = 16, fig.height = 12}

runnetB <- runwork%>%filter(keep=="Y")

runnetB<- runnetB[runnetB$main!="Opp Brk", ]

runnetB<- runnetB[runnetB$mainoc!="Opp Brk", ]

aveposB <- runnetB %>%group_by(Player, main)%>%filter( Teamnum == "B", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op","Ko",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")


#Open play Pass & rec (links)
linksnetB <- runnetB %>% filter(main %in%c("ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksnetB <- linksnetB %>% filter( Teamnum == "B") %>% select(Teamnum,Player,Playeroc)

linksnetB<- subset(linksnetB, Player != Playeroc)

linksnetB <- linksnetB %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksnetB  %>%
    mutate(Areax = VLOOKUP(Player,avgposB,Player, AreaxB),Areay = VLOOKUP(Player,avgposB,Player, AreayB),
xend = VLOOKUP(Playeroc,avgposB,Player, AreaxB),yend = VLOOKUP(Playeroc,avgposB,Player, AreayB))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksnetB %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksnetB %>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strnetB <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposB,Player, AreaxB),Areay = VLOOKUP(ply,avgposB,Player, AreayB))

strnetB [is.na(strnetB)] <- 0

strnetB <- strnetB %>% mutate (totstr = (instr+outstr))

strnetB <- strnetB %>% filter(Teamnum =="B")

strnetB <- subset(strnetB, Areax != 0, Areay !=0)

strnetB <- subset(strnetB, totstr != 0)

new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "white", high = "red",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strnetB, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strnetB, aes(x=Areax, y=Areay, label = ply), colour = "black", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "white", high = "red",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 
```

```{r, fig.width = 20, fig.height = 20}


nodesteamB <- data.frame (teamsheet %>% filter (Teamnum =="B") %>% select (ply,Pos, name, Areax, Areay))

runnet <- runwork%>%filter(keep=="Y")

runnet<- runnet[runnet$main!="Opp Brk", ]

runnet<- runnet[runnet$mainoc!="Opp Brk", ]

#Open play Pass & rec (links)
linksB <- runnet %>% filter(Teamnum == "B",main %in%c("Pass Op","Ko"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksB <- rename(count(linksB, Player, Playeroc), weight = n)

linksB<- subset(linksB, Player != Playeroc)

linksB<- data.frame (linksB)

netB <- graph_from_data_frame(d=linksB, vertices=nodesteamB, directed=T) 


```

### In Degree (Number of Players a Player Received a Pass from)
```{r}
-sort(-degree(netB, mode="in"))
```

### Out Degree (Number of Players a Player Made a Pass to)
```{r}
-sort(-degree(netB, mode="out"))
```

### Strength in (Number of Passes Received by a Player)
```{r}
-sort(-strength(netB, mode="in"))
```

### Strength Out (Number of Passes/Shots Made by a Player)
```{r}
-sort(-strength(netB, mode="out"))
```

### Betweenness Centrality (Flow of Passes through a Player)
```{r}
-sort(-betweenness(netB, directed=F, weights=NA, normalized = T))
```

### Closeness Centrality (How Well connected and central a Player is within the Teams Network)
```{r}
-sort(-closeness(netB, mode="all", weights=NA, normalized=T))
```


### Entropy (The Unpredictability in who a Player Passes to/Takes shot)
```{r}
sort(diversity(netB))
```

### Global clustering coefficient (Groups of Players who pass to each other)
```{r}
transitivity(netB)
```

### eigen_centrality (How well connected the well connected are)
```{r}
-sort(-eigen_centrality(netB)$vector)
```

## Pass Network - Shots - Kerry

```{r, fig.width = 20, fig.height = 20}
runshtB <- runwork%>%filter(keep=="Y")

runshtB <- runshtB[runshtB$main!="Opp Brk", ]

runshtB <- runshtB[runshtB$mainoc!="Opp Brk", ]

passshotb <- runshtB %>%group_by(poss) %>% filter (main =="Shot Op"|main == "Shot Rs")

#Pulls out all of the poss
passshotBB <- subset(runshtB, poss %in%passshotb$poss)

aveposB <- passshotBB %>%group_by(Player, main)%>%filter( Teamnum == "B", main %in% c("Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op", "Ko",
"Ko Rec"))


AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")


#Open play Pass & rec (links)
linksshtB <- passshotBB %>% filter(main %in%c("ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksshtB <- linksshtB %>% filter( Teamnum == "B") %>% select(Teamnum,Player,Playeroc)

linksshtB<- subset(linksshtB, Player != Playeroc)

linksshtB <- linksshtB %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksshtB  %>%
    mutate(Areax = VLOOKUP(Player,avgposB,Player, AreaxB),Areay = VLOOKUP(Player,avgposB,Player, AreayB),
xend = VLOOKUP(Playeroc,avgposB,Player, AreaxB),yend = VLOOKUP(Playeroc,avgposB,Player, AreayB))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksshtB %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksshtB %>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strshtB <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposB,Player, AreaxB),Areay = VLOOKUP(ply,avgposB,Player, AreayB))

strshtB [is.na(strshtB)] <- 0

strshtB <- strshtB %>% mutate (totstr = (instr+outstr))

strshtB <- strshtB %>% filter(Teamnum =="B")

strshtB <- subset(strshtB, Areax != 0, Areay !=0)

strshtB <- subset(strshtB, totstr != 0)

new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "white", high = "red",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strshtB, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strshtB, aes(x=Areax, y=Areay, label = ply), colour = "black", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "white", high = "red",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 


```

## Pass Network - Scores - Kerry

```{r, fig.width = 20, fig.height = 20}

runscrB <- runwork%>%filter(keep=="Y")

runscrB <- runscrB[runscrB$main!="Opp Brk", ]

runscrB <- runscrB[runscrB$mainoc!="Opp Brk", ]

passscrb <- runscrB %>%group_by(poss)%>% filter (subsetoc=="Scr Op"|subsetoc =="Scr Rs")

#Pulls out all of the poss
passscrBB <- subset(runscrB, poss %in%passscrb$poss)

aveposB <- passscrBB %>%group_by(Player, main)%>%filter( Teamnum == "B", main %in% c("Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op","Ko",
"Ko Rec"))

AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")


#Open play Pass & rec (links)
linksscrB <- passscrBB %>% filter(main %in%c("Ko","Pass Op"))%>%select(Teamnum,Player,main,Playeroc, mainoc)

linksscrB <- linksscrB %>% filter( Teamnum == "B") %>% select(Teamnum,Player,Playeroc)

linksscrB<- subset(linksscrB, Player != Playeroc)

linksscrB <- linksscrB %>% group_by(Teamnum,Player,Playeroc) %>% summarise(weight =n())

match <-linksscrB  %>%
    mutate(Areax = VLOOKUP(Player,avgposB,Player, AreaxB),Areay = VLOOKUP(Player,avgposB,Player, AreayB),
xend = VLOOKUP(Playeroc,avgposB,Player, AreaxB),yend = VLOOKUP(Playeroc,avgposB,Player, AreayB))


#Nodes - deg
indeg <- match %>% group_by(Teamnum, Playeroc) %>% summarise(indeg=n())
outdeg <- match %>% group_by(Teamnum, Player) %>% summarise(outdeg=n())

#Nodes - count of pass out and rec in 
instr <- linksscrB %>% group_by (Playeroc)%>% summarise(instr = sum( weight))
outstr <- linksscrB %>% group_by (Player)%>% summarise(outstr = sum( weight))

teamsheetsht <- teamsheet %>%select(-plytime,-Areax,-Areay)

strscrB <- teamsheetsht %>% mutate(instr = VLOOKUP(ply,instr,Playeroc,instr),outstr = VLOOKUP(ply,outstr,Player, outstr),
Areax = VLOOKUP(ply,avgposB,Player, AreaxB),Areay = VLOOKUP(ply,avgposB,Player, AreayB))

strscrB [is.na(strscrB)] <- 0

strscrB <- strscrB %>% mutate (totstr = (instr+outstr))

strscrB <- strscrB %>% filter(Teamnum =="B")

strscrB <- subset(strscrB, Areax != 0, Areay !=0)

strscrB <- subset(strscrB, totstr != 0)


new_df <- subset(match, Player != Playeroc)

new_df$code <- paste0(new_df$Player, "-", new_df$Playeroc)

new_df$baby <- (apply(sapply(strsplit(as.character(new_df$code), "-"), 
                sort), 2, paste, collapse="-"))

a <- new_df %>% group_by(baby) %>% summarise(TotW = sum(weight))

new_df <- new_df %>% mutate(TotW = VLOOKUP(baby ,a,baby , TotW))

new_df <-new_df[!duplicated(new_df[,c('baby')]),]

f <- function(k) {
        step <- k
        function(y) seq(floor(min(y)), ceiling(max(y)), by = step)       
}

p + 
    geom_segment(data = new_df, aes(x = Areax, y = Areay, xend = xend, yend = yend,colour = weight),size = new_df$weight, alpha = 0.6) +
    labs(colour="Passes") +
    scale_colour_gradient(low = "white", high = "red",breaks = f(1)) +
    new_scale_color() +
    geom_point(data = strscrB, aes(x=Areax, y=Areay, colour = totstr,size = totstr), shape = 19) +
    geom_text(data = strscrB, aes(x=Areax, y=Areay, label = ply), colour = "black", size = 6) +
    theme(legend.position="bottom") +
    scale_size_continuous(range = c(0, 30),breaks = f(10)) +
    scale_colour_gradient(low = "white", high = "red",breaks = f(10)) +
    labs(size="Passes Made & Received") +
    labs(colour="Passes Made & Received") 

```


## Player On Ball Possession (Player Number, Player, Total)

*Total = Number of Passes & Kickouts Received + Possessions Won

### Armagh

```{r, fig.width = 16, fig.height = 12}

plytree <- plystatsA 

plytreeA = plytree %>% 
   unite(combined, Player...6, OBP, sep = " ", remove = FALSE)

treemap(dtf = plytreeA,
        index=c("combined"),
        vSize="OBP",
        vColor="OBP",
        palette="Spectral",
        type="value",
        border.col=c("grey70", "grey90"),
        fontsize.title = 36,
        algorithm="pivotSize",
        title ="On Ball Possessions",
        title.legend="Possessions",
        fontsize.labels= 25)
```

### Kerry

```{r, fig.width = 16, fig.height = 12}


plytree <- plystatsB

plytreeB = plytree %>% 
   unite(combined, Player...6, OBP, sep = " ", remove = FALSE)

treemap(dtf = plytreeB,
        index=c("combined"),
        vSize="OBP",
        vColor="OBP",
        palette="Spectral",
        type="value",
        border.col=c("grey70", "grey90"),
        fontsize.title = 36,
        algorithm="pivotSize",
        title ="On Ball Possessions",
        title.legend="Possessions",
        fontsize.labels= 25)
```


## Player Time on Ball

### Armagh

```{r}
ToBA <- run %>% group_by(Team,Player)%>% filter (keep == "Y",Teamnum == "A",main %in% c("Rec Op", "Rec Rs", "Ko Rec", "PW")) %>% summarise(Time_on_Ball =sum(time_diff))

ToBA  = ToBA  %>% 
   unite(plyid, Team, Player, sep = " ", remove = FALSE)

ToBA <- ToBA %>%  mutate(plyname = VLOOKUP(plyid,teamsheet,plyid, Player))

ToBA <- ToBA %>% select (plyname, Time_on_Ball)

library(plyr)

ToBA  <- rename(ToBA, c( plyname = "Player", Time_on_Ball = "Time on Ball"))

detach(package:plyr)


formattable (ToBA , align = c("l", rep("c", NCOL(ToBA) - 1)))

```

### Kerry

```{r}
ToBB <- run %>% group_by(Team,Player)%>% filter (keep == "Y",Teamnum == "B",main %in% c("Rec Op", "Rec Rs", "Ko Rec", "PW")) %>% summarise(Time_on_Ball =sum(time_diff))

ToBB  = ToBB  %>% 
   unite(plyid, Team, Player, sep = " ", remove = FALSE)

ToBB <- ToBB %>%  mutate(plyname = VLOOKUP(plyid,teamsheet,plyid, Player))

ToBB <- ToBB %>% select (plyname, Time_on_Ball)

library(plyr)

ToBB  <- rename(ToBB, c( plyname = "Player", Time_on_Ball = "Time on Ball"))

detach(package:plyr)


formattable (ToBB , align = c("l", rep("c", NCOL(ToBB) - 1)))

```


## Player Possession Involvement

### Armagh
```{r}


passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tck Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tck End", ]
passA <- passA[passA$main!="Tck Att", ]
passA <- passA[passA$main!="Tck Att Ndp", ]
passA <- passA[passA$main!="Opp Brk", ]

passA = passA %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

teamAplyrpossns <- passA%>%group_by(Player, poss) %>% filter(Teamnum == "A", main == "PW"| main == "Ko Rec"| main == "Rec Op"| 
main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamAplyr <-dplyr::distinct(teamAplyrpossns) 

teamAplyr <-teamAplyr%>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamAplyr , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$plynumname, breaks = passA$Player, expand = c(0, 0),
                     limits = c(0, max(passA$Player) * 1.3)) +
ylab("Poessession involvements") +
 theme_classic()+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



```

### Kerry
```{r}

passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tck Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tck End", ]
passB <- passB[passB$main!="Tck Att", ]
passB <- passB[passB$main!="Tck Att Ndp", ]
passB <- passB[passB$main!="Opp Brk", ]


passB = passB %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)


teamBplyrpossns <- passB%>%group_by(Player, poss) %>% filter(Teamnum == "B", main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamBplyr <-dplyr::distinct(teamBplyrpossns) 

teamBplyr <-teamBplyr%>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamBplyr , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passB$plynumname, breaks = passB$Player, expand = c(0, 0),
                     limits = c(0, max(passB$Player) * 1.3)) +
ylab("Poessession involvements") +
theme(legend.position="none") +
 theme_classic()+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```

## Player Shot Involvement

### Armagh
```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tck Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tck End", ]
passA <- passA[passA$main!="Tck Att", ]
passA <- passA[passA$main!="Tck Att Ndp", ]
passA <- passA[passA$main!="Opp Brk", ]

passA = passA %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscr <- passA%>%group_by(Team, Action) %>% filter(main  == "Shot Op Oc"|main =="Shot Rs Oc")

#Pulls out all of the poss
teamsht <- subset(passA,poss%in%pashscr$poss)
 
teamAsht<- teamsht%>%group_by(poss) %>% filter(Teamnum == "A")%>%select(Player,poss)

teamAshtA <-dplyr::distinct(teamAsht)

teamAshtA<- teamAshtA %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamAshtA , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$plynumname, breaks = passA$Player, expand = c(0, 0),
                     limits = c(0, max(passA$Player) * 1.3))  + 
ylab("Shot involvements") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



```

### Kerry
```{r}
passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tck Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tck End", ]
passB <- passB[passB$main!="Tck Att", ]
passB <- passB[passB$main!="Tck Att Ndp", ]
passB <- passB[passB$main!="Opp Brk", ]

passB = passB %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscr <- passB%>%group_by(Team, Action) %>% filter(main  == "Shot Op Oc"|main =="Shot Rs Oc")

#Pulls out all of the poss
teamsht <- subset(passB,poss%in%pashscr$poss)


teamBsht<- teamsht%>%group_by(poss) %>% filter(Teamnum == "B")%>%select(Player,poss)


teamBshtB <-dplyr::distinct(teamBsht)


teamBshtB<- teamBshtB %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamBshtB , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passB$plynumname, breaks = passB$Player, expand = c(0, 0),
                     limits = c(0, max(passB$Player) * 1.3)) +
ylab("Shot involvements") +
theme(legend.position="none") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))



```

## Player Score Involvement

###Armagh
```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tack Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tack Def Ndp", ]
passA <- passA[passA$main!="Sht Prs", ]
passA <- passA[passA$main!="Opp Brk", ]


passA = passA %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscr <- passA%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscr <- subset(passA,poss%in%pashscr$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscr%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamAscrA <-dplyr::distinct(plyrscrinv)

teamAscrA<- teamAscrA %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamAscrA , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$plynumname, breaks = passA$Player, expand = c(0, 0),
                     limits = c(0, max(passA$Player) * 1.3))  +  
ylab("Score involvements") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_y_continuous(breaks=seq(0,10,1))

```

### Kerry
```{r}

passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tck Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tck End", ]
passB <- passB[passB$main!="Tck Att", ]
passB <- passB[passB$main!="Tck Att Ndp", ]
passB <- passB[passB$main!="Opp Brk", ]

passB = passB %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscrB <- passB%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscrB <- subset(passB,poss%in%pashscrB$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscrB%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamBscrB <-dplyr::distinct(plyrscrinv)

teamBscrB <- teamBscrB %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamBscrB , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passB$plynumname, breaks = passB$Player, expand = c(0, 0),
                     limits = c(0, max(passB$Player) * 1.3)) +
  ylab("Score involvements") +
theme(legend.position="none") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

## Player Score Links 

### Armagh
```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tack Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tack Def Ndp", ]
passA <- passA[passA$main!="Sht Prs", ]
passA <- passA[passA$main!="Opp Brk", ]


passA = passA %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscr <- passA%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscr <- subset(passA,poss%in%pashscr$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscr%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamAscrA <- plyrscrinv

teamAscrA<- teamAscrA %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamAscrA , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$plynumname, breaks = passA$Player, expand = c(0, 0),
                     limits = c(0, max(passA$Player) * 1.3))  +  
ylab("Score involvements") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
scale_y_continuous(breaks=seq(0,10,1))

```

### Kerry
```{r}

passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tck Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tck End", ]
passB <- passB[passB$main!="Tck Att", ]
passB <- passB[passB$main!="Tck Att Ndp", ]
passB <- passB[passB$main!="Opp Brk", ]

passB = passB %>% 
   unite(plynumname, Player, plyname, sep = " ", remove = FALSE)

#id poss with shots
pashscrB <- passB%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscrB <- subset(passB,poss%in%pashscrB$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscrB%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamBscrB <- plyrscrinv

teamBscrB <- teamBscrB %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamBscrB , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passB$plynumname, breaks = passB$Player, expand = c(0, 0),
                     limits = c(0, max(passB$Player) * 1.3)) +
  ylab("Score involvements") +
theme(legend.position="none") +
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```


## % of Player Involvement in Team Actions
### Armagh

```{r}

pTotA <- plystatsA %>% select ("ply","Team","name", "OBPp","PWp","Recp","KoRecp","CPp","OpShotp","OpScrp", "Poss_Lostp","Fk_Wonp","Fk_Lostp")

library(plyr)

pTotA <- rename(pTotA, c( ply = "Player", OBPp = "On Ball%","Recp" = "Passes Received%",  PWp = "Possession Won%", KoRecp = "Ko Received%", 
CPp = "Comp. Pass%", OpShotp = "Total Shot%", OpScrp = "Total Scr%", Poss_Lostp= "Turnover Lost%", Fk_Wonp = "Fk Won%", Fk_Lostp = "Fk Loss%"))

detach(package:plyr)

pTotA[, 4:13] <- round(pTotA[, 4:13], digits = 2)

formattable(pTotA, align = c("l", rep("c", NCOL(pTotA) - 1)), list(
  `Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `On Ball%`= color_tile("#DeF7E9", "#71CA97"),
  `Passes Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Possession Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Ko Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Comp. Pass%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Shot%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Scr%`= color_tile("#DeF7E9", "#71CA97"),
  `Turnover Lost%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Loss%`= color_tile("#DeF7E9", "#71CA97")
))

```

### Kerry
```{r}
pTotB <- plystatsB %>% select ("ply","Team","name", "OBPp","PWp","Recp","KoRecp","CPp","OpShotp","OpScrp", "Poss_Lostp","Fk_Wonp","Fk_Lostp")

library(plyr)

pTotB <- rename(pTotB, c( ply = "Player", OBPp = "On Ball%","Recp" = "Passes Received%",  PWp = "Possession Won%", KoRecp = "Ko Received%", 
CPp = "Comp. Pass%", OpShotp = "Total Shot%", OpScrp = "Total Scr%", Poss_Lostp= "Turnover Lost%", Fk_Wonp = "Fk Won%", Fk_Lostp = "Fk Loss%"))

detach(package:plyr)

pTotB[, 4:13] <- round(pTotB[, 4:13], digits = 2)

formattable(pTotB, align = c("l", rep("c", NCOL(pTotB) - 1)), list(
  `Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `On Ball%`= color_tile("#DeF7E9", "#71CA97"),
  `Passes Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Possession Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Ko Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Comp. Pass%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Shot%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Scr%`= color_tile("#DeF7E9", "#71CA97"),
  `Turnover Lost%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Loss%`= color_tile("#DeF7E9", "#71CA97")
))

```

## Player Involvement by Pitch Area
### Armagh

```{r}
plyP_A <- pass%>%group_by(Player)%>% filter (Teamnum == "A",main %in% c("PW", "Pass Op","Pass Rs","Rec Op", "Rec Rs", "Shot Op", "Shot Rs", "Free Won"))%>%
summarize(In_Def = sum (Pitch_Area %in% c("In_Def")),Mid_Def = sum (Pitch_Area%in% c("Mid_Def")),Out_Def = sum (Pitch_Area %in% c("Out_Def")),
Out_Att = sum (Pitch_Area %in% c("Out_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),In_Att = sum (Pitch_Area %in% c("In_Att"))) 

formattable(plyP_A, align = c("l", rep("c", NCOL(plyP_A) - 1)), list(
  `Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `In_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Mid_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Out_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Out_Att`= color_tile("#DeF7E9", "#71CA97"),
  `Mid_Att`= color_tile("#DeF7E9", "#71CA97"),
  `In_Att`= color_tile("#DeF7E9", "#71CA97")))

```

### Kerry

```{r}
plyP_B <- pass%>%group_by(Player)%>% filter (Teamnum == "B",main %in% c("PW", "Pass Op","Pass Rs","Rec Op", "Rec Rs", "Shot Op", "Shot Rs", "Free Won"))%>%
summarize(In_Def = sum (Pitch_Area %in% c("In_Def")),Mid_Def = sum (Pitch_Area%in% c("Mid_Def")),Out_Def = sum (Pitch_Area %in% c("Out_Def")),
Out_Att = sum (Pitch_Area %in% c("Out_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),In_Att = sum (Pitch_Area %in% c("In_Att"))) 


formattable(plyP_B, align = c("l", rep("c", NCOL(plyP_B) - 1)), list(
  `Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `In_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Mid_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Out_Def`= color_tile("#DeF7E9", "#71CA97"),
  `Out_Att`= color_tile("#DeF7E9", "#71CA97"),
  `Mid_Att`= color_tile("#DeF7E9", "#71CA97"),
  `In_Att`= color_tile("#DeF7E9", "#71CA97")))
```


## Pass flow - Last 3 passes before a shot (Last row = Shot taker)
### Armagh
```{r}

TeamAPAScrflow  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAA <- subset(run, poss %in% TeamAPAScrflow$poss)

passA <-passAA %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passAidA <- passAid %>%select(possno, Player)

passAidA <-passAidA%>%group_by (possno) %>%
dplyr::mutate(i1 = row_number()) %>% 
  tidyr::spread(possno,Player)%>%
   select(-i1)

passAidA <- passAidA[sapply(passAidA, function(passAidA) !any(is.na(passAidA)))]

formattable (passAidA, align = c("l", rep("c", NCOL(passAidA) - 1)))

```

### Kerry
```{r}

TeamBPBScrflow  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

pass <- subset(run, poss %in% TeamBPBScrflow$poss)

passB <-pass %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

#write.csv(passA,"passA.csv")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())


passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))


passBidB <- passBid %>%select(possno, Player)


passBidB <-passBidB%>%group_by (possno) %>%
dplyr::mutate(i1 = row_number()) %>% 
  tidyr::spread(possno,Player)%>%
   select(-i1)


passBidB <- passBidB[sapply(passBidB, function(passBidB) !any(is.na(passBidB)))]

formattable (passBidB, align = c("l", rep("c", NCOL(passBidB) - 1)))
```


## Flow Counts - Last 3 passes before a shot
### Armagh

```{r}
#Counting flows for last 4 before a shot - Player numbers 

TeamAPAScrflow  <- pass %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAA <- subset(pass, poss %in% TeamAPAScrflow$poss)

passA <-passAA %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passAid <-passAid %>%group_by (possno)%>% filter(n()>3)

passAidAa <- passAid %>%select(possno, Player)

#by player
flowcnta <- passAidAa %>% group_by(possno) %>% summarize(Player=paste(Player,collapse=","))

flowcnta <- flowcnta %>% group_by(Player) %>% summarize(count=n())

#flowcnta 

#for each group by letters - last four before a score 

TeamAPAScrflow  <-pass %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passA <- subset(pass, poss %in% TeamAPAScrflow$poss)

passAA <- passA %>%filter (Teamnum == "A", main %in% c("Pass Op", "Shot Op"))

#passAA  <-passAA  %>% group_by(possno) %>% top_n(n=4)

passAid <-passAA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passAid <-passAid %>%group_by (possno)%>% filter(n()>3)


passAid <- passAid%>%
  group_by(possno) %>%
  mutate(daynum = as.integer(factor(Player, levels = unique(Player))))


passAid  <- passAid  %>%
   mutate(letters = letters[daynum])

#passAid


flowpassAA <- passAid %>% group_by(possno) %>% summarize(letters=paste(letters,collapse=","))

flowpassAA <- flowpassAA %>% group_by(letters) %>% summarize(count=n())

#flowpassAA


flowpassAA <-flowpassAA %>% mutate(totPW = sum(count), PWa = (count/totPW*100))

flowpassAA <-flowpassAA %>% select(letters, count, PWa)

flowpassAA[, 3] <- round(flowpassAA[, 3], digits = 2)


library(plyr)

flowpassAA <- rename(flowpassAA, c(letters= "Flow", PWa = "% Occurrence"))

detach(package:plyr)

formattable (flowpassAA, align = c("l", rep("c", NCOL(letters) - 1)))

```


### Kerry

```{r}
#Counting flows for last 4 before a shot - Player numbers 

TeamBPBScrflow  <- pass %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passBB <- subset(pass, poss %in% TeamBPBScrflow$poss)

passB <-passBB %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passBid <-passBid %>%group_by (possno)%>% filter(n()>3)

passBidBb <- passBid %>%select(possno, Player)

#by player
flowcntb <- passBidBb %>% group_by(possno) %>% summarize(Player=paste(Player,collapse=","))

flowcntb <- flowcntb %>% group_by(Player) %>% summarize(count=n())

#flowcnta 

#for each group by letters - last four before a score 

TeamBPBScrflow  <-pass %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passB <- subset(pass, poss %in% TeamBPBScrflow$poss)

passBB <- passB %>%filter (Teamnum == "B", main %in% c("Pass Op", "Shot Op"))

#passBB  <-passBB  %>% group_by(possno) %>% top_n(n=4)

passBid <-passBB %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passBid <-passBid %>%group_by (possno)%>% filter(n()>3)


passBid <- passBid%>%
  group_by(possno) %>%
  mutate(daynum = as.integer(factor(Player, levels = unique(Player))))


passBid  <- passBid  %>%
   mutate(letters = letters[daynum])

#passBid


flowpassBB <- passBid %>% group_by(possno) %>% summarize(letters=paste(letters,collapse=","))

flowpassBB <- flowpassBB %>% group_by(letters) %>% summarize(count=n())

#flowpassBB


flowpassBB <-flowpassBB %>% mutate(totPW = sum(count), PWa = (count/totPW*100))

flowpassBB <-flowpassBB %>% select(letters, count, PWa)

flowpassBB[, 3] <- round(flowpassBB[, 3], digits = 2)


library(plyr)

flowpassBB <- rename(flowpassBB, c(letters= "Flow", PWa = "% Occurrence"))

detach(package:plyr)

formattable (flowpassBB, align = c("l", rep("c", NCOL(letters) - 1)))

```


## Assists

*Pass inside opposition 45 that lead to a score

###Armagh 

```{r}

TeamAPAScrflowAst  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAAst <- subset(run, poss %in% TeamAPAScrflowAst$poss)


TeamAPAScrflowAst  <- run %>%group_by(Team, Action) %>% filter( subset == "Scr Op")

passAAst <- subset(passAAst, poss %in% TeamAPAScrflowAst$poss)

passA <-passAAst %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passAidA <- passAid %>%filter (Areax > 99.9)%>%select(possno, Player)

passAidA <- passAid %>%filter (Areax > 99.9)

passAidA <-passAidA[!duplicated(passAidA[,c('possno')]),]

passAidA <-passAidA %>%group_by(Player)%>%summarize(Assist =sum(main == "Pass Op"))

passAidA <- passAidA[passAidA$Assist!="0", ]

formattable (passAidA, align = c("l", rep("c", NCOL(passAidA) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))


```

### Kerry

```{r}
#Assists - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 

TeamBPBScrflowBst  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passBAst <- subset(run, poss %in% TeamBPBScrflowBst$poss)


passB <-passBAst %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

#write.csv(passB,"passB.csv")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passBidB <- passBid %>%filter (Areax > 99.9)%>%select(possno, Player)

passBidB <- passBid %>%filter (Areax > 99.9)

passBidB <-passBidB[!duplicated(passBidB[,c('possno')]),]

passBidB <-passBidB %>%group_by(Player)%>%summarize(Assist =sum(main == "Pass Op"))

passBidB <- passBidB[passBidB$Assist!="0", ]

formattable (passBidB, align = c("l", rep("c", NCOL(passBidB) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))



```

## Key Pass 

*Pass inside opposition 45 that lead to a shot

### Armagh

```{r}
#Key Passes - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 


TeamAPAMsflowKey  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAKey <- subset(run, poss %in% TeamAPAMsflowKey$poss)


TeamAPAMsflowKey  <- run %>%group_by(Team, Action) %>% filter( subset == "Ms Op")

passAAKey <- subset(passAKey, poss %in% TeamAPAMsflowKey$poss)

passAKey <-passAAKey %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passAKey <- passAKey %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAidKey <-passAKey %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAidKey <-passAidKey%>%group_by(possno,id)%>%arrange(desc(id))
 
passAidKey <-passAidKey %>% group_by(possno) %>% arrange(possno)

passAidKey <-passAidKey %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passAidA <- passAid %>%filter (Areax > 99.9)%>%select(possno, Player)

passAidAKey <- passAidKey %>%filter (Areax > 99.9)

passAidAKey <-passAidAKey[!duplicated(passAidAKey[,c('possno')]),]

passAidAKey <-passAidAKey %>%group_by(Player)%>%summarize(Key_Pass =sum(main == "Pass Op"))

passAidAKey <- passAidAKey[passAidAKey$Key_Pass!="0", ]

formattable (passAidAKey, align = c("l", rep("c", NCOL(passAidAKey) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))
```

### Kerry

```{r}
#Key Passes - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 

TeamBPBMsflowKey  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passBKey <- subset(run, poss %in% TeamBPBMsflowKey$poss)

TeamBPBMsflowKey  <- run %>%group_by(Team, Action) %>% filter( subset == "Ms Op")

passBBKey <- subset(passBKey, poss %in% TeamBPBMsflowKey$poss)

passBKey <-passBBKey %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passBKey <- passBKey %>%filter (Teamnum == "B")

#write.csv(passB,"passB.csv")

passBidKey <-passBKey %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBidKey <-passBidKey%>%group_by(possno,id)%>%arrange(desc(id))
 
passBidKey <-passBidKey %>% group_by(possno) %>% arrange(possno)

passBidKey <-passBidKey %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passBidB <- passBid %>%filter (Areax > 99.9)%>%select(possno, Player)

passBidBKey <- passBidKey %>%filter (Areax > 99.9)

passBidBKey <-passBidBKey[!duplicated(passBidBKey[,c('possno')]),]

passBidBKey <-passBidBKey %>%group_by(Player)%>%summarize(Key_Pass =sum(main == "Pass Op"))

passBidBKey <- passBidBKey[passBidBKey$Key_Pass!="0", ]

formattable (passBidBKey, align = c("l", rep("c", NCOL(passBidBKey) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))

```


## Posessions Per Playing Time

```{r}
ggplot() + 
geom_point(data = plystatsA , aes(x = plytime, y = OBP, colour = Team), size =2) +
geom_text_repel(data = plystatsA , aes(x = plytime, y = OBP, colour = Team, label = ply), size = 4) +
  geom_point(data = plystatsB , aes(x = plytime, y = OBP, colour = Team), size =2) +
geom_text_repel(data = plystatsB , aes(x = plytime, y = OBP, colour = Team, label = ply), size = 4) +
theme_classic () +
guides(size = FALSE) + 
  theme(legend.position="bottom")+ 
  scale_colour_manual (values = teamcol) +
scale_y_continuous(breaks=seq(0,40,5)) +
  expand_limits(x = 0, y = 0)
```


## Open Play Shots vs Playing Time

```{r}

plystatsopptA <- filter(plystatsA, OpShot != 0)
plystatsopptB <- filter(plystatsB, OpShot != 0)

ggplot() + 
geom_point(data = plystatsopptA , aes(x = plytime, y = OpShot, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsopptA , aes(x = plytime, y = OpShot, colour = Teamnum, label = ply), size = 4) +
  geom_point(data = plystatsopptB , aes(x = plytime, y = OpShot, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsopptB , aes(x = plytime, y = OpShot, colour = Teamnum, label = ply), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")+
   scale_colour_manual (values = teamnumcol) +
  scale_y_continuous(breaks=seq(0,4,1))+
  expand_limits(x = 0, y = 0)
```

## Open Play Scores vs Playing Time

```{r}

plystatsopscrptA <- filter(plystatsA, OpScr != 0)
plystatsopscrptB <- filter(plystatsB, OpScr != 0)
ggplot() + 
geom_point(data = plystatsopscrptA , aes(x = plytime, y = OpScr, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsopscrptA , aes(x = plytime, y = OpScr, colour = Teamnum, label = ply), size = 4) +
  geom_point(data = plystatsopscrptB , aes(x = plytime, y = OpScr, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsopscrptB , aes(x = plytime, y = OpScr, colour = Teamnum, label = ply), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")+
   scale_colour_manual (values = teamnumcol) +
  scale_y_continuous(breaks=seq(0,4,1)) +
  expand_limits(x = 0, y = 0)
```

## Open Play Shots vs Open Play Score

```{r}
plystatsscrA <- plystatsA %>% filter(OpScr >0)
plystatsscrB <- plystatsB %>% filter(OpScr >0)

ggplot() + 
geom_point(data = plystatsscrA , aes(x = OpShot, y = OpScr, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsscrA , aes(x = OpShot, y = OpScr, colour = Teamnum, label = ply), size = 4) +
  geom_point(data = plystatsscrB , aes(x = OpShot, y = OpScr, colour = Teamnum), size = 2) +
geom_text_repel(data = plystatsscrB , aes(x = OpShot, y = OpScr, colour = Teamnum, label = ply), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")+
   scale_colour_manual (values = teamnumcol)+
  scale_y_continuous(breaks=seq(0,4,1)) +
  expand_limits(x = 0, y = 0)
```



