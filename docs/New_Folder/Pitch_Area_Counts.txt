#Total passes, distance, poss duration (not used) and m.s
totrunID <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "In_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMD <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Mid_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunOD <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Out_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))


totrunOA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Out_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Mid_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunIA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "In_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

# Players involved

teamAplyrpossnsID <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Def")%>%select(Player, poss)

teamAplyrID <-dplyr::distinct(teamAplyrpossnsID) 

teamAplyrID <-teamAplyrID %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  

# Players involved

teamAplyrpossnsMD <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Def")%>%select(Player, poss)

teamAplyrMD <-dplyr::distinct(teamAplyrpossnsMD) 

teamAplyrMD <-teamAplyrMD %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved

teamAplyrpossnsOD <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Def")%>%select(Player, poss)

teamAplyrOD <-dplyr::distinct(teamAplyrpossnsOD) 

teamAplyrOD <-teamAplyrOD %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved

teamAplyrpossnsOA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Att")%>%select(Player, poss)

teamAplyrOA <-dplyr::distinct(teamAplyrpossnsOA) 

teamAplyrOA <-teamAplyrOA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved

teamAplyrpossnsMA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Att")%>%select(Player, poss)

teamAplyrMA <-dplyr::distinct(teamAplyrpossnsMA) 

teamAplyrMA <-teamAplyrMA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved

teamAplyrpossnsIA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Att")%>%select(Player, poss)

teamAplyrIA <-dplyr::distinct(teamAplyrpossnsIA) 

teamAplyrIA <-teamAplyrIA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


passSoP  <- passSoP  %>% mutate(passno = VLOOKUP(poss,totrun, poss, passes),plyinv = VLOOKUP(poss,teamAplyr, poss, count),
tot_dist = VLOOKUP(poss,totrun, poss, tot_dist),m_s = VLOOKUP(poss,totrun, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoID = VLOOKUP(poss,totrunID, poss, passes),plyinvID = VLOOKUP(poss,teamAplyrID, poss, count),
tot_distID = VLOOKUP(poss,totrunID, poss, tot_dist), durID= VLOOKUP(poss,totrunID, poss, dur) ,m_sID = VLOOKUP(poss,totrunID, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoMD = VLOOKUP(poss,totrunMD, poss, passes),plyinvMD = VLOOKUP(poss,teamAplyrMD, poss, count),
tot_distMD = VLOOKUP(poss,totrunMD, poss, tot_dist), durMD= VLOOKUP(poss,totrunMD, poss, dur),m_sMD = VLOOKUP(poss,totrunMD, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoOD = VLOOKUP(poss,totrunOD, poss, passes),plyinvOD = VLOOKUP(poss,teamAplyrOD, poss, count),
tot_distOD = VLOOKUP(poss,totrunOD, poss, tot_dist), durOD = VLOOKUP(poss,totrunOD, poss, dur),m_sOD = VLOOKUP(poss,totrunOD, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoOA = VLOOKUP(poss,totrunOA, poss, passes),plyinvOA = VLOOKUP(poss,teamAplyrOA, poss, count),
tot_distOA = VLOOKUP(poss,totrunOA, poss, tot_dist), durOA= VLOOKUP(poss,totrunOA, poss, dur),m_sOA = VLOOKUP(poss,totrunOA, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoMA = VLOOKUP(poss,totrunMA, poss, passes),plyinvMA = VLOOKUP(poss,teamAplyrMA, poss, count),
tot_distMA = VLOOKUP(poss,totrunMA, poss, tot_dist), durMA = VLOOKUP(poss,totrunMA, poss, dur),m_sMA = VLOOKUP(poss,totrunMA, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoIA = VLOOKUP(poss,totrunIA, poss, passes),plyinvIA = VLOOKUP(poss,teamAplyrIA, poss, count),
tot_distIA = VLOOKUP(poss,totrunIA, poss, tot_dist), durIA = VLOOKUP(poss,totrunIA, poss, dur),m_sIA = VLOOKUP(poss,totrunIA, poss, m_s))

passSoP  <- passSoP  %>% mutate(plyshot  = VLOOKUP(poss,runShtd, poss, Player), shot_type  = VLOOKUP(poss,runShtd, poss, Action),
shotx  = VLOOKUP(poss,runShtd, poss,Areax),shoty  = VLOOKUP(poss,runShtd, poss,Areay),
Shot_Dist  = VLOOKUP(poss,runShtd, poss,Shot_Dist)
,Shot_vec = VLOOKUP(poss,runShtd, poss,vec),Shot_PA = VLOOKUP(poss,runShtd, poss,Pitch_Area),Shot_PAno = VLOOKUP(poss,runShtd, poss,Pitch_Area_No))


passSoP  <- passSoP  %>% mutate(Ko_Time  = VLOOKUP(poss,Ko_Time, possoc, Ko_Time),Ko_Dist  = VLOOKUP(poss,KOuts, poss,Ko_Dist)
,Ko_Vec  = VLOOKUP(poss,KOuts, poss,vec), Ko_Oc  = VLOOKUP(poss,KOuts, poss,mainoc),Ko_Ply = VLOOKUP(poss,KOuts, poss,Playeroc)
,Pitch_Area_Ko  = VLOOKUP(poss,KOuts, poss,Pitch_End)
,Ko_Zone_Rec  = VLOOKUP(poss,KOuts, poss,zoneoc),Ko_Zone_X = VLOOKUP(poss,KOuts, poss,xend),Ko_Zone_Y  = VLOOKUP(poss,KOuts, poss,yend))

