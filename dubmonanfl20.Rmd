---
title: "Dublin (1.15) vs Monaghan (1.15)"
output:
  html_document:
    theme: cosmo
    toc: yes
    toc_float: yes

---

National Football League Division 1 

Round 3

Croke Park

08/02/2020

Total Game Time: 81 mins

1st Half: 37 mins 

2nd Half:  44 mins

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, options(knitr.kable.NA = ''))

#Load packages and pitch
#install.packages('digest', repos='http://cran.us.r-project.org')
library (digest)
library(flexdashboard)
library(dplyr)
library(deldir)
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(knitr)
library(rmarkdown)
library(kableExtra)
library(data.table)
library(RColorBrewer)
library(gridExtra)
library(igraph)
library(tidyverse)
library(treemap)
library(plotly)
library(networkD3)
library (curl)
library(formattable)
library(grid)
library(yaml)
library (tinytex)
library (ggforce)
library (waffle)
library (ggnewscale)
library(factoextra)
library(cluster)
library(tidyquant)
```

```{r}

match <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/matchdubmonnfl20.csv", header=TRUE, sep=";")
attach (match)

sets <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/sets.csv", header=TRUE, sep=";")
attach (sets)

teamsheet <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/teamsheetdubmonnfl20.csv", header=TRUE, sep=";")
attach (teamsheet)

teamsheet = teamsheet %>% 
   unite(plyid, Team, ply, sep = " ", remove = FALSE)
   
zonetext <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/zonetext.csv", header=TRUE, sep=";")
attach (zonetext) 



#teamcnts <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/newplan/passlinenewplan.csv", header=TRUE, sep=";")
#attach (teamcnts)



pass <-match

pass$period <- as.integer(pass$period)
pass$poss <- as.factor(pass$poss)
pass$Phase <- as.factor(pass$Phase)
pass$Teamnum <- as.factor(pass$Teamnum)
pass$subset <- as.factor(pass$subset)

run <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/rundubmonnfl20.csv", header=TRUE, sep=";")
attach (run)

run <-run %>% mutate(line_time = ifelse(linecol == 1 ,"0-9", ifelse(linecol == 2, "10-19",ifelse(linecol == 3,"20-29" ,ifelse(linecol == 4, "30-39" ,ifelse(linecol == 5, "40-49" ,ifelse(linecol == 6, "50-59",ifelse(linecol == 7, "60-69",ifelse(linecol == 8, "70+",10)))))))))

sop <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/sopdubmonnfl20.csv", header=TRUE, sep=";")
attach (sop)

plystats <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/plystatsdubmonnfl20.csv", header=TRUE, sep=";")
attach (plystats)

scores  <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/scoresdubmonnfl20.csv", header=TRUE, sep=";")
attach (scores)

scores <-scores %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))


koonlyA <- pass %>%group_by(Team) %>% filter(subset == "Ko"|subset == "Ko Rec"| subset == "Ko ToL")%>%select(Teamnum,Phase,Team,Player,plylab,subset,Zone,main)
oddps <- koonlyA[seq(1, nrow(koonlyA), 2),]
colnames(oddps) <- c("Teamnum","Phase","Team","Player","plylab","subset","Zone","main")
evenps <- koonlyA[seq(2, nrow(koonlyA), 2),]
colnames(evenps) <- c("Teamnumoc","Phaseoc","Teamoc","Playeroc","plylaboc","subsetoc","Zoneoc","mainoc")
koonlyA <- bind_cols(oddps, evenps) 
koonlyA <- koonlyA%>%select("Teamnum","Phase","Team","Player","plylab","subset","Zone","main","plylaboc","subsetoc","Zoneoc","mainoc")

koeff <-koonlyA %>%
    mutate(tx = VLOOKUP(Zoneoc, zonetext, zone, tx),ty = VLOOKUP(Zoneoc, zonetext, zone, ty),bx = VLOOKUP(Zoneoc, zonetext, zone, bx),by = VLOOKUP(Zoneoc, zonetext, zone, by))


```

```{r}

create_GAA_Pitch <- function(grass_colour, line_colour, background_colour, goala_colour,goalb_colour,label_colour,tram_colour, BasicFeatures){
  
  theme_blankPitch = function(size=12) { 
    theme(
      #axis.line=element_blank(), 
      axis.text.x=element_blank(), 
      axis.text.y=element_blank(), 
      #axis.ticks.y=element_text(size=size),
      #axis.ticks=element_blank(),
      axis.ticks.length=unit(0, "lines"), 
      #axis.ticks.margin=unit(0, "lines"), 
      axis.title.x=element_blank(), 
      axis.title.y=element_blank(), 
      legend.key.size=unit(1.2, "lines"), 
      legend.text=element_text(size=size), 
      legend.title=element_text(size=size, face="bold",hjust=0),
      # panel.border=element_blank(), 
      panel.grid.major=element_blank(), 
      panel.grid.minor=element_blank(), 
      panel.spacing=element_blank(), 
      plot.margin=unit(c(0, 0, 0, 0), "lines"), 
      plot.title=element_text(size=size*1.2), 
      panel.background=element_rect(fill= background_colour,colour= background_colour),
      strip.text.x=element_text(size=size*1))}

  ymin <- 0 # minimum width
  ymax <- 98 # maximum width
  xmin <- 0 # minimum length
  xmax <- 144 # maximum length
  
  # pitch lines
  def13 <- 13
  def20 <- 20
  def45 <- 45
  def65 <- 65
  off65 <- 79
  off45 <- 99
  off20 <- 124
  off13 <- 131
  
  
  # small sqaure

  sixYardrd <- 42
  sixYardld <- 56
  sixYardDefxst <- 4.5
  sixYardOffxst <- 139.5

  #13 box
  right14d <- 39.5
  left14d <- 58.5

  #Goals
  glxst <- 0
  glyst <- 45.75
  glxed <- 144
  glyed <- 52.25

  #halfway line
  hwxst <- 72
  hwyst <- 45.75
  hwyed <- 52.25

  #pen spot

  pdxst <- 11
  pdyst <- 48.5
  pdyed <- 49.5
  poxst <- 133
  
# tramlines
  srwing <- 18
  rhalfsp <- 36
  ctre <- 62
  lhalfsp <- 80
      
  circleFundef <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] + diameter / 2 * cos(tt), 
               y = center[2] + diameter / 2 * sin(tt))
  }
  
  circleFunatt <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] - diameter / 2 * cos(tt), 
               y = center[2] - diameter / 2 * sin(tt))
  }
  #### create semi circle ####
  def_circle <-  circleFundef(c(20,49), 26, start=1.5, end=2.5)
  att_circle <-  circleFunatt(c(124,49), 26, start=1.5, end=2.5)
  
  if(BasicFeatures == TRUE){
    ## initiate the plot, set some boundries to the plot
    p <- ggplot() + xlim(c(xmin,xmax)) + ylim(c(ymin,ymax)) +
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
      geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5) + 
      annotate(geom="text", x= 21.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 46.5, y=1.25, label="45",color = label_colour,size = 4) +
      annotate(geom="text", x= 66.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x= 80.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x=100.5, y=1.25, label="45", color=label_colour,size = 4) +
      annotate(geom="text", x=125.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 131, y=4, label="www.witnesstheanalysis.com",color = label_colour,size = 4, alpha = 0.4) +
      annotate(geom="text", x= 12, y=96, label="www.witnesstheanalysis.com",color = label_colour,size = 4, alpha = 0.4) +
      annotate("segment", x = 68, xend = 76, y = 2, yend = 2, colour = "pink", size=3, alpha=0.6, arrow=arrow())
    
  }
  
  else{
    ## initiate the plot, set some boundries to the plot
     p <- ggplot() + xlim(c(xmin,xmax)) + ylim(c(ymin,ymax)) +
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
            geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_segment(aes(x = xmin, y = srwing, xend = xmax, yend = srwing),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = rhalfsp, xend = xmax, yend = rhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = ctre, xend = xmax, yend = ctre),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = lhalfsp, xend = xmax, yend = lhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hwxst, y =  ymin, xend = hwxst, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5) + 
      annotate(geom="text", x= 21.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 46.5, y=1.25, label="45",color = label_colour,size = 4) +
      annotate(geom="text", x= 66.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x= 80.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x=100.5, y=1.25, label="45", color=label_colour,size = 4) +
      annotate(geom="text", x=125.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 100, y=2, label="www.witnesstheanalysis.com",color = "white",size = 2, alpha = 0.4) +
      annotate(geom="text", x= 12, y=97, label="www.witnesstheanalysis.com",color = "white",size = 2, alpha = 0.4)+
      annotate("segment", x = 68, xend = 76, y = 2, yend = 2, colour = "pink", size=3, alpha=0.6, arrow=arrow())
  }
  
  return(p)}


p <- create_GAA_Pitch("gray72", "white", "lightblue", "blue","red","white","blue", BasicFeatures=FALSE)

```

```{r}

#Run 

n <- 100
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(color) <- levels(pass$poss)
colScale <- scale_colour_manual(name = "poss",values = color)

runcolpal <- c(
  "PW" = "orange",
  "Carry" = "gold",
  "Hp" = "yellow", 
  "Tck Att" = "cornflowerblue",
  "Kp Left" = "grey45", 
  "Kp Right" = "orchid2",
  "Hp Prs" = "#D2691E", 
  "Kp Left Prs" = "#800080", 
  "Kp Right Prs" = "#00FFFF",
  "Pass Rs" = "lightblue",
  "Ko" =  "darksalmon",
  "Ko Rec" = "green",
  "Ko ToL" = "darkred",
  "Pass ToL"= "red",
  "ToL" = "red",
  "Fk Point" = "pink",
  "Ms Op" = "darkred",
  "Fk Goal"= "darkgreen",
  "Ms Rs" = "dodgerblue3",
  "Free Won" = "blue",
  "Point" = "#00BA38",
  "Goal" ="black",
  "Ko Int" ="yellow",
  "Pk Goal"= "#FFFFFF",
  "Pk Point"="#800000",
  "Mk Goal"="#D92121",
  "Mk Point"="blue",
  "45 Goal"="#FFFFFF",
  "45 Point"="darkred")

#change lbw
pwcol <- c("Fk Pass"="#000000",
"Int Op"="blue",
"Int Rs"="purple",
"Gk Won"="#FF6347",
"Ko Int"="white",
"LBW"="#FFFF00",
"RBW Def"="#00FFFF",
"RBW Off"="#FF00FF")

runlinepal <- c(
  "0" = 2,
  "1" = 1, 
  "2" = 2, 
  "3" = 1,
  "4" = 1,
  "5" = 1,
  "6" = 1,
  "7" = 1,
  "8" = 1,
  "9" = 1,
  "10"= 1,
  "11"= 1,
  "12"= 1,
  "13"= 1,
  "14"= 1)



```

```{r}

#Kick Outs 
pal <- c("Ko Rec" = "blue",
"Ko Lost"  = "red",
"KoBrk Rec" = "purple",
"KoBrk Lost"  = "red",
"Ko Mk Won"  = "black",
"Ko Lost Mk" = "red",
"Ko Unc Rec" = "white",
"Ko Fk Won Off" = "lightblue",
"Ko Fk Loss Off" = "darkred",
"Ko MkW Po" = "darkgreen")

pals <- c("Ko Rec" = 19,
"Ko Lost"  = 4,
"KoBrk Rec" = 19,
"KoBrk Lost"  = 4,
"Ko Mk Won"  = 19,
"Ko Lost Mk" = 4,
"Ko Unc Rec" = 19,
"Ko Fk Won Off" = 19,
"Ko Fk Loss Off" = 4,
"Ko Mk W Po" = 19)

perpal <- c("1" = "blue",
"2"  = "darkgreen",
"3" = "purple",
"4"  = "black")
```

```{r}

#Time

actcolpals <- c(
  "20" = "grey",
  "0-9" = "black", 
  "10-19" = "blue", 
  "20-29" = "red",
  "30-39" = "purple",
  "40-49" =  "yellow",
  "50-59" = "darkred",
  "60-69" = "orange",
  "70+" = "dodgerblue3")

```

```{r}


#PW
paltow <- c("Tack W"="#000000",
"Kp Int"="blue",
"Hp Int"="purple",
"Kp Brk Int"="#FF6347",
"Hp Brk Int"="#0000FF",
"Kp Free Int"="#FFFF00",
"Fk Brk Int"="#00FFFF",
"Mk Kp Int"="#FF00FF",
"Sl Int"="darkblue",
"Ti Brk Won"=" black",
"Ko Int"="#800000",
"KoBrk Int"="#808000",
"Ko Int Mk"="#D2691E",
"Ko Int Mk Po"="#D2691E",
"Fk Short Gk"="#800080",
"Short Gk"="#008080",
"Tck LB won"="#000080",
"Free Won Def"="gold",
"Sl Kp Won To"="darkred",
"RBW Off"="#808080",
"Loose BW"="#000000",
"Brk Won"="#FF0000",
"RBW Def"="#800000",
"Ko Fk Won Def" = "lightblue",
"Fk Brk Int" = "lightblue",
"Mk Kp Brk Int"="#D2691E"
)

```

```{r}
teamcol = c("Dublin" = "blue", "Monaghan" = "red")
```

```{r}

#Shooting 

colshotvertpal <- c(
"Goal"= "white",
"Point"= "black",
"Wide Left"="purple",
"Wide Right"="#FF6347",
"Saved"="#FFFF00",
"Blkd"="#00FFFF",
"Short"="#FF00FF",
"Post"="darkblue",
"Fk Goal"= "#FFFFFF",
"Fk Point"="#800000",
"Fk Wide Left"="#808000",
"Fk Wide Right"="#D2691E",
"Fk Saved"="#800080",
"Fk Short"="#008080",
"Fk Post"="#000080",
"45 Goal"="#FFFFFF",
"45 Point"="darkred",
"45 Wide Left"="#808080",
"45 Wide Right"="#000000",
"45 Saved"="#FF0000",
"45 Short"="#800000",
"45 Post"="yellow",
"Pk Goal" ="#619CFF",
"Pk Point"="#00BA38",
"Pk Wide Left"="#F8766D",
"Pk Wide Right"="#FF9326",
"Pk Saved"="#FFFF4D",
"Pk Post"="#21D921",
"Mk Goal"="#D92121",
"Mk Point"="blue",
"Mk Wide Left"="gold",
"Mk Wide Right"="orange",
"Mk Short"="red",
"Mk Saved"="#2121D9",
"Hp Point"="#2121D9",
"Punch"="#21D921")

colshotshape <- c(
"Shot Right" = 15,
"Shot Left" = 16,
"45 Shot Right" = 2,
"45 Shot Right" = 6,
"Pk Shot Right" = 222,
"Pk Shot Right" = 112,
"Fk Shot Left" = 24,
"Fk Shot Right" = 25,
"Mk Shot Left" = 134,
"Mk Shot Right" = 135,
"Hp Shot" = 3,
"Punch" = 18
)

colshotpal <- c(
"1"= "white",
"2"= "yellow",
"3"="red")


```

```{r}
#Actions - Mainly used for ToL

n <- 160
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
colorAct = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
colormain = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(colorAct) <- levels(pass$Action)
colScale <- scale_colour_manual(name = "Action",values = colorAct)
```

```{r}
runcolpals <- c(
  "0" = "blue",
  "1" = "dodgerblue3", 
  "2" = "pink", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "darkred",
  "6" = "purple",
  "7" = "blue",
  "8" = "orange",
  "9" = "darkgreen",
  "10" = "lightblue")

```

```{r}
veccol <- c(
  "1" = "dodgerblue3", 
  "2" =  "darkred", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "pink",
   "6" = "lightblue",
  "7" = "orange",
  "8" = "purple",
  "9" = "darkgreen",
  "10" = "lightblue")

```

# Overview
# Summary 
## Starting Line Up (Number, Player, Playing time = Total Match Time)
### Dublin

```{r, fig.width = 16, fig.height = 12}


#Starting Line up change to single team

positionA <-plystats %>% filter (Teamnum == "A") %>%select(Areax,Areay,plyname,plytime)

positionA = positionA %>% 
   unite(here, plyname, plytime, sep = " ", remove = FALSE)

#positionA

p + geom_point(data = positionA, aes(x=Areax, y=Areay), shape = 19, colour = "blue",size = 6) +
  theme(plot.title = element_text( size=32, hjust=0)) +
  geom_text_repel(data = positionA, aes(x=Areax, y=Areay, label = here), colour = "white", size = 8) +
  theme(legend.position="none")


```

### Monaghan

```{r, fig.width = 16, fig.height = 12}
positionB <-plystats %>% filter (Teamnum == "B") %>%select(Areax,Areay,plyname,plytime)

positionB = positionB %>% 
   unite(here, plyname, plytime, sep = " ", remove = FALSE)

#positionA

p + geom_point(data = positionB, aes(x=Areax, y=Areay), shape = 19, colour = "red",size = 6) +
  theme(plot.title = element_text( size=32, hjust=0)) +
  geom_text_repel(data = positionB, aes(x=Areax, y=Areay, label = here), colour = "white", size = 8) +
  theme(legend.position="none")

```

## Scorers

Dublin|Monaghan
-----------------|--------------------------
David Byrne (0-1)| Conor Boyle (0-1)
James McCarthy (0-1)| Michael Bannigan (0-2)
Ciarán Kilkenny (0-1)| Niall Kearns (0-1)
Niall Scully (0-1)| Ryan McAnespie (0-2, 0-1 mark)
Dan O’Brien (0-1)| Conor McCarthy (0-1)
Dean Rock (0-6. 0-4 frees)| Dessie Ward (0-1)
Sean Bugler (0-3)| Conor McManus (1-4, 0-2 frees, 0-1 mark)
Colm Basquel (0-1)|R Beggan (0-2, 1 45 , 1 Free)
Kevin McManamon (1-0) |.




```{r}

lpop <- pass %>%group_by(Team)%>%summarize(Possession_Won =sum(main == "PW"), Kickouts = sum(main == "Ko"),Ko_Won = sum(main == "Ko Rec"),Total_Possessions = sum(Possession_Won + Kickouts),Open_Play_Shots = sum(main == "Shot Op"),Open_Play_Score = sum(subset == "Scr Op"),Fk_Shots = sum(main == "Shot Rs"),Open_Play_Score = sum(subset == "Scr Op"),Fk_Score = sum(subset == "Scr Rs"))

lpop <-lpop %>%
  tidyr::gather(variable, value, -Team)

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black")) +
theme(legend.position="bottom")
  }

q <- ggplot(data = lpop , aes(x = variable, y = value, colour = Team))

q +geom_point(stat = "identity", aes(x = variable, y = value, colour = Team), size = 12) +
geom_text(data =lpop ,aes(x = variable, y = value, label = value), colour = "white", size = 6) +
 coord_flip() +
  my_theme ()+
  scale_colour_manual(values= c (teamcol)) 


```


```{r}
All_Poss  <- sop %>%group_by(Team) %>%summarize(Possessions =sum(main %in% c("PW","Ko")), Total_Possession_time =sum (secs/60),Entry_45 = sum (Entry_45 == "Y"), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_Perc =(Shots/Possessions*100), Shot_Rate_secs = sum (secs/Shots),Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))


library(plyr)

All_Poss <- rename(All_Poss, c( Total_Possession_time = "Possession Time (mins)",Entry_45 = "45 Entry", Shot_Perc = "% Shots per Possession",  Shot_Rate_secs  = "Shot Rate (secs)"))

detach(package:plyr)


formattable (All_Poss, align = c("l", rep("c", NCOL(All_Poss) - 1)))
```


# Positioning & Possessions

## Average Position by Action

### Dublin

## Game

```{r, fig.width = 16, fig.height = 10}

aveposA <- pass %>%group_by(Player, main)%>%filter( Teamnum == "A", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "blue", size = 6) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 8, colour = "white") +
theme(legend.position="none") 
```

## Period

```{r,  out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

aveposA <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "1", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "red", size = 8) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 1") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposA <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "2", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "blue", size = 8) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 2") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


aveposA <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "3", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "black", size = 8) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 3") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposA <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "A", period == "4", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxA <- aveposA %>%
    group_by(Player) %>%
    summarise(AreaxA = mean(Areax,na.rm = TRUE)) 

AreayA <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayA = mean(Areay,na.rm = TRUE))

avgposA <- left_join(AreaxA, AreayA, by ="Player")

p + geom_point(data = avgposA, aes(x=AreaxA, y=AreayA), colour = "darkblue", size = 8) +
geom_text_repel(data = avgposA, aes(x=AreaxA, y=AreayA, label = Player), size = 10, colour = "white") +
labs(title = "Period 4") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
```

### Monaghan

## Game

```{r,  fig.width = 16, fig.height = 10}
aveposB <- pass %>%group_by(Player, main)%>%filter( Teamnum == "B", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))


AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "red", size = 6) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 8, colour = "white") +
theme(legend.position="none")
```

## Period 

```{r, out.width='50%', fig.show='hold', fig.width = 15, fig.height = 15}

aveposB <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "1", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "red", size = 8) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
 ggtitle ("Period 1") +
theme(legend.position="none") + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposB <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "2", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "blue", size = 8) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 2") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))


aveposB <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "3", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposB%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "black", size = 8) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 3") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))

aveposB <- pass %>%group_by(Player, main, period)%>%filter( Teamnum == "B", period == "4", main %in% c("PW","Rec Op","Rec Rs","Pass Op","Pass Rs","Shot Op",
"Ko Rec","Free Won","Free Loss","Spoil Off","Def Act","Tck Att"))



AreaxB <- aveposB %>%
    group_by(Player) %>%
    summarise(AreaxB = mean(Areax,na.rm = TRUE)) 

AreayB <- aveposA%>%
    group_by(Player) %>%
    summarise(AreayB = mean(Areay,na.rm = TRUE))

avgposB <- left_join(AreaxB, AreayB, by ="Player")

p + geom_point(data = avgposB, aes(x=AreaxB, y=AreayB), colour = "darkblue", size = 8) +
geom_text_repel(data = avgposB, aes(x=AreaxB, y=AreayB, label = Player), size = 10, colour = "white") +
ggtitle("Period 4") +
theme(legend.position="none")  + 
  theme(plot.title = element_text(size = 26, face = "bold",hjust = 0.5))
```


## Path of Possession

*Superscript = Possession Number

*Number inside point = Player

*Dashed line = Carry 

### Dublin - Game

```{r, fig.width = 16, fig.height = 12}


#filter by what as.factor is going to be used y add others to scale 
runA <- run%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p + geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() +  
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

### Dublin - Period 1

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runA <- run%>%filter(Teamnum=="A",keep=="Y")
runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
  geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```


### Dublin - Period 2

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runA <- run%>%filter(Teamnum=="A",keep=="Y")
runA <- runA %>% filter(period == "2")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```


### Dublin - Period 3

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runA <- run%>%filter(Teamnum=="A",keep=="Y")
runA <- runA %>% filter(period == "3")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```


### Dublin - Period 4

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runA <- run%>%filter(Teamnum=="A",keep=="Y")
runA <- runA %>% filter(period == "4")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```

### Monaghan - Game

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runB <- run%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```


### Monaghan Period - 1

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runB <- run%>%filter(Teamnum=="B",keep=="Y")
runB <- runB %>% filter(period == "1")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```

### Monaghan Period - 2

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runB <- run%>%filter(Teamnum=="B",keep=="Y")
runB <- runB %>% filter(period == "2")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

### Monaghan Period - 3

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runB <- run%>%filter(Teamnum=="B",keep=="Y")
runB <- runB %>% filter(period == "3")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 


```

### Monaghan Period - 4

```{r, fig.width = 16, fig.height = 12}

#filter by what as.factor is going to be used y add others to scale 
runB <- run%>%filter(Teamnum=="B",keep=="Y")
runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

## Forward Ball Movement Between Zones

### Dublin

```{r, fig.width = 16, fig.height = 12}


passlineAllA <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

passline <-passlineAllA%>%filter(Teamnum == "A",keep=="Y",same == "N", xend > Areax)

passlineA <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax <45)
passlineB <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >45,Areax <71.9)
passlineC <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >72,Areax <99.9)
passlineD <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >100)

p +  geom_segment(data = passlineA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)),size = 1,arrow = arrow(length = unit(0.3,"cm")))+
geom_segment(data = passlineB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)),size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
geom_segment(data = passlineC, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
geom_segment(data = passlineD, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
theme(legend.position="none") +
scale_colour_manual(values = veccol)


```

### Monaghan

```{r, fig.width = 16, fig.height = 12}

passlineBllB <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

passline <-passlineBllB%>%filter(Teamnum == "B",keep=="Y",same == "N", xend > Areax)

passlineA <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax <45)
passlineB <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >45,Areax <71.9)
passlineC <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >72,Areax <99.9)
passlineD <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >100)

p +  geom_segment(data = passlineA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)),size = 1,arrow = arrow(length = unit(0.3,"cm")))+
geom_segment(data = passlineB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)),size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
geom_segment(data = passlineC, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
geom_segment(data = passlineD, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
theme(legend.position="none") +
scale_colour_manual(values = veccol)



```

## Ball Movement Between Zones Inside 45

### Dublin

```{r, fig.width = 16, fig.height = 12}

passlineAllA <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

passline <-passlineAllA%>%filter(Teamnum == "A",keep=="Y",same == "N",)

passlineD <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >100)

p + geom_segment(data = passlineD, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
theme(legend.position="none") +
scale_colour_manual(values = veccol)

```

### Monaghan

```{r, fig.width = 16, fig.height = 12}

passlineBllB <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

passline <-passlineBllB%>%filter(Teamnum == "B",keep=="Y",same == "N",)

passlineD <- passline%>%filter(main == "Pass Op"| seg == "0"|seg == "2",  Areax >100)

p + geom_segment(data = passlineD, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(vec_col)), size = 1,arrow = arrow(length = unit(0.3,"cm"))) +
theme(legend.position="none") +
scale_colour_manual(values = veccol)



```

## 45 Entries

```{r}

Entry_45 <- sop %>%group_by(Team) %>%summarize(Entry_45 = sum (Entry_45 == "Y"), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_Perc =(Shots/Entry_45 *100), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))

formattable (Entry_45, align = c("l", rep("c", NCOL(Entry_45) - 1)))
```


### Dublin 

```{r}

total45A <- run%>%group_by(Team) %>% filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99 )
total45A <-total45A[!duplicated(total45A[,c('poss')]),]
total45A <- total45A%>%group_by(Team) %>% filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99 )%>%summarize(count=n())


hp45A <- run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )
hp45A <-hp45A[!duplicated(hp45A[,c('poss')]),]
hp45A <- hp45A%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )%>%summarize(count=n())

KPLA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )
KPLA <-KPLA[!duplicated(KPLA[,c('poss')]),]
KPLA <-  KPLA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )%>%summarize(count=n())

KPRA <-  run%>%filter(Teamnum=="A",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )
KPRA<-KPRA[!duplicated(KPRA[,c('poss')]),]
KPRA <-  KPRA%>%filter(Teamnum=="A",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )%>%summarize(count=n())

run45A <- run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )
run45A <-run45A[!duplicated(run45A[,c('poss')]),]
run45A <- run45A%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )%>%summarize(count=n())

RestartA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )
RestartA <-RestartA[!duplicated(RestartA[,c('poss')]),]
RestartA <-  RestartA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )%>%summarize(count=n())

LostA <-  run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )
LostA <-LostA[!duplicated(LostA[,c('poss')]),]
LostA <-  LostA%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )%>%summarize(count=n())

tot45A <- bind_cols (total45A,hp45A,KPLA,KPRA,run45A, RestartA, LostA)



library(plyr)

tot45A <- rename(tot45A, c( count = "Total", count1 = "Hp", count2 = "Kp Left", count3 = "Kp Right", count4 = "Carry", count5 = "Restart Pass", count6 = "Lost"))

detach(package:plyr)

#formattable (tot45A)

formattable (tot45A, align = c("l", rep("c", NCOL(tot45A) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:8) ~ color_tile("#DeF7E9", "#71CA97")))
```
34 + 1 entry resulted from an attacking free being awarded inside 45 before ball entered

### Dublin - Game

```{r, fig.width = 16, fig.height = 12}

runA45 <- run%>%filter(Teamnum=="A",keep=="Y", Areax <98.9 & xend > 99 )

runA45 <-runA45[!duplicated(runA45[,c('poss')]),]

actMark <- runA45 %>% filter ( Actionoc %in%c( "Att Mk Won","Att Mk Won Po","Att Mk Won Prs"))

passOp <- runA45%>%group_by(Team, Action) %>% filter(main=="Pass Rs"|main=="Pass Op"|seg == "0"|seg == "2",Areax <98.9 & xend > 99 )


p +   geom_segment(data = passOp, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour =as.factor(segtype)),size = 1,arrow = arrow(length = unit(0.3, "cm"))) +
      geom_point(data = runA45, aes(x = Areax, y = Areay, colour =as.factor(segtype)), shape = 15, size = 6) +
      geom_text(data = runA45, aes(x = Areax, y = Areay, label = Player), colour = "black", size = 4) +
      geom_point(data = actMark, aes(x = xend, y = yend), colour = "green", shape = 15, size = 6) +
      geom_text(data = actMark, aes(x = xend, y = yend, label = Player), colour = "black", size = 4) +
      scale_colour_manual(values = c(runcolpal, mtrKick = "purple")) +
      geom_text_repel(data = runA45, aes(x = Areax, y = Areay, label = possno), colour = "white", size = 4) +
      labs(colour="Legend") +
      theme(
      legend.position = "bottom")+
  scale_linetype_manual(values = c(runlinepal))

    


```

### Monaghan

```{r}

total45B <- run%>%group_by(Team) %>% filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99 )
total45B <-total45B[!duplicated(total45B[,c('poss')]),]
total45B <- total45B%>%group_by(Team) %>% filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99 )%>%summarize(count=n())


hp45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )
hp45B <-hp45B[!duplicated(hp45B[,c('poss')]),]
hp45B <- hp45B%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "1" )%>%summarize(count=n())

KPLB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )
KPLB <-KPLB[!duplicated(KPLB[,c('poss')]),]
KPLB <-  KPLB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "9" )%>%summarize(count=n())

KPRB <-  run%>%filter(Teamnum=="B",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )
KPRB<-KPRB[!duplicated(KPRB[,c('poss')]),]
KPRB <-  KPRB%>%filter(Teamnum=="B",keep=="Y",  Areax <98.9 & xend > 99, seg == "3" )%>%summarize(count=n())

run45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )
run45B <-run45B[!duplicated(run45B[,c('poss')]),]
run45B <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "2"| seg == "0" )%>%summarize(count=n())

RestartB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )
RestartB <-RestartB[!duplicated(RestartB[,c('poss')]),]
RestartB <-  RestartB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "10" )%>%summarize(count=n())

LostB <-  run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )
LostB <-LostB[!duplicated(LostB[,c('poss')]),]
LostB <-  LostB%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99, seg == "7" )%>%summarize(count=n())

tot45B <- bind_cols (total45B,hp45B,KPLB,KPRB,run45B, RestartB, LostB)



library(plyr)

tot45B <- rename(tot45B, c( count = "Total", count1 = "Hp", count2 = "Kp Left", count3 = "Kp Right", count4 = "Carry", count5 = "Restart Pass", count6 = "Lost"))

detach(package:plyr)

#formattable (tot45B)

formattable (tot45B, align = c("l", rep("c", NCOL(tot45B) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:8) ~ color_tile("#DeF7E9", "#71CA97")))
```
33 + 1 moved into 45 by referee 

### Monaghan - Game

```{r, fig.width = 16, fig.height = 12}

runB45 <- run%>%filter(Teamnum=="B",keep=="Y", Areax <98.9 & xend > 99 )

runB45 <-runB45[!duplicated(runB45[,c('poss')]),]

actMark <- runB45 %>% filter ( Actionoc %in%c( "Att Mk Won","Att Mk Won Po","Att Mk Won Prs"))

passOp <- runB45%>%group_by(Team, Action) %>% filter(main=="Pass Rs"|main=="Pass Op"|seg == "0"|seg == "2",Areax <98.9 & xend > 99 )

p +   geom_segment(data = passOp, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour =as.factor(segtype)),size = 1,arrow = arrow(length = unit(0.3, "cm"))) +
      geom_point(data = runB45, aes(x = Areax, y = Areay, colour =as.factor(segtype)), shape = 15, size = 6) +
      geom_text(data = runB45, aes(x = Areax, y = Areay, label = Player), colour = "black", size = 4) +
      geom_text_repel(data = runB45, aes(x = Areax, y = Areay, label = possno), colour = "white", size = 4) +
       geom_point(data = actMark, aes(x = xend, y = yend), colour = "green", shape = 15, size = 6) +
      geom_text(data = actMark, aes(x = xend, y = yend, label = Player), colour = "black", size = 4) +
      scale_colour_manual(values = c(runcolpal, mtrKick = "purple")) +
      geom_text_repel(data = runB45, aes(x = Areax, y = Areay, label = possno), colour = "white", size = 4) +
      labs(colour="Legend") +
      theme(
      legend.position = "bottom")+
  scale_linetype_manual(values = c(runlinepal))
    
```


## Zones Frequency (Total Actions within a Zone)

### Dublin

```{r}

zoneA <- pass %>%group_by(Team, Zone) %>% filter(Teamnum == "A", Zone >=0, Zone <=30)%>%summarize(count=n())

ggplot(zoneA, aes(x = Zone, y = count)) +   
  geom_bar(stat = "identity", 
           fill = "#71CA97",    
           width = 0.50) +
theme_classic() +
     geom_vline(xintercept=5.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=10.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=15.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=20.25, linetype="dotted", color = "black") +
     geom_vline(xintercept=25.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=30.25, linetype="dotted", color = "black") +  
    annotate(geom="text", x= 2.5, y=-0.25, label="In-Def",color = "black") +
      annotate(geom="text", x=7.5, y=-0.25, label="Out-Def",color = "black") +
      annotate(geom="text", x= 12.5, y=-0.25, label="Mid Def",color = "black") +
      annotate(geom="text", x= 17.5, y=-0.25, label="Mid Att",color = "black") +
      annotate(geom="text", x= 22.5, y=-0.25, label="Out-Att",color = "black") +
    annotate(geom="text", x= 27.5, y=-0.25, label="In-Def",color = "black") +
   scale_x_continuous(labels = pass$Zone, breaks = pass$Zone) 
```

### Monaghan

```{r}
zoneB <- pass %>%group_by(Team, Zone) %>% filter(Teamnum == "B", Zone >=0, Zone <=140)%>%summarize(count=n())

ggplot(zoneB, aes(x = Zone, y = count)) +   
  geom_bar(stat = "identity", 
           fill = "#71CA97",    
           width = 0.50) +
theme_classic() +
     geom_vline(xintercept=5.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=10.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=15.25, linetype="dotted", color = "black") +
   geom_vline(xintercept=20.25, linetype="dotted", color = "black") +
     geom_vline(xintercept=25.25, linetype="dotted", color = "black") + 
   geom_vline(xintercept=30.25, linetype="dotted", color = "black") +  
    annotate(geom="text", x= 2.5, y=-0.25, label="In-Def",color = "black") +
      annotate(geom="text", x=7.5, y=-0.25, label="Out-Def",color = "black") +
      annotate(geom="text", x= 12.5, y=-0.25, label="Mid Def",color = "black") +
      annotate(geom="text", x= 17.5, y=-0.25, label="Mid Att",color = "black") +
      annotate(geom="text", x= 22.5, y=-0.25, label="Out-Att",color = "black") +
    annotate(geom="text", x= 27.5, y=-0.25, label="In-Def",color = "black") +
  scale_x_continuous(labels = pass$Zone, breaks = pass$Zone)  
```


# Time

## Pitch Area Origin & Type (Ko - Start Area = where received)

### Dublin

```{r}
zonesA <- sop%>%group_by (Team,Pitch_Area_Rec) %>% filter (Teamnum =="A")%>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec"), Ave_Time = mean(secs),Att_Time =sum(secs))

library(plyr)

zonesA <- rename(zonesA, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesA, align = c("l", rep("c", NCOL(zonesA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Monaghan

```{r}
zonesB <- sop%>%group_by (Team,Pitch_Area_Rec) %>%  filter (Teamnum =="B")%>% summarize(PW =sum(main == "PW"),Ko =sum(Ko_Oc == "Ko Rec"), Ave_Time = mean(secs),Att_Time =sum(secs))

library(plyr)

zonesB <- rename(zonesB, c( Pitch_Area_Rec = "Start Area",Ave_Time = "Average Time  (secs)",Att_Time = "Total Time (secs)"))

detach(package:plyr)

formattable (zonesB, align = c("l", rep("c", NCOL(zonesB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:4) ~ color_tile("#DeF7E9", "#71CA97")))


```

## Possession Duration

### Dublin

```{r}
timeA <-sop%>% group_by (Team,Pitch_Area_Rec) %>% filter (Teamnum =="A")%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))


library(plyr)

timeA <- rename(timeA, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeA, align = c("l", rep("c", NCOL(timeA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Monaghan

```{r}
timeB <-sop%>% group_by (Team,Pitch_Area_Rec) %>% filter (Teamnum =="B")%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))


library(plyr)

timeB <- rename(timeB, c( Pitch_Area_Rec = "Start Area"))

detach(package:plyr)

formattable (timeB, align = c("l", rep("c", NCOL(timeB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:10) ~ color_tile("#DeF7E9", "#71CA97")))

```

## Shot Origin,Outcome & Time

### Dublin

```{r}

scrmsA <-sop%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "A",subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsA <- rename(scrmsA, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsA, align = c("l", rep("c", NCOL(scrmsA) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))

```

### Monaghan

```{r}
scrmsB <-sop%>% group_by (Team,Pitch_Area_Rec,subsetoc)%>%filter(Teamnum == "B",subsetoc %in% c("Scr Op","Scr Rs", "Ms Op", "Ms Rs"))%>%summarize("0-9" = sum (line_col== 1) , "10-19"= sum (line_col == 2),"20-29"= sum (line_col == 3) ,"30-39"= sum (line_col == 4) ,"40-49"= sum (line_col == 5) ,"50-59"= sum (line_col == 6), "60-69"= sum (line_col == 7), "70+"= sum (line_col == 8))

library(plyr)

scrmsB <- rename(scrmsB, c( Pitch_Area_Rec = "Start Area",subsetoc = "Shot Outcome"))

detach(package:plyr)

formattable (scrmsB, align = c("l", rep("c", NCOL(scrmsB) - 1)),
list(`Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 3:11) ~ color_tile("#DeF7E9", "#71CA97")))


```




## Duration of Shot Possessions 

### Dublin

```{r, fig.width = 16, fig.height = 12}
TeamAPASht  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc== "Scr Op"|subsetoc== "Ms Op"|subsetoc == "Scr Rs"|subsetoc == "Ms Rs")

runA <- subset(run, poss %in% TeamAPASht$poss)


#filter by what as.factor is going to be used y add others to scale 
runA <- runA%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("PW","Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(line_time)),size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession")+
scale_colour_manual(values = c(actcolpals))+  
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Action", shape = "Action")+
theme(legend.position="bottom") 

```

### Monaghan

```{r, fig.width = 16, fig.height = 12}

TeamBPBSht  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc== "Scr Op"|subsetoc== "Ms Op"|subsetoc == "Scr Rs"|subsetoc == "Ms Rs")

runB <- subset(run, poss %in% TeamBPBSht$poss)

#filter by what as.factor is going to be used y add others to scale 
runB <- runB%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "1")
actmain <- runB%>% filter(main %in% c ("PW","Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(line_time)),size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession")+
scale_colour_manual(values = c(actcolpals))+  
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Action", shape = "Action")+
theme(legend.position="bottom") 
```

## Duration of Score Possessions

### Dublin

```{r, fig.width = 16, fig.height = 12}

TeamAPAScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc== "Scr Op"|subsetoc == "Scr Rs")

runScrA <- subset(run, poss %in% TeamAPAScr$poss)


#filter by what as.factor is going to be used y add others to scale 
runA <- runScrA%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("PW","Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(line_time)),size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession")+
scale_colour_manual(values = c(actcolpals))+  
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Action", shape = "Action")+
theme(legend.position="bottom") 



```

### Monaghan

```{r, fig.width = 16, fig.height = 12}

TeamBPBScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc== "Scr Op"|subsetoc == "Scr Rs")

runScrB <- subset(run, poss %in% TeamBPBScr$poss)

#filter by what as.factor is going to be used y add others to scale 
runB <- runScrB%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "1")
actmain <- runB%>% filter(main %in% c ("PW","Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(line_time)),size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession")+
scale_colour_manual(values = c(actcolpals))+  
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Action", shape = "Action")+
theme(legend.position="bottom") 
```



# Kick Outs

```{r}

Ko <- sop %>%group_by(Team) %>% filter (main == "Ko")%>%summarize(Poss_Ko =sum(main %in% c("Ko")), Poss_time =sum (secs/60), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_PP =(Shots/Poss_Ko*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")), Ko_Time = mean (Ko_Time))

library(plyr)

Ko <- rename(Ko, c( Poss_Ko = "Kickouts",Poss_time = "Total Time (min)", Shot_PP = "% Shots per Ko", Shot_time = "Shot Rate (secs)", Ko_Time = "Time to Ko"))

detach(package:plyr)

formattable (Ko, align = c("l", rep("c", NCOL(Ko) - 1)))
```

## Kick Outs - Dublin


```{r, fig.width = 16, fig.height = 12}

komapA <-filter(pass, Teamnum == "A",subset =="Ko Rec"| subset =="Ko ToL")

koeffA <- koeff %>%group_by(Zoneoc,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(Ko_Rec =sum(subsetoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost))%>%select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneoc)

koeffA = koeffA %>% 
   unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

p + geom_text(data= koeffA, aes(x= tx, y=ty, label = korectol),colour = "white", size = 30,alpha=0.4) + 
geom_point(data = komapA, aes(x=Areax, y=Areay, colour = as.factor(period), shape = as.factor(Action)), size = 6, stroke = 2)+
geom_text_repel(data = komapA, aes(x=Areax, y=Areay, label = plylab, col = as.factor(period)),show.legend = FALSE, size = 8) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+
  scale_shape_manual(values= pals) +
  scale_colour_manual(values= perpal) +
  labs(colour="Period") +
   guides(shape = FALSE, size = FALSE) +
  guides(colour = guide_legend(override.aes = list(size = 10)))



```

### Pop Starting from Kick Out - Shots

```{r, fig.width = 16, fig.height = 12}


TeamAPAScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Ko")

runAPAScr <- subset(run, poss %in% TeamAPAScr$poss)

TeamAPAScr  <- runAPAScr %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc== "Scr Op"|subsetoc== "Ms Op")

runAPAScr <- subset(runAPAScr, poss %in% TeamAPAScr$poss)

#filter by what as.factor is going to be used y add others to scale 
runA <- runAPAScr%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +   
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

### Pop Starting from Kick Out - Turn Over lost

```{r, fig.width = 16, fig.height = 12}

TeamAPAKoL <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Ko")

runAPAKoL <- subset(run, poss %in% TeamAPAKoL$poss)

TeamAPAKoL  <- runAPAKoL %>%group_by(Team, Action) %>% filter(Teamnum == "A", mainoc == "ToL")

runAPAKoL<- subset(runAPAKoL, poss %in% TeamAPAKoL$poss)

#filter by what as.factor is going to be used y add others to scale 
runA <- runAPAKoL%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

```{r}

ko <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset=="Ko Rec"| subset =="Ko ToL")
ko <- ko %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset=="Ko Rec"| subset =="Ko ToL")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

final_data <- ko %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ko <- paste0("Total Kickouts: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Kickout Outcomes", 
          subtitle = total_ko) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))




```

## Kick Outs - Monaghan

```{r, fig.width = 16, fig.height = 12}

komapB <-filter(pass, Teamnum == "B",subset =="Ko Rec"| subset =="Ko ToL")

koeffB <- koeff %>%group_by(Zoneoc,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(Ko_Rec =sum(subsetoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost)) %>% select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneoc)


koeffB = koeffB %>% 
   unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

p + geom_text(data= koeffB, aes(x= tx, y=ty, label = korectol),colour = "white", size = 30,alpha=0.4)  +
  geom_point(data = komapB, aes(x=Areax, y=Areay, colour = as.factor(period), shape =as.factor( Action)), size = 6, stroke = 2)+
geom_text_repel(data = komapB, aes(x=Areax, y=Areay, label = plylab, col = as.factor(period)),show.legend = FALSE, size = 8) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+
  scale_shape_manual(values= pals) +
  scale_colour_manual(values= perpal) +
  labs(colour="Period") +
   guides(shape = FALSE, size = FALSE)+
  guides(colour = guide_legend(override.aes = list(size = 10)))


```

### Pop Starting from Kick Out - Shots


```{r, fig.width = 16, fig.height = 12}
TeamBPBScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Ko")

runBPBScr <- subset(run, poss %in% TeamBPBScr$poss)

TeamBPBScr  <- runBPBScr %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc== "Scr Op"|subsetoc== "Ms Op")

runBPBScr <- subset(runBPBScr, poss %in% TeamBPBScr$poss)

#filter by what as.factor is going to be used y add others to scale 
runB <- runBPBScr%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +   
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```


### Pop Starting from Kick Out - Turn Over Lost


```{r, fig.width = 16, fig.height = 12}

TeamBPBKoL <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Ko")

runBPBKoL <- subset(run, poss %in% TeamBPBKoL$poss)

TeamBPBKoL  <- runBPBKoL %>%group_by(Team, Action) %>% filter(Teamnum == "B", mainoc == "ToL")

runBPBKoL<- subset(runBPBKoL, poss %in% TeamBPBKoL$poss)

#filter by what as.factor is going to be used y add others to scale 
runB <- runBPBKoL%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +   
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```

```{r}

ko <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset=="Ko Rec"| subset =="Ko ToL")
ko <- ko %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset=="Ko Rec"| subset =="Ko ToL")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 20, color = "gray10"))
  }

final_data <- ko %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ko <- paste0("Total Kickouts: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Kickout Outcomes", 
          subtitle = total_ko) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 16, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))


```



# Possession Won

```{r}
PW <- sop %>%group_by(Team) %>% filter (main == "PW")%>%summarize(Poss_PW =sum(main %in% c("PW")), Poss_time =sum (secs/60), Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),
Shot_PP =(Shots/Poss_PW*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))


library(plyr)

PW <- rename(PW, c(Poss_PW = "Possession Won", Poss_time = "Possession Time (mins)", Shot_PP = "% Shots per Possession", Shot_time = "Shot Rate (secs)"))

detach(package:plyr)

formattable (PW, align = c("l", rep("c", NCOL(All_Poss) - 1)))




```


## Possession Won - Dublin


```{r}

ToWA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="PW")
ToWA <- ToWA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="PW")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ToWA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ToWA <- paste0("Total Possession Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Possession Won",  # Add the title and subtitle
          subtitle = total_ToWA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```


```{r, fig.width = 16, fig.height = 12}

conqmapA <- filter(pass, Teamnum == "A", main =="PW")

conqmapA <-conqmapA %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapAcnt <- conqmapA %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_text(data= conqmapAcnt, aes(x= tx, y=ty, label = PW_Won),colour = "white", size = 30,alpha=0.4) +
geom_point(data = conqmapA, aes(x=Areax, y=Areay, colour = Action, shape = main), size = 6)+
geom_text_repel(data = conqmapA, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(legend.position="none") + scale_colour_manual(
    values = paltow)


```

### Pop Starting from Possession Won -  Shots

```{r, fig.width = 16, fig.height = 12}

TeamAPAPWScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "PW")

runAPAPWScr  <- subset(run, poss %in% TeamAPAPWScr$poss)

TeamAPAPWScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc== "Scr Op"|subsetoc== "Ms Op")

runAPAPWScr  <- subset(runAPAPWScr , poss %in% TeamAPAPWScr$poss)

#filter by what as.factor is going to be used y add others to scale 
runA <- runAPAPWScr%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

### Pop Starting from Possession Won -  Turn Over Lost

```{r, fig.width = 16, fig.height = 12}

TeamAPAPWL <- run %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "PW")

runAPAPWL  <- subset(run, poss %in% TeamAPAPWL$poss)

TeamAPAPWL <- runAPAPWL %>%group_by(Team, Action) %>% filter(Teamnum == "A", mainoc == "ToL")

runAPAPWL <- subset(runAPAPWL, poss %in% TeamAPAPWL$poss)

#filter by what as.factor is going to be used y add others to scale 
runA <- runAPAPWL%>%filter(Teamnum=="A",keep=="Y")
#runA <- runA %>% filter(period == "1")
actmain <- runA%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runA %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runA %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runA %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runA %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runA %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runA%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runA, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 

```


## Possession Won - Monaghan


```{r}


ToWA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="PW")
ToWA <- ToWA %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="PW")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ToWA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ToWA <- paste0("Total Possession Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Possession Won",  # Add the title and subtitle
          subtitle = total_ToWA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```


```{r, fig.width = 16, fig.height = 12}


conqmapB <-filter(pass, Teamnum == "B", main =="PW")

conqmapB <-conqmapB %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

conqmapBcnt <- conqmapB %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(PW_Won =sum(main =="PW"))%>%select(Zone,PW_Won,tx,ty,bx,by)


p + geom_text(data= conqmapBcnt, aes(x= tx, y=ty, label = PW_Won),colour = "white", size = 30,alpha=0.4)+
geom_point(data = conqmapB, aes(x=Areax, y=Areay, colour = Action, shape = Team ), size = 6)+
geom_text_repel(data = conqmapB, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(legend.position="none")+ scale_colour_manual(
    values = paltow)

  
```

### Pop Starting from Possession Won - Shots

```{r, fig.width = 16, fig.height = 12}

TeamBPBPWScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "PW")

runBPBPWScr  <- subset(run, poss %in% TeamBPBPWScr$poss)

TeamBPBPWScr  <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc== "Scr Op"|subsetoc== "Ms Op")

runBPBPWScr  <- subset(runBPBPWScr , poss %in% TeamBPBPWScr$poss)

runB <- runBPBPWScr%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +  
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```

### Pop Starting from Possession Won - Turn Over Lost
 
```{r, fig.width = 16, fig.height = 12}

TeamBPBPWL <- run %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "PW")

runBPBPWL  <- subset(run, poss %in% TeamBPBPWL$poss)

TeamBPBPWL <- runBPBPWL %>%group_by(Team, Action) %>% filter(Teamnum == "B", mainoc == "ToL")

runBPBPWL <- subset(runBPBPWL, poss %in% TeamBPBPWL$poss)

runB <- runBPBPWL%>%filter(Teamnum=="B",keep=="Y")
#runB <- runB %>% filter(period == "4")
actmain <- runB%>% filter(main %in% c ("Ko Rec","Pass Rs"))
actPass <- runB %>% filter (Action %in% c ("Ko","Hp","Kp Left","Kp Right")|seg %in% c("0","2"))
actPassp <- runB %>% filter (Action %in% c ("Hp Prs","Kp Left Prs","Kp Right Prs","Tck Att"))
actscr <- runB %>% filter (Actionoc %in% c("Goal", "Point",  "Fk Point", "Fk Goal",  "Pk Point", "Pk Goal",  "Mk Point", "Mk Goal"))
actms <- runB %>% filter (subsetoc %in% c("Ms Op", "Ms Rs"))
actmainoc <- runB %>% filter (mainoc %in% c("ToL","Free Won"))
actPW <- runB%>% filter(subset %in% c ("Fk Pass","Int Op","Int Rs","Gk Won","Ko Int","LBW","RBW Def","RBW Off"))


#'code names' for other colours
p +geom_segment(data = runB, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(poss),linetype= as.factor(seg)),show.legend = FALSE,size = .8,arrow = arrow(length = unit(0.4,"cm"))) +
labs(colour="Possession") +
scale_colour_manual(values = c(color))+ 
scale_linetype_manual(values = c(runlinepal)) +
new_scale_color() + 
geom_point(data = actPass, aes(x = Areax, y = Areay,colour  = as.factor(segtype)), size = 4, shape = 15) +
geom_text(data = actPass, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actPassp, aes(x = Areax, y = Areay,colour  = as.factor(Action)), size = 4, shape = 15) +
geom_text(data = actPassp, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_point(data = actmain, aes(x=Areax, y=Areay, colour  = as.factor(main)),size = 6, shape = 19) +
geom_text(data = actmain, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actmain, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actmainoc, aes(x=xend, y=yend, colour  = as.factor(mainoc)),size = 4, shape = 17) +
geom_text(data = actmainoc, aes(x=xend, y=yend,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actmainoc, aes(x=xend, y=yend,label = possno), size = 3,colour = "white") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Actions")+
new_scale_color() + 
geom_point(data = actPW, aes(x=Areax, y=Areay, colour  = as.factor(subset)),size = 6, shape = 19) +
geom_text(data = actPW, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "black") +
geom_text_repel(data = actPW, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "white") +    
scale_colour_manual(values= c (pwcol)) +
labs(colour="Possession Won")+
new_scale_color() + 
geom_point(data = actms, aes(x=Areax, y=Areay, colour  = as.factor(subsetoc)),size = 6, shape = 19) +
geom_text(data = actms, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actms, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
geom_point(data = actscr, aes(x=Areax, y=Areay, colour  = as.factor(Actionoc)),size = 6, shape = 19) +
geom_text(data = actscr, aes(x = Areax, y = Areay,label = Player), size = 3,colour = "white") +
geom_text_repel(data = actscr, aes(x = Areax, y = Areay,label = possno), size = 3,colour = "black") +
scale_colour_manual(values= c (runcolpal)) +
labs(colour="Shots")+
theme(legend.position="bottom") 
```


## Passes per Defensive Action

### Dublin

```{r}


Adef <- pass %>%group_by(Team)%>%filter(Teamnum == "A") 
Adef <- Adef %>%group_by(Team)%>%filter(Teamnum == "A") %>%summarize(Tack = sum(Action == "Tck Def"),Spoil = sum(subset == "Spoil Def"), Def_Act = (Tack + Spoil))

Bpass <- pass %>%group_by(Team)%>%filter(Teamnum == "B")
Bpass <- Bpass %>%group_by(Team)%>%filter(Teamnum == "B") %>%summarize(Pass =sum(main == "Pass Op"))

BA <- bind_cols(Bpass,Adef)


BAdefact <- BA %>% summarize (Pass, Def_Act, PPDA = (Pass/Def_Act))


library(plyr)

BAdefact <- rename(BAdefact, c(Pass = "# Opposition Passes", Def_Act = "Tackle Attempt (Def Act)", PPDA = "Passes per Defensive Action"))

detach(package:plyr)

formattable (BAdefact, align = c("l", rep("c", NCOL(BAdefact) - 1)))


```


### Monaghan

```{r}

Bdef <- pass %>%group_by(Team)%>%filter(Teamnum == "B") 
Bdef <- Bdef %>%group_by(Team)%>%filter(Teamnum == "B")  %>%summarize(Tack = sum(Action == "Tck Def"),Spoil = sum(subset == "Spoil Def"), Def_Act = (Tack + Spoil))

Apass <- pass %>%group_by(Team)%>%filter(Teamnum == "A")
Apass <- Apass %>%group_by(Team)%>%filter(Teamnum == "A") %>%summarize(Pass =sum(main == "Pass Op"))

dubmonnfl20 <- bind_cols(Apass,Bdef)

dubmonnfl20defact <- dubmonnfl20 %>% summarize(Pass, Def_Act, PPDA = (Pass/Def_Act))


library(plyr)

dubmonnfl20defact <- rename(dubmonnfl20defact, c(Pass = "# Opposition Passes", Def_Act = "Tackle Attempt (Def Act)", PPDA = "Passes per Defensive Action"))

detach(package:plyr)

formattable (dubmonnfl20defact, align = c("l", rep("c", NCOL(dubmonnfl20defact) - 1)))



```


## Tackle Attempts and Defensive Spoils

*Tackle Attempt (Tck Def) = Any contact made by defender on player in possession

*Spoil Def = Defending player creates a break from opposition pass

### Dublin

```{r, fig.width = 16, fig.height = 12}

#Needs more than def act??

defactA <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def","Tck Def"))

actA <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "A",subset %in% c("Spoil Def","Tck Def")) %>% summarise (count = n ())

shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(98,98,98,98,98,98))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actA,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p +  
  theme(legend.position="bottom") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
geom_point(data = defactA, aes(x = Areax, y = Areay, colour = subset), size = 7) 

  
  

```

## Tackle Attempts (Tck Def) and Defensive Spoils

### Monaghan

```{r, fig.width = 16, fig.height = 12}



defactB <- pass %>% group_by (main,Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def","Tck Def"))

actB <- pass %>% group_by (Pitch_Area) %>%filter(Teamnum == "B",subset %in% c("Spoil Def","Tck Def")) %>% summarise (count = n ())

shade = data.frame(Pitch_Area = c ("In_Def","Mid_Def", "Out_Def", "Out_Att","Mid_Att", "In-Att"),x1=c(0,20,45,72,100,124), x2=c(20,45,72,100,124,144), y1=c(0,0,0,0,0,0), y2=c(98,98,98,98,98,98))

shade <-shade %>%
    mutate(count = VLOOKUP(Pitch_Area,actB,Pitch_Area,count))

shade$count[is.na(shade$count)] <- 0


p +  
  theme(legend.position="bottom") +
geom_rect(data=shade, 
            mapping=aes(xmin=x1, xmax=x2, ymin=y1, ymax=y2, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
scale_fill_gradient(low="white",high="red") +
geom_point(data = defactB, aes(x = Areax, y = Areay, colour = subset), size = 7) 


```


## Frees Loss

### Dublin

```{r}

FKLA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A",  main =="Free Loss"|Action == "Free Loss Off")
FKLA <- FKLA %>%group_by(Team, Action) %>% filter(Teamnum == "A",  main =="Free Loss"|Action == "Free Loss Off")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKLA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKLA  <- paste0("Total Fk Loss: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Loss",  # Add the title and subtitle
          subtitle = total_FKLA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

#Map Dublin

freeAmap <- filter(pass, Teamnum == "A", main =="Free Loss"|Action == "Free Loss Off")

p + geom_point(data = freeAmap, aes(x=Areax, y=Areay, colour = Action, shape = Action), size = 6) +
geom_text_repel(data = freeAmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")
```

### Monaghan

```{r}

FKLB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")
FKLB <- FKLB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKLB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKLB <- paste0("Total Fk Loss: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Loss",  # Add the title and subtitle
          subtitle = total_FKLB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

freeBmap <-filter(pass, Teamnum == "B", main =="Free Loss"|Action == "Free Loss Off")

p + geom_point(data = freeBmap, aes(x=Areax, y=Areay, colour = subset, shape = subset), size = 6) +
geom_text_repel(data = freeBmap, aes(x=Areax, y=Areay, label = plylab, col = subset), size = 8) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")
```


## Possession Lost 

### Dublin

```{r, fig.width = 16, fig.height = 12}

ToLmapA <- filter(pass, Teamnum == "A", main =="ToL")

ToLmapA <-ToLmapA %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapAcnt <- ToLmapA %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_text(data= ToLmapAcnt, aes(x= tx, y=ty, label = ToL),colour = "white", size = 30,alpha=0.4) +
geom_point(data = ToLmapA, aes(x=Areax, y=Areay, colour = Action, shape = main), size = 6)+
geom_text_repel(data = ToLmapA, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(legend.position="none") + scale_colour_manual(
    values = colorAct)
```

### Monaghan

```{r, fig.width = 16, fig.height = 12}

ToLmapB <- filter(pass, Teamnum == "B", main =="ToL")

ToLmapB <-ToLmapB %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

ToLmapBcnt <- ToLmapB %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(ToL =sum(main =="ToL"))%>%select(Zone,ToL,tx,ty,bx,by)


p + geom_text(data= ToLmapBcnt, aes(x= tx, y=ty, label = ToL),colour = "white", size = 30,alpha=0.4) +
geom_point(data = ToLmapB, aes(x=Areax, y=Areay, colour = Action, shape = main), size = 6)+
geom_text_repel(data = ToLmapB, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 8) +
theme(legend.position="none") + scale_colour_manual(
    values = colorAct)
```


# Shooting 

## All Shots - Location & Outcome 

### Dublin

```{r}
ShotsAll <- sop %>%group_by(Team)%>%filter(Teamnum == "A",mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsAll, align = c("l", rep("c", NCOL(ShotsAll) - 1)))
```

```{r}

ASA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASA <- ASA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASA <- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```


```{r, fig.width = 16, fig.height = 12}


scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs")

AllshotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffA = AllshotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))


```


## Open Play Shots - Location & Outcome 

### Dublin

```{r}
ShotsOp <- sop %>%group_by(Team)%>%filter(Teamnum == "A",mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100), Shot_dist = mean (Shot_Dist))

library(plyr)

ShotsOp <- rename(ShotsOp, c( Shot_Eff = "% Scoring Efficiency",Shot_dist = "Average Shot Distance"))

detach(package:plyr)

formattable (ShotsOp, align = c("l", rep("c", NCOL(ShotsOp) - 1)))

```

```{r}

OPA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc")
OPA <- OPA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- OPA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_OPA <- paste0("Total Op Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Open Play Shots",  # Add the title and subtitle
          subtitle = total_OPA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresA <- scores [scores$period!="F", ]

shotsA <- scoresA %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op")

shotseffA <- scoresA  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```

### Shot Pressure - Dublin

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scores <- scores [scores$period!="F", ]

shotsA <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "A",  subset =="Shot Op")

p + geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action), size = 6) + 
 scale_colour_manual(values = colshotpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = as.factor(shdf)), size = 6) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  labs(colour="Shot Type") +
  ggtitle("White = no pressure, yelow = light/late pressure, red = heavy pressure")
```

## Frees Won

### Dublin

```{r}

FKA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")
FKA <- FKA%>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKA <- paste0("Total Fk Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Won",  # Add the title and subtitle
          subtitle = total_FKA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

freeAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Free Won"| Action == "Free Won Def")

freeAmap <-freeAmap %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeAcnt <- freeAmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(FW =sum(main =="Free Won"))%>%select(Zone,FW,tx,ty,bx,by)

p +  geom_text(data= freeAcnt, aes(x= tx, y=ty, label = FW),colour = "white", size = 30,alpha=0.4) +
geom_point(data = freeAmap, aes(x=Areax, y=Areay, colour = Action, shape = Action), size = 6) +
geom_text_repel(data = freeAmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 6) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+ 
scale_colour_manual(values = colorAct)
```

## Free Kick Shots - Location & Outcome 

### Dublin

```{r}
ShotsRs <- sop %>%group_by(Team)%>%filter(Teamnum == "A",mainoc %in% c("Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsRs  <- rename(ShotsRs, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsRs, align = c("l", rep("c", NCOL(ShotsRs) - 1)))

```

```{r}

ASA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")
ASA <- ASA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASA %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASA <- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASA) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scores <- scores [scores$period!="F", ]

shotsRSeffA <- scores  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotsRSeffA  = shotsRSeffA  %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset == "Shot Rs")

p + geom_text(data= shotsRSeffA , aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))


```


## All Shots - Location & Outcome 

### Monaghan

```{r}
ShotsAll <- sop %>%group_by(Team)%>%filter(Teamnum == "B",mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsAll, align = c("l", rep("c", NCOL(ShotsAll) - 1)))
```

```{r}
ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASB%>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASB<- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASB)+   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() + theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))

```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresB <- scores [scores$period!="F", ]

shotsB <- scoresB %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op"|subset == "Shot Rs")

AllshotseffB <- scoresB  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

AllshotseffB = AllshotseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= AllshotseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) + 
geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))



```

## Open Play Shots - Location & Outcome 

```{r}
ShotsOp <- sop %>%group_by(Team)%>%filter(Teamnum == "B",mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100), Shot_dist = mean (Shot_Dist))

library(plyr)

ShotsOp <- rename(ShotsOp, c( Shot_Eff = "% Scoring Efficiency",Shot_dist = "Average Shot Distance"))

detach(package:plyr)

formattable (ShotsOp, align = c("l", rep("c", NCOL(ShotsOp) - 1)))

```

```{r}

OPB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc")

OPB <- OPB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- OPB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_OPB <- paste0("Total Op Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Open Play Shots",  # Add the title and subtitle
          subtitle = total_OPB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scoresB <- scores [scores$period!="F", ]


shotsB <- scoresB %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op")

shotseffB <- scoresB  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)

shotseffB = shotseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))

```


### Shot Pressure - Monaghan

```{r, fig.width = 16, fig.height = 12}

scores  <- scores [scores$period!="S", ]
scores <- scores [scores$period!="F", ]

shotsB <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "B",  subset =="Shot Op")

p + geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action, size = 6)) + 
 scale_colour_manual(values = colshotpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = as.factor(shdf)), size = 6) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10))) +
  labs(colour="Shot Type") +
  ggtitle("White = no pressure, yelow = light/late pressure, red = heavy pressure")

```

## Frees Won

### Monaghan

```{r}

FKB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")
FKB <- FKB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- FKB %>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_FKB <- paste0("Total Fk Won: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("Free Kicks Won",  # Add the title and subtitle
          subtitle = total_FKB) +   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() +
theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}


#freeBmap <- filter(pass, Teamnum == "B", subset %in% c ("FkwTs","FkwTns","Rs Pass PW"))

freeBmap <- pass%>% filter(Teamnum == "B", main =="Free Won"| Action == "Free Won Def")

freeBmap <-freeBmap %>%
    mutate(tx = VLOOKUP(Zone, zonetext, zone, tx),ty = VLOOKUP(Zone, zonetext, zone, ty),bx = VLOOKUP(Zone, zonetext, zone, bx),by = VLOOKUP(Zone, zonetext, zone, by))

freeBcnt <- freeBmap %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(FW =sum(main =="Free Won"))%>%select(Zone,FW,tx,ty,bx,by)

p +  geom_text(data= freeBcnt, aes(x= tx, y=ty, label = FW),colour = "white", size = 30,alpha=0.4) +
geom_point(data = freeBmap, aes(x=Areax, y=Areay, colour = Action, shape = Action), size = 6) +
geom_text_repel(data = freeBmap, aes(x=Areax, y=Areay, label = plylab, col = Action), size = 6) +
theme(plot.title = element_text(hjust=0.5)) +
theme(plot.subtitle = element_text(hjust=0.5)) +
theme(legend.position="bottom")+ 
scale_colour_manual(values = colorAct)
```

## Free Kick Shots - Location & Outcome 

```{r}
ShotsRs <- sop %>%group_by(Team)%>%filter(Teamnum == "B",mainoc %in% c("Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Rs")),Shot_Eff = (Scores/Shots *100))

library(plyr)

ShotsRs  <- rename(ShotsRs, c( Shot_Eff = "% Scoring Efficiency"))

detach(package:plyr)

formattable (ShotsRs, align = c("l", rep("c", NCOL(ShotsRs) - 1)))

```

```{r}

ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")%>%summarize(count=n())

my_theme <- function(){
  theme_light() +
    theme(text = element_text(),  
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 15, color = "gray10"),
          plot.title =  element_text(size = 20, color = "black"))
  }

final_data <- ASB%>% 
  # Calculate -- and format -- the percentage for each channel
  mutate(bar_percentage = sprintf("%.1f%%", 100*(count / sum(.$count)))) %>% 
  # Combine that percentage with the actual value
  mutate(bar_label = paste0(format(count, big.mark = ","), ", ", bar_percentage)) %>% 
  # Remove the "just the percentage" column
  select(-bar_percentage)


total_ASB<- paste0("All Shots: ",
                      format(sum(final_data$count), big.mark = ","))


ggplot(final_data, aes(x = Action, y = count)) +
ggtitle("All Shots",  # Add the title and subtitle
          subtitle = total_ASB)+   
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = 0.50) +  
geom_text(aes(label = bar_label, size = 5.5, hjust = 0)) +
  coord_flip() +
  scale_y_continuous(expand = c(0, 0),
                     limits = c(0, max(final_data$count) * 1.3)) +
  my_theme() + theme(legend.position="none", plot.title =  element_text(size = 20, color = "black"),plot.subtitle =  element_text(size = 18, color = "black"))
```

```{r, fig.width = 16, fig.height = 12}

shotsB <- scores  %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset == "Shot Rs")

shotsRSseffB <- scores  %>%group_by(Zone,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zone,Scr,Ms,Shot,tx,ty,bx,by)


shotsRSseffB = shotsRSseffB %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

p + geom_text(data= shotsRSseffB, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30,alpha = 0.4) +
  geom_point(data = shotsB, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsB, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    theme(legend.position="bottom", legend.title=element_text(size=15), 
          legend.text=element_text(size=20)) +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(plot.subtitle = element_text(hjust=0.5)) +
  labs(colour="Shot Type") +
    guides(color = FALSE, size = FALSE) +
    guides(shape = guide_legend(override.aes = list(size = 10)))
```


# Passing

## Pass Breakdown

```{r, fig.width = 16, fig.height = 12}

passbd <- pass%>% group_by(Team,Action) %>%filter(Action == "Hp"|Action == "Kp"|Action == "Kp Left"|Action == "Kp Right"|Action == "Fk Pass"|Action == "Sl Pass"|Action == "Mk Kp"|Action == "Mk Hp"|Action == "Sl Kp Won To"|Action == "45 Pass"|Action == "Hp Assist"|Action == "Kp L Assist"|Action == "Kp R Assist"|Action == "Hp Key"|Action == "Kp L Key"|Action == "Kp R Key"|Action == "Mk Kp Key"|Action == "Mk Kp Key")

 
passbd <- passbd%>% group_by(Team,Action) %>%filter(Action == "Hp"|Action == "Kp"|Action == "Kp Left"|Action == "Kp Right"|Action == "Fk Pass"|Action == "Sl Pass"|Action == "Mk Kp"|Action == "Mk Hp"|Action == "Sl Kp Won To"|Action == "45 Pass"|Action == "Hp Assist"|Action == "Kp L Assist"|Action == "Kp R Assist"|Action == "Hp Key"|Action == "Kp L Key"|Action == "Kp R Key"|Action == "Mk Kp Key"|Action == "Mk Kp Key")%>%summarize(count=n())

formattable (passbd, align = c("l", rep("c", NCOL(passbd) - 1)))


#, position = "dodge"

q <- ggplot(data = passbd, aes(x = Team, y = count, fill = Action))

q +geom_bar(width=.7, stat = "identity", aes(x = Team, y = count, fill = Action)) +
  xlab("Team") + ylab("Pass Count") +
  ggtitle("Pass Breakdown") +
  theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank())

```

### Dublin

*Carries over 10mts

```{r, fig.width = 16, fig.height = 12}

runA <- run%>%filter(Teamnum=="A",keep=="Y")

runApass <- runA%>%filter(main %in% c("Pass Op","Pass Rs","Pass Rs")|subsetoc == "Pass ToL")
runAcarr <- runA%>%filter(seg %in% c("0","2"), dist > 9.99)

p + geom_segment(data = runApass, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runApass, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runApass, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    geom_segment(data = runAcarr, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runAcarr, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runAcarr, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal)+
  scale_linetype_manual(values = c(runlinepal))
```


## Passes Only 

### Dublin


```{r, fig.width = 16, fig.height = 12}


runA <- run%>%filter(Teamnum=="A",keep=="Y")

runApass <- runA%>%filter(main %in% c("Pass Op","Pass Rs","Pass Rs")|subsetoc == "Pass ToL")

p + geom_segment(data = runApass, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runApass, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runApass, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal)+
  scale_linetype_manual(values = c(runlinepal))


```

## Carries Only

*Carries over 10mts

### Dublin

```{r, fig.width = 16, fig.height = 12}

runA <- run%>%filter(Teamnum=="A",keep=="Y")

runAcarr <- runA%>%filter(seg %in% c("0","2"), dist > 9.99)

p + geom_segment(data = runAcarr, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runAcarr, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runAcarr, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal)+
  scale_linetype_manual(values = c(runlinepal))  
    
```


### Monaghan

*Carries over 10mts
```{r, fig.width = 16, fig.height = 12}


runB <- run%>%filter(Teamnum=="B",keep=="Y")

runBpass <- runB%>%filter(main %in% c("Pass Op","Pass Rs","Pass Rs")|subsetoc == "Pass ToL")
runBcarr <- runB%>%filter(seg %in% c("0","2"), dist > 9.99)

p + geom_segment(data = runBpass, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runBpass, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runBpass, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    geom_segment(data = runBcarr, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runBcarr, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runBcarr, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal) +
  scale_linetype_manual(values = c(runlinepal))

```

## Passes Only
### Monaghan

```{r, fig.width = 16, fig.height = 12}

runB <- run%>%filter(Teamnum=="B",keep=="Y")

runBpass <- runB%>%filter(main %in% c("Pass Op","Pass Rs","Pass Rs")|subsetoc == "Pass ToL")


p + geom_segment(data = runBpass, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runBpass, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runBpass, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal) +
    scale_linetype_manual(values = c(runlinepal))


```

## Carries Only

*Carries over 10mts

### Monaghan
```{r, fig.width = 16, fig.height = 12}


runB <- run%>%filter(Teamnum=="B",keep=="Y")

runBcarr <- runB%>%filter(seg %in% c("0","2"), dist > 9.99)

p + geom_segment(data = runBcarr, aes(x = Areax, y = Areay, xend = xend, yend = yend, colour = as.factor(segtype)),size = .5,arrow = arrow(length = unit(0.3, "cm"))) +
    geom_point(data = runBcarr, aes(x = Areax, y = Areay, colour = as.factor(segtype)), size = 6, shape = 15) +
    geom_text(data = runBcarr, aes(x = Areax, y = Areay, label = Player), size = 4,colour = "black") +
    theme(legend.position="bottom") + 
    labs (colour = "Type") +
    scale_colour_manual(values = runcolpal)+
  scale_linetype_manual(values = c(runlinepal))

```



# Player Stats

## Player On Ball Possession (Number, Player, Total)
### Dublin

```{r, fig.width = 16, fig.height = 12}

plytree <- plystats %>%filter(Teamnum == "A")%>%select(plyno, plyname,OBP)%>% arrange(plyno)

plytreeA = plytree %>% 
   unite(combined, plyname, OBP, sep = " ", remove = FALSE)

treemap(dtf = plytreeA,
        index=c("combined"),
        vSize="OBP",
        vColor="OBP",
        palette="Spectral",
        type="value",
        border.col=c("grey70", "grey90"),
        fontsize.title = 36,
        algorithm="pivotSize",
        title ="On Ball Possessions",
        title.legend="Possessions",
        fontsize.labels= 25)
```

### Monaghan

```{r, fig.width = 16, fig.height = 12}


plytree <- plystats %>%filter(Teamnum == "B")%>%select(plyno, plyname,OBP)%>% arrange(plyno)

plytreeB = plytree %>% 
   unite(combined, plyname, OBP, sep = " ", remove = FALSE)

treemap(dtf = plytreeB,
        index=c("combined"),
        vSize="OBP",
        vColor="OBP",
        palette="Spectral",
        type="value",
        border.col=c("grey70", "grey90"),
        fontsize.title = 36,
        algorithm="pivotSize",
        title ="On Ball Possessions",
        title.legend="Possessions",
        fontsize.labels= 25)
```


## Player Possession Involvement

### Dublin
```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tack Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tack Def Ndp", ]


teamAplyrpossns <- passA%>%group_by(Player, poss) %>% filter(Teamnum == "A", main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamAplyr <-dplyr::distinct(teamAplyrpossns) 

teamAplyr <-teamAplyr%>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamAplyr , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  + 
ylab("Poessession involvements") +
theme(legend.position="none") +
 theme_classic()




```

### Monaghan

```{r}


passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tack Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tack Def Ndp", ]


teamBplyrpossns <- passB%>%group_by(Player, poss) %>% filter(Teamnum == "B", main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamBplyr <-dplyr::distinct(teamBplyrpossns) 

teamBplyr <-teamBplyr%>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 

ggplot(teamBplyr , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  + 
ylab("Poessession involvements") +
theme(legend.position="none") +
 theme_classic()


```

## Player Shot Involvement

### Dublin

```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tack Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tack Def Ndp", ]

#id poss with shots
pashscr <- passA%>%group_by(Team, Action) %>% filter(main  == "Shot Op Oc"|main =="Shot Rs Oc")

#Pulls out all of the poss
teamsht <- subset(passA,poss%in%pashscr$poss)
 
teamAsht<- teamsht%>%group_by(poss) %>% filter(Teamnum == "A")%>%select(Player,poss)

teamAshtA <-dplyr::distinct(teamAsht)

teamAshtA<- teamAshtA %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamAshtA , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  + 
ylab("Shot involvements") +
theme(legend.position="none") +
 theme_classic()



```

### Monaghan
```{r}
passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tack Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tack Def Ndp", ]

#id poss with shots
pashscr <- passB%>%group_by(Team, Action) %>% filter(main  == "Shot Op Oc"|main =="Shot Rs Oc")

#Pulls out all of the poss
teamsht <- subset(passB,poss%in%pashscr$poss)


teamBsht<- teamsht%>%group_by(poss) %>% filter(Teamnum == "B")%>%select(Player,poss)


teamBshtB <-dplyr::distinct(teamBsht)


teamBshtB<- teamBshtB %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamBshtB , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  +  
ylab("Shot involvements") +
theme(legend.position="none") +
 theme_classic()



```

## Player Score Involvement

### Dublin
```{r}

passA <- pass%>%filter(Teamnum == "A")

passA <- passA[passA$main!="Spoil Off", ]
passA <- passA[passA$main!="Def Act", ]
passA <- passA[passA$main!="Tack Def", ]
passA <- passA[passA$main!="Free Loss", ]
passA <- passA[passA$main!="Tack Def Ndp", ]
passA <- passA[passA$main!="Shot Prs", ]

#id poss with shots
pashscr <- passA%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscr <- subset(passA,poss%in%pashscr$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscr%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamAscrA <-dplyr::distinct(plyrscrinv)

teamAscrA<- teamAscrA %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamAscrA , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  +  
ylab("Score involvements") +
theme(legend.position="none") +
 theme_classic()

```

### Monaghan
```{r}

passB <- pass%>%filter(Teamnum == "B")

passB <- passB[passB$main!="Spoil Off", ]
passB <- passB[passB$main!="Def Act", ]
passB <- passB[passB$main!="Tack Def", ]
passB <- passB[passB$main!="Free Loss", ]
passB <- passB[passB$main!="Tack Def Ndp", ]
passB <- passB[passB$main!="Shot Prs", ]

#id poss with shots
pashscrB <- passB%>%group_by(Team, Action) %>% filter(subset  == "Scr Op"|subset =="Scr Rs")

#Pulls out all of the poss
teamscrB <- subset(passB,poss%in%pashscrB$poss)

#6Player Score Link - By vop
plyrscrinv <- teamscrB%>%group_by(Player, poss) %>% filter(main == "PW"| main == "Ko Rec"| main == "Rec Op"| main == "Rec Rs"|main == "Pass Rs"|main == "Ko"|main == "Shot Rs")%>%select(Player, poss)

teamBscrB <-dplyr::distinct(plyrscrinv)

teamBscrB <- teamBscrB %>%group_by(Player)%>%select(Player,poss)%>%summarize(count=n()) 


ggplot(teamBscrB , aes(x = Player, y = count)) +
  geom_bar(stat = "identity", 
           fill = "lightgreen",    
           width = .5) +  
geom_text(aes(label =count, vjust = 0), size = 8,colour ="black") +
scale_x_continuous(labels = passA$Player, breaks = passA$Player)  + 
  ylab("Score involvements") +
theme(legend.position="none") +
 theme_classic()

```

## % of Player Involvement in Team Actions
### Dublin

```{r}
pTotA <- plystats%>% filter(Teamnum == "A") %>% select ("plyno","Team","name", "OBPp","towp","Recp","korecp","CPp","Totteamshot","Totteamscr", "pploss","pFkw","pFkl")

library(plyr)

pTotA <- rename(pTotA, c( plyno = "Player", OBPp = "On Ball%","Recp" = "Passes Received%",  towp = "Possession Won%", korecp = "Ko Received%", 
CPp = "Comp. Pass%", Totteamshot = "Total Shot%", Totteamscr = "Total Scr%", pploss = "Turnover Lost%", pFkw = "Fk Won%", pFkl = "Fk Loss%"))

detach(package:plyr)

formattable(pTotA, align = c("l", rep("c", NCOL(pTotA) - 1)), list(
  `Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `On Ball%`= color_tile("#DeF7E9", "#71CA97"),
  `Passes Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Possession Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Ko Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Comp. Pass%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Shot%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Scr%`= color_tile("#DeF7E9", "#71CA97"),
  `Turnover Lost%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Loss%`= color_tile("#DeF7E9", "#71CA97")
))

```

### Monaghan

```{r}
pTotB <- plystats%>% filter(Teamnum == "B") %>% select ("plyno","Team","name", "OBPp","towp","Recp","korecp","CPp","Totteamshot","Totteamscr", "pploss","pFkw","pFkl")

library(plyr)

pTotB <- rename(pTotB, c( plyno = "Player", OBPp = "On Ball%","Recp" = "Passes Received%",  towp = "Possession Won%", korecp = "Ko Received%", 
CPp = "Comp. Pass%", Totteamshot = "Total Shot%", Totteamscr = "Total Scr%", pploss = "Turnover Lost%", pFkw = "Fk Won%", pFkl = "Fk Loss%"))

detach(package:plyr)

formattable(pTotB, align = c("l", rep("c", NCOL(pTotB) - 1)), list(
  `Team` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
  `On Ball%`= color_tile("#DeF7E9", "#71CA97"),
  `Passes Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Possession Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Ko Received%`= color_tile("#DeF7E9", "#71CA97"),
  `Comp. Pass%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Shot%`= color_tile("#DeF7E9", "#71CA97"),
  `Total Scr%`= color_tile("#DeF7E9", "#71CA97"),
  `Turnover Lost%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Won%`= color_tile("#DeF7E9", "#71CA97"),
  `Fk Loss%`= color_tile("#DeF7E9", "#71CA97")
))

```



## Pass flow (Last 3 passes before a shot (Last row = Shot taker))
### Dublin
```{r}

TeamAPAScrflow  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAA <- subset(run, poss %in% TeamAPAScrflow$poss)

passA <-passAA %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))

passAidA <- passAid %>%select(possno, Player)

passAidA <-passAidA%>%group_by (possno) %>%
dplyr::mutate(i1 = row_number()) %>% 
  tidyr::spread(possno,Player)%>%
   select(-i1)

passAidA <- passAidA[sapply(passAidA, function(passAidA) !any(is.na(passAidA)))]

formattable (passAidA, align = c("l", rep("c", NCOL(passAidA) - 1)))

```

### Monaghan
```{r}

TeamBPBScrflow  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

pass <- subset(run, poss %in% TeamBPBScrflow$poss)

passB <-pass %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

#write.csv(passA,"passA.csv")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())


passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=4,wt = id)%>%
  arrange(possno, (id))


passBidB <- passBid %>%select(possno, Player)


passBidB <-passBidB%>%group_by (possno) %>%
dplyr::mutate(i1 = row_number()) %>% 
  tidyr::spread(possno,Player)%>%
   select(-i1)


passBidB <- passBidB[sapply(passBidB, function(passBidB) !any(is.na(passBidB)))]

formattable (passBidB, align = c("l", rep("c", NCOL(passBidB) - 1)))
```

### Assists (Pass inside opposition 45 that lead to a score)
### Dublin
```{r}

run <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/rundubmonnfl20.csv", header=TRUE, sep=";")
attach (run)

TeamAPAScrflowAst  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAAst <- subset(run, poss %in% TeamAPAScrflowAst$poss)


TeamAPAScrflowAst  <- run %>%group_by(Team, Action) %>% filter( subset == "Scr Op")

passAAst <- subset(passAAst, poss %in% TeamAPAScrflowAst$poss)

passA <-passAAst %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passAidA <- passAid %>%filter (Areax > 99.9)%>%select(possno, Player)

passAidA <- passAid %>%filter (Areax > 99.9)

passAidA <-passAidA[!duplicated(passAidA[,c('possno')]),]

passAidA <-passAidA %>%group_by(Player)%>%summarize(Assist =sum(main == "Pass Op"))

passAidA <- passAidA[passAidA$Assist!="0", ]

formattable (passAidA, align = c("l", rep("c", NCOL(passAidA) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))


```

### Monaghan 
```{r}
#Assists - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 

run <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/rundubmonnfl20.csv", header=TRUE, sep=";")
attach (run)

TeamBPBScrflowBst  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passBAst <- subset(run, poss %in% TeamBPBScrflowBst$poss)


passB <-passBAst %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

#write.csv(passB,"passB.csv")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passBidB <- passBid %>%filter (Areax > 99.9)%>%select(possno, Player)

passBidB <- passBid %>%filter (Areax > 99.9)

passBidB <-passBidB[!duplicated(passBidB[,c('possno')]),]

passBidB <-passBidB %>%group_by(Player)%>%summarize(Assist =sum(main == "Pass Op"))

passBidB <- passBidB[passBidB$Assist!="0", ]

formattable (passBidB, align = c("l", rep("c", NCOL(passBidB) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))



```

### Key Pass (Pass inside opposition 45 that lead to an unsuccesful shot)
### Dublin
```{r}
#Key Passes - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 

run <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/rundubmonnfl20.csv", header=TRUE, sep=";")
attach (run)

TeamAPAMsflowKey  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passAKey <- subset(run, poss %in% TeamAPAMsflowKey$poss)


TeamAPAMsflowKey  <- run %>%group_by(Team, Action) %>% filter( subset == "Ms Op")

passAA <- subset(passAKey, poss %in% TeamAPAMsflowKey$poss)

passA <-passAA %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passA <- passA %>%filter (Teamnum == "A")

#write.csv(passA,"passA.csv")

passAid <-passA %>%
  group_by(possno) %>%
 mutate(id = row_number())

passAid <-passAid%>%group_by(possno,id)%>%arrange(desc(id))
 
passAid <-passAid %>% group_by(possno) %>% arrange(possno)

passAid <-passAid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passAidA <- passAid %>%filter (Areax > 99.9)%>%select(possno, Player)

passAidA <- passAid %>%filter (Areax > 99.9)

passAidA <-passAidA[!duplicated(passAidA[,c('possno')]),]

passAidA <-passAidA %>%group_by(Player)%>%summarize(Key_Pass =sum(main == "Pass Op"))

passAidA <- passAidA[passAidA$Key_Pass!="0", ]

formattable (passAidA, align = c("l", rep("c", NCOL(passAidA) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))
```

### Monaghan
```{r}
#Key Passes - Pass made Inside Opp 45 - Want to be able to count this not just show columns like flow 

run <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/dubmonnfl20/rundubmonnfl20.csv", header=TRUE, sep=";")
attach (run)

TeamBPBMsflowKey  <- run %>%group_by(Team, Action) %>% filter( main == "Shot Op")

passBKey <- subset(run, poss %in% TeamBPBMsflowKey$poss)


TeamBPBMsflowKey  <- run %>%group_by(Team, Action) %>% filter( subset == "Ms Op")

passBB <- subset(passBKey, poss %in% TeamBPBMsflowKey$poss)

passB <-passBB %>% filter(main == "Pass Op"|main == "Pass Rs"|main == "Shot Op")
passB <- passB %>%filter (Teamnum == "B")

#write.csv(passB,"passB.csv")

passBid <-passB %>%
  group_by(possno) %>%
 mutate(id = row_number())

passBid <-passBid%>%group_by(possno,id)%>%arrange(desc(id))
 
passBid <-passBid %>% group_by(possno) %>% arrange(possno)

passBid <-passBid %>% group_by(possno) %>% top_n(n=2,wt = id)%>%
  arrange(possno, (id))

#passBidB <- passBid %>%filter (Areax > 99.9)%>%select(possno, Player)

passBidB <- passBid %>%filter (Areax > 99.9)

passBidB <-passBidB[!duplicated(passBidB[,c('possno')]),]

passBidB <-passBidB %>%group_by(Player)%>%summarize(Key_Pass =sum(main == "Pass Op"))

passBidB <- passBidB[passBidB$Key_Pass!="0", ]

formattable (passBidB, align = c("l", rep("c", NCOL(passBidB) - 1)),
list(`Player` = formatter("span", style = ~ style(color = "grey",font.weight = "bold")), 
                 area(col = 2) ~ color_tile("#DeF7E9", "#71CA97")))



```


## Posessions Per Playing Time

```{r}
ggplot(data = plystats , aes(x = plytime, y = OBP)) + 
geom_point(data = plystats , aes(x = plytime, y = OBP, colour = Team), size =2) +
geom_text_repel(data = plystats , aes(x = plytime, y = OBP, colour = Team, label = plyname), size = 4) +
theme_classic () +
guides(size = FALSE) + 
  theme(legend.position="bottom")
```

## Player % involvement and shot efficiency
```{r}
#scrA <- plystats%>%filter(Teamnum=="A")%>% select(Team, plyname,opshots, Totteamshot,opscr,Totteamscr,convrate) 
#kable (scrA)%>% kable_styling(bootstrap_options=c("striped"))

#scrB <- plystats%>%filter(Teamnum=="B")%>% select(Team, plyname,opshots, Totteamshot,opscr,Totteamscr,convrate) 
#kable (scrB)%>% kable_styling(bootstrap_options=c("striped"))

```

## Open Play Shots vs Playing Time
```{r}

plystatsoppt <- filter(plystats, opshots != 0)
ggplot(data =plystatsoppt , aes(x = plytime, y = opshots)) + 
geom_point(data = plystatsoppt , aes(x = plytime, y = opshots, colour = Team), size = 2) +
geom_text_repel(data = plystatsoppt , aes(x = plytime, y = opshots, colour = Team, label = plyname), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")
```

## Open Play Scores vs Playing Time
```{r}

plystatsopscrpt <- filter(plystats, opscr != 0)
ggplot(data = plystatsopscrpt , aes(x = plytime, y = opscr)) + 
geom_point(data = plystatsopscrpt , aes(x = plytime, y = opscr, colour = Team), size = 2) +
geom_text_repel(data = plystatsopscrpt , aes(x = plytime, y = opscr, colour = Team, label = plyname), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")
```

## Open Play Shots vs Open Play Score
```{r}
plystatsscr <- plystats %>% filter(opscr >0)

ggplot(data = plystatsscr , aes(x = opshots, y = opscr)) + 
geom_point(data = plystatsscr , aes(x = opshots, y = opscr, colour = Team), size = 2) +
geom_text_repel(data = plystatsscr , aes(x = opshots, y = opscr, colour = Team, label = plyname), size = 4) +
theme_classic () +
guides(color = FALSE, size = FALSE) + 
  theme(legend.position="bottom")
```


