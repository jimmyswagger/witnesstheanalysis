---
title: "Crokes vs Judes"
output: html_document
---


```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, options(knitr.kable.NA = ''))

## Load packages and pitch ##
#install.packages('digest', repos='http://cran.us.r-project.org')
suppressPackageStartupMessages(library (digest))
suppressPackageStartupMessages(library(flexdashboard))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(deldir))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(ggrepel))
suppressPackageStartupMessages(library(ggpubr))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(rmarkdown))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(RColorBrewer))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(igraph))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(treemap))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(networkD3))
suppressPackageStartupMessages(library (curl))
suppressPackageStartupMessages(library(formattable))
suppressPackageStartupMessages(library(grid))
suppressPackageStartupMessages(library(yaml))
suppressPackageStartupMessages(library(tinytex))
suppressPackageStartupMessages(library(ggforce))
suppressPackageStartupMessages(library(waffle))
suppressPackageStartupMessages(library(ggnewscale))
suppressPackageStartupMessages(library(factoextra))
suppressPackageStartupMessages(library(cluster))
suppressPackageStartupMessages(library(tidyquant))
suppressPackageStartupMessages(library(parallel))
suppressPackageStartupMessages(library(ggExtra))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(sp))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(tidymodels))
suppressPackageStartupMessages(library(tidytext))
suppressPackageStartupMessages(library(RGraphics))
suppressPackageStartupMessages(library(cowplot))
suppressPackageStartupMessages(library(magick))
suppressPackageStartupMessages(library(patchwork))
suppressPackageStartupMessages(library(ggiraph))
suppressPackageStartupMessages(library(gghighlight))

options(dplyr.summarise.inform = FALSE)



```


```{r}
## Load Match and Team sheet ## 
    
match <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/kiljuddubscf21/matchkiljuddubscf21.csv", header=TRUE, sep=";")
attach (match)

teamsheet <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/kiljuddubscf21/teamsheetkiljuddubscf21.csv", header=TRUE, sep=";")
attach (teamsheet)
  
## Load sets, zones etc 
    
sets <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/sets_short.csv", header=TRUE, sep=";")
attach (sets)
  
# Changing Actions #
  


  
## Kick Outs ## 

  match <- match %>% mutate(Action =  
  ifelse(Action == "Rec" & lag (Action == "Ko Press"), "Ko Rec",
  ifelse(Action == "Rec" & lag (Action == "Ko Lat Press"), "Ko Rec",
  ifelse(Action == "Rec" & lag (Action == "Ko Unc Press"), "Ko Rec",
  ifelse(Action == "Rec Prs" & lag (Action == "Ko Press"), "Ko Rec Prs",
  ifelse(Action == "Rec Prs" & lag (Action == "Ko Lat Press"), "Ko Rec Prs",
  ifelse(Action == "Rec Prs" & lag (Action == "Ko Unc Press"), "Ko Rec Prs",
  ifelse(Action == "Mk Won" & lag (Action == "Ko Press"), "Ko Mk Won",
  ifelse(Action == "Mk Won" & lag (Action == "Ko Lat Press"), "Ko Mk Won",
  ifelse(Action == "Mk Won" & lag (Action == "Ko Unc Press"), "Ko Mk Won",
  match$Action))))))))))
  
  match <- match %>% mutate(Action = 
  ifelse(Action == "ToL" & lag (Action == "Ko Press"), "Ko ToL",
  ifelse(Action == "ToL" & lag (Action == "Ko Lat Press"), "Ko ToL",
  ifelse(Action == "ToL" & lag (Action == "Ko Unc Press"), "Ko ToL",
  match$Action))))
  
  
## Fk Shots ## 

  match <- match %>% mutate(Action =  
  ifelse(Action == "Point" & lag (Action == "Fk Shot Left"), "Fk Point",
  ifelse(Action == "Goal" & lag (Action == "Fk Shot Left"), "Fk Goal",
  ifelse(Action == "Wide Left" & lag (Action == "Fk Shot Left"), "Fk Wide Left",
  ifelse(Action == "Wide Right" & lag (Action == "Fk Shot Left"), "Fk Wide Right",
  ifelse(Action == "Short" & lag (Action == "Fk Shot Left"), "Fk Short",
  ifelse(Action == "Post" & lag (Action == "Fk Shot Left"), "Fk Post",
  ifelse(Action == "Saved" & lag (Action == "Fk Shot Left"), "Fk Saved",
  match$Action))))))))
  
  match <- match %>% mutate(Action =  
  ifelse(Action == "Point" & lag (Action == "Fk Shot Right"), "Fk Point",
  ifelse(Action == "Goal" & lag (Action == "Fk Shot Right"), "Fk Goal",
  ifelse(Action == "Wide Left" & lag (Action == "Fk Shot Right"), "Fk Wide Left",
  ifelse(Action == "Wide Right" & lag (Action == "Fk Shot Right"), "Fk Wide Right",
  ifelse(Action == "Short" & lag (Action == "Fk Shot Right"), "Fk Short",
  ifelse(Action == "Post" & lag (Action == "Fk Shot Right"), "Fk Post",
  ifelse(Action == "Saved" & lag (Action == "Fk Shot Right"), "Fk Saved",
  match$Action))))))))
  
  ## Mk Shots ## 

  match <- match %>% mutate(Action =  
  ifelse(Action == "Fk Shot Left" & lag (Action == "Mk Won"), "Mk Shot Left",
  ifelse(Action == "Fk Shot Right" & lag (Action == "Mk Won"), "Mk Shot Right",
  match$Action)))
  
  ## Mk Shots Outcome ## 
  
    match <- match %>% mutate(Action =  
  ifelse(Action == "Point" & lag (Action == "Mk Shot Left"), "Mk Point",
  ifelse(Action == "Goal" & lag (Action == "Mk Shot Left"), "Mk Goal",
  ifelse(Action == "Wide Left" & lag (Action == "Mk Shot Left"), "Mk Wide Left",
  ifelse(Action == "Wide Right" & lag (Action == "Mk Shot Left"), "Mk Wide Right",
  ifelse(Action == "Short" & lag (Action == "Mk Shot Left"), "Mk Short",
  ifelse(Action == "Post" & lag (Action == "Mk Shot Left"), "Mk Post",
  ifelse(Action == "Saved" & lag (Action == "Mk Shot Left"), "Mk Saved",
  match$Action))))))))
  
  match <- match %>% mutate(Action =  
  ifelse(Action == "Point" & lag (Action == "Mk Shot Right"), "Mk Point",
  ifelse(Action == "Goal" & lag (Action == "Mk Shot Right"), "Mk Goal",
  ifelse(Action == "Wide Left" & lag (Action == "Mk Shot Right"), "Mk Wide Left",
  ifelse(Action == "Wide Right" & lag (Action == "Mk Shot Right"), "Mk Wide Right",
  ifelse(Action == "Short" & lag (Action == "Mk Shot Right"), "Mk Short",
  ifelse(Action == "Post" & lag (Action == "Mk Shot Right"), "Mk Post",
  ifelse(Action == "Saved" & lag (Action == "Mk Shot Right"), "Mk Saved",
  match$Action))))))))
  


## Change tcks etc to opp team ##

match$Team<- as.character(match$Team)

match <- match %>% mutate(Team =
ifelse(Team == "Judes" & Action == "Tck Def", "Crokes", 
ifelse(Team == "Judes" & Action == "Tck Def G", "Crokes", 
ifelse(Team == "Judes" & Action == "Fk Loss", "Crokes",
ifelse(Team == "Judes" & Action == "Fk Loss G", "Crokes",
ifelse(Team == "Judes" & Action == "Hp Tck Prs", "Crokes",
ifelse(Team == "Judes" & Action == "Kp Tck Prs", "Crokes",
ifelse(Team == "Judes" & Action == "Ko Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Hp Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Kp Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Fk Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Sl Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Mk Brk Opp", "Crokes",
ifelse(Team == "Judes" & Action == "Def Prs", "Crokes",
ifelse(Team == "Crokes" & Action == "Tck Def", "Judes",
ifelse(Team == "Crokes" & Action == "Tck Def G", "Judes",
ifelse(Team == "Crokes" & Action == "Fk Loss", "Judes",
ifelse(Team == "Crokes" & Action == "Fk Loss G", "Judes",
ifelse(Team == "Crokes" & Action == "Hp Tck Prs", "Judes",
ifelse(Team == "Crokes" & Action == "Kp Tck Prs", "Judes",
ifelse(Team == "Crokes" & Action == "Ko Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Hp Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Kp Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Fk Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Sl Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Mk Brk Opp", "Judes",
ifelse(Team == "Crokes" & Action == "Def Prs", "Judes",
 match$Team)))))))))))))))))))))))))))
 
 
## Vlookups for subset, main and players ##

match <-match %>%
mutate(subset = VLOOKUP(Action, sets, Action, subset), main = VLOOKUP(Action, sets, Action, main))

## make time 2 digits ##

match <- match %>% mutate_if(is.numeric, round, digits = 2)


## Match Times ##


start = 	0
p1 = 	1215
ht = 	2094
p3 = 	3061



## teams and colours ## 

team <- c("Crokes","Judes")

teamcolpop = c("Crokes" = "blue", "Judes" = "red")

teamnumcolpop = c("A" = "blue", "B" = "red")

## Match Details ##

score <- c("1-07", "1-06")

gamescore <- data.frame(team,score)

time <- c("Total Time ","First Half","Second Half")

mins<- c("72", "34", "38")

gametime <- data.frame(time,mins)

## A|B Tag ##

match <- match %>% mutate(Teamnum =ifelse(Team == "Crokes","A","B"))

## Half Time ##

match <- match%>% mutate(half =ifelse(time <= ht,1, ifelse(time > ht,2,"time")))

## Direction of Play ## 
# Team Left to Right is first team 

match <- match %>%mutate(Areax=ifelse(Teamnum == "A" & half == 1,X,ifelse(Teamnum == "B" & half == 1,144-X
,ifelse(Teamnum == "A" & half == 2,144-X,ifelse(Teamnum == "B" & half == 2,X,X)))))

match <-match %>%mutate(Areay=ifelse(Teamnum == "A" & half == 1,Y,ifelse(Teamnum == "B" & half == 1,88-Y
,ifelse(Teamnum == "A" & half == 2,88-Y,ifelse(Teamnum == "B" & half == 2,Y,Y)))))

## Kick outs and Shot Outcomes ##

match <- match %>% mutate( Areax = ifelse (main == "Ko", 20, match$Areax))
match <- match %>% mutate( Areay = ifelse (main == "Ko", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Goal", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Goal", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Point", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Point", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Wide Left", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Wide Left", 50, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Wide Right", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Wide Right", 37, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Short", 143.5, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Short", 44, match$Areay))


match <- match %>% mutate( Areax = ifelse (Action == "Fk Goal", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Fk Goal", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Fk Point", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Fk Point", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Fk Wide Left", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Fk Wide Left", 50, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Fk Wide Right", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Fk Wide Right", 37, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Fk Short", 143.5, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Fk Short", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Pk Goal", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Pk Goal", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Pk Point", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Pk Point", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Pk Wide Left", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Pk Wide Left", 50, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Pk Wide Right", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Pk Wide Right", 37, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Pk Short", 143.5, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Pk Short", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Mk Goal", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Mk Goal", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Mk Point", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Mk Point", 44, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Mk Wide Left", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Mk Wide Left", 50, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Mk Wide Right", 143.9, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Mk Wide Right", 37, match$Areay))

match <- match %>% mutate( Areax = ifelse (Action == "Mk Short", 143.5, match$Areax))
match <- match %>% mutate( Areay = ifelse (Action == "Mk Short", 44, match$Areay))





## Zones 60 ##

match <- match %>% mutate(Zone =
ifelse(Areax >=0 & Areax <=9.99 & Areay >=0 & Areay <=12.99,1, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=13 & Areay <=30.99,2, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=31 & Areay <=56.99,3, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=57 & Areay <=72.49,4, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=72.50 & Areay <=88,5, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=0 & Areay <=12.99,6, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=13 & Areay <=30.99,7, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=31 & Areay <=56.99,8, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=57 & Areay <=72.49,9, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=72.50 & Areay <=88,10, 
ifelse(Areax >=20 & Areax <=32.99 & Areay >=0 & Areay <=12.99,11, 
ifelse(Areax >=20 & Areax <=32.99 & Areay >=13 & Areay <=30.99,12, 
ifelse(Areax >=20 & Areax <=32.99 & Areay >=31 & Areay <=56.99,13, 
ifelse(Areax >=20 & Areax <=32.99 & Areay >=57 & Areay <=72.49,14, 
ifelse(Areax >=20 & Areax <=32.99 & Areay >=72.50 & Areay <=88,15, "No Zone")))))))))))))))) 

match <- match %>% mutate(Zone =
ifelse(Areax >=33 & Areax <=44.99 & Areay >=0 & Areay <=12.99,16, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=13 & Areay <=30.99,17, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=31 & Areay <=56.99,18, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=57 & Areay <=72.49,19, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=72.50 & Areay <=88,20, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=0 & Areay <=12.99,21, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=13 & Areay <=30.99,22, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=31 & Areay <=56.99,23, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=57 & Areay <=72.49,24, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=72.50 & Areay <=88,25, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=0 & Areay <=12.99,26, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=13 & Areay <=30.99,27, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=31 & Areay <=56.99,28, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=57 & Areay <=72.49,29, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=72.50 & Areay <=88,30, match$Zone)))))))))))))))) 

match <- match %>% mutate(Zone =
ifelse(Areax >=72 & Areax <=88.99 & Areay >=0 & Areay <=12.99,31, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=13 & Areay <=30.99,32, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=31 & Areay <=56.99,33, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=57 & Areay <=72.49,34, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=72.50 & Areay <=88,35, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=0 & Areay <=12.99,36, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=13 & Areay <=30.99,37, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=31 & Areay <=56.99,38, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=57 & Areay <=72.49,39, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=72.50 & Areay <=88,40, 
ifelse(Areax >=99 & Areax <=110.99 & Areay >=0 & Areay <=12.99,41, 
ifelse(Areax >=99 & Areax <=110.99 & Areay >=13 & Areay <=30.99,42, 
ifelse(Areax >=99 & Areax <=110.99 & Areay >=31 & Areay <=56.99,43, 
ifelse(Areax >=99 & Areax <=110.99 & Areay >=57 & Areay <=72.49,44, 
ifelse(Areax >=99 & Areax <=110.99 & Areay >=72.50 & Areay <=88,45,  match$Zone)))))))))))))))) 

match <- match %>% mutate(Zone =
ifelse(Areax >=111 & Areax <=123.99 & Areay >=0 & Areay <=12.99,46, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=13 & Areay <=30.99,47, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=31 & Areay <=56.99,48, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=57 & Areay <=72.49,49, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=72.50 & Areay <=88,50, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=0 & Areay <=12.99,51, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=13 & Areay <=30.99,52, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=31 & Areay <=56.99,53, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=57 & Areay <=72.49,54, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=72.50 & Areay <=88,55, 
ifelse(Areax >=134 & Areax <=144 & Areay >=0 & Areay <=12.99,56, 
ifelse(Areax >=134 & Areax <=144 & Areay >=13 & Areay <=30.99,57, 
ifelse(Areax >=134 & Areax <=144 & Areay >=31 & Areay <=56.99,58, 
ifelse(Areax >=134 & Areax <=144 & Areay >=57 & Areay <=72.49,59, 
ifelse(Areax >=134 & Areax <=144 & Areay >=72.50 & Areay <=88,60,  match$Zone)))))))))))))))) 

## Zones 30 ## 

match <- match %>% mutate(Zonethy =
ifelse(Areax >=0 & Areax <=19.99& Areay >=0 & Areay <=12.99,1, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=13 & Areay <=30.99,2, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=31 & Areay <=56.99,3, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=57 & Areay <=74.99,4, 
ifelse(Areax >=0 & Areax <=19.99& Areay >=75 & Areay <=88,5, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=0 & Areay <=12.99,6, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=13 & Areay <=30.99,7, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=31 & Areay <=56.99,8, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=57 & Areay <=74.99,9, 
ifelse(Areax >=20 & Areax <=44.99& Areay >=75 & Areay <=88,10, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=0 & Areay <=12.99,11, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=13 & Areay <=30.99,12, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=31 & Areay <=56.99,13, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=57 & Areay <=74.99,14, 
ifelse(Areax >=45 & Areax <=71.99& Areay >=75 & Areay <=88,15, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=0 & Areay <=12.99,16, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=13 & Areay <=30.99,17, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=31 & Areay <=56.99,18, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=57 & Areay <=74.99,19, 
ifelse(Areax >=72 & Areax <=98.99& Areay >=75 & Areay <=88,20, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=0 & Areay <=12.99,21, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=13 & Areay <=30.99,22, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=31 & Areay <=56.99,23, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=57 & Areay <=74.99,24, 
ifelse(Areax >=99 & Areax <=123.99& Areay >=75 & Areay <=88,25, 
ifelse(Areax >=124 & Areax <=144& Areay >=0 & Areay <=12.99,26, 
ifelse(Areax >=124 & Areax <=144& Areay >=13 & Areay <=30.99,27, 
ifelse(Areax >=124 & Areax <=144& Areay >=31 & Areay <=56.99,28, 
ifelse(Areax >=124 & Areax <=144& Areay >=57 & Areay <=74.99,29, 
ifelse(Areax >=124 & Areax <=144& Areay >=75 & Areay <=88,30
,"No_Zone")))))))))))))))))))))))))))))))


## Zones 120 ## 

match <- match %>% mutate(Zoneotwn =
ifelse(Areax >=0 & Areax <=9.99 & Areay >=0 & Areay <=7.74,1, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=7.75 & Areay <=15.49,2, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=15.5 & Areay <=23.24,3, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=23.25 & Areay <=30.99,4, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=31 & Areay <=43.99,5, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=44 & Areay <=56.99,6, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=57 & Areay <=64.74,7, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=64.50 & Areay <=72.49,8, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=72.5 & Areay <=80.25,9, 
ifelse(Areax >=0 & Areax <=9.99 & Areay >=80.25 & Areay <=88,10, 

ifelse(Areax >=10 & Areax <=19.99 & Areay >=0 & Areay <=7.74,11, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=7.75 & Areay <=15.49,12, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=15.5 & Areay <=23.24,13, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=23.25 & Areay <=30.99,14, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=31 & Areay <=43.99,15, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=44 & Areay <=56.99,16, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=57 & Areay <=64.74,17, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=64.50 & Areay <=72.49,18, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=72.5 & Areay <=80.25,19, 
ifelse(Areax >=10 & Areax <=19.99 & Areay >=80.25 & Areay <=88,20, 

ifelse(Areax >=20 & Areax <=32.49 & Areay >=0 & Areay <=7.74,21, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=7.75 & Areay <=15.49,22, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=15.5 & Areay <=23.24,23, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=23.25 & Areay <=30.99,24, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=31 & Areay <=43.99,25, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=44 & Areay <=56.99,26, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=57 & Areay <=64.74,27, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=64.50 & Areay <=72.49,28, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=72.5 & Areay <=80.25,29, 
ifelse(Areax >=20 & Areax <=32.49 & Areay >=80.25 & Areay <=88,30, "No Zone")))))))))))))))))))))))))))))))

match <- match %>% mutate(Zoneotwn =ifelse(Areax >=33 & Areax <=44.99 & Areay >=0 & Areay <=7.74,31, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=7.75 & Areay <=15.49,32, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=15.5 & Areay <=23.24,33, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=23.25 & Areay <=30.99,34, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=31 & Areay <=43.99,35, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=44 & Areay <=56.99,36, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=57 & Areay <=64.74,37, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=64.50 & Areay <=72.49,38, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=72.5 & Areay <=80.25,39, 
ifelse(Areax >=33 & Areax <=44.99 & Areay >=80.25 & Areay <=88,40, 

ifelse(Areax >=45 & Areax <=54.99 & Areay >=0 & Areay <=7.74,41, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=7.75 & Areay <=15.49,42, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=15.5 & Areay <=23.24,43, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=23.25 & Areay <=30.99,44, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=31 & Areay <=43.99,45, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=44 & Areay <=56.99,46, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=57 & Areay <=64.74,47, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=64.50 & Areay <=72.49,48, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=72.5 & Areay <=80.25,49, 
ifelse(Areax >=45 & Areax <=54.99 & Areay >=80.25 & Areay <=88,50, 

ifelse(Areax >=55 & Areax <=71.99 & Areay >=0 & Areay <=7.74,51, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=7.75 & Areay <=15.49,52, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=15.5 & Areay <=23.24,53, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=23.25 & Areay <=30.99,54, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=31 & Areay <=43.99,55, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=44 & Areay <=56.99,56, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=57 & Areay <=64.74,57, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=64.50 & Areay <=72.49,58, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=72.5 & Areay <=80.25,59, 
ifelse(Areax >=55 & Areax <=71.99 & Areay >=80.25 & Areay <=88,60, match$Zone)))))))))))))))))))))))))))))))

match <- match %>% mutate(Zoneotwn =ifelse(Areax >=72 & Areax <=88.99 & Areay >=0 & Areay <=7.74,61, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=7.75 & Areay <=15.49,62, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=15.5 & Areay <=23.24,63, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=23.25 & Areay <=30.99,64, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=31 & Areay <=43.99,65, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=44 & Areay <=56.99,66, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=57 & Areay <=64.74,67, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=64.50 & Areay <=72.49,68, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=72.5 & Areay <=80.25,69, 
ifelse(Areax >=72 & Areax <=88.99 & Areay >=80.25 & Areay <=88,70, 

ifelse(Areax >=89 & Areax <=98.99 & Areay >=0 & Areay <=7.74,71, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=7.75 & Areay <=15.49,72, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=15.5 & Areay <=23.24,73, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=23.25 & Areay <=30.99,74, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=31 & Areay <=43.99,75, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=44 & Areay <=56.99,76, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=57 & Areay <=64.74,77, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=64.50 & Areay <=72.49,78, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=72.5 & Areay <=80.25,79, 
ifelse(Areax >=89 & Areax <=98.99 & Areay >=80.25 & Areay <=88,80, 

ifelse(Areax >=99 & Areax <=111.49 & Areay >=0 & Areay <=7.74,81, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=7.75 & Areay <=15.49,82, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=15.5 & Areay <=23.24,83, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=23.25 & Areay <=30.99,84, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=31 & Areay <=43.99,85, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=44 & Areay <=56.99,86, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=57 & Areay <=64.74,87, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=64.50 & Areay <=72.49,88,  
ifelse(Areax >=99 & Areax <=111.49 & Areay >=72.5 & Areay <=80.25,89, 
ifelse(Areax >=99 & Areax <=111.49 & Areay >=80.25 & Areay <=88,90, match$Zone)))))))))))))))))))))))))))))))

match <- match %>% mutate(Zoneotwn =ifelse(Areax >=111 & Areax <=123.99 & Areay >=0 & Areay <=7.74,91, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=7.75 & Areay <=15.49,92, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=15.5 & Areay <=23.24,93, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=23.25 & Areay <=30.99,94, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=31 & Areay <=43.99,95, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=44 & Areay <=56.99,96, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=57 & Areay <=64.74,97, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=64.50 & Areay <=72.49,98,  
ifelse(Areax >=111 & Areax <=123.99 & Areay >=72.5 & Areay <=80.25,99, 
ifelse(Areax >=111 & Areax <=123.99 & Areay >=80.25 & Areay <=88,100, 

ifelse(Areax >=124 & Areax <=133.99 & Areay >=0 & Areay <=7.74,101, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=7.75 & Areay <=15.49,102, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=15.5 & Areay <=23.24,103, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=23.25 & Areay <=30.99,104, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=31 & Areay <=43.99,105, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=44 & Areay <=56.99,106, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=57 & Areay <=64.74,107, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=64.50 & Areay <=72.49,108,  
ifelse(Areax >=124 & Areax <=133.99 & Areay >=72.5 & Areay <=80.25,109, 
ifelse(Areax >=124 & Areax <=133.99 & Areay >=80.25 & Areay <=88,110,

ifelse(Areax >=134 & Areax <=144 & Areay >=0 & Areay <=7.74,111, 
ifelse(Areax >=134 & Areax <=144 & Areay >=7.75 & Areay <=15.49,112, 
ifelse(Areax >=134 & Areax <=144 & Areay >=15.5 & Areay <=23.24,113, 
ifelse(Areax >=134 & Areax <=144 & Areay >=23.25 & Areay <=30.99,114, 
ifelse(Areax >=134 & Areax <=144 & Areay >=31 & Areay <=43.99,115, 
ifelse(Areax >=134 & Areax <=144 & Areay >=44 & Areay <=56.99,116, 
ifelse(Areax >=134 & Areax <=144 & Areay >=57 & Areay <=64.74,117, 
ifelse(Areax >=134 & Areax <=144 & Areay >=64.50 & Areay <=72.49,118,  
ifelse(Areax >=134 & Areax <=144 & Areay >=72.5 & Areay <=80.25,119, 
ifelse(Areax >=134 & Areax <=144 & Areay >=80.25 & Areay <=88,120, match$Zone))))))))))))))))))))))))))))))) 

## Create Player ID - for lookups ##
match = match %>% 
   unite(plyid, Team, Player, sep = " ", remove = FALSE)
   
teamsheet = teamsheet %>% 
   unite(plyid, Team, ply, sep = " ", remove = FALSE)

# Load zones etc 

## xy for 30 zones text ##

zonetextthy <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/zonetext.csv", header=TRUE, sep=";")
attach (zonetextthy) 

## xy for 60 zones text - Dont think its used  ##
   
zonetext <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/zonetext60.csv", header=TRUE, sep=";")
attach (zonetext)

#zonetext$tx <- as.numeric(zonetext$tx)
#zonetext$ty <- as.numeric(zonetext$tx)
zonetext$zone<- as.character(zonetext$zone)

#match <-match %>% mutate(xmid = VLOOKUP(Zone,zonetextthy,zone, tx), ymid = VLOOKUP(Zone,zonetextthy, zone, ty))

## Vlookups for subset, main and players ##
match <-match %>%
    mutate(plyname = VLOOKUP(plyid,teamsheet,plyid, name))
    
## Player Number and Action Joined    
match = match %>% 
   unite(plylab, Player, Action, sep = " ", remove = FALSE)
   
## Player Number and Name Joined    
match = match %>% 
   unite(plynum, Player, plyname, sep = " ", remove = FALSE)
   
## Create Poss, Phases and Periods 

teamcnts <- match%>%group_by(Teamnum)%>% mutate(possno = cumsum(main %in% c("PW","Ko")|Action %in% c("45 Shot Left","45 Shot Right","45 Pass","Pk Shot Right")))

teamcnts <- teamcnts%>%group_by(Teamnum)%>% mutate(phaseno = cumsum(main %in% c("PW","Ko","Pass Rs","Shot Rs")))

teamcnts <-teamcnts%>% unite(poss, Teamnum, possno,sep = "",  remove = FALSE)

teamcnts <-teamcnts%>% unite(Phase, Teamnum, phaseno,sep = "",  remove = FALSE)

teamcnts <- teamcnts%>% mutate(period =ifelse(time < p1,1, ifelse(time > p1 & time <=ht ,2, ifelse(time > ht & time <= p3,3,ifelse(time > p3,4,"Time")))))

teamcnts$Zone <- as.integer(teamcnts$Zone)

## Pitch Area - based on 60 zones##

teamcnts <- teamcnts %>% mutate(Pitch_Area =ifelse(Zone >0 & Zone  <=10 ,"In_Def", ifelse(Zone >= 11 & Zone  <=20 ,"Mid_Def", ifelse(Zone >=21 & Zone <=30, "Out_Def",ifelse(Zone  >=31 & Zone <=40,"Out_Att",ifelse(Zone  >=41 & Zone <=50, "Mid_Att",ifelse(Zone >=51 & Zone <=60, "In_Att","Draw")))))))

teamcnts <- teamcnts %>% mutate(Pitch_Area_No =ifelse(Zone >0 & Zone  <=10 ,"1", ifelse(Zone >= 11 & Zone  <=20 ,"2", ifelse(Zone >=21 & Zone <=30, "3",ifelse(Zone  >=31 & Zone <=40,"4",ifelse(Zone  >=41 & Zone <=50, "5",ifelse(Zone >=51 & Zone <=60, "6","Draw")))))))

teamcnts <-teamcnts%>%select (period,possno,poss, phaseno, Phase, Teamnum, Team, Player, plyname,Action, Areax, Areay, plylab,plynum, subset, Zone,Zonethy,Zoneotwn, time, main, Pitch_Area,Pitch_Area_No)

pass <-teamcnts

pass$period <- as.integer(pass$period)
pass$poss <- as.factor(pass$poss)
pass$Phase <- as.factor(pass$Phase)
pass$Teamnum <- as.factor(pass$Teamnum)
pass$subset <- as.factor(pass$subset)

## Zone text measurements and xy for 60 zones text ##

fullzones <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/fullzone60.csv", header=TRUE, sep=";")
attach (fullzones)

midzone <- fullzones %>% mutate (zxa = ((xb - xa)/2), zya = ((yb - ya)/2), zx = (xa + zxa), zy = (ya + zya)) 

midzone <- midzone %>% select (zone,zx,zy) 

midzone <- midzone %>% mutate(tx = (zx + 1), ty = (zy + 1), bx =(zx - 1), by = (zy - 1))
  
pass <- pass %>% mutate(xmid = VLOOKUP(Zone, midzone,zone, zx), ymid = VLOOKUP(Zone, midzone,zone, zy))

pass <-pass %>%select (period,possno,poss, phaseno, Phase, Teamnum, Team, Player, plyname,Action, Areax, Areay,xmid,ymid, plylab,plynum, subset, Zone,Zonethy,Zoneotwn, time, main, Pitch_Area,Pitch_Area_No)

## Zone measurements for 30 zones ##

thirtyzones <- read.csv(file="c:/Users/donagh/OneDrive/Spreadsheet fun/PA Analytics/PA Template/thirtyzones.csv", header=TRUE, sep=";")
attach (thirtyzones)

## Shot Difficulty ## 

shdfposs <- pass %>%filter(Action %in% c("Sht Prs"))

#if zones need changing 
# change Zone to diffsh in score vlookup if this is needed

#shdfposs  <- shdfposs %>% mutate (diffsh = ifelse(Zone == 30,1, ifelse(Zone  == 29,2, ifelse(Zone == 28,3,shdfposs$Zone))))

#shdfposs  <-shdfposs %>%mutate(shotdiff = VLOOKUP(time,shdf,time, Zone))


## Set or Trans def ## 

#Defsu <- pass %>%filter(main %in% c("Att Set Up"))

## Target ## 

#Target <- pass %>%filter(Action %in% c("Target"))
#KoTarget <- pass %>%filter(Action %in% c("Ko Target"))

#write.csv2(pass, "tallylog.csv")



```

```{r}

### RUN ###

## Remove For Run ##

passR <- pass[pass$main!="Def Act", ]
passR <- passR[passR$main!="Target", ]
passR <- passR[passR$main!="Att Set Up", ]
passR <- passR[passR$main!="Def Set Up", ]
passR <- passR[passR$main!="Free Loss", ]
passR <- passR[passR$main!="Sht Prs", ]
passR <- passR[passR$main!="Spoil Off", ]
passR <- passR[passR$main!="Opp Brk", ]
passR <- passR[passR$main!="Card", ]
passR <- passR[passR$main!="Sub In", ]
passR <- passR[passR$main!="Sub Out", ]
passR <- passR[passR$main!="Tck Def", ]
passR <- passR[passR$main!="Tck Def Oc", ]


passR <- passR%>%select(period,possno,poss,phaseno,Phase,Teamnum,Team,Player,plyname,Action,Areax,Areay,xmid,ymid,plylab,plynum,subset,Zone,Zonethy,Zoneotwn,time,main,Pitch_Area)


passRc <- passR 

#passRc <- passR %>% filter (poss =="A1"|poss == "B1"|poss == "A2")

oddps <- passRc[seq(1, nrow(passRc), 1),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","plyname","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area")
evenps <- passRc[seq(2, nrow(passRc), 1),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","plynameoc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc",
"plynumoc","subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc","Pitch_End")

#add column to each data frame with row number
oddps$number <- row.names(oddps)
evenps$number <- row.names(evenps)

run <- merge(oddps, evenps, by = "number", all = TRUE)

run$number <- as.numeric(run$number)

run  <- run %>% arrange(number)


run  <- rename(run, c( xend = "Areaxoc" , yend = "Areayoc", xmidend = "xmidoc", ymidend = "ymidoc", zone = "Zone",  zoneoc = "Zoneoc"))


# Keep
run <-run %>% mutate(teamsame = ifelse(Team == Teamoc ,"Y","N"))
run <-run %>% mutate(keep = ifelse(main =="Free Won" ,"N",ifelse(main == "PosReg","N",ifelse(Action == "Loss Kp 45W","N",
ifelse(Actionoc == "45 Shot Right","N",ifelse(Actionoc == "45 Shot Left","N" ,ifelse(Action == "Ko Fk Won Off","N",run$teamsame)))))))

# Seg type
run <-run %>% mutate(segtypea = ifelse(Action =="Hp","Hp",ifelse(Action  =="Hp Prs","Hp Prs", ifelse(Action  == "Kp","Kp",
ifelse(Action  == "Kp Prs","Kp Prs",ifelse(main  == "Ko","Ko",ifelse(Action == "Fk Pass","Fk Pass",ifelse(Action  == "Sl Pass","Sl Pass"
,ifelse(main  == "Spoil Off","Brk Own",ifelse(main  == "Def Act","Opp Brk",ifelse(Action  == "PW Pass","PW Pass",ifelse(Action  == "Mk Pass","Mk Pass","Carry"))))))))))))

run <-run %>% mutate(segtype = ifelse(subsetoc =="Scr Op","Score",ifelse(subsetoc  == "Ms Op","Miss",ifelse(subsetoc  == "Scr Rs","Scr Rs",ifelse(subsetoc  == "Ms Rs","Ms Rs",
ifelse(subsetoc == "Ko ToL","Ko ToL",ifelse(subsetoc  == "Pass ToL","Pass ToL",ifelse(subsetoc  == "Fk Loss ToL","Fk Loss ToL",ifelse(subsetoc  == "Rs ToL","Sl ToL",ifelse(subsetoc  == "Tck ToL","Carry Loss",ifelse(subsetoc  == "Fk ToL","Carry Loss",run$segtypea)))))))))))

segtype <- c("Hp","Hp Prs","Carry","Kp","Kp Prs","Score","Miss","Ko","Ko ToL","Pass ToL","Fk Loss ToL","Sl ToL","Carry Loss","PW Pass","Fk Pass","Sl Pass","Scr Rs","Ms Rs","Opp Brk","Brk Own")

seg<- c("1", "1", "2",	"3", "3", "4",	"5",	"6",	"7",	"8",	"9", "9","10",	
"11","11","11","12","13",	"14",	"15")

segments <- data.frame(segtype ,seg)

run  <-run  %>%
    mutate(seg = VLOOKUP(segtype,segments, segtype, seg))

#Left Zone

run <-run %>% mutate(same = ifelse(zone == zoneoc ,"Y", "N"))

# Time, Dist, m.s , vec (from where ball is played)

run <-run %>% mutate(time_diff = (timeoc-time), dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)),ms = (dist/time_diff), vec = (atan2(yend-Areay,xend - Areax)*180/pi))

#create dataframe for line colours and time
timedur <- run %>% group_by(poss) %>% filter (keep =="Y") %>%   summarize (dur = sum(time_diff))

run  <-run  %>% mutate(timedur = VLOOKUP(poss,timedur, poss, dur))

run <-run %>% mutate(linecol = ifelse(timedur >0 & timedur  <=9.99 ,1, ifelse(timedur  >=10 & timedur  <=19.99, 2,ifelse(timedur >=20 & timedur  <=29.99, 3,
ifelse(timedur >=30 & timedur  <=39.99, 4 ,ifelse(timedur >=40 & timedur  <=49.99, 5 ,
ifelse(timedur >=50 & timedur  <=59.99, 6,ifelse(timedur >=60 & timedur  <=69.99, 7,ifelse(timedur >=70, 8,10)))))))))

run <-run %>% mutate(line_time = ifelse(linecol == 1 ,"0-9", ifelse(linecol == 2, "10-19",ifelse(linecol == 3,"20-29" ,
ifelse(linecol == 4, "30-39" ,ifelse(linecol == 5, "40-49" ,
ifelse(linecol == 6, "50-59",ifelse(linecol == 7, "60-69",ifelse(linecol == 8, "70+",10)))))))))

#Add phase time colours and time
phs_time <- run %>% group_by(Phase) %>% filter (keep =="Y") %>% summarize (phs_time = sum(time_diff))

run  <-run  %>% mutate(phs_time = VLOOKUP(Phase,phs_time,Phase,phs_time))

run <-run %>% mutate(phasecol = ifelse(phs_time >0 & phs_time  <=9.99 ,1, ifelse(phs_time  >=10 & phs_time  <=19.99, 2,ifelse(phs_time >=20 & phs_time  <=29.99, 3,
ifelse(phs_time >=30 & phs_time  <=39.99, 4 ,ifelse(phs_time >=40 & phs_time  <=49.99, 5 ,
ifelse(phs_time >=50 & phs_time  <=59.99, 6,ifelse(phs_time >=60 & phs_time  <=69.99, 7,ifelse(phs_time >=70, 8,10)))))))))

run <-run %>% mutate(phs_time_line = ifelse(phasecol == 1 ,"0-9", ifelse(phasecol == 2, "10-19",ifelse(phasecol == 3,"20-29" ,
ifelse(phasecol == 4, "30-39" ,ifelse(phasecol == 5, "40-49" ,
ifelse(phasecol == 6, "50-59",ifelse(phasecol == 7, "60-69",ifelse(phasecol == 8, "70+",10)))))))))


#Add pass vec and directions

run <- run%>% mutate(vec_col =ifelse(vec > -90 & vec < -55 ,1, ifelse(vec > -55 & vec < -25,2, ifelse(vec > -25 & vec < 25, 3,ifelse(vec > 25 & vec < 55,4,ifelse(vec > 55 & vec < 90,5,
ifelse(vec > 90 & vec < 145,6,ifelse(vec > 145 & vec < 170,7,ifelse(vec > 170 & vec < -170,8,ifelse(vec > -170 & vec < -145,9,ifelse(vec > -145 & vec < -90, 10,"Draw")))))))))))

run <- run %>% mutate(RunDir = ifelse(vec_col == "1" ,"swr", ifelse(vec_col == 2 ,"for",ifelse(vec_col == 3 ,"for",
ifelse(vec_col == 4 ,"for",ifelse(vec_col == 5 ,"swl",ifelse(vec_col == 6 ,"swl",
ifelse(vec_col == 7 ,"bw",ifelse(vec_col == 8 ,"bw",ifelse(vec_col == 9 ,"bw",ifelse(vec_col == 10 ,"swr",ifelse(vec_col == "None","None","None"))))))))))))

#Add ms time colours

passlinepos <- run %>% filter (keep == "Y") %>%group_by (Team, Phase) %>%
  summarize(ms_ave_phase = mean(ms, na.rm = TRUE))

run <-run  %>% mutate(ms_time = VLOOKUP(Phase,passlinepos,Phase,ms_ave_phase))

run <-run %>% mutate(mscol = ifelse(ms_time  >0 & ms_time <= 2.99 ,1, ifelse(ms_time  >=3 & ms_time  <=5.99, 2,ifelse(ms_time >=6 & ms_time  <=8.99, 3,
ifelse(ms_time >=9 & ms_time <=11.99, 4,ifelse(ms_time >= 12 & ms_time <=14.99, 5 ,
ifelse(ms_time >=15.00 & ms_time <=17.99, 6,ifelse(ms_time >= 18 & ms_time <=20.99, 7,ifelse(ms_time >=21, 8,10)))))))))

run <-run %>% mutate(ms_time_line = ifelse(mscol == 1 ,"0-2.99", ifelse(mscol == 2, "3-5.99",ifelse(mscol == 3,"6-8.99",
ifelse(mscol == 4, "9-11.99" ,ifelse(mscol == 5, "12-14.99",
ifelse(mscol == 6, "15-17.99",ifelse(mscol == 7, "18-20.99",ifelse(mscol == 8, ">21",10)))))))))

#run = run %>% 
   #unite(numname, Player,plyname, sep = " ", remove = FALSE)

#write.csv(run, "run.csv")


```

```{r}

#### PHASE SOP ####

#phaseSoP
#Base Phase details

phaseSoP <- pass %>%filter (main %in% c("PW", "Ko", "Pass Rs","Shot Rs", "Shot Op Oc", "Shot Rs Oc","ToL","Free Won","Off Foul Won","Off 45 Won","Off Sl Won","Half Time", "Full Time","Ref Stop")|
Action %in% c("45 Shot Right","45 Shot Left","45 Pass","Sl Won","Ko Sl Won","Ko Fk Won Off","Pk Shot Right")|
subset %in% c("Att Mk Won", "Ko Mk Won"))

phaseSoP <- phaseSoP%>%select(-plyname)

oddps <- phaseSoP [seq(1, nrow(phaseSoP), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area","Pitch_Area_No")
evenps <- phaseSoP[seq(2, nrow(phaseSoP), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc",
"subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc", "Pitch_Areaoc","Pitch_Area_Nooc")

phaseSoP <- bind_cols(oddps, evenps)


#write.csv2(phasesop, "phasesop.csv")
#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")

phaseSoP <- phaseSoP %>%select("period","possno","poss","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area","possoc","Phaseoc","Actionoc","Zoneoc","Zonethyoc" ,"Zoneotwnoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","mainoc","timeoc","Pitch_Areaoc")


# Pitch_Area_st - where poss started
phaseSoP <- phaseSoP %>% mutate(Pitch_Area_st =ifelse(Pitch_Area == "In_Def" ,"1", ifelse(Pitch_Area == "Mid_Def","2", ifelse(Pitch_Area == "Out_Def", "3",ifelse(Pitch_Area == "Out_Att","4",ifelse(Pitch_Area =="Mid_Att","5",ifelse(Pitch_Area == "In_Att", "6","Draw")))))))

# Pitch_Area_oc - where poss ended
phaseSoP <- phaseSoP %>% mutate(Pitch_Area_Oc =ifelse(Pitch_Areaoc == "In_Def" ,"1", ifelse(Pitch_Areaoc == "Mid_Def","2", ifelse(Pitch_Areaoc == "Out_Def", "3",ifelse(Pitch_Areaoc == "Out_Att","4",ifelse(Pitch_Areaoc =="Mid_Att","5",ifelse(Pitch_Areaoc == "In_Att", "6","Draw")))))))

## Shots ##

shotsallsop <- pass%>%group_by(Team,Phase) %>% filter(main =="Shot Op Oc"|main =="Shot Rs Oc"|main == "Shot Op"|main =="Shot Rs")%>%select(-plyname)

oddps <- shotsallsop[seq(1, nrow(shotsallsop), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area","Pitch_Area_No")
evenps <- shotsallsop[seq(2, nrow(shotsallsop), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc","Pitch_Areaoc","Pitch_Area_Nooc")
shotsallsop <- bind_cols(oddps, evenps) 
shotsallsop <- shotsallsop%>%select("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Zone","Zonethy","Zoneotwnoc","Areax","Areay","xmid","ymid","plylab","plynum","subset","Pitch_Area","Pitch_Area_No"
,"Actionoc","Zoneoc","Zonethyoc","Zoneotwnoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","timeoc")

## Shot Details ## 

runShtd <-shotsallsop %>%mutate (Shot_Dist =(sqrt((144 - Areax)^2+ (44 - Areay)^2)),vec = (atan2(44-Areay,144 - Areax)*180/pi))%>%select(Phase,Player, Action,Areax,Areay,Actionoc,Areaxoc,Areayoc, Shot_Dist,vec,Pitch_Area, Pitch_Area_No)

## Ko Dist y Ko Rec ##

runakod <- run %>% filter (main %in% c("Ko"),keep =="Y")

KOuts <- runakod %>% mutate (Ko_Dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)))%>%select (Phase,Playeroc, Ko_Dist,mainoc,xend,yend,zoneoc, vec,Pitch_End)

## Ko Time ##

runa <- run %>% filter (mainoc %in% c("Ko"),keep =="N")

runa$time <- as.numeric(runa$time)
runa$timeoc <- as.numeric(runa$timeoc)

Ko_Time <- runa%>% mutate(Ko_Time = (timeoc - time))%>%select (Phaseoc, Ko_Time)

## Pass Type Count ## 

## Hp ## 
hptype <- pass %>% group_by(Phase,Action) %>% filter (Action == "Hp") %>% count (Action) 

## Hp Prs ## 
hpprstype <- pass %>% group_by(Phase,Action) %>% filter (Action == "Hp Prs") %>% count (Action) 

#Kp 
kptype <- pass %>% group_by(Phase,Action) %>% filter (Action == "Kp") %>% count (Action) 

#Kp Prs
kpprstype <- pass %>% group_by(Phase,Action) %>% filter (Action == "Kp Prs") %>% count (Action) 


# Tackles - where off was tackled

tckall <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won")) %>% summarise(count = n())

tckallID <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "In_Def") %>% summarise(count = n())

tckallMD <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Mid_Def") %>% summarise(count = n())

tckallOD <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Out_Def") %>% summarise(count = n())

tckallOA <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Out_Att") %>% summarise(count = n())

tckallMA <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Mid_Att") %>% summarise(count = n())

tckallIA <- pass %>% group_by(Phase) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "In_Att") %>% summarise(count = n())

# Frees Won

fkall <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won")) %>% summarise(count = n())

fkallID <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "In_Def") %>% summarise(count = n())

fkallMD <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "Mid_Def") %>% summarise(count = n())

fkallOD <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "Out_Def") %>% summarise(count = n())

fkallOA <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "Out_Att") %>% summarise(count = n())

fkallMA <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "Mid_Att") %>% summarise(count = n())

fkallIA <- pass %>% group_by(Phase) %>% filter (main %in% c("Free Won"), Pitch_Area == "In_Att") %>% summarise(count = n())


# Players involved

teamAplyrPhasens <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"))%>%select(Player, Phase)

teamAplyr <-dplyr::distinct(teamAplyrPhasens) 

teamAplyr <-teamAplyr%>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  

# Players involved - P_A

teamAplyrPhasensID <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Def")%>%select(Player, Phase)

teamAplyrID <-dplyr::distinct(teamAplyrPhasensID) 

teamAplyrID <-teamAplyrID %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  

# Players involved - P_A

teamAplyrPhasensMD <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Def")%>%select(Player, Phase)

teamAplyrMD <-dplyr::distinct(teamAplyrPhasensMD) 

teamAplyrMD <-teamAplyrMD %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrPhasensOD <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Def")%>%select(Player, Phase)

teamAplyrOD <-dplyr::distinct(teamAplyrPhasensOD) 

teamAplyrOD <-teamAplyrOD %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrPhasensOA <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Att")%>%select(Player, Phase)

teamAplyrOA <-dplyr::distinct(teamAplyrPhasensOA) 

teamAplyrOA <-teamAplyrOA %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrPhasensMA <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Att")%>%select(Player, Phase)

teamAplyrMA <-dplyr::distinct(teamAplyrPhasensMA) 

teamAplyrMA <-teamAplyrMA %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrPhasensIA <- pass%>%group_by(Player, Phase) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Att")%>%select(Player, Phase)

teamAplyrIA <-dplyr::distinct(teamAplyrPhasensIA) 

teamAplyrIA <-teamAplyrIA %>%group_by(Phase)%>%select(Player,Phase)%>%summarize(count=n())  


#Total passes, distance, Phase duration and m.s
totrun <- run %>% group_by(Phase) %>% filter (keep =="Y") %>%   summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

#Total passes, distance, Phase duration and m.s - P_A
totrunID <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "In_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMD <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "Mid_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunOD <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "Out_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))


totrunOA <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "Out_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMA <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "Mid_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunIA <- run %>% group_by(Phase) %>% filter (keep =="Y", Pitch_Area == "In_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

## Time to Tackle ##

tack <-pass %>%filter (main %in% c("PW", "Ko", "Pass Rs","Shot Rs", "Shot Op Oc", "Shot Rs Oc","ToL","Free Won","Off Foul Won","Off Sl Won","Half Time", "Full Time")|
                              Action %in% c("45 Shot Right","45 Shot Left","45 Pass","Loss Kp SlW","Loss Hp SlW","Loss Ko SlW","Ko Fk Won Off", "Att Mk Won", "Ko Mk Won"))


tack$main[tack$main =="Free Won"]<-"Tck Att"
tack$main[tack$main =="Pass Op"]<-"Tck Att"

#
tack <-tack%>%group_by (Phase)%>% filter(n()>1)

tack <- distinct(tack, main, .keep_all = TRUE)

#Open play Pass & rec (links)
passonly <- tack %>%select(Phase,phaseno, Teamnum,Team,Action,Areax, Areay, Zone, time, main)

oddpl <- passonly[seq(1, nrow(passonly), 2),]
colnames(oddpl) <- c("Phase","phaseno","Teamnum","Team","Action","Areax","Areay","Zone","time","main")
evenpl <- passonly[seq(2, nrow(passonly), 2),]
colnames(evenpl) <- c("Phaseoc","phasenooc","Teamnumoc","Teamoc","Actionoc","Areaxoc","Areayoc","Zoneoc","timeoc","mainoc")
tack_time <- bind_cols(oddpl, evenpl) 
tack_time <- tack_time%>%select("Phase","phaseno","Teamnum","Team","Action","Areax","Areay","Zone","time","main","Phaseoc","mainoc","Areaxoc","Areayoc","Zoneoc","timeoc")

#tack_time

tack_time <-tack_time%>% mutate(timedif = (timeoc - time)) %>% 
   mutate(rounded = round(timedif, 2))
   
#total time of Phase including breaks
phaseSoP  <-phaseSoP %>% mutate(secs =(timeoc - time))


#create duration groups
phaseSoP <-phaseSoP %>% mutate(line_col = ifelse(secs >=0 & secs  <9.491 ,1, ifelse(secs  >=9.5 & secs  <19.491, 2,ifelse(secs >=19.5 & secs  <29.491, 3,ifelse(secs >=29.5 & secs  <39.491, 4 ,ifelse(secs >=39.5 & secs  <50.491, 5 ,ifelse(secs >=49.5 & secs  <60.491, 6,ifelse(secs >=59.5 & secs  <70.491, 7,ifelse(secs >=70.5, 8,10)))))))))

#name duration groups
phaseSoP <- phaseSoP %>% mutate(line_time = ifelse(line_col  == 1 ,"0-9", ifelse(line_col  == 2, "10-19",ifelse(line_col  == 3,"20-29" ,
ifelse(line_col== 4, "30-39" ,ifelse(line_col == 5, "40-49" ,ifelse(line_col  == 6, "50-59",ifelse(line_col  == 7, "60-69",ifelse(line_col  == 8, "70+",10)))))))))

#Entry_45
phaseSoP <- phaseSoP %>% mutate(Entry_45 = ifelse(Areax <99.5 & Areaxoc >99.6 ,"Y", "N"))

#phaseSoP <- phaseSoP %>%select (-phaseno,-Phase, -periodoc,-possnooc, -phasenooc,-Phaseoc,-Teamnumoc,-Teamoc)

## Adding to Sop ## 

phaseSoP  <- phaseSoP  %>% mutate(passno = VLOOKUP(Phase,totrun, Phase, passes),plyinv = VLOOKUP(Phase,teamAplyr, Phase, count),
tot_dist = VLOOKUP(Phase,totrun, Phase, tot_dist),m_s = VLOOKUP(Phase,totrun, Phase, m_s))


#Pass Type
phaseSoP  <- phaseSoP %>% mutate(Hp = VLOOKUP(Phase,hptype,Phase,n))
#Pass Type
phaseSoP  <- phaseSoP %>% mutate(Hp_Prs = VLOOKUP(Phase,hpprstype,Phase,n))
#Pass Type
phaseSoP  <- phaseSoP %>% mutate(Kp_Left = VLOOKUP(Phase,kptype,Phase,n))
#Pass Type
phaseSoP  <- phaseSoP %>% mutate(Kp_Leftprs = VLOOKUP(Phase,kpprstype,Phase,n))



phaseSoP  <- phaseSoP  %>% mutate(passnoID = VLOOKUP(Phase,totrunID, Phase, passes),plyinvID = VLOOKUP(Phase,teamAplyrID, Phase, count),
tot_distID = VLOOKUP(Phase,totrunID, Phase, tot_dist), durID= VLOOKUP(Phase,totrunID, Phase, dur) ,m_sID = VLOOKUP(Phase,totrunID, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(passnoMD = VLOOKUP(Phase,totrunMD, Phase, passes),plyinvMD = VLOOKUP(Phase,teamAplyrMD, Phase, count),
tot_distMD = VLOOKUP(Phase,totrunMD, Phase, tot_dist), durMD= VLOOKUP(Phase,totrunMD, Phase, dur),m_sMD = VLOOKUP(Phase,totrunMD, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(passnoOD = VLOOKUP(Phase,totrunOD, Phase, passes),plyinvOD = VLOOKUP(Phase,teamAplyrOD, Phase, count),
tot_distOD = VLOOKUP(Phase,totrunOD, Phase, tot_dist), durOD = VLOOKUP(Phase,totrunOD, Phase, dur),m_sOD = VLOOKUP(Phase,totrunOD, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(passnoOA = VLOOKUP(Phase,totrunOA, Phase, passes),plyinvOA = VLOOKUP(Phase,teamAplyrOA, Phase, count),
tot_distOA = VLOOKUP(Phase,totrunOA, Phase, tot_dist), durOA= VLOOKUP(Phase,totrunOA, Phase, dur),m_sOA = VLOOKUP(Phase,totrunOA, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(passnoMA = VLOOKUP(Phase,totrunMA, Phase, passes),plyinvMA = VLOOKUP(Phase,teamAplyrMA, Phase, count),
tot_distMA = VLOOKUP(Phase,totrunMA, Phase, tot_dist), durMA = VLOOKUP(Phase,totrunMA, Phase, dur),m_sMA = VLOOKUP(Phase,totrunMA, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(passnoIA = VLOOKUP(Phase,totrunIA, Phase, passes),plyinvIA = VLOOKUP(Phase,teamAplyrIA, Phase, count),
tot_distIA = VLOOKUP(Phase,totrunIA, Phase, tot_dist), durIA = VLOOKUP(Phase,totrunIA, Phase, dur),m_sIA = VLOOKUP(Phase,totrunIA, Phase, m_s))

phaseSoP  <- phaseSoP  %>% mutate(plyshot  = VLOOKUP(Phase,runShtd, Phase, Player), shot_type  = VLOOKUP(Phase,runShtd, Phase, Action),
shotx  = VLOOKUP(Phase,runShtd, Phase,Areax),shoty  = VLOOKUP(Phase,runShtd, Phase,Areay),
Shot_Dist  = VLOOKUP(Phase,runShtd, Phase,Shot_Dist)
,Shot_vec = VLOOKUP(Phase,runShtd, Phase,vec),Shot_PA = VLOOKUP(Phase,runShtd, Phase,Pitch_Area),Shot_PAno = VLOOKUP(Phase,runShtd, Phase,Pitch_Area_No))

# tcks atts and fk won

phaseSoP  <- phaseSoP  %>% mutate(tckAll = VLOOKUP(Phase,tckall, Phase, count),tckID = VLOOKUP(Phase,tckallID, Phase, count), tckMD = VLOOKUP(Phase,tckallMD, Phase, count),  tckOD = VLOOKUP(Phase,tckallOD, Phase, count),
                                 tckOA = VLOOKUP(Phase,tckallOA, Phase, count), tckMA = VLOOKUP(Phase,tckallMA, Phase, count), tckIA = VLOOKUP(Phase,tckallIA, Phase, count))

phaseSoP  <- phaseSoP  %>% mutate(fkAll = VLOOKUP(Phase,fkall, Phase, count),fkID = VLOOKUP(Phase,fkallID, Phase, count), fkMD = VLOOKUP(Phase,fkallMD, Phase, count),  fkOD = VLOOKUP(Phase,fkallOD, Phase, count),
                                 fkOA = VLOOKUP(Phase,fkallOA, Phase, count), fkMA = VLOOKUP(Phase,fkallMA, Phase, count), fkIA = VLOOKUP(Phase,fkallIA, Phase, count))

phaseSoP  <- phaseSoP  %>% mutate(tcktime = VLOOKUP(Phase,tack_time, Phase, rounded))

phaseSoP  <- phaseSoP  %>% mutate(passnoIA = VLOOKUP(Phase,totrunIA, Phase, passes),plyinvIA = VLOOKUP(Phase,teamAplyrIA, Phase, count),
tot_distIA = VLOOKUP(Phase,totrunIA, Phase, tot_dist),m_sIA = VLOOKUP(Phase,totrunIA, Phase, m_s))
phaseSoP  <- phaseSoP  %>% mutate(plyshot  = VLOOKUP(Phase,runShtd, Phase, Player), shot_type  = VLOOKUP(Phase,runShtd, Phase, Action),
shotx  = VLOOKUP(Phase,runShtd, Phase,Areax),shoty  = VLOOKUP(Phase,runShtd, Phase,Areay),
Shot_Dist  = VLOOKUP(Phase,runShtd, Phase,Shot_Dist)
,Shot_vec = VLOOKUP(Phase,runShtd, Phase,vec),Shot_PA = VLOOKUP(Phase,runShtd, Phase,Pitch_Area),Shot_PAno = VLOOKUP(Phase,runShtd, Phase,Pitch_Area_No))

# Kickouts 

phaseSoP  <- phaseSoP  %>% mutate(Ko_Time  = VLOOKUP(Phase,Ko_Time, Phaseoc, Ko_Time),Ko_Dist  = VLOOKUP(Phase,KOuts, Phase,Ko_Dist)
,Ko_Vec  = VLOOKUP(Phase,KOuts, Phase,vec), Ko_Oc  = VLOOKUP(Phase,KOuts, Phase,mainoc),Ko_Ply = VLOOKUP(Phase,KOuts, Phase,Playeroc)
,Pitch_Area_Ko  = VLOOKUP(Phase,KOuts, Phase,Pitch_End)
,Ko_Zone_Rec  = VLOOKUP(Phase,KOuts, Phase,zoneoc),Ko_Zone_X = VLOOKUP(Phase,KOuts, Phase,xend),Ko_Zone_Y  = VLOOKUP(Phase,KOuts, Phase,yend))

# Pitch_Area_Rec
phaseSoP <-phaseSoP %>% mutate(Pitch_Area_Rec = ifelse(main == "Ko",Pitch_Area_Ko,Pitch_Area))

# if Phase started w/ a Ko rec or PW

phaseSoP$Ko_Oc <- as.character(phaseSoP$Ko_Oc)
phaseSoP$main <- as.character(phaseSoP$main)

phaseSoP <-phaseSoP %>% mutate(Pitch_Oc_Ko = ifelse(main == "Ko",	Ko_Oc,main))

# Pitch_Area_Rec - where Phase started w/ a Ko rec or PW
phaseSoP <- phaseSoP %>% mutate(Pitch_Area_Rec_No =ifelse(Pitch_Area_Rec == "In_Def" ,"1", ifelse(Pitch_Area_Rec == "Mid_Def","2", ifelse(Pitch_Area_Rec == "Out_Def", "3",ifelse(Pitch_Area_Rec == "Out_Att","4",ifelse(Pitch_Area_Rec =="Mid_Att","5",ifelse(Pitch_Area_Rec == "In_Att", "6","Draw")))))))

#Distance and m.s start to end (straight line)
phaseSoP <- phaseSoP %>% mutate(oedist =(sqrt((Areaxoc - Areax)^2+ (Areayoc - Areay)^2)), oems = (oedist/secs))

phaseSoP <-phaseSoP %>% mutate(Poss_startx = ifelse(Pitch_Oc_Ko %in% c("PW"),Areax,Ko_Zone_X))
phaseSoP <-phaseSoP %>% mutate(Poss_starty = ifelse(Pitch_Oc_Ko %in% c("PW"),Areay,Ko_Zone_Y))

phaseSoP <-phaseSoP %>% mutate(Poss_endx = ifelse(mainoc == "ToL",Areaxoc, shotx))
phaseSoP <-phaseSoP %>% mutate(Poss_endy = ifelse(mainoc == "ToL",Areayoc, shoty))

phaseSoP <-phaseSoP %>% mutate(Poss_Area_end = ifelse(mainoc == "ToL",Pitch_Areaoc,Shot_PA))
phaseSoP <-phaseSoP %>% mutate(Poss_Area_noend = ifelse(mainoc == "ToL",Pitch_Area_Oc,Shot_PAno))

phaseSoP  <- phaseSoP  %>% mutate(direct = (tot_dist/oedist))


# Add ms lines and colours 

phaseSoP <-phaseSoP %>% mutate(mscol = ifelse(m_s  >0 & m_s <= 2.99 ,1, ifelse(m_s  >=3 & m_s  <=5.99, 2,ifelse(m_s >=6 & m_s  <=8.99, 3,
ifelse(m_s >=9 & m_s <=11.99, 4,ifelse(m_s >= 12 & m_s <=14.99, 5 ,
ifelse(m_s >=15.00 & m_s <=17.99, 6,ifelse(m_s >= 18 & m_s <=20.99, 7,ifelse(m_s >=21, 8,10)))))))))

phaseSoP <-phaseSoP %>% mutate(ms_time_line = ifelse(mscol == 1 ,"0-2.99", ifelse(mscol == 2, "3-5.99",ifelse(mscol == 3,"6-8.99",
ifelse(mscol == 4, "9-11.99" ,ifelse(mscol == 5, "12-14.99",
ifelse(mscol == 6, "15-17.99",ifelse(mscol == 7, "18-20.99",ifelse(mscol == 8, ">21",10)))))))))

# Add oems lines and colours 

phaseSoP <-phaseSoP %>% mutate(oemscol = ifelse(oems  >0 & oems <= 2.99 ,1, ifelse(oems  >=3 & oems  <=5.99, 2,ifelse(oems >=6 & oems  <=8.99, 3,
ifelse(oems >=9 & oems <=11.99, 4,ifelse(oems >= 12 & oems <=14.99, 5 ,
ifelse(oems >=15.00 & oems <=17.99, 6,ifelse(oems >= 18 & oems <=20.99, 7,ifelse(oems >=21, 8,10)))))))))

phaseSoP <-phaseSoP %>% mutate(oems_time_line = ifelse(oemscol == 1 ,"0-2.99", ifelse(oemscol == 2, "3-5.99",ifelse(oemscol == 3,"6-8.99",
ifelse(oemscol == 4, "9-11.99" ,ifelse(oemscol == 5, "12-14.99",
ifelse(oemscol == 6, "15-17.99",ifelse(oemscol == 7, "18-20.99",ifelse(oemscol == 8, ">21",10)))))))))

# digits 

phaseSoP <- phaseSoP %>% mutate_if(is.numeric, round, digits = 2)

phasesop  <- phaseSoP  

phasesop <- phasesop %>% mutate_if(is.numeric, ~replace(., is.na(.), 0))

#write.csv2(phasesop, "phasesop.csv")
#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")
#formattable (phasesop)
#view (phasesop)



```

```{r}

#### SOP ####

#SoP
#Base poss details

passSoP <- pass %>%filter (main %in% c("PW", "Ko", "Shot Op Oc", "Shot Rs Oc","ToL", "Half Time", "Full Time")|Action %in% c("45 Shot Right","45 Shot Left","45 Pass","Off 45 Won", "Ref Stop","Pk Shot Right"))

passSoP <- passSoP%>%select(-plyname)

oddps <- passSoP [seq(1, nrow(passSoP), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area")
evenps <- passSoP[seq(2, nrow(passSoP), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc",
"subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc", "Pitch_Areaoc")
passSoP <- bind_cols(oddps, evenps) 

#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")

passSoP <- passSoP%>%select("period","possno","poss","Phase","Teamnum","Team","Player","Action","Zone","Zonethy","Zoneotwn","Areax","Areay","xmid","ymid","plylab","plynum","subset","main","time","Pitch_Area","possoc","Phaseoc","Actionoc","Zoneoc","Zonethyoc","Zoneotwnoc","Playeroc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","subsetoc","mainoc","timeoc","Pitch_Areaoc")


# Pitch_Area_st - where poss started
passSoP <- passSoP %>% mutate(Pitch_Area_st =ifelse(Pitch_Area == "In_Def" ,"1", ifelse(Pitch_Area == "Mid_Def","2", ifelse(Pitch_Area == "Out_Def", "3",ifelse(Pitch_Area == "Out_Att","4",ifelse(Pitch_Area =="Mid_Att","5",ifelse(Pitch_Area == "In_Att", "6","Draw")))))))

# Pitch_Area_oc - where poss ended
passSoP <- passSoP %>% mutate(Pitch_Area_Oc =ifelse(Pitch_Areaoc == "In_Def" ,"1", ifelse(Pitch_Areaoc == "Mid_Def","2", ifelse(Pitch_Areaoc == "Out_Def", "3",ifelse(Pitch_Areaoc == "Out_Att","4",ifelse(Pitch_Areaoc =="Mid_Att","5",ifelse(Pitch_Areaoc == "In_Att", "6","Draw")))))))

## Shots ##

shotsallsop <- pass%>%group_by(Team,poss) %>% filter(main =="Shot Op Oc"|main =="Shot Rs Oc"|main == "Shot Op"|main =="Shot Rs")%>%select(-plyname)

oddps <- shotsallsop[seq(1, nrow(shotsallsop), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main","Pitch_Area","Pitch_Area_No")
evenps <- shotsallsop[seq(2, nrow(shotsallsop), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc","Pitch_Areaoc","Pitch_Area_Nooc")
shotsallsop <- bind_cols(oddps, evenps) 
shotsallsop <- shotsallsop%>%select("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Zone","Zonethy","Zoneotwnoc","Areax","Areay","xmid","ymid","plylab","plynum","subset","Pitch_Area","Pitch_Area_No"
,"Actionoc","Zoneoc","Zonethyoc","Zoneotwnoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","timeoc")

## Shot Details ## 

runShtd <-shotsallsop %>%mutate (Shot_Dist =(sqrt((144 - Areax)^2+ (44 - Areay)^2)),vec = (atan2(44-Areay,144 - Areax)*180/pi))%>%select(poss,Player, Action,Areax,Areay,Actionoc,Areaxoc,Areayoc, Shot_Dist,vec,Pitch_Area, Pitch_Area_No)

## Ko Dist y Ko Rec ##

runakod <- run %>% filter (main %in% c("Ko"),keep =="Y")

KOuts <- runakod %>% mutate (Ko_Dist =(sqrt((xend - Areax)^2+ (yend - Areay)^2)))%>%select (poss,Playeroc, Ko_Dist,mainoc,xend,yend,zoneoc, vec,Pitch_End)

## Ko Time ##

runa <- run %>% filter (mainoc %in% c("Ko"),keep =="N")

runa$time <- as.numeric(runa$time)
runa$timeoc <- as.numeric(runa$timeoc)

Ko_Time <- runa%>% mutate(Ko_Time = (timeoc - time))%>%select (possoc, Ko_Time)

## Pass Type Count ## 

## Hp ## 
hptype <- pass %>% group_by(poss,Action) %>% filter (Action == "Hp") %>% count (Action) 

## Hp Prs ## 
hpprstype <- pass %>% group_by(poss,Action) %>% filter (Action == "Hp Prs") %>% count (Action) 

#Kp
kptype <- pass %>% group_by(poss,Action) %>% filter (Action == "Kp") %>% count (Action) 

#Kp Prs
kpprstype <- pass %>% group_by(poss,Action) %>% filter (Action == "KpPrs") %>% count (Action) 


# Carries over 20m 

runcarr <- run %>% group_by(poss)%>%filter(keep == "N",seg %in% c("0","2"), dist > 19.99) %>% summarise(count = n())

# Tackles - P_A

tckall <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won")) %>% summarise(count = n())

tckallID <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "In_Def") %>% summarise(count = n())

tckallMD <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Mid_Def") %>% summarise(count = n())

tckallOD <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Out_Def") %>% summarise(count = n())

tckallOA <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Out_Att") %>% summarise(count = n())

tckallMA <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "Mid_Att") %>% summarise(count = n())

tckallIA <- pass %>% group_by(poss) %>% filter (main %in% c("Tck Att","Free Won"), Pitch_Area == "In_Att") %>% summarise(count = n())

# Frees Won - P_A

fkall <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won")) %>% summarise(count = n())

fkallID <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "In_Def") %>% summarise(count = n())

fkallMD <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "Mid_Def") %>% summarise(count = n())

fkallOD <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "Out_Def") %>% summarise(count = n())

fkallOA <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "Out_Att") %>% summarise(count = n())

fkallMA <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "Mid_Att") %>% summarise(count = n())

fkallIA <- pass %>% group_by(poss) %>% filter (main %in% c("Free Won"), Pitch_Area == "In_Att") %>% summarise(count = n())


# Players involved 

teamAplyrpossns <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"))%>%select(Player, poss)

teamAplyr <-dplyr::distinct(teamAplyrpossns) 

teamAplyr <-teamAplyr%>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  

# Players involved - P_A

teamAplyrpossnsID <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Def")%>%select(Player, poss)

teamAplyrID <-dplyr::distinct(teamAplyrpossnsID) 

teamAplyrID <-teamAplyrID %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  

# Players involved - P_A

teamAplyrpossnsMD <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Def")%>%select(Player, poss)

teamAplyrMD <-dplyr::distinct(teamAplyrpossnsMD) 

teamAplyrMD <-teamAplyrMD %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrpossnsOD <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Def")%>%select(Player, poss)

teamAplyrOD <-dplyr::distinct(teamAplyrpossnsOD) 

teamAplyrOD <-teamAplyrOD %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  

 
# Players involved - P_A

teamAplyrpossnsOA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Out_Att")%>%select(Player, poss)

teamAplyrOA <-dplyr::distinct(teamAplyrpossnsOA) 

teamAplyrOA <-teamAplyrOA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrpossnsMA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "Mid_Att")%>%select(Player, poss)

teamAplyrMA <-dplyr::distinct(teamAplyrpossnsMA) 

teamAplyrMA <-teamAplyrMA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


# Players involved - P_A

teamAplyrpossnsIA <- pass%>%group_by(Player, poss) %>% filter(main %in% c("PW","Ko","Pass Op", "Pass Rs","Shot Op","Shot Rs"), Pitch_Area == "In_Att")%>%select(Player, poss)

teamAplyrIA <-dplyr::distinct(teamAplyrpossnsIA) 

teamAplyrIA <-teamAplyrIA %>%group_by(poss)%>%select(Player,poss)%>%summarize(count=n())  


#Total passes, distance, poss duration and m.s
totrun <- run %>% group_by(poss) %>% filter (keep =="Y") %>% summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

#Total passes, distance, poss duration and m.s
totrunID <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "In_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMD <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Mid_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunOD <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Out_Def",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))


totrunOA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Out_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunMA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "Mid_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

totrunIA <- run %>% group_by(poss) %>% filter (keep =="Y", Pitch_Area == "In_Att",main %in% c("Pass Op", "Pass Rs")) %>%   
summarize (passes = sum (main %in% c("Pass Op", "Pass Rs")),tot_dist = sum(dist), dur = sum(time_diff), m_s = sum(tot_dist/dur))

# Time to Tackle

tack <-pass%>%filter (main == "Ko"| main == "PW"| main %in% c( "Tck Att", "Free Won" )|Action %in% c ("Hp Prs", "Kp Prs", "45 Pass"))

tack$main[tack$main =="Free Won"]<-"Tck Att"
tack$main[tack$main =="Pass Op"]<-"Tck Att"

#
tack <-tack%>%group_by (poss)%>% filter(n()>1)

tack <- distinct(tack, main, .keep_all = TRUE)

#Open play Pass & rec (links)
passonly <- tack %>%select(poss,possno, Teamnum,Team,Action,Areax, Areay, Zone, time, main)

oddpl <- passonly[seq(1, nrow(passonly), 2),]
colnames(oddpl) <- c("poss","possno","Teamnum","Team","Action","Areax","Areay","Zone","time","main")
evenpl <- passonly[seq(2, nrow(passonly), 2),]
colnames(evenpl) <- c("possoc","possnooc","Teamnumoc","Teamoc","Actionoc","Areaxoc","Areayoc","Zoneoc","timeoc","mainoc")
tack_time <- bind_cols(oddpl, evenpl) 
tack_time <- tack_time%>%select("poss","possno","Teamnum","Team","Action","Areax","Areay","Zone","time","main","possoc","mainoc","Areaxoc","Areayoc","Zoneoc","timeoc")

#tack_time

tack_time <-tack_time%>% mutate(timedif = (timeoc - time)) %>% 
   mutate(rounded = round(timedif, 2))
   
#Total Phases   

phaseno <- phasesop %>% group_by(poss) %>% count(poss)

#Time of phases 
phasetime  <-phasesop %>% group_by(poss) %>% summarise(phtime = sum(secs))

#phasetime$phtime <- as.integer(phasetime$phtime)

#time$phtime <- as.numeric(as.character(time$phtime))

#phasesop <- phasesop[phasesop$poss!="B98", ]

#total time of poss including breaks
passSoP  <-passSoP %>% mutate(tot_poss_secs =(timeoc - time))

#total number of phases
passSoP  <- passSoP %>% mutate(phno = VLOOKUP(poss,phaseno, poss, n))

#total time of all phases
passSoP  <- passSoP %>% mutate(secs = VLOOKUP(poss,phasetime, poss, phtime))


#create duration groups
passSoP <-passSoP %>% mutate(line_col = ifelse(secs >=0 & secs  <9.491 ,1, ifelse(secs  >=9.5 & secs  <19.491, 2,ifelse(secs >=19.5 & secs  <29.491, 3,ifelse(secs >=29.5 & secs  <39.491, 4 ,ifelse(secs >=39.5 & secs  <50.491, 5 ,ifelse(secs >=49.5 & secs  <60.491, 6,ifelse(secs >=59.5 & secs  <70.491, 7,ifelse(secs >=70.5, 8,10)))))))))

#name duration groups
passSoP <- passSoP %>% mutate(line_time = ifelse(line_col  == 1 ,"0-9", ifelse(line_col  == 2, "10-19",ifelse(line_col  == 3,"20-29" ,
                                                                                                              ifelse(line_col== 4, "30-39" ,ifelse(line_col == 5, "40-49" ,
                                                                                                                                                   ifelse(line_col  == 6, "50-59",ifelse(line_col  == 7, "60-69",ifelse(line_col  == 8, "70+",10)))))))))

#Entry_45
passSoP <- passSoP %>% mutate(Entry_45 = ifelse(Areax <99.5 & Areaxoc >99.6 ,"Y", "N"))

#passSoP <- passSoP %>%select (-phaseno,-Phase, -periodoc,-possnooc, -phasenooc,-Phaseoc,-Teamnumoc,-Teamoc)

passSoP  <- passSoP  %>% mutate(passno = VLOOKUP(poss,totrun, poss, passes),plyinv = VLOOKUP(poss,teamAplyr, poss, count),
tot_dist = VLOOKUP(poss,totrun, poss, tot_dist),m_s = VLOOKUP(poss,totrun, poss, m_s))


#Pass Type
passSoP  <- passSoP %>% mutate(Hp = VLOOKUP(poss,hptype,poss,n))
#Pass Type
passSoP  <- passSoP %>% mutate(Hp_Prs = VLOOKUP(poss,hpprstype,poss,n))
#Pass Type
passSoP  <- passSoP %>% mutate(Kp = VLOOKUP(poss,kptype,poss,n))
#Pass Type
passSoP  <- passSoP %>% mutate(Kp_prs = VLOOKUP(poss,kpprstype,poss,n))




# Carries over 20m

passSoP  <- passSoP  %>% mutate(carries = VLOOKUP(poss,runcarr, poss, count))


passSoP  <- passSoP  %>% mutate(passnoID = VLOOKUP(poss,totrunID, poss, passes),plyinvID = VLOOKUP(poss,teamAplyrID, poss, count),
tot_distID = VLOOKUP(poss,totrunID, poss, tot_dist), durID= VLOOKUP(poss,totrunID, poss, dur) ,m_sID = VLOOKUP(poss,totrunID, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoMD = VLOOKUP(poss,totrunMD, poss, passes),plyinvMD = VLOOKUP(poss,teamAplyrMD, poss, count),
tot_distMD = VLOOKUP(poss,totrunMD, poss, tot_dist), durMD= VLOOKUP(poss,totrunMD, poss, dur),m_sMD = VLOOKUP(poss,totrunMD, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoOD = VLOOKUP(poss,totrunOD, poss, passes),plyinvOD = VLOOKUP(poss,teamAplyrOD, poss, count),
tot_distOD = VLOOKUP(poss,totrunOD, poss, tot_dist), durOD = VLOOKUP(poss,totrunOD, poss, dur),m_sOD = VLOOKUP(poss,totrunOD, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoOA = VLOOKUP(poss,totrunOA, poss, passes),plyinvOA = VLOOKUP(poss,teamAplyrOA, poss, count),
tot_distOA = VLOOKUP(poss,totrunOA, poss, tot_dist), durOA= VLOOKUP(poss,totrunOA, poss, dur),m_sOA = VLOOKUP(poss,totrunOA, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoMA = VLOOKUP(poss,totrunMA, poss, passes),plyinvMA = VLOOKUP(poss,teamAplyrMA, poss, count),
tot_distMA = VLOOKUP(poss,totrunMA, poss, tot_dist), durMA = VLOOKUP(poss,totrunMA, poss, dur),m_sMA = VLOOKUP(poss,totrunMA, poss, m_s))

passSoP  <- passSoP  %>% mutate(passnoIA = VLOOKUP(poss,totrunIA, poss, passes),plyinvIA = VLOOKUP(poss,teamAplyrIA, poss, count),
tot_distIA = VLOOKUP(poss,totrunIA, poss, tot_dist), durIA = VLOOKUP(poss,totrunIA, poss, dur),m_sIA = VLOOKUP(poss,totrunIA, poss, m_s))

passSoP  <- passSoP  %>% mutate(plyshot  = VLOOKUP(poss,runShtd, poss, Player), shot_type  = VLOOKUP(poss,runShtd, poss, Action),
shotx  = VLOOKUP(poss,runShtd, poss,Areax),shoty  = VLOOKUP(poss,runShtd, poss,Areay),
Shot_Dist  = VLOOKUP(poss,runShtd, poss,Shot_Dist)
,Shot_vec = VLOOKUP(poss,runShtd, poss,vec),Shot_PA = VLOOKUP(poss,runShtd, poss,Pitch_Area),Shot_PAno = VLOOKUP(poss,runShtd, poss,Pitch_Area_No))



# tcks atts and fk won

passSoP  <- passSoP  %>% mutate(tckAll = VLOOKUP(poss,tckall, poss, count),tckID = VLOOKUP(poss,tckallID, poss, count), tckMD = VLOOKUP(poss,tckallMD, poss, count),  tckOD = VLOOKUP(poss,tckallOD, poss, count),
                                 tckOA = VLOOKUP(poss,tckallOA, poss, count), tckMA = VLOOKUP(poss,tckallMA, poss, count), tckIA = VLOOKUP(poss,tckallIA, poss, count))

passSoP  <- passSoP  %>% mutate(fkAll = VLOOKUP(poss,fkall, poss, count),fkID = VLOOKUP(poss,fkallID, poss, count), fkMD = VLOOKUP(poss,fkallMD, poss, count),  fkOD = VLOOKUP(poss,fkallOD, poss, count),
                                 fkOA = VLOOKUP(poss,fkallOA, poss, count), fkMA = VLOOKUP(poss,fkallMA, poss, count), fkIA = VLOOKUP(poss,fkallIA, poss, count))

passSoP  <- passSoP  %>% mutate(tcktime = VLOOKUP(poss,tack_time, poss, rounded))

passSoP  <- passSoP  %>% mutate(passnoIA = VLOOKUP(poss,totrunIA, poss, passes),plyinvIA = VLOOKUP(poss,teamAplyrIA, poss, count),
tot_distIA = VLOOKUP(poss,totrunIA, poss, tot_dist),m_sIA = VLOOKUP(poss,totrunIA, poss, m_s))
passSoP  <- passSoP  %>% mutate(plyshot  = VLOOKUP(poss,runShtd, poss, Player), shot_type  = VLOOKUP(poss,runShtd, poss, Action),
shotx  = VLOOKUP(poss,runShtd, poss,Areax),shoty  = VLOOKUP(poss,runShtd, poss,Areay),
Shot_Dist  = VLOOKUP(poss,runShtd, poss,Shot_Dist)
,Shot_vec = VLOOKUP(poss,runShtd, poss,vec),Shot_PA = VLOOKUP(poss,runShtd, poss,Pitch_Area),Shot_PAno = VLOOKUP(poss,runShtd, poss,Pitch_Area_No))


passSoP  <- passSoP  %>% mutate(Ko_Time  = VLOOKUP(poss,Ko_Time, possoc, Ko_Time),Ko_Dist  = VLOOKUP(poss,KOuts, poss,Ko_Dist)
,Ko_Vec  = VLOOKUP(poss,KOuts, poss,vec), Ko_Oc  = VLOOKUP(poss,KOuts, poss,mainoc),Ko_Ply = VLOOKUP(poss,KOuts, poss,Playeroc)
,Pitch_Area_Ko  = VLOOKUP(poss,KOuts, poss,Pitch_End)
,Ko_Zone_Rec  = VLOOKUP(poss,KOuts, poss,zoneoc),Ko_Zone_X = VLOOKUP(poss,KOuts, poss,xend),Ko_Zone_Y  = VLOOKUP(poss,KOuts, poss,yend))



# Pitch_Area_Rec
passSoP <-passSoP %>% mutate(Pitch_Area_Rec = ifelse(main == "Ko",Pitch_Area_Ko,Pitch_Area))

# if poss started w/ a Ko rec or PW

passSoP$Ko_Oc <- as.character(passSoP$Ko_Oc)
passSoP$main <- as.character(passSoP$main)

passSoP <-passSoP %>% mutate(Pitch_Oc_Ko = ifelse(main == "Ko",	Ko_Oc,main))

# Pitch_Area_Rec - where poss started w/ a Ko rec or PW
passSoP <- passSoP %>% mutate(Pitch_Area_Rec_No =ifelse(Pitch_Area_Rec == "In_Def" ,"1", ifelse(Pitch_Area_Rec == "Mid_Def","2", ifelse(Pitch_Area_Rec == "Out_Def", "3",ifelse(Pitch_Area_Rec == "Out_Att","4",ifelse(Pitch_Area_Rec =="Mid_Att","5",ifelse(Pitch_Area_Rec == "In_Att", "6","Draw")))))))

#Distance and m.s start to end (straight line)
passSoP <- passSoP %>% mutate(oedist =(sqrt((Areaxoc - Areax)^2+ (Areayoc - Areay)^2)), oems = (oedist/secs))

passSoP <-passSoP %>% mutate(Poss_startx = ifelse(Pitch_Oc_Ko %in% c("PW"),Areax,Ko_Zone_X))
passSoP <-passSoP %>% mutate(Poss_starty = ifelse(Pitch_Oc_Ko %in% c("PW"),Areay,Ko_Zone_Y))


passSoP <-passSoP %>% mutate(Poss_endx = ifelse(mainoc %in% c( "ToL","Half Time", "Full Time", "Off 45 Won","Ref Stop"),Areaxoc, shotx))
passSoP <-passSoP %>% mutate(Poss_endy = ifelse(mainoc %in% c( "ToL", "Half Time","Full Time", "Off 45 Won","Ref Stop"),Areayoc, shoty))

passSoP <-passSoP %>% mutate(Poss_Area_end = ifelse(mainoc  %in% c( "ToL","Half Time", "Full Time", "Off 45 Won","Ref Stop"),Pitch_Areaoc,Shot_PA))
passSoP <-passSoP %>% mutate(Poss_Area_noend = ifelse(mainoc %in% c( "ToL", "Half Time","Full Time", "Off 45 Won","Ref Stop"),Pitch_Area_Oc,Shot_PAno))


passSoP  <- passSoP  %>% mutate(direct = (tot_dist/oedist))


# Add ms lines and colours 

passSoP <-passSoP %>% mutate(mscol = ifelse(m_s  >0 & m_s <= 2.99 ,1, ifelse(m_s  >=3 & m_s  <=5.99, 2,ifelse(m_s >=6 & m_s  <=8.99, 3,
ifelse(m_s >=9 & m_s <=11.99, 4,ifelse(m_s >= 12 & m_s <=14.99, 5 ,
ifelse(m_s >=15.00 & m_s <=17.99, 6,ifelse(m_s >= 18 & m_s <=20.99, 7,ifelse(m_s >=21, 8,10)))))))))

passSoP <-passSoP %>% mutate(ms_time_line = ifelse(mscol == 1 ,"0-2.99", ifelse(mscol == 2, "3-5.99",ifelse(mscol == 3,"6-8.99",
ifelse(mscol == 4, "9-11.99" ,ifelse(mscol == 5, "12-14.99",
ifelse(mscol == 6, "15-17.99",ifelse(mscol == 7, "18-20.99",ifelse(mscol == 8, ">21",10)))))))))

# Add oems lines and colours 

passSoP <-passSoP %>% mutate(oemscol = ifelse(oems  >0 & oems <= 2.99 ,1, ifelse(oems  >=3 & oems  <=5.99, 2,ifelse(oems >=6 & oems  <=8.99, 3,
ifelse(oems >=9 & oems <=11.99, 4,ifelse(oems >= 12 & oems <=14.99, 5 ,
ifelse(oems >=15.00 & oems <=17.99, 6,ifelse(oems >= 18 & oems <=20.99, 7,ifelse(oems >=21, 8,10)))))))))

passSoP <-passSoP %>% mutate(oems_time_line = ifelse(oemscol == 1 ,"0-2.99", ifelse(oemscol == 2, "3-5.99",ifelse(oemscol == 3,"6-8.99",
ifelse(oemscol == 4, "9-11.99" ,ifelse(oemscol == 5, "12-14.99",
ifelse(oemscol == 6, "15-17.99",ifelse(oemscol == 7, "18-20.99",ifelse(oemscol == 8, ">21",10)))))))))


# digits 

passSoP <- passSoP %>% mutate_if(is.numeric, round, digits = 2)

sop  <- passSoP  

sop  <- sop %>% mutate_if(is.numeric, ~replace(., is.na(.), 0))

sop$Zonethy <- as.numeric(sop$Zonethy)
sop$Zoneotwn <- as.numeric(sop$Zoneotwn)

#write.csv2(sop, "sop.csv")
#write.csv2(oddps, "odsop.csv")
#write.csv2(evenps, "evsop.csv")
#formattable (sop)





```

```{r}

#### SHOTS ####

shotsall <- pass%>%group_by(Team,poss) %>% filter(main =="Shot Op Oc"|main =="Shot Rs Oc"|main == "Shot Op"|main =="Shot Rs")%>%select(-plyname)

oddps <- shotsall[seq(1, nrow(shotsall), 2),]
colnames(oddps) <- c("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","Areax","Areay","xmid","ymid","plylab","plynum","subset","Zone","Zonethy","Zoneotwn","time","main")
evenps <- shotsall[seq(2, nrow(shotsall), 2),]
colnames(evenps) <- c("periodoc","possnooc","possoc","phasenooc","Phaseoc","Teamnumoc","Teamoc","Playeroc","Actionoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc"
,"subsetoc","Zoneoc","Zonethyoc","Zoneotwnoc","timeoc","mainoc")
shotsall <- bind_cols(oddps, evenps) 
shotsall <- shotsall%>%select("period","possno","poss","phaseno","Phase","Teamnum","Team","Player","Action","time","Zone","Zonethy","Zoneotwn","Areax","Areay","xmid","ymid","plylab","plynum","subset"
,"Actionoc","Zoneoc","Zonethyoc","Zoneotwnoc","Areaxoc","Areayoc","xmidoc","ymidoc","plylaboc","plynumoc","subsetoc","timeoc")

scores = shotsall %>% 
   unite(Shot_lab, plylab, timeoc, sep = " ", remove = FALSE)

scores <- scores%>% mutate(scoreA = ifelse(Actionoc == "Goal" & Teamnum == "A",3,ifelse(Actionoc == "Pk Goal" & Teamnum == "A",3,ifelse(Actionoc == "Mk Point" & Teamnum == "A",1,ifelse(Actionoc == "Fk Point"& Teamnum == "A",1, ifelse(Actionoc == "Point"& Teamnum == "A",1, ifelse(Actionoc == "45 Point" & Teamnum == "A",1,0)))))))

scores <- scores%>% mutate(scoreB = ifelse(Actionoc == "Goal" & Teamnum == "B",3,ifelse(Actionoc == "Pk Goal" & Teamnum == "B",3,ifelse(Actionoc == "Mk Point" & Teamnum == "B",1,ifelse(Actionoc == "Fk Point"& Teamnum == "B",1, ifelse(Actionoc == "Point"& Teamnum == "B",1, ifelse(Actionoc == "45 Point" & Teamnum == "B",1,0)))))))

scored <- scores  %>%group_by(Teamnum)%>% mutate(Tot_ScrA = cumsum(scoreA), Tot_ScrB = cumsum(scoreB))  

scored <- as.data.frame(scored) %>% 
  dplyr::mutate(Tot_ScrA = ifelse(Tot_ScrA == 0, NA, Tot_ScrA)) %>% 
  tidyr::fill(Tot_ScrA, .direction = c("updown"))

scored <- as.data.frame(scored) %>% 
  dplyr::mutate(Tot_ScrB = ifelse(Tot_ScrB == 0, NA, Tot_ScrB)) %>% 
  tidyr::fill(Tot_ScrB, .direction = c("updown"))

scored$number <- row.names(scored)


scored <- scored%>% mutate(Tot_ScrA = ifelse(scoreA == "0" & number %in% c("1"),0,scored$Tot_ScrA))

scored <- scored%>% mutate(Tot_ScrB = ifelse(scoreB == "0" & number %in% c("1"),0,scored$Tot_ScrB))

scored <- scored %>%group_by(Teamnum)%>% mutate(diff = (Tot_ScrA- Tot_ScrB))  

scored <- scored %>%group_by(Teamnum)%>% mutate(abdiff = (abs(Tot_ScrA- Tot_ScrB)))

scored$Zonethy <- as.numeric(scored$Zonethy)

scores <-scored %>%
    mutate(tx = VLOOKUP(Zonethy, zonetextthy, zone, tx),ty = VLOOKUP(Zonethy, zonetextthy, zone, ty),bx = VLOOKUP(Zonethy, zonetextthy, zone, bx),by = VLOOKUP(Zonethy, zonetextthy, zone, by))

#Add shot difficulty

scores  <- scores %>% mutate(shdf = VLOOKUP(poss,shdfposs,poss,Zone))

#write.csv2(scores, "scores.csv")
#write.csv2(oddps, "oddpsscrs.csv")
#write.csv2(evenps, "evenpsscrs.csv")
#formattable(scores)



```

```{r, eval = FALSE}

#### PLAYER STATS ####

## Team A ## 

plystatsAA <- teamsheet%>%filter(Teamnum =="A") %>%select( Teamnum, Team, plytime, ply, name, Player,Areax,Areay)

plystatsAA <- plystatsAA %>% arrange(ply)
#plystatsA

passA <- pass %>%filter (Teamnum == "A", Action != "Opp Brk")

playersts <- passA %>%group_by(Player)%>%summarize(PW =sum(main == "PW"),Pass =sum(main == "Pass Op"),Hndps =sum(Action %in% c ( "Hp", "Hp Prs")),Kp = sum (Action %in% c("Kp ", "Kp Prs")),Rec =sum(main == "Rec Op"),
KoRec =sum(main == "Ko Rec"), RsRec =sum(main == "Rec Rs") ,OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"),
RsShot =sum(main == "Shot Rs"),RsScr =sum(subset == "Scr Rs"), Poss_Lost =sum(main == "ToL"), Fk_Won =sum(main == "Free Won"),Fk_Lost =sum(main == "Free Loss"),
Spoils =sum(main == "Def Act"),Targ =sum(subset == "Target"), Ko_Targ =sum(subset == "Ko Target"),  
OBP = (PW + Rec + RsRec + KoRec), Pass_Loss = sum(subset == "Pass ToL"), Comp_Pass = (Pass - Pass_Loss), Att_Mk = sum (subset =="Att Mk Won"), 
Ko_Mk = sum (subset =="Ko Mk Won"))


## Remove player if they had no actions ##
#plystatsAA <- plystatsAA[plystatsAA$ply!="8", ]

playersts <- rename(playersts, "Players" = Player)

statsA <- bind_cols (plystatsAA,playersts)

#plystatsAA
#playersts

statsA <- statsA %>% select(-Players)

statsA [is.na(statsA)] <- 0

## Total Actions in Area of Pitch ##  

plyP_A <- pass%>%group_by(Player)%>% filter (Teamnum == "A",main %in% c("PW", "Pass Op","Pass Rs","Rec Op", "Rec Rs", "Shot Op", "Tck Def", "Free Won", "Free Loss"))%>%
  summarize(In_Def = sum (Pitch_Area %in% c("In_Def")),Mid_Def = sum (Pitch_Area%in% c("Mid_Def")),Out_Def = sum (Pitch_Area %in% c("Out_Def")),
            Out_Att = sum (Pitch_Area %in% c("Out_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),In_Att = sum (Pitch_Area %in% c("In_Att"))) 

plyP_A <- rename(plyP_A, "PlayersA" = Player)

statsA <- bind_cols (statsA,plyP_A)

statsA <- statsA %>% select(-PlayersA)

statsA [is.na(statsA)] <- 0


statsA <- statsA %>% mutate(to_ratio = (Poss_Lost/OBP), pass_eff = ((Pass-Pass_Loss)/Pass*100), att_balls = (OpScr + Comp_Pass),
                            eff_ind = ((PW + att_balls)/(10 + Poss_Lost)), Perf_Score = ((eff_ind*10)+(OBP/2)))

## % of Team Totals - May change this to % player total ## 

statsA <- statsA %>% mutate(totPW = sum(PW), PWp = (PW/totPW*100), totPass = sum(Pass), Passp = (Pass/totPass*100), totRec = sum(Rec), Recp = (Rec/totRec*100),  totKoRec = sum(KoRec), KoRecp = (KoRec/totKoRec*100), 
                            totOpShot = sum(OpShot), OpShotp = (OpShot/totOpShot*100), totOpScr = sum(OpScr), OpScrp = (OpScr/totOpScr*100),
                            totRsShot = sum(RsShot), RsShotp = (RsShot/totRsShot*100), totRsScr = sum(RsScr), RsScrp = (RsScr/totRsScr*100),
                            totPoss_Lost = sum(Poss_Lost), Poss_Lostp = (Poss_Lost/totPoss_Lost*100), 
                            totFk_Won = sum(Fk_Won), Fk_Wonp = (Fk_Won/totFk_Won*100), totFk_Lost = sum(Fk_Lost), Fk_Lostp = (Fk_Lost/totFk_Lost*100), totSpoils = sum(Spoils), Spoilsp = (Spoils/totSpoils*100),
                            totOBP = sum(OBP), OBPp = (OBP/totOBP*100), totCP = sum(Comp_Pass), CPp = (Comp_Pass/totCP*100))


## Per Minute ##
statsA <- statsA %>% mutate(PWamin = (PW/plytime),Passamin = (Pass/plytime), Recamin = (Rec/plytime), KoRecamin = (KoRec/plytime), 
                            OpShotamin = (OpShot/plytime),OpScramin = (OpScr/plytime),
                            RsShotamin = (RsShot/plytime),RsScramin = (RsScr/plytime),
                            Poss_Lostamin = (Poss_Lost/plytime), 
                            Fk_Wonamin = (Fk_Won/plytime),Fk_Losttamin = (Fk_Lost/plytime),Spoilsamin = (Spoils/plytime))

## Pitch Area Counts ##

## Comp Pass wont work for P_A because pass may not have been made in the same P_A

passA<- pass %>%filter(Teamnum=="A")

plystatsAID <- passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def")) %>%summarize(PWAID =sum(main == "PW"),PassAID =sum(main == "Pass Op"),RecAID =sum(main == "Rec Op"),
                                                                                             KoRecAID =sum(main == "Ko Rec"), RsRecAID =sum(main == "Rec Rs") ,OpShotAID =sum(main == "Shot Op"),OpScrAID =sum(subset == "Scr Op"),
                                                                                             RsShotAID =sum(main == "Shot Rs"),RsScrAID =sum(subset == "Scr Rs"), Poss_LostAID =sum(main == "ToL"), Fk_WonAID =sum(main == "Free Won"),Fk_LostAID =sum(main == "Free Loss"),
                                                                                             SpoilsAID =sum(main == "Def Act"), OBPAID = (PWAID + RecAID + RsRecAID + KoRecAID), Pass_LossAID = sum(subset == "Pass ToL"), Comp_PassAID = (PassAID - Pass_LossAID))

plystatsAMD <- passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def")) %>%summarize(PWAMD =sum(main == "PW"),PassAMD =sum(main == "Pass Op"),RecAMD =sum(main == "Rec Op"),
                                                                                              KoRecAMD =sum(main == "Ko Rec"), RsRecAMD =sum(main == "Rec Rs") ,OpShotAMD =sum(main == "Shot Op"),OpScrAMD =sum(subset == "Scr Op"),
                                                                                              RsShotAMD =sum(main == "Shot Rs"),RsScrAMD =sum(subset == "Scr Rs"), Poss_LostAMD =sum(main == "ToL"), Fk_WonAMD =sum(main == "Free Won"),Fk_LostAMD =sum(main == "Free Loss"),
                                                                                              SpoilsAMD =sum(main == "Def Act"), OBPAMD = (PWAMD + RecAMD + RsRecAMD + KoRecAMD), Pass_LossAMD = sum(subset == "Pass ToL"), Comp_PassAMD = (PassAMD - Pass_LossAMD))

plystatsAOD <- passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def")) %>%summarize(PWAOD =sum(main == "PW"),PassAOD =sum(main == "Pass Op"),RecAOD =sum(main == "Rec Op"),
                                                                                              KoRecAOD =sum(main == "Ko Rec"), RsRecAOD =sum(main == "Rec Rs") ,OpShotAOD =sum(main == "Shot Op"),OpScrAOD =sum(subset == "Scr Op"),
                                                                                              RsShotAOD =sum(main == "Shot Rs"),RsScrAOD =sum(subset == "Scr Rs"), Poss_LostAOD =sum(main == "ToL"), Fk_WonAOD =sum(main == "Free Won"),Fk_LostAOD =sum(main == "Free Loss"),
                                                                                              SpoilsAOD =sum(main == "Def Act"), OBPAOD = (PWAOD + RecAOD + RsRecAOD + KoRecAOD), Pass_LossAOD = sum(subset == "Pass ToL"), Comp_PassAOD = (PassAOD - Pass_LossAOD))

plystatsAOA <- passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att")) %>%summarize(PWAOA =sum(main == "PW"),PassAOA =sum(main == "Pass Op"),RecAOA =sum(main == "Rec Op"),
                                                                                              KoRecAOA =sum(main == "Ko Rec"), RsRecAOA =sum(main == "Rec Rs") ,OpShotAOA =sum(main == "Shot Op"),OpScrAOA =sum(subset == "Scr Op"),
                                                                                              RsShotAOA =sum(main == "Shot Rs"),RsScrAOA =sum(subset == "Scr Rs"), Poss_LostAOA =sum(main == "ToL"), Fk_WonAOA =sum(main == "Free Won"),Fk_LostAOA =sum(main == "Free Loss"),
                                                                                              SpoilsAOA =sum(main == "Def Act"), OBPAOA = (PWAOA + RecAOA + RsRecAOA + KoRecAOA), Pass_LossAOA = sum(subset == "Pass ToL"), Comp_PassAOA = (PassAOA - Pass_LossAOA))

plystatsAMA <- passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att")) %>%summarize(PWAMA =sum(main == "PW"),PassAMA =sum(main == "Pass Op"),RecAMA =sum(main == "Rec Op"),
                                                                                              KoRecAMA =sum(main == "Ko Rec"), RsRecAMA =sum(main == "Rec Rs") ,OpShotAMA =sum(main == "Shot Op"),OpScrAMA =sum(subset == "Scr Op"),
                                                                                              RsShotAMA =sum(main == "Shot Rs"),RsScrAMA =sum(subset == "Scr Rs"), Poss_LostAMA =sum(main == "ToL"), Fk_WonAMA =sum(main == "Free Won"),Fk_LostAMA =sum(main == "Free Loss"),
                                                                                              SpoilsAMA =sum(main == "Def Act"), OBPAMA = (PWAMA + RecAMA + RsRecAMA + KoRecAMA), Pass_LossAMA = sum(subset == "Pass ToL"), Comp_PassAMA = (PassAMA - Pass_LossAMA))

plystatsAIA <-passA %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att")) %>%summarize(PWAIA =sum(main == "PW"),PassAIA =sum(main == "Pass Op"),RecAIA =sum(main == "Rec Op"),
                                                                                            KoRecAIA =sum(main == "Ko Rec"), RsRecAIA =sum(main == "Rec Rs") ,OpShotAIA =sum(main == "Shot Op"),OpScrAIA =sum(subset == "Scr Op"),
                                                                                            RsShotAIA =sum(main == "Shot Rs"),RsScrAIA =sum(subset == "Scr Rs"), Poss_LostAIA =sum(main == "ToL"), Fk_WonAIA =sum(main == "Free Won"),Fk_LostAIA =sum(main == "Free Loss"),
                                                                                            SpoilsAIA =sum(main == "Def Act"), OBPAIA = (PWAIA + RecAIA + RsRecAIA + KoRecAIA), Pass_LossAIA = sum(subset == "Pass ToL"), Comp_PassAIA = (PassAIA - Pass_LossAIA))

## Adding Pitch_Area Counts to Base Stats A - VLOOKUPS ##

statsA <-statsA %>%
  mutate(PWAID = VLOOKUP(ply, plystatsAID, Player, PWAID),PassAID = VLOOKUP(ply, plystatsAID, Player, PassAID),RecAID = VLOOKUP(ply, plystatsAID, Player, RecAID),
         KoRecAID = VLOOKUP(ply, plystatsAID, Player, KoRecAID),RsRecAID = VLOOKUP(ply, plystatsAID, Player, RsRecAID),OpShotAID = VLOOKUP(ply, plystatsAID, Player, OpShotAID),
         OpScrAID = VLOOKUP(ply, plystatsAID, Player, OpScrAID),RsShotAID = VLOOKUP(ply, plystatsAID, Player, RsShotAID),RsScrAID = VLOOKUP(ply, plystatsAID, Player,RsScrAID),
         Poss_LostAID = VLOOKUP(ply, plystatsAID, Player, Poss_LostAID),Fk_WonAID = VLOOKUP(ply, plystatsAID, Player,Fk_WonAID),Fk_LostAID= VLOOKUP(ply, plystatsAID, Player, Fk_LostAID),
         SpoilsAID = VLOOKUP(ply, plystatsAID, Player, SpoilsAID),OBPAID =VLOOKUP (ply, plystatsAID, Player, OBPAID), Pass_LossAID = VLOOKUP (ply, plystatsAID, Player,Pass_LossAID))

statsA <-statsA %>%
  mutate(PWAMD = VLOOKUP(ply, plystatsAMD, Player, PWAMD),PassAMD = VLOOKUP(ply, plystatsAMD, Player, PassAMD),RecAMD = VLOOKUP(ply, plystatsAMD, Player, RecAMD),
         KoRecAMD = VLOOKUP(ply, plystatsAMD, Player, KoRecAMD),RsRecAMD = VLOOKUP(ply, plystatsAMD, Player, RsRecAMD),OpShotAMD = VLOOKUP(ply, plystatsAMD, Player, OpShotAMD),
         OpScrAMD = VLOOKUP(ply, plystatsAMD, Player, OpScrAMD),RsShotAMD = VLOOKUP(ply, plystatsAMD, Player, RsShotAMD),RsScrAMD = VLOOKUP(ply, plystatsAMD, Player,RsScrAMD),
         Poss_LostAMD = VLOOKUP(ply, plystatsAMD, Player, Poss_LostAMD),Fk_WonAMD = VLOOKUP(ply, plystatsAMD, Player,Fk_WonAMD),Fk_LostAMD= VLOOKUP(ply, plystatsAMD, Player, Fk_LostAMD),
         SpoilsAMD = VLOOKUP(ply, plystatsAMD, Player, SpoilsAMD),OBPAMD =VLOOKUP (ply, plystatsAMD, Player, OBPAMD), Pass_LossAMD = VLOOKUP (ply, plystatsAMD, Player,Pass_LossAMD))

statsA <-statsA %>%
  mutate(PWAOD = VLOOKUP(ply, plystatsAOD, Player, PWAOD),PassAOD = VLOOKUP(ply, plystatsAOD, Player, PassAOD),RecAOD = VLOOKUP(ply, plystatsAOD, Player, RecAOD),
         KoRecAOD = VLOOKUP(ply, plystatsAOD, Player, KoRecAOD),RsRecAOD = VLOOKUP(ply, plystatsAOD, Player, RsRecAOD),OpShotAOD = VLOOKUP(ply, plystatsAOD, Player, OpShotAOD),
         OpScrAOD = VLOOKUP(ply, plystatsAOD, Player, OpScrAOD),RsShotAOD = VLOOKUP(ply, plystatsAOD, Player, RsShotAOD),RsScrAOD = VLOOKUP(ply, plystatsAOD, Player,RsScrAOD),
         Poss_LostAOD = VLOOKUP(ply, plystatsAOD, Player, Poss_LostAOD),Fk_WonAOD = VLOOKUP(ply, plystatsAOD, Player,Fk_WonAOD),Fk_LostAOD= VLOOKUP(ply, plystatsAOD, Player, Fk_LostAOD),
         SpoilsAOD = VLOOKUP(ply, plystatsAOD, Player, SpoilsAOD),OBPAOD =VLOOKUP (ply, plystatsAOD, Player, OBPAOD), Pass_LossAOD = VLOOKUP (ply, plystatsAOD, Player,Pass_LossAOD))

statsA <-statsA %>%
  mutate(PWAOA = VLOOKUP(ply, plystatsAOA, Player, PWAOA),PassAOA = VLOOKUP(ply, plystatsAOA, Player, PassAOA),RecAOA = VLOOKUP(ply, plystatsAOA, Player, RecAOA),
         KoRecAOA = VLOOKUP(ply, plystatsAOA, Player, KoRecAOA),RsRecAOA = VLOOKUP(ply, plystatsAOA, Player, RsRecAOA),OpShotAOA = VLOOKUP(ply, plystatsAOA, Player, OpShotAOA),
         OpScrAOA = VLOOKUP(ply, plystatsAOA, Player, OpScrAOA),RsShotAOA = VLOOKUP(ply, plystatsAOA, Player, RsShotAOA),RsScrAOA = VLOOKUP(ply, plystatsAOA, Player,RsScrAOA),
         Poss_LostAOA = VLOOKUP(ply, plystatsAOA, Player, Poss_LostAOA),Fk_WonAOA = VLOOKUP(ply, plystatsAOA, Player,Fk_WonAOA),Fk_LostAOA= VLOOKUP(ply, plystatsAOA, Player, Fk_LostAOA),
         SpoilsAOA = VLOOKUP(ply, plystatsAOA, Player, SpoilsAOA),OBPAOA =VLOOKUP (ply, plystatsAOA, Player, OBPAOA), Pass_LossAOA = VLOOKUP (ply, plystatsAOA, Player,Pass_LossAOA))

statsA <-statsA %>%
  mutate(PWAMA = VLOOKUP(ply, plystatsAMA, Player, PWAMA),PassAMA = VLOOKUP(ply, plystatsAMA, Player, PassAMA),RecAMA = VLOOKUP(ply, plystatsAMA, Player, RecAMA),
         KoRecAMA = VLOOKUP(ply, plystatsAMA, Player, KoRecAMA),RsRecAMA = VLOOKUP(ply, plystatsAMA, Player, RsRecAMA),OpShotAMA = VLOOKUP(ply, plystatsAMA, Player, OpShotAMA),
         OpScrAMA = VLOOKUP(ply, plystatsAMA, Player, OpScrAMA),RsShotAMA = VLOOKUP(ply, plystatsAMA, Player, RsShotAMA),RsScrAMA = VLOOKUP(ply, plystatsAMA, Player,RsScrAMA),
         Poss_LostAMA = VLOOKUP(ply, plystatsAMA, Player, Poss_LostAMA),Fk_WonAMA = VLOOKUP(ply, plystatsAMA, Player,Fk_WonAMA),Fk_LostAMA= VLOOKUP(ply, plystatsAMA, Player, Fk_LostAMA),
         SpoilsAMA = VLOOKUP(ply, plystatsAMA, Player, SpoilsAMA),OBPAMA =VLOOKUP (ply, plystatsAMA, Player, OBPAMA), Pass_LossAMA = VLOOKUP (ply, plystatsAMA, Player,Pass_LossAMA))

statsA <-statsA %>%
  mutate(PWAIA = VLOOKUP(ply, plystatsAIA, Player, PWAIA),PassAIA = VLOOKUP(ply, plystatsAIA, Player, PassAIA),RecAIA = VLOOKUP(ply, plystatsAIA, Player, RecAIA),
         KoRecAIA = VLOOKUP(ply, plystatsAIA, Player, KoRecAIA),RsRecAIA = VLOOKUP(ply, plystatsAIA, Player, RsRecAIA),OpShotAIA = VLOOKUP(ply, plystatsAIA, Player, OpShotAIA),
         OpScrAIA = VLOOKUP(ply, plystatsAIA, Player, OpScrAIA),RsShotAIA = VLOOKUP(ply, plystatsAIA, Player, RsShotAIA),RsScrAIA = VLOOKUP(ply, plystatsAIA, Player,RsScrAIA),
         Poss_LostAIA = VLOOKUP(ply, plystatsAIA, Player, Poss_LostAIA),Fk_WonAIA = VLOOKUP(ply, plystatsAIA, Player,Fk_WonAIA),Fk_LostAIA= VLOOKUP(ply, plystatsAIA, Player, Fk_LostAIA),
         SpoilsAIA = VLOOKUP(ply, plystatsAIA, Player, SpoilsAIA),OBPAIA =VLOOKUP (ply, plystatsAIA, Player, OBPAIA), Pass_LossAIA = VLOOKUP (ply, plystatsAIA, Player,Pass_LossAIA))

statsA [is.na(statsA)] <- 0

## TACKLES ##

## Create Tackle Count - tck def ## 
passATck <- pass %>%filter (Teamnum == "A")

plystatsDef <- passATck %>%group_by(Player)%>% 
  summarize(TckDefA =sum(main == "Tck Def"), SpoilsDefA =sum(main == "Def Act"), Tot_DefA = (TckDefA + SpoilsDefA ))

plystatsDefAID <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckDefAID =sum(main == "Tck Def"), SpoilsDefAID =sum(main == "Def Act"), Tot_DefAID = (TckDefAID + SpoilsDefAID ))

plystatsDefAMD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckDefAMD =sum(main == "Tck Def"), SpoilsDefAMD =sum(main == "Def Act"), Tot_DefAMD = (TckDefAMD + SpoilsDefAMD ))

plystatsDefAOD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckDefAOD =sum(main == "Tck Def"), SpoilsDefAOD =sum(main == "Def Act"), Tot_DefAOD = (TckDefAOD + SpoilsDefAOD ))

plystatsDefAOA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckDefAOA =sum(main == "Tck Def"), SpoilsDefAOA =sum(main == "Def Act"), Tot_DefAOA = (TckDefAOA + SpoilsDefAOA ))

plystatsDefAMA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckDefAMA =sum(main == "Tck Def"), SpoilsDefAMA =sum(main == "Def Act"), Tot_DefAMA = (TckDefAMA + SpoilsDefAMA ))

plystatsDefAIA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckDefAIA =sum(main == "Tck Def"), SpoilsDefAIA =sum(main == "Def Act"), Tot_DefAIA = (TckDefAIA + SpoilsDefAIA ))

statsA <-statsA %>%
  mutate(TckDefA = VLOOKUP(ply, plystatsDef, Player, TckDefA), SpoilsDefA = VLOOKUP(ply, plystatsDef, Player, SpoilsDefA), Tot_DefA = VLOOKUP(ply, plystatsDef, Player, Tot_DefA),
         TckDefAID = VLOOKUP(ply, plystatsDefAID, Player, TckDefAID), SpoilsDefAID = VLOOKUP(ply, plystatsDefAID, Player,SpoilsDefAID), Tot_DefAID = VLOOKUP(ply, plystatsDefAID, Player, Tot_DefAID),
         TckDefAMD = VLOOKUP(ply, plystatsDefAMD, Player, TckDefAMD), SpoilsDefAMD = VLOOKUP(ply, plystatsDefAMD, Player,SpoilsDefAMD), Tot_DefAMD = VLOOKUP(ply, plystatsDefAMD, Player, Tot_DefAMD),
         TckDefAOD = VLOOKUP(ply, plystatsDefAOD, Player, TckDefAOD), SpoilsDefAOD = VLOOKUP(ply, plystatsDefAOD, Player,SpoilsDefAOD), Tot_DefAOD = VLOOKUP(ply, plystatsDefAOD, Player, Tot_DefAOD),
         TckDefAOA = VLOOKUP(ply, plystatsDefAOA, Player, TckDefAOA), SpoilsDefAOA = VLOOKUP(ply, plystatsDefAOA, Player,SpoilsDefAOA), Tot_DefAOA = VLOOKUP(ply, plystatsDefAOA, Player, Tot_DefAOA),
         TckDefAMA = VLOOKUP(ply, plystatsDefAMA, Player, TckDefAMA), SpoilsDefAMA = VLOOKUP(ply, plystatsDefAMA, Player,SpoilsDefAMA), Tot_DefAMA = VLOOKUP(ply, plystatsDefAMA, Player, Tot_DefAMA),
         TckDefAIA = VLOOKUP(ply, plystatsDefAIA, Player, TckDefAIA), SpoilsDefAIA = VLOOKUP(ply, plystatsDefAIA, Player,SpoilsDefAIA), Tot_DefAIA = VLOOKUP(ply, plystatsDefAIA, Player, Tot_DefAIA))


## DP Tackles ##

## Create Tackle Count - tck dp ## 
passATck <- pass %>%filter (Teamnum == "A")

plystatsDpA <- passATck %>%group_by(Player)%>% 
  summarize(TckDpA =sum(subset == "Tck Dp"))

plystatsDpAID <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckDpAID =sum(subset == "Tck Dp"))

plystatsDpAMD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckDpAMD =sum(subset == "Tck Dp"))

plystatsDpAOD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckDpAOD =sum(subset == "Tck Dp"))

plystatsDpAOA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckDpAOA =sum(subset == "Tck Dp"))

plystatsDpAMA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckDpAMA =sum(subset == "Tck Dp"))

plystatsDpAIA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckDpAIA =sum(subset == "Tck Dp"))

statsA <-statsA %>%
  mutate(TckDpA = VLOOKUP(ply, plystatsDpA, Player, TckDpA), 
         TckDpAID = VLOOKUP(ply, plystatsDpAID, Player, TckDpAID),
         TckDpAMD = VLOOKUP(ply, plystatsDpAMD, Player, TckDpAMD), 
         TckDpAOD = VLOOKUP(ply, plystatsDpAOD, Player, TckDpAOD), 
         TckDpAOA = VLOOKUP(ply, plystatsDpAOA, Player, TckDpAOA), 
         TckDpAMA = VLOOKUP(ply, plystatsDpAMA, Player, TckDpAMA), 
         TckDpAIA = VLOOKUP(ply, plystatsDpAIA, Player, TckDpAIA))

statsA <-statsA %>%  
mutate(TckndpA = (TckDefA - TckDpA),
      TckndpAID = (TckDefAID - TckDpAID),
      TckndpAMD = (TckDefAMD - TckDpAMD),
      TckndpAOD = (TckDefAOD - TckDpAOD),
      TckndpAOA = (TckDefAOA - TckDpAOA),
      TckndpAMA = (TckDefAMA - TckDpAMA),
      TckndpAIA = (TckDefAIA - TckDpAIA))
      
  
## Tackled ##     
      
## Create Tackle Count - tck def ## 

passATck <- pass %>%filter (Teamnum == "A")

plystatsAttA <- passATck %>%group_by(Player)%>% 
  summarize(TckAttA =sum(main == "Tck Att"))

plystatsAttAID <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckAttAID =sum(main == "Tck Att"))

plystatsAttAMD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckAttAMD =sum(main == "Tck Att"))

plystatsAttAOD <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckAttAOD =sum(main == "Tck Att"))

plystatsAttAOA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckAttAOA =sum(main == "Tck Att"))

plystatsAttAMA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckAttAMA =sum(main == "Tck Att"))

plystatsAttAIA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckAttAIA =sum(main == "Tck Att"))

statsA <-statsA %>%
  mutate(TckAttA = VLOOKUP(ply, plystatsAttA, Player, TckAttA), 
         TckAttAID = VLOOKUP(ply, plystatsAttAID, Player, TckAttAID),
         TckAttAMD = VLOOKUP(ply, plystatsAttAMD, Player, TckAttAMD), 
         TckAttAOD = VLOOKUP(ply, plystatsAttAOD, Player, TckAttAOD), 
         TckAttAOA = VLOOKUP(ply, plystatsAttAOA, Player, TckAttAOA), 
         TckAttAMA = VLOOKUP(ply, plystatsAttAMA, Player, TckAttAMA), 
         TckAttAIA = VLOOKUP(ply, plystatsAttAIA, Player, TckAttAIA))


## Carries ##

#carries over 10 - Maybe change it to 15 or 20 
# 10 maybe too short to count as a run 

#runAcarr <- runA%>%filter(seg %in% c("0","2"), dist > 9.99)

runA <- run%>%filter(Teamnum=="A",keep=="Y")

carrA <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99)%>%summarize(Carries = sum(segtype == "Carry"))
carrAID <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("In_Def"))%>%summarize(carrAID = sum(segtype == "Carry"))
carrAMD <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Mid_Def"))%>%summarize(carrAMD = sum(segtype == "Carry"))
carrAOD <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Out_Def"))%>%summarize(carrAOD = sum(segtype == "Carry"))
carrAOA <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Out_Att"))%>%summarize(carrAOA = sum(segtype == "Carry"))
carrAMA <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Mid_Att"))%>%summarize(carrAMA = sum(segtype == "Carry"))
carrAIA <- runA %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("In_Att"))%>%summarize(carrAIA = sum(segtype == "Carry"))

statsA <-statsA %>%
  mutate(Carries = VLOOKUP(ply, carrA, Player, Carries),
         CarriesAID = VLOOKUP(ply, carrAID, Player, carrAID),
         CarriesAMD = VLOOKUP(ply, carrAMD, Player, carrAMD),
         CarriesAOD = VLOOKUP(ply, carrAOD, Player, carrAOD),
         CarriesAOA = VLOOKUP(ply, carrAOA, Player, carrAOA),
         CarriesAMA = VLOOKUP(ply, carrAMA, Player, carrAMA),
         CarriesAIA = VLOOKUP(ply, carrAIA, Player, carrAIA))

statsA [is.na(statsA)] <- 0


## Pass Direction ## 

pass_dirA <- run%>%filter(Teamnum=="A",keep=="Y", main %in% c("Pass Op", "Pass Rs"))

move_dirA <- pass_dirA %>%group_by(Player)%>% summarize(For=sum(RunDir == "for"),Back=sum(RunDir == "bw"),SWL=sum(RunDir == "swl"),SWR=sum(RunDir == "swr"))

statsA <-statsA %>%
  mutate(PsFor= VLOOKUP(ply, move_dirA, Player, For),PsBack = VLOOKUP(ply, move_dirA, Player, Back),PsSWL = VLOOKUP(ply, move_dirA, Player, SWL),
         PsSWR = VLOOKUP(ply,move_dirA, Player, SWR))

statsA [is.na(statsA)] <- 0

## Run Direction ## 

runAcar <- run%>%filter(Teamnum=="A",keep=="Y",seg %in% c("0","2"), dist > 19.99)

Run_Dir <- runAcar %>%group_by(Player)%>% summarize(RunFor=sum(RunDir == "for"),RunBack=sum(RunDir == "bw"),RunSWL=sum(RunDir == "swl"),RunSWR=sum(RunDir == "swr"))

statsA <-statsA %>%
  mutate(RunFor= VLOOKUP(ply, Run_Dir, Player, RunFor),RunBack = VLOOKUP(ply,Run_Dir, Player, RunBack),RunSWL = VLOOKUP(ply,Run_Dir, Player, RunSWL),
         RunSWR = VLOOKUP(ply,Run_Dir, Player, RunSWR))

statsA [is.na(statsA)] <- 0

statsA <- statsA%>% mutate_if(is.numeric, round, digits = 2)

plystatsA <-statsA

# plystatsAA  playersts

## All Actions -  Player Stats ## 
  
plyactallA <-   pass %>% group_by(Player) %>% filter (Teamnum == "A") %>% count (Action)


plyactallA <-plyactallA %>% spread(Action,n)


plyactallA  [is.na(plyactallA)] <- 0

plyactallA <- plyactallA%>% mutate_if(is.numeric, round, digits = 2)


plyactallA <- rename(plyactallA, "ply" = Player, "kpall" = Kp, "PWall" = PW)

plystatsA <- dplyr::full_join(plystatsA, plyactallA, by = "ply")


#write.csv2(plystatsA, "plystatsA.csv")


```

```{r, eval = FALSE}

## Team B ##

plystatsBB <- teamsheet%>%filter(Teamnum =="B") %>%select( Teamnum, Team, plytime, ply, name, Player,Areax,Areay)

plystatsBB <- plystatsBB %>% arrange(ply)

# Remove player if they had no actions 
#plystatsBB <- plystatsBB[plystatsBB$ply!="17", ]
#plystatsBB <- plystatsBB[plystatsBB$ply!="13", ]

#plystatsB

passB <- pass %>%filter (Teamnum == "B", Action != "Opp Brk")

playersts <- passB %>%group_by(Player)%>%summarize(PW =sum(main == "PW"),Pass =sum(main == "Pass Op"),Hndps =sum(Action %in% c ( "Hp", "Hp Prs")),Kp = sum (Action %in% c("Kp", "Kp Prs")),Rec =sum(main == "Rec Op"),
KoRec =sum(main == "Ko Rec"), RsRec =sum(main == "Rec Rs") ,OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"),
RsShot =sum(main == "Shot Rs"),RsScr =sum(subset == "Scr Rs"), Poss_Lost =sum(main == "ToL"), Fk_Won =sum(main == "Free Won"),Fk_Lost =sum(main == "Free Loss"),
Spoils =sum(main == "Def Act"),Targ =sum(subset == "Target"), Ko_Targ =sum(subset == "Ko Target"),  
OBP = (PW + Rec + RsRec + KoRec), Pass_Loss = sum(subset == "Pass ToL"), Comp_Pass = (Pass - Pass_Loss), Att_Mk = sum (subset =="Att Mk Won"), 
Ko_Mk = sum (subset =="Ko Mk Won"))


playersts <- rename(playersts, "Players" = Player)

#playersts <- playersts[playersts$Players!="30", ]

statsB <- bind_cols (plystatsBB,playersts)

#plystatsBB 
#playersts

statsB <- statsB %>% select(-Players)

statsB [is.na(statsB)] <- 0

plyP_B <- pass%>%group_by(Player)%>% filter (Teamnum == "B",main %in% c("PW", "Pass Op","Pass Rs","Rec Op", "Rec Rs", "Shot Op", "Tck Def", "Free Won", "Free Loss"))%>%
  summarize(In_Def = sum (Pitch_Area %in% c("In_Def")),Mid_Def = sum (Pitch_Area%in% c("Mid_Def")),Out_Def = sum (Pitch_Area %in% c("Out_Def")),
            Out_Att = sum (Pitch_Area %in% c("Out_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),Mid_Att = sum (Pitch_Area %in% c("Mid_Att")),In_Att = sum (Pitch_Area %in% c("In_Att"))) 

plyP_B <- rename(plyP_B, "PlayersB" = Player)

statsB <- bind_cols (statsB,plyP_B)

statsB <- statsB %>% select(-PlayersB)

statsB [is.na(statsB)] <- 0


statsB <- statsB %>% mutate(to_ratio = (Poss_Lost/OBP), pass_eff = ((Pass-Pass_Loss)/Pass*100), att_balls = (OpScr + Comp_Pass),
                            eff_ind = ((PW + att_balls)/(10 + Poss_Lost)), Perf_Score = ((eff_ind*10)+(OBP/2)))

statsB <- statsB %>%  mutate(totPW = sum(PW), PWp = (PW/totPW*100), totPass = sum(Pass), Passp = (Pass/totPass*100), totRec = sum(Rec), Recp = (Rec/totRec*100),  totKoRec = sum(KoRec), KoRecp = (KoRec/totKoRec*100), 
                             totOpShot = sum(OpShot), OpShotp = (OpShot/totOpShot*100), totOpScr = sum(OpScr), OpScrp = (OpScr/totOpScr*100),
                             totRsShot = sum(RsShot), RsShotp = (RsShot/totRsShot*100), totRsScr = sum(RsScr), RsScrp = (RsScr/totRsScr*100),
                             totPoss_Lost = sum(Poss_Lost), Poss_Lostp = (Poss_Lost/totPoss_Lost*100), 
                             totFk_Won = sum(Fk_Won), Fk_Wonp = (Fk_Won/totFk_Won*100), totFk_Lost = sum(Fk_Lost), Fk_Lostp = (Fk_Lost/totFk_Lost*100), totSpoils = sum(Spoils), Spoilsp = (Spoils/totSpoils*100),
                             totOBP = sum(OBP), OBPp = (OBP/totOBP*100), totCP = sum(Comp_Pass), CPp = (Comp_Pass/totCP*100))

statsB <- statsB %>% mutate(PWamin = (PW/plytime),Passamin = (Pass/plytime), Recamin = (Rec/plytime), KoRecamin = (KoRec/plytime), 
                            OpShotamin = (OpShot/plytime),OpScramin = (OpScr/plytime),
                            RsShotamin = (RsShot/plytime),RsScramin = (RsScr/plytime),
                            Poss_Lostamin = (Poss_Lost/plytime), 
                            Fk_Wonamin = (Fk_Won/plytime),Fk_Losttamin = (Fk_Lost/plytime),Spoilsamin = (Spoils/plytime))

## Pitch Area Counts ##

## Comp Pass wont work for P_A because pass may not have been made in the same P_A

passB <- pass %>%filter(Teamnum=="B")

plystatsBID <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def")) %>%summarize(PWBID =sum(main == "PW"),PassBID =sum(main == "Pass Op"),RecBID =sum(main == "Rec Op"),
                                                                                             KoRecBID =sum(main == "Ko Rec"), RsRecBID =sum(main == "Rec Rs") ,OpShotBID =sum(main == "Shot Op"),OpScrBID =sum(subset == "Scr Op"),
                                                                                             RsShotBID =sum(main == "Shot Rs"),RsScrBID =sum(subset == "Scr Rs"), Poss_LostBID =sum(main == "ToL"), Fk_WonBID =sum(main == "Free Won"),Fk_LostBID =sum(main == "Free Loss"),
                                                                                             SpoilsBID =sum(main == "Def Act"), OBPBID = (PWBID + RecBID + RsRecBID + KoRecBID), Pass_LossBID = sum(subset == "Pass ToL"), Comp_PassBID = (PassBID - Pass_LossBID))

plystatsBMD <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def")) %>%summarize(PWBMD =sum(main == "PW"),PassBMD =sum(main == "Pass Op"),RecBMD =sum(main == "Rec Op"),
                                                                                              KoRecBMD =sum(main == "Ko Rec"), RsRecBMD =sum(main == "Rec Rs") ,OpShotBMD =sum(main == "Shot Op"),OpScrBMD =sum(subset == "Scr Op"),
                                                                                              RsShotBMD =sum(main == "Shot Rs"),RsScrBMD =sum(subset == "Scr Rs"), Poss_LostBMD =sum(main == "ToL"), Fk_WonBMD =sum(main == "Free Won"),Fk_LostBMD =sum(main == "Free Loss"),
                                                                                              SpoilsBMD =sum(main == "Def Act"), OBPBMD = (PWBMD + RecBMD + RsRecBMD + KoRecBMD), Pass_LossBMD = sum(subset == "Pass ToL"), Comp_PassBMD = (PassBMD - Pass_LossBMD))

plystatsBOD <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def")) %>%summarize(PWBOD =sum(main == "PW"),PassBOD =sum(main == "Pass Op"),RecBOD =sum(main == "Rec Op"),
                                                                                              KoRecBOD =sum(main == "Ko Rec"), RsRecBOD =sum(main == "Rec Rs") ,OpShotBOD =sum(main == "Shot Op"),OpScrBOD =sum(subset == "Scr Op"),
                                                                                              RsShotBOD =sum(main == "Shot Rs"),RsScrBOD =sum(subset == "Scr Rs"), Poss_LostBOD =sum(main == "ToL"), Fk_WonBOD =sum(main == "Free Won"),Fk_LostBOD =sum(main == "Free Loss"),
                                                                                              SpoilsBOD =sum(main == "Def Act"), OBPBOD = (PWBOD + RecBOD + RsRecBOD + KoRecBOD), Pass_LossBOD = sum(subset == "Pass ToL"), Comp_PassBOD = (PassBOD - Pass_LossBOD))

plystatsBOA <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att")) %>%summarize(PWBOA =sum(main == "PW"),PassBOA =sum(main == "Pass Op"),RecBOA =sum(main == "Rec Op"),
                                                                                              KoRecBOA =sum(main == "Ko Rec"), RsRecBOA =sum(main == "Rec Rs") ,OpShotBOA =sum(main == "Shot Op"),OpScrBOA =sum(subset == "Scr Op"),
                                                                                              RsShotBOA =sum(main == "Shot Rs"),RsScrBOA =sum(subset == "Scr Rs"), Poss_LostBOA =sum(main == "ToL"), Fk_WonBOA =sum(main == "Free Won"),Fk_LostBOA =sum(main == "Free Loss"),
                                                                                              SpoilsBOA =sum(main == "Def Act"), OBPBOA = (PWBOA + RecBOA + RsRecBOA + KoRecBOA), Pass_LossBOA = sum(subset == "Pass ToL"), Comp_PassBOA = (PassBOA - Pass_LossBOA))

plystatsBMA <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att")) %>%summarize(PWBMA =sum(main == "PW"),PassBMA =sum(main == "Pass Op"),RecBMA =sum(main == "Rec Op"),
                                                                                              KoRecBMA =sum(main == "Ko Rec"), RsRecBMA =sum(main == "Rec Rs") ,OpShotBMA =sum(main == "Shot Op"),OpScrBMA =sum(subset == "Scr Op"),
                                                                                              RsShotBMA =sum(main == "Shot Rs"),RsScrBMA =sum(subset == "Scr Rs"), Poss_LostBMA =sum(main == "ToL"), Fk_WonBMA =sum(main == "Free Won"),Fk_LostBMA =sum(main == "Free Loss"),
                                                                                              SpoilsBMA =sum(main == "Def Act"), OBPBMA = (PWBMA + RecBMA + RsRecBMA + KoRecBMA), Pass_LossBMA = sum(subset == "Pass ToL"), Comp_PassBMA = (PassBMA - Pass_LossBMA))

plystatsBIA <- passB %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att")) %>%summarize(PWBIA =sum(main == "PW"),PassBIA =sum(main == "Pass Op"),RecBIA =sum(main == "Rec Op"),
                                                                                              KoRecBIA =sum(main == "Ko Rec"), RsRecBIA =sum(main == "Rec Rs") ,OpShotBIA =sum(main == "Shot Op"),OpScrBIA =sum(subset == "Scr Op"),
                                                                                              RsShotBIA =sum(main == "Shot Rs"),RsScrBIA =sum(subset == "Scr Rs"), Poss_LostBIA =sum(main == "ToL"), Fk_WonBIA =sum(main == "Free Won"),Fk_LostBIA =sum(main == "Free Loss"),
                                                                                              SpoilsBIA =sum(main == "Def Act"), OBPBIA = (PWBIA + RecBIA + RsRecBIA + KoRecBIA), Pass_LossBIA = sum(subset == "Pass ToL"), Comp_PassBIA = (PassBIA - Pass_LossBIA))

#Adding Pitch_Area Counts to Base Stats A - VLOOKUPS 

statsB <-statsB %>%
  mutate(PWBID = VLOOKUP(ply, plystatsBID, Player, PWBID),PassBID = VLOOKUP(ply, plystatsBID, Player, PassBID),RecBID = VLOOKUP(ply, plystatsBID, Player, RecBID),
         KoRecBID = VLOOKUP(ply, plystatsBID, Player, KoRecBID),RsRecBID = VLOOKUP(ply, plystatsBID, Player, RsRecBID),OpShotBID = VLOOKUP(ply, plystatsBID, Player, OpShotBID),
         OpScrBID = VLOOKUP(ply, plystatsBID, Player, OpScrBID),RsShotBID = VLOOKUP(ply, plystatsBID, Player, RsShotBID),RsScrBID = VLOOKUP(ply, plystatsBID, Player,RsScrBID),
         Poss_LostBID = VLOOKUP(ply, plystatsBID, Player, Poss_LostBID),Fk_WonBID = VLOOKUP(ply, plystatsBID, Player,Fk_WonBID),Fk_LostBID= VLOOKUP(ply, plystatsBID, Player, Fk_LostBID),
         SpoilsBID = VLOOKUP(ply, plystatsBID, Player, SpoilsBID),OBPBID =VLOOKUP (ply, plystatsBID, Player, OBPBID), Pass_LossBID = VLOOKUP (ply, plystatsBID, Player,Pass_LossBID))

statsB <-statsB %>%
  mutate(PWBMD = VLOOKUP(ply, plystatsBMD, Player, PWBMD),PassBMD = VLOOKUP(ply, plystatsBMD, Player, PassBMD),RecBMD = VLOOKUP(ply, plystatsBMD, Player, RecBMD),
         KoRecBMD = VLOOKUP(ply, plystatsBMD, Player, KoRecBMD),RsRecBMD = VLOOKUP(ply, plystatsBMD, Player, RsRecBMD),OpShotBMD = VLOOKUP(ply, plystatsBMD, Player, OpShotBMD),
         OpScrBMD = VLOOKUP(ply, plystatsBMD, Player, OpScrBMD),RsShotBMD = VLOOKUP(ply, plystatsBMD, Player, RsShotBMD),RsScrBMD = VLOOKUP(ply, plystatsBMD, Player,RsScrBMD),
         Poss_LostBMD = VLOOKUP(ply, plystatsBMD, Player, Poss_LostBMD),Fk_WonBMD = VLOOKUP(ply, plystatsBMD, Player,Fk_WonBMD),Fk_LostBMD= VLOOKUP(ply, plystatsBMD, Player, Fk_LostBMD),
         SpoilsBMD = VLOOKUP(ply, plystatsBMD, Player, SpoilsBMD),OBPBMD =VLOOKUP (ply, plystatsBMD, Player, OBPBMD), Pass_LossBMD = VLOOKUP (ply, plystatsBMD, Player,Pass_LossBMD))

statsB <-statsB %>%
  mutate(PWBOD = VLOOKUP(ply, plystatsBOD, Player, PWBOD),PassBOD = VLOOKUP(ply, plystatsBOD, Player, PassBOD),RecBOD = VLOOKUP(ply, plystatsBOD, Player, RecBOD),
         KoRecBOD = VLOOKUP(ply, plystatsBOD, Player, KoRecBOD),RsRecBOD = VLOOKUP(ply, plystatsBOD, Player, RsRecBOD),OpShotBOD = VLOOKUP(ply, plystatsBOD, Player, OpShotBOD),
         OpScrBOD = VLOOKUP(ply, plystatsBOD, Player, OpScrBOD),RsShotBOD = VLOOKUP(ply, plystatsBOD, Player, RsShotBOD),RsScrBOD = VLOOKUP(ply, plystatsBOD, Player,RsScrBOD),
         Poss_LostBOD = VLOOKUP(ply, plystatsBOD, Player, Poss_LostBOD),Fk_WonBOD = VLOOKUP(ply, plystatsBOD, Player,Fk_WonBOD),Fk_LostBOD= VLOOKUP(ply, plystatsBOD, Player, Fk_LostBOD),
         SpoilsBOD = VLOOKUP(ply, plystatsBOD, Player, SpoilsBOD),OBPBOD =VLOOKUP (ply, plystatsBOD, Player, OBPBOD), Pass_LossBOD = VLOOKUP (ply, plystatsBOD, Player,Pass_LossBOD))

statsB <-statsB %>%
  mutate(PWBOA = VLOOKUP(ply, plystatsBOA, Player, PWBOA),PassBOA = VLOOKUP(ply, plystatsBOA, Player, PassBOA),RecBOA = VLOOKUP(ply, plystatsBOA, Player, RecBOA),
         KoRecBOA = VLOOKUP(ply, plystatsBOA, Player, KoRecBOA),RsRecBOA = VLOOKUP(ply, plystatsBOA, Player, RsRecBOA),OpShotBOA = VLOOKUP(ply, plystatsBOA, Player, OpShotBOA),
         OpScrBOA = VLOOKUP(ply, plystatsBOA, Player, OpScrBOA),RsShotBOA = VLOOKUP(ply, plystatsBOA, Player, RsShotBOA),RsScrBOA = VLOOKUP(ply, plystatsBOA, Player,RsScrBOA),
         Poss_LostBOA = VLOOKUP(ply, plystatsBOA, Player, Poss_LostBOA),Fk_WonBOA = VLOOKUP(ply, plystatsBOA, Player,Fk_WonBOA),Fk_LostBOA= VLOOKUP(ply, plystatsBOA, Player, Fk_LostBOA),
         SpoilsBOA = VLOOKUP(ply, plystatsBOA, Player, SpoilsBOA),OBPBOA =VLOOKUP (ply, plystatsBOA, Player, OBPBOA), Pass_LossBOA = VLOOKUP (ply, plystatsBOA, Player,Pass_LossBOA))

statsB <-statsB %>%
  mutate(PWBMA = VLOOKUP(ply, plystatsBMA, Player, PWBMA),PassBMA = VLOOKUP(ply, plystatsBMA, Player, PassBMA),RecBMA = VLOOKUP(ply, plystatsBMA, Player, RecBMA),
         KoRecBMA = VLOOKUP(ply, plystatsBMA, Player, KoRecBMA),RsRecBMA = VLOOKUP(ply, plystatsBMA, Player, RsRecBMA),OpShotBMA = VLOOKUP(ply, plystatsBMA, Player, OpShotBMA),
         OpScrBMA = VLOOKUP(ply, plystatsBMA, Player, OpScrBMA),RsShotBMA = VLOOKUP(ply, plystatsBMA, Player, RsShotBMA),RsScrBMA = VLOOKUP(ply, plystatsBMA, Player,RsScrBMA),
         Poss_LostBMA = VLOOKUP(ply, plystatsBMA, Player, Poss_LostBMA),Fk_WonBMA = VLOOKUP(ply, plystatsBMA, Player,Fk_WonBMA),Fk_LostBMA= VLOOKUP(ply, plystatsBMA, Player, Fk_LostBMA),
         SpoilsBMA = VLOOKUP(ply, plystatsBMA, Player, SpoilsBMA),OBPBMA =VLOOKUP (ply, plystatsBMA, Player, OBPBMA), Pass_LossBMA = VLOOKUP (ply, plystatsBMA, Player,Pass_LossBMA))

statsB <-statsB %>%
  mutate(PWBIA = VLOOKUP(ply, plystatsBIA, Player, PWBIA),PassBIA = VLOOKUP(ply, plystatsBIA, Player, PassBIA),RecBIA = VLOOKUP(ply, plystatsBIA, Player, RecBIA),
         KoRecBIA = VLOOKUP(ply, plystatsBIA, Player, KoRecBIA),RsRecBIA = VLOOKUP(ply, plystatsBIA, Player, RsRecBIA),OpShotBIA = VLOOKUP(ply, plystatsBIA, Player, OpShotBIA),
         OpScrBIA = VLOOKUP(ply, plystatsBIA, Player, OpScrBIA),RsShotBIA = VLOOKUP(ply, plystatsBIA, Player, RsShotBIA),RsScrBIA = VLOOKUP(ply, plystatsBIA, Player,RsScrBIA),
         Poss_LostBIA = VLOOKUP(ply, plystatsBIA, Player, Poss_LostBIA),Fk_WonBIA = VLOOKUP(ply, plystatsBIA, Player,Fk_WonBIA),Fk_LostBIA= VLOOKUP(ply, plystatsBIA, Player, Fk_LostBIA),
         SpoilsBIA = VLOOKUP(ply, plystatsBIA, Player, SpoilsBIA),OBPBIA =VLOOKUP (ply, plystatsBIA, Player, OBPBIA), Pass_LossBIA = VLOOKUP (ply, plystatsBIA, Player,Pass_LossBIA))

statsB [is.na(statsB)] <- 0

## TACKLES ##

## Create Tackle Count - tck def ## 
passBTck <- pass %>%filter (Teamnum == "B")

plystatsDef <- passBTck %>%group_by(Player)%>% 
  summarize(TckDefB =sum(main == "Tck Def"), SpoilsDefB =sum(main == "Def Act"), Tot_DefB = (TckDefB + SpoilsDefB))

plystatsDefBID <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckDefBID =sum(main == "Tck Def"), SpoilsDefBID =sum(main == "Def Act"), Tot_DefBID = (TckDefBID + SpoilsDefBID ))

plystatsDefBMD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckDefBMD =sum(main == "Tck Def"), SpoilsDefBMD =sum(main == "Def Act"), Tot_DefBMD = (TckDefBMD + SpoilsDefBMD ))

plystatsDefBOD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckDefBOD =sum(main == "Tck Def"), SpoilsDefBOD =sum(main == "Def Act"), Tot_DefBOD = (TckDefBOD + SpoilsDefBOD ))

plystatsDefBOA <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckDefBOA =sum(main == "Tck Def"), SpoilsDefBOA =sum(main == "Def Act"), Tot_DefBOA = (TckDefBOA + SpoilsDefBOA ))

plystatsDefBMA <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckDefBMA =sum(main == "Tck Def"), SpoilsDefBMA =sum(main == "Def Act"), Tot_DefBMA = (TckDefBMA + SpoilsDefBMA ))

plystatsDefBIA <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckDefBIA =sum(main == "Tck Def"), SpoilsDefBIA =sum(main == "Def Act"), Tot_DefBIA = (TckDefBIA + SpoilsDefBIA ))

statsB <-statsB %>%
  mutate(TckDefB = VLOOKUP(ply, plystatsDef, Player, TckDefB), SpoilsDefB = VLOOKUP(ply, plystatsDef, Player, SpoilsDefB), Tot_DefB = VLOOKUP(ply, plystatsDef, Player, Tot_DefB),
         TckDefBID = VLOOKUP(ply, plystatsDefBID, Player, TckDefBID), SpoilsDefBID = VLOOKUP(ply, plystatsDefBID, Player,SpoilsDefBID), Tot_DefBID = VLOOKUP(ply, plystatsDefBID, Player, Tot_DefBID),
         TckDefBMD = VLOOKUP(ply, plystatsDefBMD, Player, TckDefBMD), SpoilsDefBMD = VLOOKUP(ply, plystatsDefBMD, Player,SpoilsDefBMD), Tot_DefBMD = VLOOKUP(ply, plystatsDefBMD, Player, Tot_DefBMD),
         TckDefBOD = VLOOKUP(ply, plystatsDefBOD, Player, TckDefBOD), SpoilsDefBOD = VLOOKUP(ply, plystatsDefBOD, Player,SpoilsDefBOD), Tot_DefBOD = VLOOKUP(ply, plystatsDefBOD, Player, Tot_DefBOD),
         TckDefBOA = VLOOKUP(ply, plystatsDefBOA, Player, TckDefBOA), SpoilsDefBOA = VLOOKUP(ply, plystatsDefBOA, Player,SpoilsDefBOA), Tot_DefBOA = VLOOKUP(ply, plystatsDefBOA, Player, Tot_DefBOA),
         TckDefBMA = VLOOKUP(ply, plystatsDefBMA, Player, TckDefBMA), SpoilsDefBMA = VLOOKUP(ply, plystatsDefBMA, Player,SpoilsDefBMA), Tot_DefBMA = VLOOKUP(ply, plystatsDefBMA, Player, Tot_DefBMA),
         TckDefBIA = VLOOKUP(ply, plystatsDefBIA, Player, TckDefBIA), SpoilsDefBIA = VLOOKUP(ply, plystatsDefBIA, Player,SpoilsDefBIA), Tot_DefBIA = VLOOKUP(ply, plystatsDefBIA, Player, Tot_DefBIA))

## DP Tackles ##

## Create Tackle Count - tck def ## 
passBTck <- pass %>%filter (Teamnum == "B")

plystatsDpB <- passBTck %>%group_by(Player)%>% 
  summarize(TckDpB =sum(subset == "Tck Dp"))

plystatsDpBID <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckDpBID =sum(subset == "Tck Dp"))

plystatsDpBMD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckDpBMD =sum(subset == "Tck Dp"))

plystatsDpBOD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckDpBOD =sum(subset == "Tck Dp"))

plystatsDpBOA <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckDpBOA =sum(subset == "Tck Dp"))

plystatsDpBMA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckDpBMA =sum(subset == "Tck Dp"))

plystatsDpBIA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckDpBIA =sum(subset == "Tck Dp"))

statsB <-statsB %>%
  mutate(TckDpB = VLOOKUP(ply, plystatsDpB, Player, TckDpB), 
         TckDpBID = VLOOKUP(ply, plystatsDpBID, Player, TckDpBID),
         TckDpBMD = VLOOKUP(ply, plystatsDpBMD, Player, TckDpBMD), 
         TckDpBOD = VLOOKUP(ply, plystatsDpBOD, Player, TckDpBOD), 
         TckDpBOA = VLOOKUP(ply, plystatsDpBOA, Player, TckDpBOA), 
         TckDpBMA = VLOOKUP(ply, plystatsDpBMA, Player, TckDpBMA), 
         TckDpBIA = VLOOKUP(ply, plystatsDpBIA, Player, TckDpBIA))


statsB <-statsB %>%  
  mutate(TckndpB = (TckDefB - TckDpB),
         TckndpBID = (TckDefBID - TckDpBID),
         TckndpBMD = (TckDefBMD - TckDpBMD),
         TckndpBOD = (TckDefBOD - TckDpBOD),
         TckndpBOA = (TckDefBOA - TckDpBOA),
         TckndpBMA = (TckDefBMA - TckDpBMA),
         TckndpBIA = (TckDefBIA - TckDpBIA))
         
         
## Tackled ##

## Create Tackle Count - tck def ## 
passBTck <- pass %>%filter (Teamnum == "B")

plystatsAttB <- passBTck %>%group_by(Player)%>% 
  summarize(TckAttB =sum(main == "Tck Att"))

plystatsAttBID <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Def"))%>% 
  summarize(TckAttBID =sum(main == "Tck Att"))

plystatsAttBMD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Def"))%>% 
  summarize(TckAttBMD =sum(main == "Tck Att"))

plystatsAttBOD <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Def"))%>% 
  summarize(TckAttBOD =sum(main == "Tck Att"))

plystatsAttBOA <- passBTck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Out_Att"))%>% 
  summarize(TckAttBOA =sum(main == "Tck Att"))

plystatsAttBMA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("Mid_Att"))%>% 
  summarize(TckAttBMA =sum(main == "Tck Att"))

plystatsAttBIA <- passATck %>%group_by(Player)%>%filter (Pitch_Area %in% c("In_Att"))%>% 
  summarize(TckAttBIA =sum(main == "Tck Att"))

statsB <-statsB %>%
  mutate(TckAttB = VLOOKUP(ply, plystatsAttB, Player, TckAttB), 
         TckAttBID = VLOOKUP(ply, plystatsAttBID, Player, TckAttBID),
         TckAttBMD = VLOOKUP(ply, plystatsAttBMD, Player, TckAttBMD), 
         TckAttBOD = VLOOKUP(ply, plystatsAttBOD, Player, TckAttBOD), 
         TckAttBOA = VLOOKUP(ply, plystatsAttBOA, Player, TckAttBOA), 
         TckAttBMA = VLOOKUP(ply, plystatsAttBMA, Player, TckAttBMA), 
         TckAttBIA = VLOOKUP(ply, plystatsAttBIA, Player, TckAttBIA))



## Carries ##

#carries over 10 - Maybe change it to 15 or 20 
# 10 maybe too short to count as a run 

#runAcarr <- runA%>%filter(seg %in% c("0","2"), dist > 9.99)

runB <- run%>%filter(Teamnum=="B",keep=="Y")

carrB <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99)%>%summarize(Carries = sum(segtype == "Carry"))
carrBID <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("In_Def"))%>%summarize(carrBID = sum(segtype == "Carry"))
carrBMD <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Mid_Def"))%>%summarize(carrBMD = sum(segtype == "Carry"))
carrBOD <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Out_Def"))%>%summarize(carrBOD = sum(segtype == "Carry"))
carrBOA <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Out_Att"))%>%summarize(carrBOA = sum(segtype == "Carry"))
carrBMA <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("Mid_Att"))%>%summarize(carrBMA = sum(segtype == "Carry"))
carrBIA <- runB %>%group_by(Player)%>%filter (seg %in% c("0","2"), dist > 19.99,Pitch_Area %in% c("In_Att"))%>%summarize(carrBIA = sum(segtype == "Carry"))

statsB <-statsB %>%
  mutate(Carries = VLOOKUP(ply, carrB, Player, Carries),
         CarriesBID = VLOOKUP(ply, carrBID, Player, carrBID),
         CarriesBMD = VLOOKUP(ply, carrBMD, Player, carrBMD),
         CarriesBOD = VLOOKUP(ply, carrBOD, Player, carrBOD),
         CarriesBOA = VLOOKUP(ply, carrBOA, Player, carrBOA),
         CarriesBMA = VLOOKUP(ply, carrBMA, Player, carrBMA),
         CarriesBIA = VLOOKUP(ply, carrBIA, Player, carrBIA))

statsB [is.na(statsB)] <- 0


## Pass Direction ## 

pass_dirB <- run%>%filter(Teamnum=="B",keep=="Y", main %in% c("Pass Op", "Pass Rs"))

move_dirB <- pass_dirB %>%group_by(Player)%>% summarize(For=sum(RunDir == "for"),Back=sum(RunDir == "bw"),SWL=sum(RunDir == "swl"),SWR=sum(RunDir == "swr"))

statsB <-statsB %>%
  mutate(PsFor= VLOOKUP(ply, move_dirB, Player, For),PsBack = VLOOKUP(ply, move_dirB, Player, Back),PsSWL = VLOOKUP(ply, move_dirB, Player, SWL),
         PsSWR = VLOOKUP(ply,move_dirB, Player, SWR))

statsB [is.na(statsB)] <- 0

## Run Direction ## 

runBcar <- run%>%filter(Teamnum=="B",keep=="Y",seg %in% c("0","2"), dist > 19.99)

Run_Dir <- runBcar %>%group_by(Player)%>% summarize(RunFor=sum(RunDir == "for"),RunBack=sum(RunDir == "bw"),RunSWL=sum(RunDir == "swl"),RunSWR=sum(RunDir == "swr"))

statsB <-statsB %>%
  mutate(RunFor= VLOOKUP(ply, Run_Dir, Player, RunFor),RunBack = VLOOKUP(ply,Run_Dir, Player, RunBack),RunSWL = VLOOKUP(ply,Run_Dir, Player, RunSWL),
         RunSWR = VLOOKUP(ply,Run_Dir, Player, RunSWR))

statsB [is.na(statsB)] <- 0

statsB <- statsB%>% mutate_if(is.numeric, round, digits = 2)

plystatsB <-statsB

## All Actions -  Player Stats ## 
  
plyactallB <-   pass %>% group_by(Player) %>% filter (Teamnum == "B") %>% count (Action)


plyactallB <-plyactallB %>% spread(Action,n)


plyactallB  [is.na(plyactallB)] <- 0

plyactallB <- plyactallB%>% mutate_if(is.numeric, round, digits = 2)


plyactallB <- rename(plyactallB, "ply" = Player, "kpall" = Kp, "PWall" = PW)

plystatsB <- dplyr::full_join(plystatsB, plyactallB, by = "ply")

# plystatsBB playersts

#write.csv2(plystatsB, "plystatsB.csv")



```

```{r}

#### KICK OUTS ####

#may need to add or delete "Half Time" or "Full Time"

koonlyA <- pass %>%group_by(Team) %>% filter(subset == "Ko"|main == "Ko Rec"| subset == "Ko ToL")%>%select(period, Teamnum,Phase,Team,Player,plylab,"plynum",Action,subset,Zonethy,main)

oddps <- koonlyA[seq(1, nrow(koonlyA), 2),]
colnames(oddps) <- c("period","Teamnum","Phase","Team","Player","plylab","plynum","Action","subset","Zonethy","main")
evenps <- koonlyA[seq(2, nrow(koonlyA), 2),]
colnames(evenps) <- c("periodoc","Teamnumoc","Phaseoc","Teamoc","Playeroc","plylaboc","plynumoc","Actionoc","subsetoc","Zoneocthy","mainoc")
koonlyA <- bind_cols(oddps, evenps) 
koonlyA <- koonlyA%>%select("period","Teamnum","Phase","Team","Player","plylab","plynum","subset","Action","Zonethy","main","plylaboc","plynumoc","Actionoc","subsetoc","Zoneocthy","mainoc")

#koonlyA$Zoneoc <- as.character(koonlyA$Zoneoc)

koonlyA$Zoneocthy <- as.numeric(koonlyA$Zoneocthy)

koeff <-koonlyA %>%
    mutate(tx = VLOOKUP(Zoneocthy, zonetextthy, zone, tx),ty = VLOOKUP(Zoneocthy, zonetextthy, zone, ty),bx = VLOOKUP(Zoneocthy, zonetextthy, zone, bx),by = VLOOKUP(Zoneocthy, zonetextthy, zone, by))


#write.csv2(oddps, "oddpsko.csv")
#write.csv2(evenps, "evenpsko.csv")
#view(koeff)


```


```{r}

## 60 Pitch ## 

# add lines for inside 14 # 

create_GAA_Pitch <- function(grass_colour, line_colour, background_colour, goala_colour,goalb_colour,label_colour,tram_colour, BasicFeatures){
  
  theme_blankPitch = function(size=12) { 
    theme(
      #axis.line=element_blank(), 
      axis.text.x=element_blank(), 
      axis.text.y=element_blank(), 
      #axis.ticks.y=element_text(size=size),
      #axis.ticks=element_blank(),
      axis.ticks.length=unit(0, "lines"), 
      #axis.ticks.margin=unit(0, "lines"), 
      axis.title.x=element_blank(), 
      axis.title.y=element_blank(), 
      legend.key.size=unit(1.2, "lines"), 
      legend.text=element_text(size=size), 
      legend.title=element_text(size=size, face="bold",hjust=0),
      # panel.border=element_blank(), 
      panel.grid.major=element_blank(), 
      panel.grid.minor=element_blank(), 
      panel.spacing=element_blank(), 
      plot.margin=unit(c(0, 0, 0, 0), "lines"), 
      plot.title=element_text(size=size*1.2), 
      panel.background=element_rect(fill= background_colour,colour= background_colour),
      strip.text.x=element_text(size=size*1))}

  ymin <- 0 # minimum width
  ymax <- 88 # maximum width
  xmin <- 0 # minimum length
  xmax <- 144 # maximum length
  
  # pitch lines
  def13 <- 13
  def20 <- 20
  def45 <- 45
  def65 <- 65
  off65 <- 79
  off45 <- 99
  off20 <- 124
  off13 <- 131
  
  
  # small sqaure
  
 #HERE
  sixYardrd <- 37
  sixYardld <- 51
  
  sixYardDefxst <- 4.5
  sixYardOffxst <- 139.5

  #13 box
 #HERE  
  right14d <- 34.5
  left14d <- 53.5

  #Goals
  glxst <- 0
  glyst <- 40.75
  glxed <- 143.9
  glyed <- 47.25

  #halfway line
  hwxst <- 72
  hwyst <- 40.75
  hwyed <- 47.25

  #pen spot

  pdxst <- 11
  pdyst <- 43.5
  pdyed <- 44.5
  poxst <- 133
  
 #tramlines - hor
  srwing <- 13
  rhalfsp <- 31
  ctre <- 57
  lhalfsp <- 75
  
#tramlines - vert

zero <- 10
one <- 33
two <- 55
hw <- 72
four <- 89
five <- 111
six <- 134  
  
  
      
  circleFundef <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] + diameter / 2 * cos(tt), 
               y = center[2] + diameter / 2 * sin(tt))
  }
  
  circleFunatt <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] - diameter / 2 * cos(tt), 
               y = center[2] - diameter / 2 * sin(tt))
  }
  #### create semi circle ####
  def_circle <-  circleFundef(c(20,44), 26, start=1.5, end=2.5)
  att_circle <-  circleFunatt(c(124,44), 26, start=1.5, end=2.5)
  
  if(BasicFeatures == TRUE){
    ## initiate the plot, set some boundries to the plot
    psxt <- ggplot() + 
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
      geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5) +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax))
    
  }
  
  else{
    ## initiate the plot, set some boundries to the plot
     psxt <- ggplot()  +
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
            geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_segment(aes(x = xmin, y = srwing, xend = xmax, yend = srwing),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = rhalfsp, xend = xmax, yend = rhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = ctre, xend = xmax, yend = ctre),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = lhalfsp, xend = xmax, yend = lhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hwxst, y =  ymin, xend = hwxst, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = zero, y = ymin, xend = zero, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = one, y = ymin, xend = one, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = two, y = ymin, xend = two, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hw, y = ymin, xend = hw, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = four, y = ymin, xend = four, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = five, y = ymin, xend = five, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = six, y = ymin, xend = six, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5)  +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax))

  }
  
  return(psxt)}


psxt <- create_GAA_Pitch("gray72", "white", "white", "blue","red","white","blue", BasicFeatures=FALSE)



### Pitch 30 ###

### Pitch 30 zones  ###

create_GAA_Pitch <- function(grass_colour, line_colour, background_colour, goala_colour,goalb_colour,label_colour,tram_colour, BasicFeatures){
  
  theme_blankPitch = function(size=12) { 
    theme(
      #axis.line=element_blank(), 
      axis.text.x=element_blank(), 
      axis.text.y=element_blank(), 
      #axis.ticks.y=element_text(size=size),
      #axis.ticks=element_blank(),
      axis.ticks.length=unit(0, "lines"), 
      #axis.ticks.margin=unit(0, "lines"), 
      axis.title.x=element_blank(), 
      axis.title.y=element_blank(), 
      legend.key.size=unit(1.2, "lines"), 
      legend.text=element_text(size=size), 
      legend.title=element_text(size=size, face="bold",hjust=0),
      # panel.border=element_blank(), 
      panel.grid.major=element_blank(), 
      panel.grid.minor=element_blank(), 
      #panel.spacing=element_blank(), 
      plot.margin=unit(c(0, 0, 0, 0), "lines"), 
      plot.title=element_text(size=size*1.2), 
      panel.background=element_rect(fill= background_colour,colour= background_colour),
      strip.text.x=element_text(size=size*1))}

  ymin <- 0 # minimum width
  ymax <- 88 # maximum width
  xmin <- 0 # minimum length
  xmax <- 144 # maximum length
  
  # pitch lines
  def13 <- 13
  def20 <- 20
  def45 <- 45
  def65 <- 65
  off65 <- 79
  off45 <- 99
  off20 <- 124
  off13 <- 131
  
  
  # small sqaure
  
 #HERE
  sixYardrd <- 37
  sixYardld <- 51
  
  sixYardDefxst <- 4.5
  sixYardOffxst <- 139.5

  #13 box
 #HERE  
  right14d <- 34.5
  left14d <- 53.5

  #Goals
  glxst <- 0
  glyst <- 40.75
  glxed <- 143.9
  glyed <- 47.25

  #halfway line
  hwxst <- 72
  hwyst <- 40.75
  hwyed <- 47.25

  #pen spot

  pdxst <- 11
  pdyst <- 43.5
  pdyed <- 44.5
  poxst <- 133
  
 #tramlines - hor
  srwing <- 13
  rhalfsp <- 31
  ctre <- 57
  lhalfsp <- 75
  
 #tramlines - vert

zero <- 10
one <- 33
two <- 55
hw <- 72
four <- 89
five <- 111
six <- 134  
  
      
  circleFundef <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] + diameter / 2 * cos(tt), 
               y = center[2] + diameter / 2 * sin(tt))
  }
  
  circleFunatt <- function(center=c(0,0), diameter=1, npoints=100, start=0, end=2)
  {
    tt <- seq(start*pi, end*pi, length.out=npoints)
    data.frame(x = center[1] - diameter / 2 * cos(tt), 
               y = center[2] - diameter / 2 * sin(tt))
  }
  #### create semi circle ####
  def_circle <-  circleFundef(c(20,44), 26, start=1.5, end=2.5)
  att_circle <-  circleFunatt(c(124,44), 26, start=1.5, end=2.5)
  
  if(BasicFeatures == TRUE){
    ## initiate the plot, set some boundries to the plot
    pthy <- ggplot() + 
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
      geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5) +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax))
    
  }
  
  else{
    ## initiate the plot, set some boundries to the plot
     pthy <- ggplot()  +
      # add the theme 
      theme_blankPitch() +
      # add lines goals etc
            geom_rect(aes(xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax), fill = grass_colour, colour = line_colour) + 
      geom_segment(aes(x = def13, y = ymin, xend = def13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +   
      geom_segment(aes(x = def20, y = ymin, xend = def20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = def45, y = ymin, xend = def45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = def65, y = ymin, xend = def65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off65, y = ymin, xend = off65, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off45, y = ymin, xend = off45, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off20, y = ymin, xend = off20, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = off13, y = ymin, xend = off13, yend = ymax),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = right14d, xend = def13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = left14d, xend = def13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = right14d, xend = off13, yend = right14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = left14d, xend = off13, yend = left14d),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = hwxst, y = hwyst, xend = hwxst, yend = hwyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmin, y = sixYardrd, xend = sixYardDefxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmin, y = sixYardld, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardDefxst, y = sixYardrd, xend = sixYardDefxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = xmax, y = sixYardrd, xend = sixYardOffxst, yend = sixYardrd),colour = line_colour,linetype="solid",size = 0.5) + 
      geom_segment(aes(x = xmax, y = sixYardld, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = sixYardOffxst, y = sixYardrd, xend = sixYardOffxst, yend = sixYardld),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = pdxst, y = pdyst, xend = pdxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = poxst, y = pdyst, xend = poxst, yend = pdyed),colour = line_colour,linetype="solid",size = 0.5) +
      geom_segment(aes(x = glxst, y =  glyst, xend = glxst, yend = glyed),colour = goala_colour, size = 1) +
      geom_segment(aes(x =glxed, y =  glyst, xend =glxed, yend = glyed),colour = goalb_colour, size = 1) +
      geom_segment(aes(x = xmin, y = srwing, xend = xmax, yend = srwing),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = rhalfsp, xend = xmax, yend = rhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = ctre, xend = xmax, yend = ctre),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = xmin, y = lhalfsp, xend = xmax, yend = lhalfsp),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hwxst, y =  ymin, xend = hwxst, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_segment(aes(x = hw, y = ymin, xend = hw, yend = ymax),colour = tram_colour,linetype="dotted",size = 0.5) +
      geom_path(data=def_circle, aes(x,y), colour = line_colour,size = 0.5) +
      geom_path(data=att_circle, aes(x,y), colour = line_colour,size = 0.5)  +
      xlim(c(xmin,xmax)) + ylim(c(ymin,ymax)) +
      annotate(geom="text", x= 21.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 46.5, y=1.25, label="45",color = label_colour,size = 4) +
      annotate(geom="text", x= 66.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x= 80.5, y=1.25, label="65",color = label_colour,size = 4) +
      annotate(geom="text", x=100.5, y=1.25, label="45", color=label_colour,size = 4) +
      annotate(geom="text", x=125.5, y=1.25, label="20",color = label_colour,size = 4) +
      annotate(geom="text", x= 112, y=2, label="www.witnesstheanalysis.com",color = "white",size = 6, alpha = 0.4) +
      annotate(geom="text", x= 32, y=87, label="www.witnesstheanalysis.com",color = "white",size = 6, alpha = 0.4)+
      annotate("segment", x = 68, xend = 76, y = 2, yend = 2, colour = "pink", size=3, alpha=0.6, arrow=arrow())
  }

  
  return(pthy)}

pthy <- create_GAA_Pitch("gray72", "white", "white", "blue","red","white","blue", BasicFeatures=FALSE)


```


```{r}

## Run ##

n <- 100
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
color = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(color) <- levels(pass$poss)
colScale <- scale_colour_manual(name = "poss",values = color)

## Actions/Main etc ##

runcolpal <- c(
  "PW" = "orange",
  "Carry" = "lightgreen",
  "Hp" = "yellow", 
  "Tck Att Ndp" = "cornflowerblue",
  "Kp" = "orchid2",
  "Hp Prs" = "#D2691E", 
  "PW Pass" = "purple", 
  "Kp Prs" = "#00FFFF",
  "Pass Rs" = "lightblue",
  "Fk Pass" = "lightblue",
  "Ko" =  "darksalmon",
  "Ko Rec" = "darkgreen",
  "Ko ToL" = "darkred",
  "Pass ToL"= "red",
  "ToL" = "red",
  "Fk Point" = "pink",
  "Ms Op" = "darkred",
  "Fk Goal"= "darkgreen",
  "Ms Rs" = "dodgerblue3",
  "Free Won" = "mediumblue",
  "Point" = "#00BA38",
  "Goal" ="black",
  "Ko Int" ="yellow",
  "Pk Goal"= "#FFFFFF",
  "Pk Point"="#800000",
  "Mk Goal"="#D92121",
  "Sl Shot Right"="blue",
  "Sl Shot Left"="blue",
  "45 Goal"="#FFFFFF",
  "45 Point"="green",
  "45 Short"="darkred",
  "Brk Own"= "darkgreen",
  "KoBrk Own" ="darkgreen" ,
  "Opp Brk" = "darkgreen",
  "Opp KoBrk" = "darkgreen",
  "PW Sl Pass"= "#D2691E",
  "Fk Loss ToL"= "red",
  "Sl ToL"= "red",
   "Sl Pass"= "blue",
  "PW Pass" = "purple")

## PW for Run ## 

pwcol <- c(
"PW"="orange",  
"Fk Pass"="#000000",
"PW Fk Pass" = "#000000",
"PW Sl Pass" = "#000000",
"Int Op"="blue",
"Int Rs"="purple",
"Gk Won"="#FF6347",
"Ko Int"="orange",
"LBW"="black",
"RBW Def"="grey15",
"RBW Off"="#FF00FF",
"Rs Pass PW" = "turquoise",
"PW Sl Pass"="turquoise",
"Fkwof" = "turquoise",
"Tck LB Won" = "#D2691E")

## runlinepal - segtype ##

runlinepal <- c(
  "0" = 2, #carry
  "1" = 1, #Hp/Prs
  "2" = 2, #carry
  "3" = 3, #Kp Right
  "4" = 5, #Op Score	
  "5" = 5, #Miss
  "6" = 1, #Ko
  "7" = 1, #Ko ToL
  "8" = 6, # Pass ToL
  "9" = 3, #Fk/Sl Loss ToL 
  "10"= 6, #Carry Loss
  "11"= 3, #Kp Left 	
  "12"= 4, #Fk Pass Sl Pass
  "13"= 5, #Scr Rs
  "14"= 5, #Ms Rs	
  "15"=1, # Brk
  "16"=1) # KoBrk



```

```{r}

## Kick Outs ##

pal <- c("Ko Rec" = "blue",
"Ko Rec Prs" = "darkblue",
"Ko ToL"  = "red",
"Ko Lost High"  = "red",
"Ko Brk Rec" = "purple",
"Ko Brk Rec Prs" = "white",
"Ko Brk ToL"  = "red",
"Ko Brk Lost High"  = "red",
"Ko Mk Won"  = "darkgreen",
"Ko Mk Won High"  = "orange",
"Ko Lost Mk" = "red",
"Ko Lost Mk High" = "red",
"Ko Sl Won" = "yellow",
"Ko Unc Rec High" = "white",
"Ko Unc Rec NoPrs" = "white",
"Ko Fk Won Off" = "lightblue",
"Ko Fk Loss Off" = "darkred",
"Ko Mk Won Po" = "darkgreen",
"Ko MkW Po High" = "darkgreen",
"Ko Target" = "pink",
"Ko Target High" = "pink")

pals <- c("Ko Rec" = 19,
"Ko Rec Prs" = 19,
"ToL"  = 4,
"Ko ToL"  = 4,
"Ko Lost High"  = 4,
"Ko Brk Rec" = 19,
"Ko Brk Rec Prs" = 19,
"Ko Brk ToL"  = 4,
"KoBrk Lost High"  = 4,
"Ko Mk Won"  = 19,
"Ko Mk Won High"  = 19,
"Ko Lost Mk" = 4,
"Ko Lost Mk High" = 4,
"Ko Unc Rec" = 19,
"Ko Sl Won" = 19,
"Ko Fk Won Off" = 19,
"Ko Fk Loss Off" = 4,
"Ko Mk Won Po" = 19,
"Ko Mk W Po High" = 19)

perpal <- c("Ko Press" = "brown",
"Ko Lat Press"  = "orange",
"Ko Unc Press" = "pink")


runshape <- c("PW" = 15,
              "Ko Rec" = 19)

```

```{r}
## Time ##

actcolpals <- c(
  "20" = "grey",
  "0-9" = "darkgreen", 
  "10-19" = "blue", 
  "20-29" = "red",
  "30-39" = "purple",
  "40-49" =  "black",
  "50-59" = "darkred",
  "60-69" = "orange",
  "70+" = "dodgerblue3")
  
teamcol = c("Crokes" = "blue", "Judes" = "red")

teamnumcol = c("A" = "blue", "B" = "red")
  
```

```{r}
## PW General ##

paltow <- c("Tack W"="#000000",
"Kp Int"="blue",
"Kp Int High"="blue",
"Hp Int"="purple",
"Kp Brk Int"="#FF6347",
"Kp Brk High"="#000000",
"Hp Brk Int"="#0000FF",
"Fk Int"="#FFFF00",
"Fk Brk Int"="#00FFFF",
"Mk Kp Int"="#FF00FF",
"Sl Int"="darkblue",
"Ti Brk Won"=" black",
"Ko Int"="#800000",
"KoBrk Int"="#808000",
"PW Ko Int Mk Pass"="#D2691E",
"PW Ko Int Mk Po"="#D2691E",
"Fk Short Gk"="#800080",
"Short Gk"="#008080",
"Tck LB Won"="#000080",
"Tck LB Won G"="#D2691E",
"Free Won Def"="gold",
"Sl Kp Won To"="darkred",
"RBW Off"="#808080",
"Loose BW"="#000000",
"Brk Won"="#FF0000",
"RBW Def"="#800000",
"Ko Fk Won Def" = "lightblue",
"Fk Brk Int" = "lightblue",
"Mk Kp Brk Int"="#D2691E",
"PW Kp Int Mk Pass"= "#D2691E",
"PW Kp Int Mk Po"= "#D2691E",
"PW Sl Pass"= "#D2691E",
"PW Fk Pass"= "#D2691E",
"Sl Won Def Loss" = "#D2691E")



```

```{r}


## Shooting ## 

colshotvertpal <- c(
"Goal"= "blue",
"Point"= "black",
"Wide Left"="purple",
"Wide Right"="#FF6347",
"Saved"="#FFFF00",
"Blkd"="#00FFFF",
"Short"="#FF00FF",
"Post"="darkblue",
"Fk Goal"= "#FFFFFF",
"Fk Point"="#800000",
"Fk Wide Left"="#808000",
"Fk Wide Right"="#D2691E",
"Fk Saved"="#800080",
"Fk Short"="#008080",
"Fk Post"="#000080",
"45 Goal"="#FFFFFF",
"45 Point"="darkred",
"45 Wide Left"="#808080",
"45 Wide Right"="#000000",
"45 Saved"="#FF0000",
"45 Short"="#800000",
"45 Post"="yellow",
"Pk Goal" ="#619CFF",
"Pk Point"="#00BA38",
"Pk Wide Left"="#F8766D",
"Pk Wide Right"="#FF9326",
"Pk Saved"="#FFFF4D",
"Pk Post"="#21D921",
"Mk Goal"="white",
"Mk Point"="#D92121",
"Sl Point"="#FFFFFF",
"Sl Wide Left"="gold",
"Mk Wide Right"="#00BA38",
"Mk Short"="red",
"Mk Saved"="#2121D9",
"Hp Point"="#2121D9",
"Punch"="#21D921")

colshotshape <- c(
"Shot Right" = 15,
"Shot Left" = 16,
"45 Shot Right" = 6,
"45 Shot Left" = 2,
"Pk Shot Right" = 222,
"Pk Shot Left" = 112,
"Fk Shot Left" = 24,
"Fk Shot Right" = 25,
"Mk Shot Left" = 77,
"Mk Shot Right" = 109,
"Sl Shot Left" = 134,
"Sl Shot Right" = 135,
"Hp Shot" = 3,
"Punch" = 18
)

colshotpal <- c(
"1"= "darkgreen",
"2"= "yellow",
"3"="red",
"28" = "red")

```

```{r}

## Actions - Mainly used for ToL ## 

n <- 160
qual_col_pals = brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector = unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals)))

#created lots of colours - colour wheel
colorAct = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]

#added them to colscale
colormain = grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]
names(colorAct) <- levels(pass$Action)
colScale <- scale_colour_manual(name = "Action",values = colorAct)

```

```{r}
## Line Colours ## 

runcolpals <- c(
  "0" = "blue",
  "1" = "dodgerblue3", 
  "2" = "pink", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "darkred",
  "6" = "purple",
  "7" = "blue",
  "8" = "orange",
  "9" = "darkgreen",
  "10" = "lightblue")


segcolpals <- c(
  "1" = "dodgerblue3", 
  "2" = "pink", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "darkred",
  "6" = "purple",
  "7" = "blue",
  "8" = "red",
  "9" = "red",
  "10" = "lightblue",
  "11" = "blue",
  "12" = "darkgreen")


veccol <- c(
  "1" = "dodgerblue3", 
  "2" =  "darkred", 
  "3" = "white",
  "4" = "yellow",
  "5" =  "pink",
   "6" = "lightblue",
  "7" = "orange",
  "8" = "purple",
  "9" = "darkgreen",
  "10" = "lightblue")

veclinepal <- c(
  "0" = 1,
  "1" = 2, 
  "2" = 3, 
  "3" = 4,
  "4" = 5,
  "5" = 1,
  "6" = 1,
  "7" = 1,
  "8" = 1,
  "9" = 1,
  "10"= 1,
  "11"= 1,
  "12"= 1,
  "13"= 1,
  "14"= 1,
  "15"=1,
  "16"=1)



passnocolpals <- c(
 "Shot Op Oc" = "darkgreen",
 "Shot Rs Oc" = "lightblue",
 "ToL"= "red",
 "Half Time" = "grey",
 "Full Time" = "grey",
 "Ref Stop" = "grey",
 "Off 45 Won" = "orange")

## m/s ##

mscolpals <- c(
  "0" = "grey",
  "0-2.99" = "black", 
  "3-5.99" = "blue", 
  "6-8.99" = "red",
  "9-11.99" = "purple",
  "12-14.99" =  "yellow",
  "15-17.99" = "darkred",
  "18-20.99" = "orange",
  ">21" = "dodgerblue3")
```

```{r}
## Rec'd ##   

reccolply <- c(
"Hp Rec" = "purple", 
"Hp Brk Rec" = "purple", 
"Kp Rec" = "purple", 
"Hp Rec Prs" = "purple", 
"Hp Brk Rec Prs" = "purple", 
"Kp Brk Rec" = "darkgreen",
"Kp Rec Prs" = "darkgreen",
"Kp Brk Rec Prs" = "darkgreen",
"Kp Rec High" = "darkgreen",
"Kp Rec High Prs" = "darkgreen",
"Kp Brk Rec High" = "darkgreen",
"Kp Brk Rec High Prs" = "darkgreen",
"Att Mk Won" = "black",
"Att Mk Won Po" = "black",
"Att Mk Won Prs" = "black",
"Att Mk Won High" = "black",
"Att Mk Won Po High" = "black",
"Att Mk Won Prs High" = "black",
"Att Mk Won Po Prs High" = "black",
"Fk Rec" = "orange",
"Mk Rec" = "orange",
"Sl Rec" = "orange",
"Fk Rec Prs" = "orange",
"Mk Rec Prs" = "orange", 
"Sl Rec Prs" = "orange", 
"Brk Rec Prs" = "orange", 
"45 Rec" = "orange",
"PWP Rec" = "orange",
"Target" = "blue")


```

```{r}
## Start and End ## 

startcolpal <- c(
  "PW" = "orange",
  "Carry" = "lightgreen",
  "Hp" = "yellow", 
  "Tck Att Ndp" = "cornflowerblue",
  "Tck Att" = "cornflowerblue",
  "Kp" = "orchid2",
  "Hp Prs" = "#D2691E", 
  "Kp Prs" = "#00FFFF",
  "Pw Pass" = "purple", 
  "Pass Rs" = "lightblue",
  "Fk Pass" = "lightblue",
  "Ko" =  "darksalmon",
  "Ko Rec" = "darkgreen",
  "Ko Won" = "blue",
  "Ko ToL" = "darkred",
  "Pass ToL"= "red",
  "Fk ToL"= "red",
  "ToL" = "red",
  "Fk Point" = "pink",
  "Scr Op" = "darkgreen",
  "Scr Rs" = "darkblue",
  "Ms Op" = "darkred",
  "Ms Rs" = "lightblue",
  "Fk Goal"= "darkgreen",
  "Ms Rs" = "dodgerblue3",
  "Free Won" = "purple",
  "Point" = "#00BA38",
  "Goal" ="black",
  "Ko Int" ="yellow",
  "Pk Goal"= "#FFFFFF",
  "Pk Point"="#800000",
  "Mk Goal"="#D92121",
  "Sl Shot Right"="blue",
  "45 Goal"="#FFFFFF",
  "45 Point"="green",
  "45 Short"="darkred",
  "Brk Own"= "darkgreen",
  "KoBrk Own" ="darkgreen" ,
  "Opp Brk" = "darkgreen",
  "Opp KoBrk" = "darkgreen",
  "PW Sl Pass"= "#D2691E",
  "Fk Loss ToL"= "darksalmon",
  "Tck ToL"= "#D2691E",
  "Sl ToL"= "red",
   "Sl Pass"= "blue",
   "Shot Op" = "black",
   "Shot Rs" = "black",
  "LB ToL" = "#D2691E",
  "Rs ToL" = "#800000",
  "Half Time" = "grey",
  "Full Time" = "grey",
  "Off 45 Won" = "grey")

startshape <- c( "PW" = 15, "Ko" = 19,"Ko Won" = 19, "ToL" = 19)



```

```{r}
### Player Stats ###

runcolply <- c(
  "PW" = "orange", 
  "Def Act" = "#D2691E", 
  "Pass Op" = "purple", 
  "Pass Rs" = "lightblue",
  "Ko" =  "gold",
  "Ko Rec" = "green",
  "Ko ToL" = "darkred",
  "Pass ToL"= "red",
  "ToL" = "red",
  "Fk Point" = "pink",
  "Spoil Off" = "darkred",
  "Shot Op"= "darkgreen",
  "Shot Rs" = "dodgerblue3",
  "Free Won" = "blue",
  "Rec Op" = "#00BA38",
  "Rec Rs" = "black",
  "Free Loss" = "#D92121",
  "Tck Att" = "gold",
  "Tck Def" = "dodgerblue3")


### Player Invol ### 

invol <- c("miss" = "lightblue", 
           "score" = "darkgreen",
           "nonshot" = "red")

```


```{r}

##TEAM A##

# Only needed for the counts not the maps (except entry)
# Creates for all rows 

#0 point is strictly exterior to polygon
#1 point is strictly interior to polygon
#2 point lies on the relative interior of an edge of polygon
#3 point is a vertex of polygon


#looking at poss that started in in_def and see if they ended in inzone
#creating the hull
#Finds the shots

scoresAarea <- scores %>%ungroup() %>%filter (Teamnum == "A") %>% select(Areax, Areay)

#creates the hull for all shots - think about changing this to scores only
hull <- scoresAarea %>%slice(chull(Areax, Areay))

#filters end of possessions - actions only
TeamAEnd  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "A")

#finds which are inside 


#creates a dataframe of oc 
inzone <- data.frame(inzone = point.in.polygon(TeamAEnd$Areax, TeamAEnd$Areay,hull$Areax, hull$Areay, mode.checked=FALSE))

#creates a df of all action - allows to create other things
zonedA <-bind_cols(TeamAEnd,inzone)


#filters end of possessions - actions only
zonedB  <- zonedA %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "A")

#finds which are inside 


#creates a dataframe of oc 
oczone <- data.frame(oczone = point.in.polygon(zonedB$xend,zonedB$yend,hull$Areax, hull$Areay, mode.checked=FALSE))

#creates col based on oc - allows to create other things
zonedA <-bind_cols(zonedA,oczone)

#Finds the scores 

scrAarea <- scores %>%ungroup() %>%filter (Teamnum == "A", subsetoc %in% c("Scr Op", "Scr Rs")) %>% select(Areax, Areay)

#creates the hull for all shots - think about changing this to scores only
hullscr <- scrAarea %>%slice(chull(Areax, Areay))

#filters end of possessions - actions only
TeamAEndscr  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "A")

#finds which are inside 
#point.in.polygon( TeamAEnd$Areax, TeamAEnd$Areay,hull$Areax, hull$Areay, mode.checked=FALSE)

#creates a dataframe of orig 
inzonescr <- data.frame(inzonescr = point.in.polygon(TeamAEndscr$Areax, TeamAEndscr$Areay,hullscr$Areax, hullscr$Areay, mode.checked=FALSE))

#creates a df of all action - allows to create other things
#zonedAscr <-bind_cols(TeamAEndscr,inzonescr)


#filters end of possessions - actions only
zonedBscr  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "A")

#finds which are inside 

#creates a dataframe of oc 
oczonescr <- data.frame(oczonescr = point.in.polygon(zonedBscr$xend,zonedBscr$yend,hullscr$Areax, hullscr$Areay, mode.checked=FALSE))

#creates col based on oc - allows to create other things
zonedA <-bind_cols(zonedA,inzonescr,oczonescr)




```

```{r}

##TEAM B##

# Only needed for the counts not the maps (except entry)
# Creates for all rows 

#0 point is strictly exterior to polygon
#1 point is strictly interior to polygon
#2 point lies on the relative interior of an edge of polygon
#3 point is a vertex of polygon


#looking at poss that started in in_def and see if they ended in inzone
#creating the hull
#Finds the shots

scoresBarea <- scores %>%ungroup() %>%filter (Teamnum == "B") %>% select(Areax, Areay)

#creates the hull for all shots - think about changing this to scores only
hullB <- scoresBarea %>%slice(chull(Areax, Areay))

#filters end of possessions - actions only
TeamBEnd  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "B")

#finds which are inside 
#point.in.polygon( TeamBEnd$Areax, TeamBEnd$Areay,hullB$Areax, hullB$Areay, mode.checked=FALSE)

#creates a dataframe of oc 
inzoneB <- data.frame(inzone = point.in.polygon(TeamBEnd$Areax, TeamBEnd$Areay,hullB$Areax, hullB$Areay, mode.checked=FALSE))

#creates a df of all action - allows to create other things
zonedB <-bind_cols(TeamBEnd,inzoneB)


#filters end of possessions - actions only
zonedBB  <- zonedB %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "B")

#finds which are inside 
#point.in.polygon(zonedBB$xend,zonedBB$yend,hullB$Areax, hullB$Areay, mode.checked=FALSE)

#creates a dataframe of oc 
oczone <- data.frame(oczone = point.in.polygon(zonedBB$xend,zonedBB$yend,hullB$Areax, hullB$Areay, mode.checked=FALSE))

#creates col based on oc - allows to create other things
zonedB <-bind_cols(zonedB,oczone)

#Finds the scores 

scrBarea <- scores %>%ungroup() %>%filter (Teamnum == "B", subsetoc %in% c("Scr Op", "Scr Rs")) %>% select(Areax, Areay)

#creates the hull for all shots - think about changing this to scores only
hullscrB <- scrBarea %>%slice(chull(Areax, Areay))

#filters end of possessions - actions only
TeamBEndscrB  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "B")

#finds which are inside 
#point.in.polygon( TeamBEnd$Areax, TeamBEnd$Areay,hullB$Areax, hullB$Areay, mode.checked=FALSE)

#creates a dataframe of orig 
inzonescrB <- data.frame(inzonescr = point.in.polygon(TeamBEndscrB$Areax, TeamBEndscrB$Areay,hullscrB$Areax, hullscrB$Areay, mode.checked=FALSE))


#filters end of possessions - actions only
zonedBscrB  <- run %>%group_by(Team, Action) %>% filter(keep=="Y",Teamnum == "B")

#finds which are inside 
#point.in.polygon(zonedB$xend,zonedB$yend,hullB$Areax, hullB$Areay, mode.checked=FALSE)

#creates a dataframe of oc 
oczonescrB <- data.frame(oczonescr = point.in.polygon(zonedBscrB$xend,zonedBscrB$yend,hullscrB$Areax, hullscrB$Areay, mode.checked=FALSE))

#creates col based on oc - allows to create other things
zonedB <-bind_cols(zonedB,inzonescrB,oczonescrB)
```

<font size="4">Dublin Senior Final<font>

<font size="4">	21st November 2021, Parnell Park, Dublin<font>


```{r, fig.width = 16, fig.height = 2}
df <- data.frame(
    x = rep(seq(0, 6, 6), 1),
    y = c(rep(6.5, 2)),
    h = rep(4.25,),
    w = rep(5.95,2),
    value = gamescore$score,
    info = gamescore$team,
    color = factor(1:2)
)

ggplot(df, aes(x, y, height = h, width = w, label = info)) +
    geom_tile(aes(fill = color)) +
    geom_text(data = df,
              aes(label = info, x = x - 1.5, y = y + 1),color = "white", fontface = "bold", size = 25, hjust = 0) +
    geom_text(data = df,
              aes(label = value, x = x - 1, y = y - 1),color = "white", fontface = "bold", size = 15, hjust = 0) +
    #coord_fixed() +
    scale_fill_brewer(type = "qual",palette = "Dark2") +
    theme_void() +
    guides(fill = FALSE) +
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0))


``` 

```{r, fig.width = 16, fig.height = 2}

df <- data.frame(
    x = rep(seq(0, 12, 6), 1),
    y = c(rep(6.5, 3)),
    h = rep(4.25,3),
    w = rep(5.95,3),
    value = gametime$mins,
    info = gametime$time,
    color = factor(1:3)
)

 ggplot(df, aes(x, y, height = h, width = w, label = info)) +
    geom_tile(aes(fill = color)) +
    geom_text(data = df,
              aes(label = value, x = x - 1, y = y + .5),color = "white", fontface = "bold", size = 15, hjust = 0) +
    geom_text(data = df,
              aes(label = info, x = x - 1.5, y = y - 1),color = "white", fontface = "bold", size = 10, hjust = 0) +
    #coord_fixed() +
    scale_fill_brewer(type = "qual",palette = "Dark2") +
    theme_void() +
    guides(fill = FALSE) +
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0))




```

* Includes water breaks 

# Quick Game Stats 

```{r}

sopA <- sop 

All_Poss  <- sopA %>%group_by(Team) %>%summarize(Possessions =sum(main %in% c("PW","Ko")|Action %in% c("45 Shot Left","45 Shot Right","45 Pass")), Total_Possession_time =sum (secs/60), Ave_Possession_time =mean(secs),  All_Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Shot_Perc =(All_Shots/Possessions*100), Shot_Rate_secs = sum (secs/All_Shots),Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Scr_Perc =(Scores/All_Shots*100))

All_Poss  <- All_Poss  %>%  mutate_at(vars(Total_Possession_time,Ave_Possession_time,Shot_Perc,Shot_Rate_secs,Scr_Perc), funs(round(., 0)))

library(plyr)

All_PossA <- rename(All_Poss, c( Total_Possession_time = "Poss Time (mins)",Ave_Possession_time = "Ave time (secs)",Scr_Perc = "Score %",All_Shots = "All Shots", Shot_Perc = "% Shots per Poss",  Shot_Rate_secs  = "Shot Rate (secs)"))

detach(package:plyr)


All_PossA <- All_PossA   %>%
kbl(caption = "All Possessions", align = "c") %>%
kable_minimal() 

All_PossA


```

```{r}

passlpop <- pass[pass$main!="Def Act", ]
passlpop <- passlpop[passlpop$main!="Free Loss", ]
passlpop <- passlpop[passlpop$main!="Tck Def", ]
passlpop <- passlpop[passlpop$main!="Tck End", ]
passlpop <- passlpop[passlpop$main!="Sht Prs", ]
passlpop <- passlpop[passlpop$main!="Spoil Off", ]
passlpop <- passlpop[passlpop$main!="Opp Brk", ]


passlpop <- passlpop

lpop <- passlpop %>%group_by(Team)%>%summarize(Possession_Won =sum(main == "PW"), Ko = sum(main == "Ko"),Ko_Won = sum(main == "Ko Rec"), Forty_Fives = sum(Action %in% c("45 Shot Left","45 Shot Right","45 Pass")) ,Open_Play_Shots = sum(main == "Shot Op"),Open_Play_Score = sum(subset == "Scr Op"), PWp = (Open_Play_Score/Open_Play_Shots*100),
Fk_Shots = sum(main == "Shot Rs"),Fk_Score = sum(subset == "Scr Rs"), Pp = (Fk_Score/Fk_Shots*100))



lpopA <- rename(lpop,  "Possessions Won" = Possession_Won, "Ko Won" = Ko_Won, "OP Shots" = Open_Play_Shots ,  "Op Scores" = Open_Play_Score ,  "Rs Shots" = Fk_Shots , "Rs Scores" = Fk_Score, "Op Score %" = PWp, "Rs Score %" = Pp)



lpopA <- lpopA %>% mutate_if(is.numeric, round, digits = 2)

lpopA %>%
kbl(caption = "Team Scores", align = "c") %>%
kable_minimal()
```


```{r}
## Team ##

PWA <- sop 

PWA <- PWA %>%group_by(Team) %>% filter (main == "PW")%>%summarize(Poss_PW =sum(main %in% c("PW")), Poss_time =sum (secs/60), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),Shot_PP =(Shots/Poss_PW*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))

PWA <- PWA %>% mutate_if(is.numeric, round, digits = 2)

PWA <- rename(PWA, "Possession Won" = Poss_PW, "Total Time (min)" = Poss_time, "% Shots per PW" = Shot_PP , "Shot Rate (secs)" = Shot_time )

PWA   %>%
kbl(caption = "Team Possession Won", align = "c") %>%
kable_minimal()

```

```{r}

## Team ## 

koA <- sop

KoA <- koA %>%group_by(Team) %>% filter (main == "Ko")%>%summarize(Poss_Ko =sum(main %in% c("Ko")), Ko_Won =sum(Pitch_Oc_Ko %in% c("Ko Rec")),Ko_Perc = ((Ko_Won/Poss_Ko)*100), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),  Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")), Ko_Time = mean (Ko_Time))

KoA <- rename(KoA, "Kickouts" = Poss_Ko, " Ko Won" =  Ko_Won,"% Ko Won" = Ko_Perc,  "Time to Ko (secs)" =  Ko_Time )

KoA <- KoA %>% mutate_if(is.numeric, round, digits = 2)


KoA  %>%
kbl(caption = "Kick Outs", align = "c") %>%
kable_minimal()


```




# Scorers

```{r}

scores <- scores %>% mutate (minute = timeoc/60) 

scores <- scores %>% mutate_if(is.numeric, round, digits = 0) 
  
plyscr <-  scores %>% filter (subsetoc %in% c ( "Scr Op", "Scr Rs")) %>% ungroup()

plyscr <- plyscr %>% select (7,9,19,21,45)


#plyscr <- rename(plyscr,  "Shot Type" = Action, "Player" = plynum, "Outcome" = Actionoc,  "Minute" = minute)

#kable (plyscr) %>%kable_minimal()


datatable(plyscr,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```

## Player Score Type - Crokes

```{r}
scrAtot <- pass %>% group_by(plynum) %>% filter (Teamnum == "A", Action %in% c ("Goal", "Point","Fk Goal", "Fk Point","Mk Goal","Mk Point", "Pk Goal", "Pk Point")) %>% count (Action)

scrAtot <- rename(scrAtot, "Player" = plynum, "Outcome" = Action,  "Total" = n)


scrAtot  %>%
  kbl(caption = "Player Score Type - Crokes", align = "c") %>%
  kable_minimal()

```

## Player Score Type - Judes

```{r}
scrBtot <- pass %>% group_by(plynum) %>% filter (Teamnum == "B", Action %in% c ("Goal", "Point","Fk Goal", "Fk Point","Mk Goal","Mk Point", "Pk Goal", "Pk Point")) %>% count (Action)

scrBtot <- rename(scrBtot, "Player" = plynum, "Outcome" = Action,  "Total" = n)

scrBtot  %>%
  kbl(caption = "Player Score Type - Judes", align = "c") %>%
  kable_minimal()

```


# Team Sheet

## Crokes

```{r}
tmshtA <- teamsheet %>% filter (Teamnum == "A") %>% select (3,10)

datatable(tmshtA,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)
```



## Judes

```{r}

tmshtB <- teamsheet %>% filter (Teamnum == "B") %>% select (3,10)

#kable (tmsht) %>%kable_minimal()


datatable(tmshtB,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```


# Worm

```{r, fig.width = 16, fig.height = 8}

wormA <-filter(scores, Teamnum == "A")
wormB <-filter(scores, Teamnum == "B") 

ggplot(data=scores, aes(x=timeoc, y=scoreA, group=Team)) +
  geom_step(data=wormA, aes(x=timeoc, y=Tot_ScrA), colour = "yellow",size=2) + 
  geom_step(data=wormB, aes(x=timeoc, y=Tot_ScrB), colour = "lightblue", size=2) + 
  geom_point(data = wormA,aes(x=timeoc, y=Tot_ScrA, colour = Actionoc, shape = Team),  size = 4, stroke = 2) +
  geom_point(data = wormB, aes(x=timeoc, y=Tot_ScrB, colour = Actionoc, shape = Team),  size = 4, stroke = 2) +
  theme_classic() + 
  theme(plot.background = element_blank(),
        legend.position="bottom",
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks = element_blank(), 
        axis.title.x = element_blank()) +
  #geom_text_repel(data = wormA, aes(x=timeoc, y=Tot_ScrA, label = Player), size = 6, colour = "green", nudge_y = 2, 
                 # segment.size  = 0.2,  direction = "x", hjust = 1 ) + 
 # geom_text_repel(data = wormB, aes(x=timeoc, y=Tot_ScrB, label =  Player), size = 6, colour = "darkblue", nudge_x = 4, nudge_y = -2, 
                 # segment.size  = 0.2,  direction = "y", hjust = 1) + 
  guides(size = FALSE) +
  geom_vline(xintercept=p1, linetype="dotted", color = "black") +
  geom_vline(xintercept=ht, linetype="dotted", color = "black") +
  geom_vline(xintercept=p3, linetype="dotted", color = "black") +
  #geom_vline(xintercept=77, linetype="dotted", color = "black") +  
  annotate(geom="text", x= p1, y=-0.25, label="1Qtr",color = "black") +
  annotate(geom="text", x= ht, y=-0.25, label="HT",color = "black") +
  annotate(geom="text", x= p3, y=-0.25, label="3Qtr",color = "black") +
  #annotate(geom="text", x= 74, y=-0.25, label="FT",color = "black") +
  theme(axis.text.y =element_text(size=16),
        axis.title.y =element_text(size=16,face="bold")) +
   labs(colour="Outcome", title = "Shot Worm", y="Score") +
theme(plot.title=element_text(size= 32, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20))
```



# Periods

```{r, fig.width = 16, fig.height = 10}

perA <- pass%>%group_by(Team,main,period, .drop=TRUE) %>% filter (main %in% c("PW", "ToL", "Ko Rec", "Ko", "Free Won", "Free Loss", "Shot Op","Shot Rs"))

perA <- perA %>%group_by(Team,main,period)%>%tally%>%mutate(f = sum(n))

 ggplot(perA,aes(x=period,weight = n,fill = as.factor(period))) + 
geom_histogram()+facet_grid(Team ~ main, scales='free') + 
theme(strip.background = element_rect(colour="black", fill="lightgreen", size=1.5, linetype="solid"), 
strip.text = element_text(size = 14, colour = "black"),
axis.text = element_text(size = 12, colour = "black")) +
labs (fill = "Period") + theme(legend.position="bottom") 

```



#  Shooting - Crokes

```{r, fig.width = 16, fig.height = 2}
ShotsAllA <- sop %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsAll <-ShotsAllA %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

ShotsAll <-ShotsAll %>% mutate_at(vars(Shot_Eff), funs(round(., 1)))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "Efficiency %"))

detach(package:plyr)


lpop <-ShotsAll %>%
  tidyr::gather(variable, value, -Team)

lpop <-lpop %>% select (variable, value)

#lpop


df <- data.frame(
    x = rep(seq(0, 12, 6), 1),
    y = c(rep(6.5, 3)),
    h = rep(4.25,3),
    w = rep(5.95,3),
    value = lpop$value,
    info = lpop$variable,
    color = factor(1:3)
)

ggplot(df, aes(x, y, height = h, width = w, label = info)) +
    geom_tile(aes(fill = color)) +
    geom_text(data = df,
              aes(label = value, x = x - 1, y = y + .5),color = "white", fontface = "bold", size = 25, hjust = 0) +
    geom_text(data = df,
              aes(label = info, x = x - 1.5, y = y - 1),color = "white", fontface = "bold", size = 10, hjust = 0) +
    #coord_fixed() +
    scale_fill_brewer(type = "qual",palette = "Dark2") +
    theme_void() +
    guides(fill = FALSE) +
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0))

```

```{r, fig.width = 16, fig.height = 12}

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op"|subset == "Shot Rs")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc =="Scr Op"|subsetoc == "Scr Rs")

shotseffA <- scores  %>%group_by(Zonethy,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zonethy,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

pthy + 
  geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 28, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
  scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = Player, col = Actionoc), size = 8) +
  scale_shape_manual(values = colshotshape) +
  guides(size = FALSE) +
  labs(shape ="Shot Type", colour = "Outcome",title = "All Shots - Crokes") +
  theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20))




```


```{r}
ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "A", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

ASB <- spread(ASB, key = Action, value = count)

ASB  %>%
  kbl(caption = "Shot Outcome",align = "c") %>%
    kable_minimal()

```



# Shooting - Judes

```{r, fig.width = 16, fig.height = 2}
ShotsAllB <- sop %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsAll <-ShotsAllB %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc","Shot Rs Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")),Shot_Eff = (Scores/Shots *100))

ShotsAll <-ShotsAll %>% mutate_at(vars(Shot_Eff), funs(round(., 1)))

library(plyr)

ShotsAll <- rename(ShotsAll, c( Shot_Eff = "Efficiency %"))

detach(package:plyr)


lpop <-ShotsAll %>%
  tidyr::gather(variable, value, -Team)

lpop <-lpop %>% select (variable, value)

#lpop


df <- data.frame(
    x = rep(seq(0, 12, 6), 1),
    y = c(rep(6.5, 3)),
    h = rep(4.25,3),
    w = rep(5.95,3),
    value = lpop$value,
    info = lpop$variable,
    color = factor(1:3)
)

ggplot(df, aes(x, y, height = h, width = w, label = info)) +
    geom_tile(aes(fill = color)) +
    geom_text(data = df,
              aes(label = value, x = x - 1, y = y + .5),color = "white", fontface = "bold", size = 25, hjust = 0) +
    geom_text(data = df,
              aes(label = info, x = x - 1.5, y = y - 1),color = "white", fontface = "bold", size = 10, hjust = 0) +
    #coord_fixed() +
    scale_fill_brewer(type = "qual",palette = "Dark2") +
    theme_void() +
    guides(fill = FALSE) +
    scale_x_continuous(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0))

```

```{r, fig.width = 16, fig.height = 12}

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op"|subset == "Shot Rs")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc =="Scr Op"|subsetoc == "Scr Rs")

shotseffA <- scores  %>%group_by(Zonethy,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op"|subset == "Shot Rs") %>%summarize(Scr =sum(subsetoc == "Scr Op"|subsetoc == "Scr Rs"), Ms = sum(subsetoc == "Ms Op"|subsetoc == "Ms Rs"),Shot=(Scr + Ms))%>%select(Zonethy,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

pthy + 
  geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 28, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
  scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = Player, col = Actionoc), size = 8) +
  scale_shape_manual(values = colshotshape) +
  guides(size = FALSE) +
  labs(shape ="Shot Type", colour = "Outcome",title = "All Shots - Judes") +
  theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20))




```

```{r}
ASB<- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")
ASB<- ASB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main =="Shot Op Oc"| main == "Shot Rs Oc")%>%summarize(count=n())

ASB<- spread(ASB, key = Action, value = count)

ASB  %>%
  kbl(caption = "Shot Outcome",align = "c") %>%
    kable_minimal()


```



# Open Play Shooting - Crokes 

```{r, fig.width = 16, fig.height = 2}

ShotsAllA <- sop %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsAll <-ShotsAllA %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100))

ShotsAll <-ShotsAll %>% mutate_at(vars(Shot_Eff), funs(round(., 1)))

library(plyr)

ShotsAllA <- rename(ShotsAll, c( Shot_Eff = "Efficiency %"))

detach(package:plyr)


ShotsAllA  %>%
kbl(caption = "Open Play Shots - Crokes", align = "c") %>%
kable_minimal()

```

```{r, fig.width = 16, fig.height = 12}


shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset =="Shot Op")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subsetoc =="Scr Op")

shotseffA <- scores  %>%group_by(Zonethy,tx,ty,bx,by)%>%filter(Teamnum =="A", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zonethy,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

pthy + 
  geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action), size = 6) + 
    scale_colour_manual(values = colshotpal, labels = c("None", "Light/Late", "Heavy")) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, colour = as.factor(shdf)), size = 6) +
    scale_shape_manual(values = colshotshape) +
    guides(size = FALSE) +
labs(colour="Pressure",shape = "Shot Type", title = "Shot Pressure - Crokes") +
theme(plot.title=element_text(size=18, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 


```



```{r}
prsA <- scores %>% filter (subset == "Shot Op", Teamnum == "A") %>% group_by(subsetoc, Team, shdf) %>% summarise(count = n()) %>% ungroup ()%>% select(subsetoc, shdf, count)

#prsA$subsetoc[prsA$subsetoc =="Ms Op"]<-"Miss"

prsA$subsetoc <- as.character(prsA$subsetoc)

prsA <- prsA %>% mutate(subsetoc = replace(subsetoc, str_detect(subsetoc, "Ms"), "Miss"))
prsA <- prsA %>% mutate(subsetoc = replace(subsetoc, str_detect(subsetoc, "Scr"), "Score"))

prsA <- prsA %>% mutate(shdf = replace(shdf, str_detect(shdf, "1"), "None"))
prsA <- prsA %>% mutate(shdf = replace(shdf, str_detect(shdf, "2"), "Light/Late"))
prsA <- prsA %>% mutate(shdf = replace(shdf, str_detect(shdf, "3"), "Heavy"))


prsA <- rename(prsA, "Shot Outcome" = subsetoc, "Pressure" = shdf )

#prsA %>%kbl(caption = "Crokes - Shot Pressure") %>%kable_minimal()



prsA %>%
  kable("html", align = 'clc', caption = 'Shot Pressure - Crokes') %>%
    kable_styling(full_width = F, position = "left")




```


## Player Open Play Shooting Stats - Crokes

```{r}

passA <- pass %>%filter (Teamnum == "A")


playerstsA <- passA %>%group_by(Player,plynum)%>%summarize(Slef =sum(Action == "Shot Left"),Srig =sum(Action == "Shot Right"),Hndps =sum(Action %in% c ( "Hp Shot")),Punch = sum (Action %in% c("Punch")),
Goal = sum (Action %in% c("Goal")),Point = sum (Action %in% c("Point")),WR =sum (Action %in% c("Wide Right")),
WL =sum (Action %in% c("Wide Left")),Sve = sum (Action %in% c("Saved")),blkd= sum (Action %in% c("Blkd")),
OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"))

playerstsA  <- playerstsA  %>%ungroup() %>% select(-Player)

#playerstsA  %>%
  #kbl(caption = "Player Shooting Stats - Crokes",align = "c") %>%
    #kable_minimal()


datatable(playerstsA,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),caption = 'Player Shooting Stats - Crokes',class = 'cell-border stripe', rownames = FALSE)

```


# Open Play Shooting - Judes

```{r, fig.width = 16, fig.height = 2}
ShotsAllB <- sop %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsAll <-ShotsAllB %>%group_by(Team)%>%filter(mainoc %in% c("Shot Op Oc")) %>%summarize(Shots = sum(mainoc %in% c("Shot Op Oc")), Scores = sum(subsetoc %in% c("Scr Op")),Shot_Eff = (Scores/Shots *100))

ShotsAll <-ShotsAll %>% mutate_at(vars(Shot_Eff), funs(round(., 1)))

library(plyr)

ShotsAllB <- rename(ShotsAll, c( Shot_Eff = "Efficiency %"))

detach(package:plyr)



ShotsAllB  %>%
kbl(caption = "Open Play Shots - Judes", align = "c") %>%
kable_minimal()

```

```{r, fig.width = 16, fig.height = 12}

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset =="Shot Op")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B", subsetoc =="Scr Op")

shotseffA <- scores  %>%group_by(Zonethy,tx,ty,bx,by)%>%filter(Teamnum =="B", subset == "Shot Op") %>%summarize(Scr =sum(subsetoc == "Scr Op"), Ms = sum(subsetoc == "Ms Op"),Shot=(Scr + Ms))%>%select(Zonethy,Scr,Ms,Shot,tx,ty,bx,by)

shotseffA = shotseffA %>% 
   unite(shtscr, Scr, Shot, sep = "/", remove = FALSE)

pthy + 
  geom_text(data= shotseffA, aes(x= tx, y=ty, label = shtscr),colour = "white", size = 30, alpha = 0.4) +
  geom_point(data = shotsA, aes(x=Areax, y=Areay, colour = as.factor(shdf), shape = Action), size = 6) + 
    scale_colour_manual(values = colshotpal, labels = c("None", "Light/Late", "Heavy")) +
  geom_text_repel(data = shotsA, aes(x=Areax, y=Areay, label = plylaboc, colour = as.factor(shdf)), size = 6) +
    scale_shape_manual(values = colshotshape) +
    guides(size = FALSE) +
labs(colour="Pressure",shape = "Shot Type", title = "Shot Pressure - Judes") +
theme(plot.title=element_text(size=18, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 


```


```{r}
prsB <- scores %>% filter (subset == "Shot Op", Teamnum == "B") %>% group_by(subsetoc, Team, shdf) %>% summarise(count = n()) %>% ungroup ()%>% select(subsetoc, shdf, count)

#prsB$subsetoc[prsB$subsetoc =="Ms Op"]<-"Miss"

prsB$subsetoc <- as.character(prsB$subsetoc)

prsB <- prsB %>% mutate(subsetoc = replace(subsetoc, str_detect(subsetoc, "Ms"), "Miss"))
prsB <- prsB %>% mutate(subsetoc = replace(subsetoc, str_detect(subsetoc, "Scr"), "Score"))


prsB <- prsB %>% mutate(shdf = replace(shdf, str_detect(shdf, "1"), "None"))
prsB <- prsB %>% mutate(shdf = replace(shdf, str_detect(shdf, "2"), "Light/Late"))
prsB <- prsB %>% mutate(shdf = replace(shdf, str_detect(shdf, "3"), "Heavy"))

prsB <- rename(prsB, "Shot Outcome" = subsetoc, "Pressure" = shdf )

#prsB %>%kbl(caption = "Judes Shot Pressure") %>%kable_minimal()


prsB %>%
  kable("html", align = 'clc', caption = 'Shot Pressure - Judes') %>%
    kable_styling(full_width = F,position = "left")




```

## Player Open Play Shooting Stats - Judes

```{r}

passB <- pass %>%filter (Teamnum == "B")


playerstsB <- passB %>%group_by(Player,plynum)%>%summarize(Slef =sum(Action == "Shot Left"),Srig =sum(Action == "Shot Right"),Hndps =sum(Action %in% c ( "Hp Shot")),Punch = sum (Action %in% c("Punch")),
Goal = sum (Action %in% c("Goal")),Point = sum (Action %in% c("Point")),WR =sum (Action %in% c("Wide Right")),
WL =sum (Action %in% c("Wide Left")),Sve = sum (Action %in% c("Saved")),blkd= sum (Action %in% c("Blkd")),
OpShot =sum(main == "Shot Op"),OpScr =sum(subset == "Scr Op"))

playerstsB  <- playerstsB  %>%ungroup() %>% select(-Player)

#playerstsB  %>%
  #kbl(caption = "Player Shooting Stats - Judes",align = "c") %>%
    #kable_minimal()

datatable(playerstsB,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),caption = 'Player Shooting Stats - Judes',class = 'cell-border stripe', rownames = FALSE)
```

# Frees and Attacking Marks Won 

```{r, fig.width = 16, fig.height = 2}

ShotsAllA <- pass %>%group_by(Team)%>%filter(Teamnum == "A")

ShotsAll <-ShotsAllA %>%group_by(Team)%>%summarize(
   
  Att_Mark = sum (subset %in% c ("Att Mk Won")), 
  
  Mk_Shots = sum(Action %in% c("Mk Shot Left", "Mk Shot Right")), 
                                                                                         
  Mk_Scores = sum(Action %in% c("Mk Point", "Mk Goal")),Mk_Shot_Eff = (Mk_Scores/Mk_Shots *100),
  
  Free_Won = sum (main %in% c ("Free Won")), 
  
  Fk_Shots = sum(Action %in% c("Fk Shot Left", "Fk Shot Right")), 
                                                                                         
  Fk_Scores = sum(Action %in% c("Fk Point", "Fk Goal")),Fk_Shot_Eff = (Fk_Scores/Fk_Shots *100))


fksAllA  <- rename(ShotsAll, "Fk Shot Efficiency %" = Fk_Shot_Eff, "Frees Won" =  Free_Won,"Fk Shots" = Fk_Shots,"Fk Scores" = Fk_Scores, 
"Att Mark Won" =  Att_Mark,"Mark Shots" = Mk_Shots,"Mk Scores" = Mk_Scores, "Mark Efficiency %" = Mk_Shot_Eff)

fksAllA  <- fksAllA %>% mutate_if(is.numeric, round, digits = 2)

fksAllA  %>%
  kbl(caption = "Frees and Attacking Marks Won", align = "c") %>%
  kable_minimal()


```

# All Place Ball Shots - Crokes

```{r, fig.width = 16, fig.height = 12}


ASA <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")
ASA <- ASA %>%group_by(Team, Action) %>% filter(Teamnum == "A", main == "Shot Rs Oc")%>%summarize(count=n())


ASA <- ASA %>% spread(Action,count)

ASA  %>%
  kbl(caption = "All Place Ball Shots - Crokes", align = "c") %>%
  kable_minimal()



```

```{r, fig.width = 16, fig.height = 12}

shotsA <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A", subset == "Shot Op"| subset == "Shot Rs")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "A",subsetoc %in% c ("Scr Rs", "Ms Rs"))

freeAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "A", Action %in% c ("Fk Pass"))

markAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "A",Action == "Mk Pass")


pthy +  
  geom_point(data = freeAmap, aes(x=Areax, y=Areay, colour = Action),alpha = 0.5, shape = 19, size = 7)  +
  labs(colour="Fk Won") +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  scale_colour_manual(values = runcolpal) +
  new_scale_color() + 
  geom_point(data = markAmap, aes(x=Areax, y=Areay, colour = Action),alpha = 0.5, shape = 19, size = 7)  +
  labs(colour="Att Mark Won") +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  scale_colour_manual(values = reccolply ) +
  new_scale_color() + 
  geom_point(data = shotsAScr, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsAScr, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
    #guides(color = FALSE, size = FALSE) +
labs(colour="Outcome", shape ="Shot Type", title = "Free Kicks and Attacking Marks") +
theme(plot.title=element_text(size=20, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 

   



```

# Frees and Attacking Marks Won - Judes

```{r, fig.width = 16, fig.height = 2}

ShotsBllB <- pass %>%group_by(Team)%>%filter(Teamnum == "B")

ShotsBll <-ShotsBllB %>%group_by(Team)%>%summarize(
   
  Att_Mark = sum (subset %in% c ("Att Mk Won")), 
  
  Mk_Shots = sum(Action %in% c("Mk Shot Left", "Mk Shot Right")), 
                                                                                         
  Mk_Scores = sum(Action %in% c("Mk Point", "Mk Goal")),Mk_Shot_Eff = (Mk_Scores/Mk_Shots *100),
  
  Free_Won = sum (main %in% c ("Free Won")), 
  
  Fk_Shots = sum(Action %in% c("Fk Shot Left", "Fk Shot Right")), 
                                                                                         
  Fk_Scores = sum(Action %in% c("Fk Point", "Fk Goal")),Fk_Shot_Eff = (Fk_Scores/Fk_Shots *100))


fksBllB  <- rename(ShotsBll, "Fk Shot Efficiency %" = Fk_Shot_Eff, "Frees Won" =  Free_Won,"Fk Shots" = Fk_Shots,"Fk Scores" = Fk_Scores, 
"Att Mark Won" =  Att_Mark,"Mark Shots" = Mk_Shots,"Mk Scores" = Mk_Scores, "Mark Efficiency %" = Mk_Shot_Eff)

fksBllB  <- fksBllB %>% mutate_if(is.numeric, round, digits = 2)

fksBllB  %>%
  kbl(caption = "Frees and Attacking Marks Won", align = "c") %>%
  kable_minimal()

```

# All Place Ball Shots - Judes

```{r, fig.width = 16, fig.height = 2}



BSB <- pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")
BSB <- BSB %>%group_by(Team, Action) %>% filter(Teamnum == "B", main == "Shot Rs Oc")%>%summarize(count=n())


BSB <- BSB %>% spread(Action,count)

BSB  %>%
  kbl(caption = "All Place Ball Shots - Judes", align = "c") %>%
  kable_minimal()



```

```{r, fig.width = 16, fig.height = 12}

shotsB <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B", subset == "Shot Op"| subset == "Shot Rs")

shotsAScr <- scores %>%group_by(Team, Action) %>% filter(Teamnum == "B",subsetoc %in% c ("Scr Rs", "Ms Rs"))

freeAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "B", Action %in% c ("Fk Pass"))

markAmap <-  pass %>%group_by(Team, Action) %>% filter(Teamnum == "B",Action == "Mk Pass")


pthy +  
  geom_point(data = freeAmap, aes(x=Areax, y=Areay, colour = Action),alpha = 0.5, shape = 19, size = 7)  +
  theme(legend.position="bottom") + 
  labs(colour="Fk Won") +
  scale_colour_manual(values = runcolpal) +
  new_scale_color() + 
     geom_point(data = markAmap, aes(x=Areax, y=Areay, colour = Action),alpha = 0.5, shape = 19, size = 7)  +
  theme(legend.position="bottom") + 
  labs(colour="Att Mark Won") +
  scale_colour_manual(values = reccolply ) +
  new_scale_color() + 
  geom_point(data = shotsAScr, aes(x=Areax, y=Areay, colour = Actionoc, shape = Action), size = 6) + 
   scale_colour_manual(values = colshotvertpal) +
  geom_text_repel(data = shotsAScr, aes(x=Areax, y=Areay, label = plylaboc, col = Actionoc), size = 6) +
    scale_shape_manual(values = colshotshape) +
labs(colour="Outcome", shape ="Shot Type", title = "Free Kicks and Attacking Marks") +
theme(plot.title=element_text(size=20, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 



```


# Kick Outs - Crokes  

```{r}
## Counts ##


sopA <- sop[sop$mainoc!="Half Time", ]
sopA <- sopA[sopA$mainoc!="Full Time", ]

PossorigKo <-filter(sopA, Teamnum == "A",main =="Ko")

kocnt <- PossorigKo %>% group_by(main) %>% summarise(count = n())
kooccnt <- PossorigKo %>% group_by(subsetoc) %>% summarise(count = n())

kooccnt <-  rename (kooccnt, "main" = subsetoc)

koorig <- bind_rows(kocnt,kooccnt)

koorig  <- koorig %>% pivot_wider(names_from = main,values_from = count)

koorig  %>%
  kbl(caption = "Outcome from Kick Outs - Crokes",align = "c") %>%
    kable_minimal()


```


```{r,fig.width = 16, fig.height = 12}

## Plot ##

komapArec <-filter(pass, Teamnum == "A",main =="Ko Rec"| subset =="Ko ToL")

#komapARec <-filter(pass, Teamnum == "A",main =="Ko Rec")

komapA <-filter(sop, Teamnum == "A",main =="Ko"|Pitch_Oc_Ko =="Ko Rec"|Pitch_Oc_Ko =="Ko ToL")

koeffA <- koeff %>%group_by(Zoneocthy,tx,ty,bx,by)%>%filter(Teamnum =="A") %>%summarize(Ko_Rec =sum(mainoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost))%>%select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneocthy)

koeffA = koeffA %>% 
  unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

#KoaveA <- sop %>% filter (Teamnum == "A",main== "Ko")
#KoaveAb <- KoaveA %>% group_by(Pitch_Area_Ko) %>% summarise(AreaxocKo = mean(Areaxoc,na.rm = TRUE), AreayocKo = mean(Areayoc,na.rm = TRUE))

pthy + 
  geom_text(data= koeffA, aes(x= tx, y=ty, label = korectol),colour = "white", size = 30,alpha=0.4) + 
  geom_point(data = komapA, aes(x=Ko_Zone_X, y=Ko_Zone_Y, colour = as.factor(Action), shape = as.factor(Pitch_Oc_Ko)), size = 6, stroke = 2)+
  scale_shape_manual(values= pals) +
  scale_colour_manual(values= perpal) +
  labs(colour="Ko Type") +
  new_scale_color() + 
  geom_text_repel(data = komapArec, aes(x=Areax, y=Areay, label = Action, col = as.factor(Action)),show.legend = FALSE, size = 6) +
  scale_colour_manual(values= pal) +
  guides(shape = FALSE, size = FALSE) +
  guides(colour = guide_legend(override.aes = list(size = 20)))+
  labs(title = "Kickouts - Crokes") +
   theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) + 
  theme(plot.title = element_text(hjust=0.5, size = 32)) +
  theme(legend.box="vertical", legend.margin=margin())



```


```{r}

## Team ## 

koA <- sop %>% filter (Teamnum == "A")

KoA <- koA %>%group_by(Team) %>% filter (main == "Ko")%>%summarize(Poss_Ko =sum(main %in% c("Ko")), Ko_Won =sum(Pitch_Oc_Ko %in% c("Ko Rec")),Ko_Perc = ((Ko_Won/Poss_Ko)*100), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),  Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")), Ko_Time = mean (Ko_Time))

KoA <- rename(KoA, "Kickouts" = Poss_Ko, " Ko Won" =  Ko_Won,"% Ko Won" = Ko_Perc,  "Time to Ko (secs)" =  Ko_Time )

KoA <- KoA %>% mutate_if(is.numeric, round, digits = 2)


KoA  %>%
kbl(caption = "Kick Outs - Crokes", align = "c") %>%
kable_minimal()


```



```{r}
 kobdA <-  sop %>% filter (main == "Ko", Teamnum == "A")

 kobdA <-  kobdA %>% group_by(Action) %>% count (subsetoc)
 
 
kobdA <- rename(kobdA, "Defence Setup" = Action, " Outcome" = subsetoc,"Total" = n)

 kobdA <-  kobdA  %>%
  kbl(caption = "Kick Out Outcomes by Type", align = "c") %>%
  kable_minimal() 
 
 kobdA

```



```{r, fig.width = 16, fig.height = 12}

sopa <- sop %>%group_by(Team, Action) %>% filter(Teamnum == "A",Pitch_Oc_Ko == "Ko Rec")


pthy + theme(legend.position="bottom") +
     geom_segment(data = sopa, aes(x=Poss_startx, y=Poss_starty, xend =Poss_endx, yend =Poss_endy, colour = as.factor(line_time)), size = 0.8,arrow = arrow(length = unit(0.8,"cm"))) +
    scale_colour_manual(values= actcolpals)+
   labs(colour = "Time(secs)") +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
     guides(shape = FALSE, size = FALSE) +
    new_scale_color() + 
  geom_point(data = sopa, aes(x=Poss_startx, y=Poss_starty, colour = main), size = 8,shape = 15) +
  geom_text(data = sopa, aes(x=Poss_startx, y=Poss_starty, label = possno), colour = "white", size = 6) +
  geom_point(data = sopa, aes(x=Poss_endx, y=Poss_endy, colour =subsetoc), size = 8, shape = 15) +
  geom_text (data = sopa, aes(x=Poss_endx, y=Poss_endy, label = possno), colour = "white", size = 6) +
  scale_colour_manual(values= startcolpal)+  scale_shape_manual(values= startshape) +
  labs(title = "Ko Possession Details - Crokes") +
  theme(plot.title = element_text(size=15, face="bold",hjust=0.5),legend.title= element_text(size=15, face="bold"))  +
   guides(shape = FALSE, size = FALSE) +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme(legend.box="vertical", legend.margin=margin()) +
    theme(legend.position="bottom") +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 
 

```



```{r, fig.width = 16, fig.height = 10}

Posstime  <- sop %>% filter(Teamnum == "A", main == "Ko") 

PosstimeAb  <- Posstime %>% group_by(Action,line_time, .drop = FALSE) %>% summarise(count = n())

ggplot(data = PosstimeAb, aes(x = Action, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
  xlab("Ko Type") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
  theme_bw() + theme (panel.grid.major = element_blank(),
                      panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
  scale_fill_manual(values= actcolpals) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
        axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
        legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
  labs( title = "Possession Duration from Kick Outs - Crokes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play



```{r}

#sopbdkoA <- sop %>% filter (Teamnum == "A", main == "Ko") %>% ungroup()%>% select(2,18,113,24,40,42,41,46,50:53,93)

sopbdkoA <- sop %>% filter (Teamnum == "A", main == "Ko") %>% ungroup()%>% select(2,18,113,24,40,42,41)


sopbdkoA <- rename(sopbdkoA, "Type" = subset, "Pitch Area Rec" = Pitch_Area_Ko,  "Outcome" = Actionoc,"No of Phases" = phno,  "Tot Time" = tot_poss_secs)

datatable(sopbdkoA,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```

* Tot Time = total time of possession including breaks in Play 

* Secs = Total Playing time of possession


# Kick Outs - Judes

```{r}
## Counts ##


sopA <- sop[sop$mainoc!="Half Time", ]
sopA <- sopA[sopA$mainoc!="Full Time", ]

PossorigKo <-filter(sopA, Teamnum == "B",main =="Ko")

kocnt <- PossorigKo %>% group_by(main) %>% summarise(count = n())
kooccnt <- PossorigKo %>% group_by(subsetoc) %>% summarise(count = n())

kooccnt <-  rename (kooccnt, "main" = subsetoc)

koorig <- bind_rows(kocnt,kooccnt)

koorigB  <- koorig %>% pivot_wider(names_from = main,values_from = count)

koorigB  %>%
  kbl(caption = "Outcome from Kick Outs - Judes",align = "c") %>%
    kable_minimal()


```


```{r,fig.width = 16, fig.height = 12}

## Plot ##

komapArec <-filter(pass, Teamnum == "B",main =="Ko Rec"| subset =="Ko ToL")

#komapARec <-filter(pass, Teamnum == "A",main =="Ko Rec")

komapA <-filter(sop, Teamnum == "B",main =="Ko"|Pitch_Oc_Ko =="Ko Rec"|Pitch_Oc_Ko =="Ko ToL")

koeffA <- koeff %>%group_by(Zoneocthy,tx,ty,bx,by)%>%filter(Teamnum =="B") %>%summarize(Ko_Rec =sum(mainoc == "Ko Rec"), Ko_Lost = sum(subsetoc == "Ko ToL"),Ko =(Ko_Rec  + Ko_Lost))%>%select(Ko_Rec,Ko_Lost,Ko,tx,ty,bx,by,Zoneocthy)

koeffA = koeffA %>% 
  unite(korectol, Ko_Rec, Ko, sep = "/", remove = FALSE)

#KoaveA <- sop %>% filter (Teamnum == "A",main== "Ko")
#KoaveAb <- KoaveA %>% group_by(Pitch_Area_Ko) %>% summarise(AreaxocKo = mean(Areaxoc,na.rm = TRUE), AreayocKo = mean(Areayoc,na.rm = TRUE))

pthy + 
  geom_text(data= koeffA, aes(x= tx, y=ty, label = korectol),colour = "white", size = 30,alpha=0.4) + 
  geom_point(data = komapA, aes(x=Ko_Zone_X, y=Ko_Zone_Y, colour = as.factor(Action), shape = as.factor(Pitch_Oc_Ko)), size = 6, stroke = 2)+
  scale_shape_manual(values= pals) +
  scale_colour_manual(values= perpal) +
  labs(colour="Ko Type") +
  new_scale_color() + 
  geom_text_repel(data = komapArec, aes(x=Areax, y=Areay, label = Action, col = as.factor(Action)),show.legend = FALSE, size = 6) +
  scale_colour_manual(values= pal) +
  guides(shape = FALSE, size = FALSE) +
  guides(colour = guide_legend(override.aes = list(size = 20)))+
  labs(title = "Kickouts - Judes") +
   theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) + 
  theme(plot.title = element_text(hjust=0.5, size = 32)) +
  theme(legend.box="vertical", legend.margin=margin())




```


```{r}

## Team ## 

koA <- sop %>% filter (Teamnum == "B")

KoA <- koA %>%group_by(Team) %>% filter (main == "Ko")%>%summarize(Poss_Ko =sum(main %in% c("Ko")), Ko_Won =sum(Pitch_Oc_Ko %in% c("Ko Rec")),Ko_Perc = ((Ko_Won/Poss_Ko)*100), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),  Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")), Ko_Time = mean (Ko_Time))

KoA <- rename(KoA, "Kickouts" = Poss_Ko, " Ko Won" =  Ko_Won,"% Ko Won" = Ko_Perc,  "Time to Ko (secs)" =  Ko_Time )

KoB <- KoA %>% mutate_if(is.numeric, round, digits = 2)


KoB  %>%
kbl(caption = "Kick Outs - Judes", align = "c") %>%
kable_minimal()




```

```{r}
 kobdA <-  sop %>% filter (main == "Ko", Teamnum == "B")

 kobdA <-  kobdA %>% group_by(Action) %>% count (subsetoc)
 
 kobdA <- rename(kobdA, "Defence Setup" = Action, " Outcome" = subsetoc,"Total" = n)

 kobdA <-  kobdA  %>%
  kbl(caption = "Kick Out Outcomes by Type", align = "c") %>%
  kable_minimal() 
 
 kobdA

```


```{r, fig.width = 16, fig.height = 12}

sopa <- sop %>%group_by(Team, Action) %>% filter(Teamnum == "B",Pitch_Oc_Ko == "Ko Rec")


pthy + theme(legend.position="bottom") +
     geom_segment(data = sopa, aes(x=Poss_startx, y=Poss_starty, xend =Poss_endx, yend =Poss_endy, colour = as.factor(line_time)), size = 0.8,arrow = arrow(length = unit(0.8,"cm"))) +
    scale_colour_manual(values= actcolpals)+
   labs(colour = "Time(secs)") +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
     guides(shape = FALSE, size = FALSE) +
    new_scale_color() + 
  geom_point(data = sopa, aes(x=Poss_startx, y=Poss_starty, colour = main), size = 8,shape = 15) +
  geom_text (data = sopa, aes(x=Poss_startx, y=Poss_starty, label = possno), colour = "white", size = 6) +
  geom_point(data = sopa, aes(x=Poss_endx, y=Poss_endy, colour =subsetoc), size = 8, shape = 15) +
  geom_text (data = sopa, aes(x=Poss_endx, y=Poss_endy, label = possno), colour = "white", size = 6) +
  scale_colour_manual(values= startcolpal)+  scale_shape_manual(values= startshape) +
  labs(title = "Ko Possession Details - Judes") +
  theme(plot.title = element_text(size=15, face="bold",hjust=0.5),legend.title= element_text(size=15, face="bold"))  +
   guides(shape = FALSE, size = FALSE) +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme(legend.box="vertical", legend.margin=margin()) +
    theme(legend.position="bottom")
 




```


```{r, fig.width = 16, fig.height = 10}

Posstime  <- sop %>% filter(Teamnum == "B", main == "Ko") 

PosstimeAb  <- Posstime %>% group_by(Action,line_time, .drop = FALSE) %>% summarise(count = n())

ggplot(data = PosstimeAb, aes(x = Action, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
  xlab("Ko Type") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
  theme_bw() + theme (panel.grid.major = element_blank(),
                      panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
  scale_fill_manual(values= actcolpals) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
        axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
        legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
  labs( title = "Possession Duration from Kick Outs - Judes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play




```{r}
#sopbdkoB <- sop %>% filter (Teamnum == "B", main == "Ko") %>% ungroup()%>% select(2,18,113,24,40,42,41,46,50:53,93)

sopbdkoB <- sop %>% filter (Teamnum == "B", main == "Ko") %>% ungroup()%>% select(2,18,113,24,40,42,41)


sopbdkoB <- rename(sopbdkoB, "Type" = subset, "Pitch Area Rec" = Pitch_Area_Ko,  "Outcome" = Actionoc,"No of Phases" = phno,  "Tot Time" = tot_poss_secs)


datatable(sopbdkoB,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```

* Tot Time = total time of possession including breaks in Play 

* Secs = Total Playing time of possession excluding breaks in Play


# Possession Won - Crokes

```{r,fig.width = 16, fig.height = 12}

sopA <- sop[sop$mainoc!="Half Time", ]
sopA <- sopA[sopA$mainoc!="Full Time", ]

PossorigPWohA <- sopA %>% filter(Teamnum == "A",main =="PW")

pwcntohA <- PossorigPWohA %>% group_by(main) %>% summarise(count = n())
pwoccntohA <- PossorigPWohA %>% group_by(subsetoc) %>% summarise(count = n())

pwoccntohA <-  rename (pwoccntohA, "main" = subsetoc)

pworigohA <- bind_rows(pwcntohA, pwoccntohA)

pworigohA <- pworigohA %>% pivot_wider(names_from = main,values_from = count)

pworigohA %>%kbl(align = "c") %>% kable_minimal()

```


```{r,fig.width = 16, fig.height = 12}

## Plot ## 

## Tackles by 30 zones ##

# Need to add spoils and def rec prs 

# Zone Counts 

actAcnt  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "A",main %in% c ("PW")) %>% summarise (count = n ())

actAcnt$Zonethy <- as.numeric(actAcnt$Zonethy)

actAcnt <-actAcnt %>%
    mutate(tx = VLOOKUP(Zonethy, zonetextthy, zone, tx),ty = VLOOKUP(Zonethy, zonetextthy, zone, ty),bx = VLOOKUP(Zonethy, zonetextthy, zone, bx),by = VLOOKUP(Zonethy,zonetextthy, zone, by))
    
# Shade

shdAcnt  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "A",main %in% c ("PW")) %>% summarise (count = n ())

shdAcnt$Zonethy <- as.numeric(shdAcnt$Zonethy)

shade <- shdAcnt %>%
    mutate(xa = VLOOKUP(Zonethy, thirtyzones, zone, xa),ya = VLOOKUP(Zonethy, thirtyzones, zone, ya),xb= VLOOKUP(Zonethy, thirtyzones, zone, xb),yb = VLOOKUP(Zonethy, thirtyzones, zone, yb))

#shade$count[is.na(shade$count)] <- 0

## Points ## 

actAcntfkl  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "A",main %in% c ("PW")) 


pwplotA <- pthy +   
  geom_rect(data=shade, mapping=aes(xmin=xa, xmax=xb, ymin=ya, ymax=yb, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
  scale_fill_gradient(low="lightgreen",high="darkgreen") + 
  geom_text(data= actAcnt, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) + 
  geom_point(data= actAcntfkl, aes(x= Areax, y=Areay, colour = subset),size = 8) +
  labs(colour="Outcome", title = "Possessions Won - Crokes") +
  theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20))

pwplotA 


```


```{r}
## Team ##

PWA <- sop %>% filter (Teamnum == "A")

PWA <- PWA %>%group_by(Team) %>% filter (main == "PW")%>%summarize(Poss_PW =sum(main %in% c("PW")), Poss_time =sum (secs/60), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),Shot_PP =(Shots/Poss_PW*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))

PWA  <- PWA  %>% mutate_at(vars(Poss_time, Shot_PP ,Shot_time), funs(round(., 0)))

PWA <- rename(PWA, "Possession Won" = Poss_PW, "Total Time (min)" = Poss_time, "% Shots per PW" = Shot_PP , "Shot Rate (secs)" = Shot_time )

PWA <- PWA %>% select (-Team)


PWA   %>%
kbl(caption = "Team Possession Won - Crokes", align = "c") %>%
kable_minimal()

```

```{r, fig.width = 16, fig.height = 12}

sopa <- sop %>%group_by(Team, Action) %>% filter(Teamnum == "A",Pitch_Oc_Ko == "PW")


pthy + theme(legend.position="bottom") +
     geom_segment(data = sopa, aes(x=Poss_startx, y=Poss_starty, xend =Poss_endx, yend =Poss_endy, colour = as.factor(line_time)), size = 0.8,arrow = arrow(length = unit(0.8,"cm"))) +
    scale_colour_manual(values= actcolpals)+
   labs(colour = "Time(secs)") +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
     guides(shape = FALSE, size = FALSE) +
    new_scale_color() + 
  geom_point(data = sopa, aes(x=Poss_startx, y=Poss_starty, colour = main),shape = 15, size = 8) +
  geom_text (data = sopa, aes(x=Poss_startx, y=Poss_starty, label = possno), colour = "white", size = 6) +
  geom_point(data = sopa, aes(x=Poss_endx, y=Poss_endy, colour =subsetoc),  shape = 15, size = 8) +
  geom_text (data = sopa, aes(x=Poss_endx, y=Poss_endy, label = possno), colour = "white", size = 6) +
  scale_colour_manual(values= startcolpal)+  scale_shape_manual(values= startshape) +
  labs(title = "PW Possession Details - Crokes") +
  theme(plot.title = element_text(size=15, face="bold",hjust=0.5),legend.title= element_text(size=15, face="bold"))  +
   guides(shape = FALSE, size = FALSE) +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme(legend.box="vertical", legend.margin=margin()) +
    theme(legend.position="bottom") +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 
 
```


```{r, fig.width = 16, fig.height = 10}

Posstime  <- sop %>% filter(Teamnum == "A", main == "PW") 

PosstimeAb  <- Posstime %>% group_by(Action,line_time, .drop = FALSE) %>% summarise(count = n())

ggplot(data = PosstimeAb, aes(x = Action, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
  xlab("PW Type") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
  theme_bw() + theme (panel.grid.major = element_blank(),
                      panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
  scale_fill_manual(values= actcolpals) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
        axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
        legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
  labs( title = "Possession Duration from Possession Won - Crokes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play



```{r}

#sopbdpwA <- sop %>% filter (Teamnum == "A", main == "PW") %>% ungroup()%>%  select(2,18,21,24,40,42,41,46,50:53,93)


sopbdpwA <- sop %>% filter (Teamnum == "A", main == "PW") %>% ungroup()%>%  select(2,18,21,24,40,42,41)

sopbdpwA <- rename(sopbdpwA, "Type" = subset, "Start Area" = Pitch_Area,  "Outcome" = Actionoc,"No of Phases" = phno,  "Tot Time" = tot_poss_secs)

datatable(sopbdpwA,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```

* Tot Time = total time of possession including breaks in Play 

* Secs = Total Playing time of possession excluding breaks in Play

# Possession Won - Judes

```{r,fig.width = 16, fig.height = 12}

sopA <- sop[sop$mainoc!="Half Time", ]
sopA <- sopA[sopA$mainoc!="Full Time", ]

PossorigPWohA <- sopA %>% filter(Teamnum == "B",main =="PW")

pwcntohA <- PossorigPWohA %>% group_by(main) %>% summarise(count = n())
pwoccntohA <- PossorigPWohA %>% group_by(subsetoc) %>% summarise(count = n())

pwoccntohA <-  rename (pwoccntohA, "main" = subsetoc)

pworigohA <- bind_rows(pwcntohA, pwoccntohA)

pworigohB <- pworigohA %>% pivot_wider(names_from = main,values_from = count)

pworigohB %>%kbl(align = "c") %>% kable_minimal()

```


```{r,fig.width = 16, fig.height = 12}

## Plot ## 

## Tackles by 30 zones ##

# Need to add spoils and def rec prs 

# Zone Counts 

actAcnt  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "B",main %in% c ("PW")) %>% summarise (count = n ())

actAcnt$Zonethy <- as.numeric(actAcnt$Zonethy)

actAcnt <-actAcnt %>%
    mutate(tx = VLOOKUP(Zonethy, zonetextthy, zone, tx),ty = VLOOKUP(Zonethy, zonetextthy, zone, ty),bx = VLOOKUP(Zonethy, zonetextthy, zone, bx),by = VLOOKUP(Zonethy,zonetextthy, zone, by))
    
# Shade

shdAcnt  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "B",main %in% c ("PW")) %>% summarise (count = n ())

shdAcnt$Zonethy <- as.numeric(shdAcnt$Zonethy)

shade <- shdAcnt %>%
    mutate(xa = VLOOKUP(Zonethy, thirtyzones, zone, xa),ya = VLOOKUP(Zonethy, thirtyzones, zone, ya),xb= VLOOKUP(Zonethy, thirtyzones, zone, xb),yb = VLOOKUP(Zonethy, thirtyzones, zone, yb))

#shade$count[is.na(shade$count)] <- 0

## Points ## 

actAcntfkl  <- pass %>% group_by (Zonethy) %>%filter(Teamnum == "B",main %in% c ("PW")) 


pwplotB <- pthy +   
  geom_rect(data=shade, mapping=aes(xmin=xa, xmax=xb, ymin=ya, ymax=yb, fill=as.numeric(count), alpha=0.2),show.legend = FALSE) +
  scale_fill_gradient(low="lightgreen",high="darkgreen") + 
  geom_text(data= actAcnt, aes(x= tx, y=ty, label = count),colour = "white", size = 30,alpha=0.4) + 
  geom_point(data= actAcntfkl, aes(x= Areax, y=Areay, colour = subset),size = 8) +
  labs(colour="Outcome", title = "Possessions Won - Judes") +
  theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black")) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20))


pwplotB 


```


```{r}
## Team ##

PWA <- sop %>% filter (Teamnum == "B")

PWA <- PWA %>%group_by(Team) %>% filter (main == "PW")%>%summarize(Poss_PW =sum(main %in% c("PW")), Poss_time =sum (secs/60), 
Shots = sum(mainoc %in% c("Shot Op Oc","Shot Rs Oc")),Shot_PP =(Shots/Poss_PW*100), Shot_time = sum(secs/Shots), Scores = sum(subsetoc %in% c("Scr Op","Scr Rs")))

PWA  <- PWA  %>% mutate_at(vars(Poss_time, Shot_PP ,Shot_time), funs(round(., 0)))

PWA <- rename(PWA, "Possession Won" = Poss_PW, "Total Time (min)" = Poss_time, "% Shots per PW" = Shot_PP , "Shot Rate (secs)" = Shot_time )

PWB <- PWA %>% select (-Team)


PWB   %>%
kbl(caption = "Team Possession Won", align = "c") %>%
kable_minimal()


```



```{r, fig.width = 16, fig.height = 12}

sopa <- sop %>%group_by(Team, Action) %>% filter(Teamnum == "B",Pitch_Oc_Ko == "PW")


pthy + theme(legend.position="bottom") +
     geom_segment(data = sopa, aes(x=Poss_startx, y=Poss_starty, xend =Poss_endx, yend =Poss_endy, colour = as.factor(line_time)), size = 0.8,arrow = arrow(length = unit(0.8,"cm"))) +
    scale_colour_manual(values= actcolpals)+
   labs(colour = "Time(secs)") +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
     guides(shape = FALSE, size = FALSE) +
    new_scale_color() + 
  geom_point(data = sopa, aes(x=Poss_startx, y=Poss_starty, colour = main), size = 8,shape = 15) +
  geom_text (data = sopa, aes(x=Poss_startx, y=Poss_starty, label = possno), colour = "white", size = 6) +
  geom_point(data = sopa, aes(x=Poss_endx, y=Poss_endy, colour =subsetoc), size = 8, shape = 15) +
  geom_text (data = sopa, aes(x=Poss_endx, y=Poss_endy, label = possno), colour = "white", size = 6) +
  scale_colour_manual(values= startcolpal)+  scale_shape_manual(values= startshape) +
  labs(title = "PW Possession Details - Judes") +
  theme(plot.title = element_text(size=15, face="bold",hjust=0.5),legend.title= element_text(size=15, face="bold"))  +
   guides(shape = FALSE, size = FALSE) +
    guides(colour = guide_legend(override.aes = list(size = 10))) +
    theme(legend.box="vertical", legend.margin=margin())  +
    theme(legend.position="bottom") +
   theme(plot.title = element_text(hjust=0.5, size = 32)) 
 


```

```{r, fig.width = 16, fig.height = 10}

Posstime  <- sop %>% filter(Teamnum == "B", main == "PW") 

PosstimeAb  <- Posstime %>% group_by(Action,line_time, .drop = FALSE) %>% summarise(count = n())

ggplot(data = PosstimeAb, aes(x = Action, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
  xlab("PW Type") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
  theme_bw() + theme (panel.grid.major = element_blank(),
                      panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
  scale_fill_manual(values= actcolpals) +
  theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
  theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
        axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
        legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
  labs( title = "Possession Duration from Possession Won - Judes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play



```{r}

#sopbdBpw <- sop %>% filter (Teamnum == "B", main == "PW") %>% ungroup()%>%  select(2,18,21,24,40,42,41,46,50:53,93)

sopbdBpw <- sop %>% filter (Teamnum == "B", main == "PW") %>% ungroup()%>%  select(2,18,21,24,40,42,41,46,50:53,93)

sopbdBpw <- rename(sopbdBpw, "Type" = subset, "Start Area" = Pitch_Area,  "Outcome" = Actionoc,"No of Phases" = phno,  "Tot Time" = tot_poss_secs)

datatable(sopbdBpw,options = list(pageLength = 5,lengthMenu = c(5, 10, 15, 20),columnDefs = 
                           list(list(className = 'dt-center', 
                                     targets = "_all"))),class = 'cell-border stripe', rownames = FALSE)

```

* Tot Time = total time of possession including breaks in Play 

* Secs = Total Playing time of possession excluding breaks in Play 


# Possession & Phase Duration

```{r, fig.width = 16, fig.height = 10}
PosstimeAb  <- sop %>% group_by(period,line_time, .drop = FALSE)%>% filter(Teamnum == "A") %>% summarise(count = n())

ggplot(data = PosstimeAb, aes(x = period, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
   xlab("Period") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
    theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
   scale_fill_manual(values= actcolpals) +
   theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
       axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
       legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
 labs( title = "Possession Duration - Crokes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play


```{r, fig.width = 16, fig.height = 10}

PosstimeBb  <- sop %>% group_by(period,line_time, .drop = FALSE)%>% filter(Teamnum == "B") %>% summarise(count = n())

ggplot(data = PosstimeBb, aes(x = period, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
   xlab("Period") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
    theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
   scale_fill_manual(values= actcolpals) +
   theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
       axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
       legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
 labs( title = "Possession Duration - Judes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```

* Duration (secs) = Total Playing time of possession excluding breaks in play

```{r, fig.width = 16, fig.height = 10}
PhasetimeAb  <- phasesop %>% group_by(period,line_time, .drop = FALSE)%>% filter(Teamnum == "A") %>% summarise(count = n())

ggplot(data = PhasetimeAb, aes(x = period, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
   xlab("Period") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
    theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
   scale_fill_manual(values= actcolpals) +
   theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
       axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
       legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
 labs( title = "Phase Duration - Crokes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))
```


```{r, fig.width = 16, fig.height = 10}

PhasetimeBb  <- phasesop %>% group_by(period,line_time, .drop = FALSE)%>% filter(Teamnum == "B") %>% summarise(count = n())

ggplot(data = PhasetimeBb, aes(x = period, y = count, fill = line_time)) + geom_bar(position="dodge", stat="identity") +
  labs(fill="Duration (secs)") +
   xlab("Period") +
  ylab("Possession") +
  geom_text(aes(label = count, group =line_time), color = "white", position = position_dodge(width = 1), size = 8) +
    theme_bw() + theme (panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) + theme(legend.position="bottom",panel.background = element_rect(fill = "grey47")) +
   scale_fill_manual(values= actcolpals) +
   theme(legend.box="vertical", legend.margin=margin()) +
  guides(shape = guide_legend(override.aes = list(size = 10)),colour = guide_legend(override.aes = list(size = 10))) +
 theme(axis.text.x = element_text( size = 20), axis.text.y = element_text( size = 20), 
       axis.title.x = element_text( size = 20), axis.title.y = element_text( size = 20),
       legend.position="bottom", legend.title=element_text(size=20),legend.text=element_text(size=20)) +
 labs( title = "Phase Duration - Judes") + theme(plot.title=element_text(size=32, hjust=0.5, face="bold", color="black"))

```



